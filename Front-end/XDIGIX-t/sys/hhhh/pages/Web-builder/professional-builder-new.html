<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="Professional drag-and-drop website builder with real-time editing, responsive design, and cloud sync capabilities.">
    <meta name="keywords" content="website builder, web design, drag and drop, responsive design, MADAS">
    <meta name="author" content="MADAS">
    <meta name="grammarly-disable-ghost" content="true">
    <meta name="grammarly-disable-indicator" content="true">
    <meta name="format-detection" content="telephone=no">
    <meta name="theme-color" content="#2563eb">
    <meta name="color-scheme" content="light">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="MADAS Professional Website Builder">
    <meta property="og:description" content="Build stunning websites with our professional drag-and-drop builder">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:title" content="MADAS Professional Website Builder">
    <meta property="twitter:description" content="Build stunning websites with our professional drag-and-drop builder">

    <title>MADAS Professional Website Builder | Create Beautiful Websites</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" media="print"
        onload="this.media='all'">

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-functions-compat.js"></script>

    <!-- Production Configuration -->
    <script src="config.js"></script>

    <script>
        // Firebase configuration - loaded from config.js
        const firebaseConfig = BuilderConfig.getFirebaseConfig();

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        window.auth = firebase.auth();
        window.db = firebase.firestore();
        window.functions = firebase.functions();

        // Set auth persistence to local
        window.auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL).catch((error) => {
            console.error('Firebase persistence error:', error);
        });

        // Make Firebase available globally
        window.firebase = firebase;

        console.log('Firebase initialized successfully');
    </script>

    <!-- Production Utilities -->
    <script src="js/production-utils.js"></script>

    <!-- Core Services -->
    <script src="js/bridge-service.js"></script>
    <script src="js/storage-service.js"></script>
    <script src="js/preview-service.js"></script>
    <script src="js/site-manager.js"></script>

    <!-- Initialization Script -->
    <script src="js/init.js"></script>
    <noscript>
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    </noscript>
    <style>
        :root {
            --nextgen-primary: #2563eb;
            --nextgen-secondary: #1e40af;
            --nextgen-accent: #3b82f6;
            --nextgen-dark: #1e293b;
            --nextgen-light: #f1f5f9;
            --nextgen-success: #10b981;
            --nextgen-warning: #f59e0b;
            --nextgen-error: #ef4444;

            /* MADAS Brand Colors - Official Guidelines */
            --madas-dark-moss: #2b4a24;
            --madas-pop-pink: #f0c9e0;
            --madas-deep-graphite: #171817;
            --madas-cloud-white: #f4f4f4;

            /* Secondary Colors */
            --madas-burnt-orange: #f05a2c;
            --madas-bolt-yellow: #fcdb11;
            --madas-electric-blue: #19a0cb;

            /* Brand Typography - Lama Sans */
            --madas-font-family: 'Lama Sans', 'Inter', sans-serif;
            --madas-font-weight-thin: 100;
            --madas-font-weight-light: 300;
            --madas-font-weight-normal: 400;
            --madas-font-weight-medium: 500;
            --madas-font-weight-semibold: 600;
            --madas-font-weight-bold: 700;
            --madas-font-weight-black: 900;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            margin: 0;
            padding: 0;
            background: #f8fafc;
            overflow: hidden;
            height: 100vh;
        }

        /* Font loading optimization */
        @font-face {
            font-family: 'Material Icons';
            font-style: normal;
            font-weight: 400;
            font-display: swap;
            src: url('https://fonts.gstatic.com/s/materialicons/v144/flUhRq6tzZclQEJ-Vdg-IuiaDsNcIhQ8tQ.woff2') format('woff2');
        }

        .builder-container {
            display: flex;
            height: 100vh;
        }

        /* Top Navigation */
        .top-nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: white;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 1000;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .nav-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #64748b;
            font-size: 14px;
        }

        .breadcrumb a {
            color: var(--nextgen-primary);
            text-decoration: none;
            cursor: pointer;
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .preview-modes {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            background: #f1f5f9;
            border-radius: 8px;
        }

        .preview-mode {
            padding: 6px 8px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #64748b;
        }

        .preview-mode.active {
            background: white;
            color: var(--nextgen-primary);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .action-buttons {
            display: flex;
            gap: 12px;
        }

        .btn {
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
        }

        .btn-secondary {
            background: white;
            color: #374151;
            border: 1px solid #d1d5db;
        }

        .btn-primary {
            background: var(--nextgen-primary);
            color: white;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            margin-top: 60px;
            margin-right: 300px;
            height: calc(100vh - 60px);
            overflow: hidden;
        }

        .canvas-area {
            flex: 1;
            background: #f8fafc;
            overflow-y: auto;
            overflow-x: hidden;
            position: relative;
            height: 100%;
        }

        .canvas-container {
            min-height: calc(100vh - 120px);
            max-height: calc(100vh - 120px);
            background: white;
            margin: 0;
            border-radius: 0;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow-y: auto;
            overflow-x: hidden;
        }

        /* Desktop styling for canvas container */
        @media (min-width: 1024px) {
            .canvas-container {
                margin: 20px;
                border-radius: 12px;
            }
        }

        /* Mobile and tablet - seamless */
        @media (max-width: 1023px) {
            .canvas-container {
                margin: 0;
                border-radius: 0;
            }
        }

        /* Right Panel */
        .right-panel {
            width: 300px;
            background: white;
            border-left: 1px solid #e2e8f0;
            overflow-y: auto;
            overflow-x: hidden;
            position: fixed;
            top: 60px;
            right: 0;
            height: calc(100vh - 60px);
            z-index: 100;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .main-content {
                margin-right: 250px;
            }

            .right-panel {
                width: 250px;
            }
        }

        @media (max-width: 768px) {
            .main-content {
                margin-right: 0;
                flex-direction: column;
            }

            .right-panel {
                width: 100%;
                position: relative;
                height: auto;
                max-height: 300px;
            }

            .canvas-container {
                min-height: calc(100vh - 200px);
                max-height: calc(100vh - 200px);
            }
        }

        .panel-header {
            padding: 20px;
            border-bottom: 1px solid #e2e8f0;
            background: #f8fafc;
        }

        .panel-title {
            font-size: 18px;
            font-weight: 600;
            color: #1e293b;
            margin: 0;
        }

        .add-section-btn {
            width: calc(100% - 40px);
            padding: 16px;
            background: #6366f1;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 16px;
            margin: 20px;
            transition: all 0.2s ease;
        }

        .add-section-btn:hover {
            background: #4f46e5;
            transform: translateY(-1px);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            width: 90%;
            max-width: 900px;
            height: 90vh;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            border: 1px solid #e5e7eb;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            padding: 32px 32px 24px;
            border-bottom: 1px solid #e2e8f0;
            position: relative;
            flex-shrink: 0;
        }

        .modal-title {
            font-size: 28px;
            font-weight: 700;
            color: #1e293b;
            margin: 0 0 8px 0;
        }

        .modal-subtitle {
            color: #64748b;
            font-size: 16px;
            margin: 0 0 24px 0;
        }

        .modal-close {
            position: absolute;
            top: 24px;
            right: 24px;
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #6b7280;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .modal-close:hover {
            background: #f3f4f6;
            color: #374151;
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #6b7280;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s ease;
        }

        .modal-close:hover {
            background: #f3f4f6;
            color: #374151;
        }

        .modal-body {
            padding: 32px;
            flex: 1;
            overflow-y: auto;
            min-height: 0;
        }

        .section-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .modal-body::-webkit-scrollbar {
            width: 6px;
        }

        .modal-body::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 3px;
        }

        .modal-body::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }

        .modal-body::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        .section-card {
            display: flex;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 16px;
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .section-card:hover {
            border-color: #6366f1;
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.15);
        }

        .section-preview {
            width: 200px;
            min-width: 200px;
            background: #f8fafc;
            border-right: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 16px;
        }

        .preview-mockup {
            width: 100%;
            max-width: 160px;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border: 1px solid #e5e7eb;
        }

        .section-details {
            flex: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .section-title {
            margin: 0 0 8px 0;
            font-size: 18px;
            font-weight: 600;
            color: #1e293b;
        }

        .section-description {
            margin: 0 0 16px 0;
            font-size: 14px;
            color: #64748b;
            line-height: 1.5;
        }

        .use-section-btn {
            align-self: flex-start;
            background: #1e293b;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .use-section-btn:hover {
            background: #374151;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .use-section-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* Section Styles */
        .canvas-section {
            margin: 0;
            border: 2px solid transparent;
            border-radius: 0;
            transition: all 0.2s ease;
            position: relative;
            cursor: move;
        }

        /* Desktop border radius for sections */
        @media (min-width: 1024px) {
            .canvas-section {
                border-radius: 12px;
                margin: 8px 0;
            }

            .canvas-section:first-child {
                margin-top: 0;
                border-top-left-radius: 12px;
                border-top-right-radius: 12px;
            }

            .canvas-section:last-child {
                margin-bottom: 0;
                border-bottom-left-radius: 12px;
                border-bottom-right-radius: 12px;
            }
        }

        /* Tablet and mobile - no border radius, seamless */
        @media (max-width: 1023px) {
            .canvas-section {
                border-radius: 0;
                margin: 0;
            }
        }

        .canvas-section:hover {
            border-color: var(--nextgen-primary);
        }

        .canvas-section.selected {
            border-color: var(--nextgen-primary);
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.2);
        }

        .section-controls {
            position: absolute;
            top: 8px;
            right: 8px;
            display: flex;
            gap: 4px;
            opacity: 0;
            transition: opacity 0.2s ease;
            z-index: 10;
        }

        .canvas-section:hover .section-controls {
            opacity: 1;
        }

        .canvas-section.selected .section-controls {
            opacity: 1;
        }

        .section-control-btn {
            width: 24px;
            height: 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            transition: all 0.2s ease;
        }

        .delete-section-btn {
            background: #ef4444;
            color: white;
            cursor: pointer;
            pointer-events: auto;
        }

        .delete-section-btn:hover {
            background: #dc2626;
            transform: scale(1.1);
        }

        .delete-section-btn:active {
            transform: scale(0.95);
        }

        .canvas-section.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
            z-index: 1000;
        }

        .canvas-section.drag-over {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.1);
        }

        .drag-handle {
            position: absolute;
            top: 8px;
            left: 8px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            cursor: move;
            opacity: 0;
            transition: opacity 0.2s ease;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .canvas-section:hover .drag-handle {
            opacity: 1;
        }

        /* Component Editor Styles */
        .component-editor {
            display: none;
        }

        .component-editor.active {
            display: block;
        }

        .editor-form {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .form-label {
            font-size: 14px;
            font-weight: 500;
            color: #374151;
        }

        .form-input {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--nextgen-primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .form-textarea {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            resize: vertical;
            min-height: 80px;
            transition: all 0.2s ease;
        }

        .form-textarea:focus {
            outline: none;
            border-color: var(--nextgen-primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .form-range {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #e2e8f0;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }

        .form-range::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--nextgen-primary);
            cursor: pointer;
        }

        .form-range::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--nextgen-primary);
            cursor: pointer;
            border: none;
        }

        .range-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .range-value {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: #6b7280;
            font-weight: 500;
        }

        .color-picker {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Enhanced Editor Styles */
        .editor-section {
            margin-bottom: 24px;
            padding: 16px;
            background: #f8fafc;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }

        .editor-section-title {
            margin: 0 0 16px 0;
            font-size: 16px;
            font-weight: 600;
            color: #1e293b;
            border-bottom: 2px solid #3b82f6;
            padding-bottom: 8px;
        }

        .form-textarea {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            resize: vertical;
            min-height: 80px;
        }

        .form-select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            background: white;
            cursor: pointer;
        }

        .form-select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .color-input {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        .color-input::-webkit-color-swatch-wrapper {
            padding: 0;
        }

        .color-input::-webkit-color-swatch {
            border: none;
            border-radius: 4px;
        }

        /* Navbar Editor Styles */
        .menu-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 12px;
            margin: 4px 0;
            background: #ffffff;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
        }

        .menu-item-text {
            font-weight: 500;
            color: #1e293b;
        }

        .menu-item-collection {
            font-size: 12px;
            color: #6b7280;
            background: #f3f4f6;
            padding: 2px 8px;
            border-radius: 4px;
        }

        .btn-remove-menu-item {
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-remove-menu-item:hover {
            background: #dc2626;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 14px;
            color: #374151;
        }

        .checkbox-label input[type="checkbox"] {
            margin-right: 8px;
            width: 16px;
            height: 16px;
        }

        /* Mobile Menu Toggle Button */
        .navbar-mobile-toggle {
            display: none;
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
            border-radius: 4px;
            transition: background 0.2s ease;
            margin-left: 8px;
            min-width: 40px;
            height: 40px;
            align-items: center;
            justify-content: center;
        }

        .navbar-mobile-toggle:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .navbar-mobile-toggle .material-icons {
            font-size: 24px;
        }

        /* Mobile Search Bar */
        .navbar-mobile-search {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: #1e293b;
            padding: 16px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            z-index: 1000;
        }

        .navbar-mobile-search.active {
            display: block !important;
        }

        .navbar-mobile-search input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 16px;
            outline: none;
        }

        .navbar-mobile-search input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .navbar-mobile-search input:focus {
            border-color: #6366f1;
            background: rgba(255, 255, 255, 0.15);
        }

        /* Responsive navbar styles */
        @media (max-width: 768px) {

            /* Hide desktop menu, show mobile toggle */
            .navbar-menu {
                display: none !important;
            }

            .navbar-mobile-toggle {
                display: flex !important;
            }

            /* Adjust navbar layout */
            .navbar-container {
                padding: 10px 14px !important;
            }

            .navbar-left {
                gap: 12px !important;
            }

            .navbar-logo {
                width: 32px !important;
                height: 32px !important;
                font-size: 12px !important;
            }

            .navbar-icons {
                gap: 2px !important;
                margin-right: 8px !important;
            }

            .navbar-icon {
                min-width: 36px !important;
                height: 36px !important;
                padding: 8px !important;
                margin: 0 2px !important;
            }

            .navbar-icon .material-icons {
                font-size: 18px !important;
            }

            /* Hide search icon on mobile - it becomes a search bar */
            .navbar-search {
                display: none !important;
            }

            .navbar-buttons {
                gap: 8px !important;
            }

            .navbar-btn-primary,
            .navbar-btn-secondary {
                padding: 6px 12px !important;
                font-size: 14px !important;
            }

            /* Mobile menu dropdown */
            .navbar-mobile-menu {
                display: none;
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                background: #1e293b;
                border-top: 1px solid rgba(255, 255, 255, 0.1);
                padding: 16px;
                flex-direction: column;
                gap: 12px;
                z-index: 1000;
            }

            .navbar-mobile-menu.active {
                display: flex !important;
            }

            .navbar-mobile-menu .navbar-link {
                padding: 12px 0;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
                text-align: center;
            }

            .navbar-mobile-menu .navbar-link:last-child {
                border-bottom: none;
            }
        }

        @media (max-width: 480px) {

            /* Extra small mobile adjustments */
            .navbar-container {
                padding: 8px 12px !important;
            }

            .navbar-left {
                gap: 8px !important;
            }

            .navbar-logo {
                width: 28px !important;
                height: 28px !important;
                font-size: 10px !important;
            }

            .navbar-actions {
                gap: 4px !important;
            }

            .navbar-icons {
                margin-right: 4px !important;
            }

            .navbar-icon {
                min-width: 32px !important;
                height: 32px !important;
                padding: 6px !important;
                margin: 0 1px !important;
            }

            .navbar-icon .material-icons {
                font-size: 16px !important;
            }

            .navbar-buttons {
                gap: 4px !important;
            }

            .navbar-btn-primary,
            .navbar-btn-secondary {
                padding: 4px 8px !important;
                font-size: 12px !important;
            }

            /* Hide some icons on very small screens */
            .navbar-icon:nth-child(n+4) {
                display: none !important;
            }
        }

        @media (max-width: 360px) {

            /* Ultra small screens */
            .navbar-container {
                padding: 6px 8px !important;
            }

            .navbar-logo {
                width: 24px !important;
                height: 24px !important;
                font-size: 8px !important;
            }

            .navbar-icon {
                min-width: 28px !important;
                height: 28px !important;
                padding: 4px !important;
            }

            .navbar-icon .material-icons {
                font-size: 14px !important;
            }

            .navbar-btn-primary,
            .navbar-btn-secondary {
                padding: 3px 6px !important;
                font-size: 10px !important;
            }

            /* Show only essential icons */
            .navbar-icon:not(:first-child):not(:nth-child(2)) {
                display: none !important;
            }
        }

        /* Preview Mode Responsive Styles */
        /* Tablet Preview Mode */
        .preview-tablet .navbar-menu {
            display: none !important;
        }

        .preview-tablet .navbar-mobile-toggle {
            display: flex !important;
        }

        .preview-tablet .navbar-search {
            display: none !important;
        }

        .preview-tablet .navbar-search-container {
            display: none !important;
        }

        .preview-tablet #mobile-menu-button {
            display: flex !important;
        }

        .preview-tablet #mobile-menu-button.hidden {
            display: flex !important;
        }

        .preview-tablet .navbar-actions-container {
            display: flex !important;
        }

        .preview-tablet .navbar-mobile-menu {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: #1e293b;
            padding: 16px;
            flex-direction: column;
            gap: 12px;
            z-index: 1000;
        }

        .preview-tablet .navbar-mobile-menu.active {
            display: flex !important;
        }

        .preview-tablet #mobile-menu {
            display: none !important;
        }

        .preview-tablet #mobile-menu:not(.hidden) {
            display: block !important;
        }

        .preview-tablet .navbar-container {
            padding: 12px 16px;
        }

        .preview-tablet .navbar-left {
            gap: 8px;
        }

        .preview-tablet .navbar-logo {
            font-size: 18px;
        }

        .preview-tablet .navbar-icons {
            gap: 4px;
            margin-right: 8px;
        }

        .preview-tablet .navbar-icon {
            width: 32px;
            height: 32px;
            padding: 4px;
            margin: 0 2px;
            font-size: 16px;
        }

        .preview-tablet .navbar-buttons {
            gap: 6px;
        }

        .preview-tablet .navbar-btn-primary,
        .preview-tablet .navbar-btn-secondary {
            padding: 6px 12px;
            font-size: 12px;
        }

        /* Tablet responsive adjustments */
        .preview-tablet .container {
            max-width: 768px !important;
            padding: 0 16px !important;
        }

        .preview-tablet .grid {
            grid-template-columns: repeat(2, 1fr) !important;
            gap: 16px !important;
        }

        .preview-tablet .text-4xl {
            font-size: 2.5rem !important;
        }

        .preview-tablet .text-6xl {
            font-size: 3.5rem !important;
        }

        /* Mobile Preview Mode */
        .preview-mobile .navbar-menu {
            display: none !important;
        }

        .preview-mobile .navbar-mobile-toggle {
            display: flex !important;
        }

        .preview-mobile .navbar-search {
            display: none !important;
        }

        .preview-mobile .navbar-search-container {
            display: none !important;
        }

        .preview-mobile #mobile-menu-button {
            display: flex !important;
        }

        .preview-mobile #mobile-menu-button.hidden {
            display: flex !important;
        }

        .preview-mobile .navbar-actions-container {
            display: flex !important;
        }

        .preview-mobile .navbar-mobile-menu {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: #1e293b;
            padding: 16px;
            flex-direction: column;
            gap: 12px;
            z-index: 1000;
        }

        .preview-mobile .navbar-mobile-menu.active {
            display: flex !important;
        }

        .preview-mobile #mobile-menu {
            display: none !important;
        }

        .preview-mobile #mobile-menu:not(.hidden) {
            display: block !important;
        }

        .preview-mobile .navbar-container {
            padding: 8px 12px;
        }

        .preview-mobile .navbar-left {
            gap: 8px;
        }

        .preview-mobile .navbar-logo {
            font-size: 16px;
        }

        .preview-mobile .navbar-icons {
            gap: 4px;
            margin-right: 8px;
        }

        .preview-mobile .navbar-icon {
            width: 28px;
            height: 28px;
            padding: 2px;
            margin: 0 1px;
            font-size: 14px;
        }

        .preview-mobile .navbar-buttons {
            gap: 6px;
        }

        .preview-mobile .navbar-btn-primary,
        .preview-mobile .navbar-btn-secondary {
            padding: 4px 8px;
            font-size: 11px;
        }

        /* Mobile responsive adjustments */
        .preview-mobile .container {
            max-width: 375px !important;
            padding: 0 12px !important;
        }

        .preview-mobile .grid {
            grid-template-columns: 1fr !important;
            gap: 12px !important;
        }

        .preview-mobile .text-4xl {
            font-size: 2rem !important;
        }

        .preview-mobile .text-6xl {
            font-size: 2.5rem !important;
        }

        .preview-mobile .text-xl {
            font-size: 1.125rem !important;
        }

        .preview-mobile .py-16 {
            padding-top: 2rem !important;
            padding-bottom: 2rem !important;
        }

        .preview-mobile .px-4 {
            padding-left: 1rem !important;
            padding-right: 1rem !important;
        }

        /* Enhanced mobile and tablet preview styles */
        .preview-tablet .canvas-section,
        .preview-mobile .canvas-section {
            border-radius: 8px;
            overflow: hidden;
        }

        .preview-mobile .canvas-section {
            border-radius: 12px;
        }

        /* Mobile-specific button and form adjustments */
        .preview-mobile button {
            min-height: 44px !important;
            font-size: 16px !important;
        }

        .preview-mobile input,
        .preview-mobile textarea,
        .preview-mobile select {
            min-height: 44px !important;
            font-size: 16px !important;
        }

        /* Touch-friendly spacing */
        .preview-mobile .space-x-4>*+* {
            margin-left: 0.75rem !important;
        }

        .preview-mobile .space-y-4>*+* {
            margin-top: 0.75rem !important;
        }

        /* Mobile and Tablet Navigation Specific Styles */
        .preview-mobile .navbar-container,
        .preview-tablet .navbar-container {
            padding: 10px 14px !important;
        }

        .preview-mobile .navbar-logo-text {
            font-size: 18px !important;
        }

        .preview-tablet .navbar-logo-text {
            font-size: 20px !important;
        }

        .preview-mobile .navbar-actions-container {
            gap: 4px !important;
        }

        .preview-tablet .navbar-actions-container {
            gap: 6px !important;
        }

        /* Smaller icons for mobile and tablet */
        .preview-mobile .navbar-favorite-btn,
        .preview-mobile .navbar-cart-btn,
        .preview-mobile .navbar-profile-btn {
            padding: 1px !important;
        }

        .preview-mobile .navbar-favorite-btn .material-icons,
        .preview-mobile .navbar-cart-btn .material-icons,
        .preview-mobile .navbar-profile-btn .material-icons {
            font-size: 18px !important;
        }

        .preview-mobile .navbar-favorite-btn span:last-child,
        .preview-mobile .navbar-cart-btn span:last-child {
            width: 12px !important;
            height: 12px !important;
            font-size: 8px !important;
        }

        .preview-tablet .navbar-favorite-btn,
        .preview-tablet .navbar-cart-btn,
        .preview-tablet .navbar-profile-btn {
            padding: 1.5px !important;
        }

        .preview-tablet .navbar-favorite-btn .material-icons,
        .preview-tablet .navbar-cart-btn .material-icons,
        .preview-tablet .navbar-profile-btn .material-icons {
            font-size: 20px !important;
        }

        .preview-tablet .navbar-favorite-btn span:last-child,
        .preview-tablet .navbar-cart-btn span:last-child {
            width: 14px !important;
            height: 14px !important;
            font-size: 9px !important;
        }

        /* Ensure mobile menu button is properly sized */
        .preview-mobile #mobile-menu-button,
        .preview-tablet #mobile-menu-button {
            width: 36px !important;
            height: 36px !important;
            padding: 6px !important;
        }

        .preview-mobile #mobile-menu-button .material-icons,
        .preview-tablet #mobile-menu-button .material-icons {
            font-size: 18px !important;
        }

        /* Mobile menu dropdown styling */
        .preview-mobile #mobile-menu,
        .preview-tablet #mobile-menu {
            background: white !important;
            border-top: 1px solid #e5e7eb !important;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1) !important;
        }

        /* Ensure mobile menu is properly positioned and visible */
        #mobile-menu {
            position: relative !important;
            z-index: 50 !important;
        }

        #mobile-menu.hidden {
            display: none !important;
        }

        #mobile-menu:not(.hidden) {
            display: block !important;
        }

        /* Ensure mobile menu is properly positioned and visible */
        #mobile-menu {
            position: relative !important;
            z-index: 1000 !important;
            background: white !important;
            border-top: 1px solid #e5e7eb !important;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1) !important;
        }

        /* Mobile menu visibility in published version */
        @media (max-width: 1023px) {
            #mobile-menu {
                display: block !important;
            }

            #mobile-menu.hidden {
                display: none !important;
            }
        }

        /* Hide mobile menu on desktop in published version */
        @media (min-width: 1024px) {
            #mobile-menu {
                display: none !important;
            }
        }

        /* Mobile menu button styling */
        #mobile-menu-button {
            cursor: pointer !important;
            transition: all 0.2s ease !important;
            z-index: 100 !important;
            position: relative !important;
        }

        #mobile-menu-button:hover {
            background-color: #f3f4f6 !important;
        }

        #mobile-menu-button:active {
            transform: scale(0.95) !important;
        }

        /* Ensure mobile menu button is visible on mobile devices in published version */
        @media (max-width: 1023px) {
            #mobile-menu-button {
                display: flex !important;
                visibility: visible !important;
                opacity: 1 !important;
            }
        }

        /* Hide mobile menu button on desktop in published version */
        @media (min-width: 1024px) {
            #mobile-menu-button {
                display: none !important;
            }
        }

        /* Ensure mobile menu button is always visible in preview modes */
        .preview-mobile #mobile-menu-button,
        .preview-tablet #mobile-menu-button {
            display: flex !important;
            visibility: visible !important;
            opacity: 1 !important;
        }

        /* Force mobile menu button to be visible in all preview modes */
        .preview-mobile #mobile-menu-button.hidden,
        .preview-tablet #mobile-menu-button.hidden {
            display: flex !important;
        }

        /* Ensure mobile menu is properly styled and visible when opened */
        .preview-mobile #mobile-menu:not(.hidden),
        .preview-tablet #mobile-menu:not(.hidden) {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }

        /* Additional responsive styles for other sections in preview modes */
        .preview-tablet .hero-section,
        .preview-mobile .hero-section {
            padding: 40px 20px;
        }

        .preview-tablet .hero-section h1,
        .preview-mobile .hero-section h1 {
            font-size: 2.5rem;
        }

        .preview-mobile .hero-section h1 {
            font-size: 2rem;
        }

        .preview-tablet .hero-section p,
        .preview-mobile .hero-section p {
            font-size: 1.1rem;
        }

        .preview-mobile .hero-section p {
            font-size: 1rem;
        }

        .preview-tablet .product-grid,
        .preview-mobile .product-grid {
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }

        .preview-mobile .product-grid {
            grid-template-columns: 1fr;
            gap: 12px;
        }

        .preview-tablet .feature-grid,
        .preview-mobile .feature-grid {
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .preview-mobile .feature-grid {
            grid-template-columns: 1fr;
            gap: 16px;
        }

        .preview-tablet .testimonial-grid,
        .preview-mobile .testimonial-grid {
            grid-template-columns: 1fr;
            gap: 20px;
        }

        .preview-mobile .testimonial-grid {
            gap: 16px;
        }

        /* MADAS Navbar Styles */
        .nav-link {
            font-weight: var(--madas-font-weight-medium);
            transition: color 0.3s ease;
            text-transform: uppercase;
        }

        .nav-link:hover {
            color: var(--madas-pop-pink);
        }

        .search-input {
            border: 1px solid #e5e7eb;
            transition: border-color 0.3s ease;
        }

        .search-input:focus {
            border-color: var(--madas-pop-pink);
            outline: none;
        }

        /* Hero Slider Styles */
        .hero-slider {
            position: relative;
            height: 400px;
            overflow: hidden;
        }

        .slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .slide.active {
            opacity: 1;
            transform: translateX(0);
        }

        .slide.prev {
            transform: translateX(-100%);
        }

        .slider-dot.active {
            background-color: var(--madas-pop-pink) !important;
            transform: scale(1.2);
        }

        .slider-control:hover {
            transform: scale(1.1);
        }

        @media (max-width: 768px) {
            .hero-slider {
                height: 300px;
            }

            .slide h1 {
                font-size: 2.5rem !important;
            }

            .slide p {
                font-size: 1.25rem !important;
            }
        }

        /* Rich Text Editor Styles */
        .rich-text-editor {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
        }

        .rich-text-toolbar {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            background: #f9fafb;
            border-bottom: 1px solid #e5e7eb;
            gap: 4px;
            flex-wrap: wrap;
        }

        .rich-text-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            border: none;
            background: transparent;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .rich-text-btn:hover {
            background: #e5e7eb;
        }

        .rich-text-btn.active {
            background: #3b82f6;
            color: white;
        }

        .rich-text-separator {
            width: 1px;
            height: 24px;
            background: #d1d5db;
            margin: 0 4px;
        }

        .rich-text-color {
            width: 32px;
            height: 32px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .rich-text-select {
            padding: 4px 8px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            background: white;
            font-size: 12px;
        }

        .rich-text-content {
            min-height: 100px;
            padding: 12px;
            background: white;
            outline: none;
            font-family: inherit;
        }

        .rich-text-content:focus {
            outline: none;
        }

        /* Slide Management Styles */
        .slides-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
        }

        .slide-item {
            border-bottom: 1px solid #e5e7eb;
            padding: 12px;
        }

        .slide-item:last-child {
            border-bottom: none;
        }

        .slide-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .slide-number {
            font-weight: 600;
            color: #374151;
        }

        .slide-item-controls {
            display: flex;
            gap: 8px;
        }

        .btn-edit-slide,
        .btn-remove-slide {
            padding: 4px 8px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            background: white;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
        }

        .btn-edit-slide:hover {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }

        .btn-remove-slide:hover {
            background: #ef4444;
            color: white;
            border-color: #ef4444;
        }

        .slide-preview {
            background: #f9fafb;
            border-radius: 4px;
            padding: 8px;
        }

        .slide-preview-content {
            font-size: 12px;
        }

        .slide-preview-title {
            font-weight: 600;
            color: #374151;
            margin-bottom: 4px;
        }

        .slide-preview-subtitle {
            color: #6b7280;
        }

        .btn-add-slide {
            width: 100%;
            padding: 12px;
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            background: transparent;
            color: #6b7280;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
        }

        .btn-add-slide:hover {
            border-color: #3b82f6;
            color: #3b82f6;
            background: #eff6ff;
        }

        .btn-save-slide {
            width: 100%;
            padding: 12px;
            background: #10b981;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.2s ease;
        }

        .btn-save-slide:hover {
            background: #059669;
        }

        .btn-success {
            background: #10b981;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-info {
            background: #06b6d4;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
        }

        .btn-info:hover {
            background: #0891b2;
        }

        /* Preview Status Styles */
        .preview-status {
            position: absolute;
            top: 70px;
            right: 20px;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            z-index: 1001;
            transition: all 0.3s ease;
        }

        .preview-status-inactive {
            background: #f3f4f6;
            color: #6b7280;
        }

        .preview-status-active {
            background: #dbeafe;
            color: #1d4ed8;
        }

        .preview-status-expired {
            background: #fef3c7;
            color: #d97706;
        }

        /* Save Status Styles */
        .save-status {
            position: absolute;
            top: 100px;
            right: 20px;
            padding: 6px 10px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 500;
            z-index: 1001;
            transition: all 0.3s ease;
        }

        .save-status-saved {
            background: #d1fae5;
            color: #065f46;
        }

        .save-status-unsaved-changes {
            background: #fef3c7;
            color: #d97706;
        }

        .save-status-auto-saved {
            background: #dbeafe;
            color: #1d4ed8;
        }

        .save-status-save-failed {
            background: #fee2e2;
            color: #dc2626;
        }

        /* Preview Button Active State */
        .preview-active {
            background: #059669 !important;
        }

        .preview-active:hover {
            background: #047857 !important;
        }

        /* Storage Status Styles */
        .storage-status {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 6px 10px;
            background: #f3f4f6;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            color: #6b7280;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .storage-status:hover {
            background: #e5e7eb;
        }

        .storage-status.warning {
            background: #fef3c7;
            color: #d97706;
        }

        .storage-status.danger {
            background: #fee2e2;
            color: #dc2626;
        }

        .storage-status .material-icons {
            font-size: 16px;
        }

        /* Builder Message Styles */
        .builder-message {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 10000;
            max-width: 400px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            animation: slideInRight 0.3s ease-out;
        }

        .builder-message-success {
            background: #d1fae5;
            border: 1px solid #10b981;
            color: #065f46;
        }

        .builder-message-error {
            background: #fee2e2;
            border: 1px solid #ef4444;
            color: #dc2626;
        }

        .builder-message-info {
            background: #dbeafe;
            border: 1px solid #3b82f6;
            color: #1d4ed8;
        }

        .message-content {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            gap: 8px;
        }

        .message-icon {
            font-size: 20px;
            flex-shrink: 0;
        }

        .message-text {
            flex: 1;
            font-size: 14px;
            font-weight: 500;
        }

        .message-close {
            background: none;
            border: none;
            color: inherit;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0.7;
            transition: opacity 0.2s ease;
        }

        .message-close:hover {
            opacity: 1;
        }

        .message-close .material-icons {
            font-size: 16px;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .image-preview {
            margin-top: 8px;
            max-width: 200px;
            max-height: 150px;
            border-radius: 4px;
            overflow: hidden;
        }

        .image-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Announcement Bar Animations */
        @keyframes slideInFromTop {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }
        }

        @keyframes bounce {

            0%,
            20%,
            50%,
            80%,
            100% {
                transform: translateY(0);
            }

            40% {
                transform: translateY(-10px);
            }

            60% {
                transform: translateY(-5px);
            }
        }

        @keyframes shimmer {
            0% {
                background-position: -200px 0;
            }

            100% {
                background-position: calc(200px + 100%) 0;
            }
        }

        .announcement-bar-animated {
            animation: slideInFromTop 0.8s ease-out;
        }

        .announcement-bar-pulse {
            animation: pulse 2s infinite;
        }

        .announcement-bar-bounce {
            animation: bounce 2s infinite;
        }

        .announcement-bar-shimmer {
            background: linear-gradient(90deg, #1e293b 0%, #334155 50%, #1e293b 100%);
            background-size: 200px 100%;
            animation: shimmer 3s infinite;
        }

        /* Enhanced Section Previews */
        .section-card {
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .section-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
            border-color: var(--nextgen-primary);
        }

        .section-preview {
            position: relative;
            overflow: hidden;
        }

        .section-preview::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.5s;
        }

        .section-card:hover .section-preview::before {
            left: 100%;
        }

        .preview-mockup {
            transition: transform 0.3s ease;
        }

        .section-card:hover .preview-mockup {
            transform: scale(1.02);
        }

        .use-section-btn {
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .use-section-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .use-section-btn:hover::before {
            left: 100%;
        }

        .use-section-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }

        .checkmark {
            margin-left: 8px;
        }

        .btn-group {
            display: flex;
            gap: 8px;
            margin-top: 16px;
        }

        .btn-small {
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
        }

        .btn-small-primary {
            background: var(--nextgen-primary);
            color: white;
        }

        .btn-small-secondary {
            background: #f3f4f6;
            color: #374151;
            border: 1px solid #d1d5db;
        }

        .btn-small-danger {
            background: #dc2626;
            color: white;
        }

        .btn-small-danger:hover {
            background: #b91c1c;
        }

        .btn-small:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* Left Sidebar Styles - Zammit Style */
        .left-sidebar {
            width: 60px;
            background: #1e293b;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px 0;
            gap: 16px;
            position: relative;
            z-index: 100;
            border-right: 1px solid #374151;
        }

        .sidebar-icon {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #94a3b8;
            position: relative;
        }

        .sidebar-icon:hover {
            background: #374151;
            color: white;
            transform: scale(1.05);
        }

        .sidebar-icon.active {
            background: var(--nextgen-primary);
            color: white;
        }

        .sidebar-icon .material-icons {
            font-size: 20px;
        }

        /* Tooltip styling for sidebar icons */
        .sidebar-icon[title]:hover::after {
            content: attr(title);
            position: absolute;
            left: 65px;
            top: 50%;
            transform: translateY(-50%);
            background: #1e293b;
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 1000;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            border: 1px solid #374151;
        }

        .sidebar-icon[title]:hover::before {
            content: '';
            position: absolute;
            left: 60px;
            top: 50%;
            transform: translateY(-50%);
            border: 5px solid transparent;
            border-right-color: #1e293b;
            z-index: 1000;
        }

        .section-controls {
            position: absolute;
            top: -12px;
            right: -12px;
            background: var(--nextgen-primary);
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.2s ease;
            font-size: 14px;
        }

        .canvas-section:hover .section-controls {
            opacity: 1;
        }

        /* Spacing Control Modal */
        .spacing-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .spacing-modal.active {
            display: flex;
        }

        .spacing-modal-content {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
            padding: 24px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        .spacing-controls {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .spacing-slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #e2e8f0;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }

        .spacing-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--nextgen-primary);
            cursor: pointer;
        }

        .spacing-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--nextgen-primary);
            cursor: pointer;
            border: none;
        }

        .spacing-value {
            text-align: center;
            font-weight: 600;
            color: var(--nextgen-primary);
            font-size: 18px;
        }

        .spacing-presets {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        .spacing-preset {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            background: white;
            cursor: pointer;
            text-align: center;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .spacing-preset:hover {
            border-color: var(--nextgen-primary);
            background: #f8fafc;
        }

        .spacing-preset.active {
            border-color: var(--nextgen-primary);
            background: var(--nextgen-primary);
            color: white;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .right-panel {
                width: 250px;
            }

            .main-content {
                margin-right: 250px;
            }

            .section-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 1024px) {
            .right-panel {
                width: 280px;
            }

            .main-content {
                margin-right: 280px;
            }
        }

        /* Unified Dropdown Menu Styling - No 3D Effects */
        .inventory-submenu,
        .finance-dropdown-menu,
        .ecommerce-dropdown-menu {
            background: transparent !important;
            border: none !important;
            border-radius: 0 !important;
            box-shadow: none !important;
            margin: 0 !important;
            padding: 0 !important;
        }

        /* Unified Dropdown Items - Same as Main Navigation */
        .inventory-submenu .sidebar-link,
        .finance-dropdown-menu .sidebar-link,
        .ecommerce-dropdown-menu .sidebar-link {
            padding: 10px 14px !important;
            margin: 0 !important;
            border-radius: 0 !important;
            transition: all 0.2s ease !important;
        }

        .inventory-submenu .sidebar-link:hover,
        .finance-dropdown-menu .sidebar-link:hover,
        .ecommerce-dropdown-menu .sidebar-link:hover {
            background: var(--madas-light) !important;
            color: var(--madas-primary) !important;
        }

        /* Ensure dropdown hover maintains color in dark mode */
        body.dark-mode .inventory-submenu .sidebar-link:hover,
        body.dark-mode .finance-dropdown-menu .sidebar-link:hover,
        body.dark-mode .ecommerce-dropdown-menu .sidebar-link:hover {
            color: var(--madas-primary) !important;
        }


        /* Ensure all dropdown text sizes are uniform */
        .inventory-submenu .sidebar-link span,
        .finance-dropdown-menu .sidebar-link span,
        .ecommerce-dropdown-menu .sidebar-link span {
            font-size: 0.8rem !important;
        }

        /* Make dropdown icons smaller */
        .inventory-submenu .material-icons,
        .finance-dropdown-menu .material-icons,
        .ecommerce-dropdown-menu .material-icons {
            font-size: 18px !important;
        }

        /* Unified Dropdown Items Active State - EXACT Same as Main Navigation */
        .inventory-submenu .sidebar-link.active,
        .finance-dropdown-menu .sidebar-link.active,
        .ecommerce-dropdown-menu .sidebar-link.active {
            background: var(--madas-light) !important;
            color: var(--madas-primary) !important;
            font-weight: 600 !important;
        }

        .inventory-submenu .sidebar-link.active .material-icons,
        .finance-dropdown-menu .sidebar-link.active .material-icons,
        .ecommerce-dropdown-menu .sidebar-link.active .material-icons {
            color: var(--madas-primary) !important;
        }

        /* Unified Dropdown Button Styling */
        .inventory-dropdown button,
        .finance-dropdown button,
        .ecommerce-dropdown button {
            background: transparent !important;
            border: none !important;
            padding: 10px 14px !important;
            border-radius: 8px !important;
            transition: all 0.2s ease !important;
            width: 100% !important;
            text-align: left !important;
        }

        .inventory-dropdown button:hover,
        .finance-dropdown button:hover,
        .ecommerce-dropdown button:hover {
            background: var(--madas-light) !important;
        }

        /* Unified Dropdown Arrow */
        .dropdown-arrow {
            transition: transform 0.2s ease !important;
        }

        .dropdown-arrow.rotate {
            transform: rotate(180deg) !important;
        }

        /* Unified Visible States for Dropdowns - No 3D Effects */
        .inventory-submenu:not(.hidden) {
            opacity: 1 !important;
            transform: translateY(0) !important;
            pointer-events: auto !important;
            background: transparent !important;
            border: none !important;
            border-radius: 0 !important;
            box-shadow: none !important;
            margin: 0 !important;
            padding: 0 !important;
        }

        .finance-dropdown-menu.show {
            display: block !important;
            animation: slideDown 0.3s ease !important;
            background: transparent !important;
            border: none !important;
            border-radius: 0 !important;
            box-shadow: none !important;
            margin: 0 !important;
            padding: 0 !important;
        }

        .ecommerce-dropdown-menu.show {
            display: block !important;
            animation: slideDown 0.3s ease !important;
            background: transparent !important;
            border: none !important;
            border-radius: 0 !important;
            box-shadow: none !important;
            margin: 0 !important;
            padding: 0 !important;
        }
    </style>
</head>

<body>
    <!-- Loading Screen -->
    <div id="loading-screen" style="
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 99999;
        transition: opacity 0.3s ease;
    ">
        <div style="text-align: center;">
            <div class="loader" style="
                width: 60px;
                height: 60px;
                border: 4px solid rgba(255,255,255,0.2);
                border-top-color: white;
                border-radius: 50%;
                animation: spin 1s linear infinite;
                margin: 0 auto 24px;
            "></div>
            <h2 style="color: white; margin: 0 0 12px 0; font-size: 24px; font-weight: 700;">
                MADAS Website Builder
            </h2>
            <p style="color: rgba(255,255,255,0.9); margin: 0; font-size: 16px;">
                Loading your workspace...
            </p>
        </div>
    </div>

    <style>
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }

            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }

        /* Enhanced Sidebar Link Styles */
        .sidebar-link {
            position: relative;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
            color: var(--text-main) !important;
        }





        /* Override Tailwind text color classes */
        .sidebar-link.text-gray-700,
        .sidebar-link.text-gray-600 {
            color: var(--text-main) !important;
        }

        /* Dark mode text color for sidebar links */

        body.dark-mode .sidebar-link {
            color: var(--text-main) !important;
        }

        .sidebar-link:hover {
            transform: translateX(6px) scale(1.02);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            background: var(--madas-light);
        }

        .sidebar-link:active {
            transform: translateX(3px) scale(0.98);
            transition: all 0.1s ease;
        }/* Simple Dropdown Menu Styling - No 3D Effects */
        .inventory-submenu,
        .finance-dropdown-menu,
        .ecommerce-dropdown-menu {
            background: transparent;
            border: none;
            border-radius: 0;
            box-shadow: none;
            margin: 0;
            padding: 0;
        }/* Simple Dropdown Items - Same as Main Navigation */
        .inventory-submenu .sidebar-link,
        .finance-dropdown-menu .sidebar-link,
        .ecommerce-dropdown-menu .sidebar-link {
            padding: 12px 16px;
            margin: 0;
            border-radius: 0;
            transition: all 0.2s ease;
        }

        .inventory-submenu .sidebar-link:hover,
        .finance-dropdown-menu .sidebar-link:hover,
        .ecommerce-dropdown-menu .sidebar-link:hover {
            background: var(--madas-light);
            color: var(--madas-primary);
        }

        /* Ensure dropdown hover maintains color in dark mode */
        body.dark-mode .inventory-submenu .sidebar-link:hover,
        body.dark-mode .finance-dropdown-menu .sidebar-link:hover,
        body.dark-mode .ecommerce-dropdown-menu .sidebar-link:hover {
            color: var(--madas-primary) !important;
        }

        /* Dark mode submenu text color */
        body.dark-mode .sidebar-link.submenu-link {
            color: var(--text-main) !important;
        }

        body.dark-mode .sidebar-link.submenu-link:hover {
            color: var(--text-main) !important;
        }

        /* Dropdown Items Active State - EXACT Same as Main Navigation */
        .inventory-submenu .sidebar-link.active,
        .finance-dropdown-menu .sidebar-link.active,
        .ecommerce-dropdown-menu .sidebar-link.active {
            background: var(--madas-light) !important;
            color: var(--madas-primary) !important;
            font-weight: 600 !important;
        }

        .inventory-submenu .sidebar-link.active .material-icons,
        .finance-dropdown-menu .sidebar-link.active .material-icons,
        .ecommerce-dropdown-menu .sidebar-link.active .material-icons {
            color: var(--madas-primary) !important;
        }

        /* Original Dropdown Button */
        .inventory-dropdown button,
        .finance-dropdown button,
        .ecommerce-dropdown button {
            background: transparent;
            border: none;
            padding: 12px 16px;
            border-radius: 8px;
            transition: all 0.2s ease;
            width: 100%;
            text-align: left;
        }

        .inventory-dropdown button:hover,
        .finance-dropdown button:hover,
        .ecommerce-dropdown button:hover {
            background: #f3f4f6;
        }

        /* Original Dropdown Arrow */
        .dropdown-arrow {
            transition: transform 0.2s ease;
        }

        .dropdown-arrow.rotate {
            transform: rotate(180deg);
        }

        /* Enhanced dropdown menu container */
        .inventory-submenu:not(.hidden),
        .finance-dropdown-menu.show {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(39, 73, 31, 0.1);
            border-radius: 12px;
            box-shadow:
                0 8px 32px rgba(39, 73, 31, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        /* Enhanced dropdown button hover */
        .inventory-dropdown button:hover,
        .finance-dropdown button:hover,
        .ecommerce-dropdown button:hover {
            background: rgba(39, 73, 31, 0.05);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            border-radius: 12px;
            transform: translateX(2px);
        }

        .sidebar-link.active:hover {
            transform: translateX(6px) scale(1.02);
            box-shadow: 0 6px 20px rgba(39, 73, 31, 0.4);
        }

        /* Icon animation on hover */
        .sidebar-link:hover .material-icons {
            transform: scale(1.1) rotate(2deg);
            transition: all 0.3s ease;
        }

        /* Submenu link enhancements */
        .sidebar-link.submenu-link {
            position: relative;
            margin-left: 1rem;
            border-left: 2px solid transparent;
            transition: all 0.3s ease;
            color: var(--text-main) !important;
        }

        .sidebar-link.submenu-link:hover {
            border-left-color: var(--madas-primary);
            background: var(--madas-light);
            transform: translateX(8px);
            color: var(--text-main) !important;
        }

        .sidebar-link.submenu-link.active {
            border-left-color: var(--madas-primary);
            background: var(--madas-light);
            color: var(--madas-primary);
        }

        /* Dark mode submenu text color */
        body.dark-mode .sidebar-link.submenu-link {
            color: var(--text-main) !important;
        }

        body.dark-mode .sidebar-link.submenu-link:hover {
            color: var(--text-main) !important;
        }

        /* Unified Dropdown Menu Styling - No 3D Effects */
        .inventory-submenu,
        .finance-dropdown-menu,
        .ecommerce-dropdown-menu {
            background: transparent !important;
            border: none !important;
            border-radius: 0 !important;
            box-shadow: none !important;
            margin: 0 !important;
            padding: 0 !important;
        }

        /* Unified Dropdown Items - Same as Main Navigation */
        .inventory-submenu .sidebar-link,
        .finance-dropdown-menu .sidebar-link,
        .ecommerce-dropdown-menu .sidebar-link {
            padding: 10px 14px !important;
            margin: 0 !important;
            border-radius: 0 !important;
            transition: all 0.2s ease !important;
        }

        .inventory-submenu .sidebar-link:hover,
        .finance-dropdown-menu .sidebar-link:hover,
        .ecommerce-dropdown-menu .sidebar-link:hover {
            background: var(--madas-light) !important;
            color: var(--madas-primary) !important;
        }

        /* Ensure dropdown hover maintains color in dark mode */
        body.dark-mode .inventory-submenu .sidebar-link:hover,
        body.dark-mode .finance-dropdown-menu .sidebar-link:hover,
        body.dark-mode .ecommerce-dropdown-menu .sidebar-link:hover {
            color: var(--madas-primary) !important;
        }

        /* Unified Dropdown Items Active State - EXACT Same as Main Navigation */
        .inventory-submenu .sidebar-link.active,
        .finance-dropdown-menu .sidebar-link.active,
        .ecommerce-dropdown-menu .sidebar-link.active {
            background: var(--madas-light) !important;
            color: var(--madas-primary) !important;
            font-weight: 600 !important;
        }

        .inventory-submenu .sidebar-link.active .material-icons,
        .finance-dropdown-menu .sidebar-link.active .material-icons,
        .ecommerce-dropdown-menu .sidebar-link.active .material-icons {
            color: var(--madas-primary) !important;
        }

        /* Unified Dropdown Button Styling */
        .inventory-dropdown button,
        .finance-dropdown button,
        .ecommerce-dropdown button {
            background: transparent !important;
            border: none !important;
            padding: 10px 14px !important;
            border-radius: 8px !important;
            transition: all 0.2s ease !important;
            width: 100% !important;
            text-align: left !important;
        }

        .inventory-dropdown button:hover,
        .finance-dropdown button:hover,
        .ecommerce-dropdown button:hover {
            background: var(--madas-light) !important;
        }

        /* Unified Dropdown Arrow */
        .dropdown-arrow {
            transition: transform 0.2s ease !important;
        }

        .dropdown-arrow.rotate {
            transform: rotate(180deg) !important;
        }

        /* Unified Visible States for Dropdowns - No 3D Effects */
        .inventory-submenu:not(.hidden) {
            opacity: 1 !important;
            transform: translateY(0) !important;
            pointer-events: auto !important;
            background: transparent !important;
            border: none !important;
            border-radius: 0 !important;
            box-shadow: none !important;
            margin: 0 !important;
            padding: 0 !important;
        }

        .finance-dropdown-menu.show {
            display: block !important;
            animation: slideDown 0.3s ease !important;
            background: transparent !important;
            border: none !important;
            border-radius: 0 !important;
            box-shadow: none !important;
            margin: 0 !important;
            padding: 0 !important;
        }

        .ecommerce-dropdown-menu.show {
            display: block !important;
            animation: slideDown 0.3s ease !important;
            background: transparent !important;
            border: none !important;
            border-radius: 0 !important;
            box-shadow: none !important;
            margin: 0 !important;
            padding: 0 !important;
        }
    </style>

    <!-- Top Navigation Bar -->
    <div class="top-nav">
        <div class="nav-left">
            <div class="breadcrumb">
                <a href="#" id="back-btn" class="material-icons">arrow_back</a>
                <span>Theme Library / Website Builder</span>
            </div>
        </div>

        <div class="nav-right">
            <div class="preview-modes">
                <div class="preview-mode active" data-mode="desktop">
                    <span class="material-icons">desktop_windows</span>
                </div>
                <div class="preview-mode" data-mode="tablet">
                    <span class="material-icons">tablet</span>
                </div>
                <div class="preview-mode" data-mode="mobile">
                    <span class="material-icons">phone_android</span>
                </div>
            </div>

            <!-- Storage Status -->
            <div class="storage-status" id="storage-status" title="Click to view storage details">
                <span class="material-icons">storage</span>
                <span id="storage-usage">0%</span>
            </div>

            <div class="action-buttons">
                <button class="btn btn-secondary" id="save-btn">Save</button>
                <button class="btn btn-info" id="preview-btn">Preview</button>
                <button class="btn btn-warning" id="debug-btn" style="background: #f59e0b;">Debug</button>
                <button class="btn btn-info" id="debug-preview-btn" style="background: #06b6d4;">Debug Preview</button>
                <button class="btn btn-secondary" id="show-storage-btn" style="background: #6b7280;">Show
                    Storage</button>
                <button class="btn btn-primary" id="publish-btn">Publish</button>
                <button class="btn btn-success" id="live-site-btn" style="display: none;">Make Live Site</button>
            </div>

            <!-- Preview Status -->
            <div id="preview-status" class="preview-status preview-status-inactive"></div>

            <!-- Save Status -->
            <div id="save-status" class="save-status save-status-saved"></div>
        </div>
    </div>

    <div class="builder-container">
        <!-- Left Sidebar -->
        <div class="left-sidebar" id="left-sidebar">
            <div class="sidebar-icon active" data-tool="sections" title="Sections">
                <span class="material-icons">view_module</span>
            </div>
            <div class="sidebar-icon" data-tool="styling" title="Styling">
                <span class="material-icons">palette</span>
            </div>
            <div class="sidebar-icon" data-tool="assets" title="Assets">
                <span class="material-icons">photo_library</span>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Canvas Area -->
            <div class="canvas-area">
                <div class="canvas-container" id="canvas">
                    <!-- Website content will be rendered here -->
                </div>
            </div>

            <!-- Right Panel -->
            <div class="right-panel">
                <div class="panel-header">
                    <h2 class="panel-title" id="panel-title">Sections</h2>
                </div>
                <div style="padding: 20px;">
                    <button class="add-section-btn" id="add-section-btn">
                        <span class="material-icons">add</span>
                        Add Section
                    </button>

                    <!-- Section Controls -->
                    <div style="margin-top: 16px; display: flex; flex-direction: column; gap: 12px;">
                        <button class="btn btn-primary" id="style-section-btn"
                            style="width: 100%; justify-content: center; background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); border: none; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);">
                            <span class="material-icons"
                                style="font-size: 16px; margin-right: 8px;">format_line_spacing</span>
                            Spacing & Borders
                        </button>
                        <button class="btn btn-secondary" id="spacing-btn"
                            style="width: 100%; justify-content: center;">
                            <span class="material-icons"
                                style="font-size: 16px; margin-right: 8px;">format_line_spacing</span>
                            Adjust Spacing
                        </button>
                        <button class="btn btn-secondary" id="connect-sections-btn"
                            style="width: 100%; justify-content: center;">
                            <span class="material-icons" style="font-size: 16px; margin-right: 8px;">view_agenda</span>
                            Connect Sections
                        </button>
                        <button class="btn btn-secondary" id="grid-layout-btn"
                            style="width: 100%; justify-content: center;">
                            <span class="material-icons" style="font-size: 16px; margin-right: 8px;">grid_view</span>
                            Grid Layout
                        </button>
                    </div>
                </div>

                <!-- Component Editing Panel -->
                <div id="component-editor" style="display: none;">
                    <div class="panel-header">
                        <h2 class="panel-title">Edit Section</h2>
                        <button id="close-editor"
                            style="background: none; border: none; color: #6b7280; cursor: pointer; font-size: 20px;">&times;</button>
                    </div>
                    <div id="editor-content" style="padding: 20px;">
                        <!-- Dynamic content will be loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Section Modal -->
    <div class="modal" id="add-section-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Add New Section</h2>
                <p class="modal-subtitle">Choose the section you want to add</p>
                <button class="modal-close" id="modal-close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="section-list">
                    <!-- Hero Slider Section -->
                    <div class="section-card" data-section="hero-slider">
                        <div class="section-preview">
                            <div class="preview-mockup">
                                <div class="mockup-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; text-align: center; position: relative; overflow: hidden;
            color: var(--text-main) !important; box-shadow: 0 8px 24px rgba(102, 126, 234, 0.3);">
                                    <div style="position: absolute; top: 8px; right: 8px; display: flex; gap: 4px;">
                                        <div
                                            style="width: 6px; height: 6px; background: rgba(255, 255, 255, 0.5); border-radius: 50%; animation: pulse 2s infinite;">
                                        </div>
                                        <div
                                            style="width: 6px; height: 6px; background: white; border-radius: 50%; animation: pulse 2s infinite 0.5s;">
                                        </div>
                                        <div
                                            style="width: 6px; height: 6px; background: rgba(255, 255, 255, 0.5); border-radius: 50%; animation: pulse 2s infinite 1s;">
                                        </div>
                                    </div>
                                    <div
                                        style="position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent); animation: shimmer 3s infinite;">
                                    </div>
                                    <h3 style="margin: 0; font-size: 24px; position: relative; z-index: 1;">Welcome to
                                        Our Store</h3>
                                    <p style="margin: 8px 0 0 0; opacity: 0.9; position: relative; z-index: 1;">Discover
                                        amazing products</p>
                                </div>
                            </div>
                        </div>
                        <div class="section-details">
                            <h3 class="section-title">Hero Slider</h3>
                            <p class="section-description">Create an impactful first impression with multiple slides
                                featuring text, images, and call-to-action buttons</p>
                            <button class="use-section-btn">Use this section</button>
                        </div>
                    </div>

                    <!-- Image with Text Section -->
                    <div class="section-card" data-section="image-text">
                        <div class="section-preview">
                            <div class="preview-mockup">
                                <div class="mockup-content"
                                    style="display: flex; align-items: center; padding: 20px; background: #f8fafc;">
                                    <div class="mockup-image"
                                        style="width: 100px; height: 80px; background: #e2e8f0; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #64748b; font-size: 12px;">
                                         Image
                                    </div>
                                    <div class="mockup-text" style="margin-left: 16px; flex: 1;">
                                        <h4 style="margin: 0 0 8px 0; font-size: 16px;">Your Content Title</h4>
                                        <p style="margin: 0; font-size: 12px; color: #64748b;">Add your content here...
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="section-details">
                            <h3 class="section-title">Image with Text</h3>
                            <p class="section-description">Display an image with text to highlight any product,
                                collection, or anything you want to feature on your homepage</p>
                            <button class="use-section-btn">Use this section</button>
                        </div>
                    </div>

                    <!-- Product Slider Section -->
                    <div class="section-card" data-section="product-slider">
                        <div class="section-preview">
                            <div class="preview-mockup">
                                <div class="mockup-header"
                                    style="background: #f8fafc; padding: 16px; text-align: center; border-bottom: 1px solid #e2e8f0;">
                                    <h3 style="margin: 0; font-size: 18px; color: #1e293b;">Featured Products</h3>
                                </div>
                                <div class="mockup-products"
                                    style="display: flex; gap: 12px; padding: 16px; overflow-x: auto;">
                                    <div class="product-item" style="min-width: 80px; text-align: center;">
                                        <div
                                            style="width: 60px; height: 60px; background: #e2e8f0; border-radius: 8px; margin: 0 auto 8px;">
                                        </div>
                                        <p style="margin: 0; font-size: 10px; color: #64748b;">Product</p>
                                    </div>
                                    <div class="product-item" style="min-width: 80px; text-align: center;">
                                        <div
                                            style="width: 60px; height: 60px; background: #e2e8f0; border-radius: 8px; margin: 0 auto 8px;">
                                        </div>
                                        <p style="margin: 0; font-size: 10px; color: #64748b;">Product</p>
                                    </div>
                                    <div class="product-item" style="min-width: 80px; text-align: center;">
                                        <div
                                            style="width: 60px; height: 60px; background: #e2e8f0; border-radius: 8px; margin: 0 auto 8px;">
                                        </div>
                                        <p style="margin: 0; font-size: 10px; color: #64748b;">Product</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="section-details">
                            <h3 class="section-title">Product Slider</h3>
                            <p class="section-description">Showcase your best-selling products in a horizontal scrolling
                                carousel with images and prices</p>
                            <button class="use-section-btn">Use this section</button>
                        </div>
                    </div>

                    <!-- Testimonials Section -->
                    <div class="section-card" data-section="testimonials">
                        <div class="section-preview">
                            <div class="preview-mockup">
                                <div class="mockup-header"
                                    style="background: #f8fafc; padding: 16px; text-align: center; border-bottom: 1px solid #e2e8f0;">
                                    <h3 style="margin: 0; font-size: 18px; color: #1e293b;">What Our Customers Say</h3>
                                </div>
                                <div class="mockup-testimonials" style="padding: 16px;">
                                    <div class="testimonial-item"
                                        style="background: white; padding: 12px; border-radius: 8px; margin-bottom: 8px; border: 1px solid #e2e8f0;">
                                        <p
                                            style="margin: 0 0 8px 0; font-size: 11px; color: #64748b; font-style: italic;">
                                            "Amazing quality and fast shipping!"</p>
                                        <p style="margin: 0; font-size: 10px; color: #94a3b8;">- John Doe</p>
                                    </div>
                                    <div class="testimonial-item"
                                        style="background: white; padding: 12px; border-radius: 8px; border: 1px solid #e2e8f0;">
                                        <p
                                            style="margin: 0 0 8px 0; font-size: 11px; color: #64748b; font-style: italic;">
                                            "Excellent customer service!"</p>
                                        <p style="margin: 0; font-size: 10px; color: #94a3b8;">- Sarah Miller</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="section-details">
                            <h3 class="section-title">Customer Testimonials</h3>
                            <p class="section-description">Showcase customer reviews and ratings to build trust and
                                credibility with your visitors</p>
                            <button class="use-section-btn">Use this section</button>
                        </div>
                    </div>

                    <!-- Newsletter Section -->
                    <div class="section-card" data-section="newsletter">
                        <div class="section-preview">
                            <div class="preview-mockup">
                                <div class="mockup-newsletter"
                                    style="background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); padding: 20px; text-align: center;">
                                    <h3 style="margin: 0 0 8px 0; font-size: 18px; color: #1e293b;">Stay Updated</h3>
                                    <p style="margin: 0 0 16px 0; font-size: 12px; color: #64748b;">Subscribe to our
                                        newsletter</p>
                                    <div style="display: flex; gap: 8px; max-width: 200px; margin: 0 auto;">
                                        <input type="email" placeholder="Email"
                                            style="flex: 1; padding: 8px; border: none; border-radius: 4px; font-size: 10px;">
                                        <button
                                            style="background: #2563eb; color: white; border: none; padding: 8px 12px; border-radius: 4px; font-size: 10px;">Subscribe</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="section-details">
                            <h3 class="section-title">Newsletter Signup</h3>
                            <p class="section-description">Email subscription form for marketing and keeping your
                                customers updated with latest offers and news</p>
                            <button class="use-section-btn">Use this section</button>
                        </div>
                    </div>

                    <!-- Navigation Bar Section -->
                    <div class="section-card" data-section="navbar">
                        <div class="section-preview">
                            <div class="preview-mockup">
                                <div class="mockup-navbar"
                                    style="background: #1e293b; color: white; padding: 12px 20px; display: flex; align-items: center; justify-content: space-between;">
                                    <div style="font-weight: 600; font-size: 14px;">Logo</div>
                                    <div style="display: flex; gap: 16px; font-size: 12px;">
                                        <span>Home</span>
                                        <span>Products</span>
                                        <span>About</span>
                                        <span>Contact</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="section-details">
                            <h3 class="section-title">Navigation Bar</h3>
                            <p class="section-description">Fully functional navigation with logo, menu items, and mobile
                                responsive design</p>
                            <button class="use-section-btn">Use this section</button>
                        </div>
                    </div>

                    <!-- Announcement Bar Section -->
                    <div class="section-card" data-section="announcement-bar">
                        <div class="section-preview">
                            <div class="preview-mockup">
                                <div class="mockup-announcement"
                                    style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 14px 20px; text-align: center; font-size: 12px; border-radius: 8px; position: relative; overflow: hidden; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4); border: 1px solid rgba(255, 255, 255, 0.2);">
                                    <div
                                        style="position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent); animation: shimmer 2s infinite;">
                                    </div>
                                    <div
                                        style="position: relative; z-index: 2; display: flex; align-items: center; justify-content: center; gap: 6px; flex-wrap: wrap;">
                                        <span
                                            style="background: rgba(255, 255, 255, 0.2); padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 700; text-transform: uppercase;">
                                            Limited</span>
                                        <span style="font-weight: 600;">MEGA SALE! 70% OFF</span>
                                        <span
                                            style="background: rgba(251, 191, 36, 0.3); padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 700;">Shop
                                            Now </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="section-details">
                            <h3 class="section-title">Premium Announcement Bar</h3>
                            <p class="section-description">Modern promotional banner with gradient backgrounds,
                                animations, and interactive elements for maximum engagement</p>
                            <button class="use-section-btn">Use this section</button>
                        </div>
                    </div>

                    <!-- About Us Section -->
                    <div class="section-card" data-section="about-us">
                        <div class="section-preview">
                            <div class="preview-mockup">
                                <div class="mockup-about"
                                    style="padding: 20px; text-align: center; background: #f8fafc;">
                                    <h3 style="margin: 0 0 12px 0; font-size: 18px; color: #1e293b;">About Our Company
                                    </h3>
                                    <p style="margin: 0 0 16px 0; font-size: 12px; color: #64748b; line-height: 1.4;">We
                                        are passionate about delivering exceptional products and services to our
                                        customers.</p>
                                    <div style="display: flex; justify-content: center; gap: 16px;">
                                        <div style="text-align: center;">
                                            <div style="font-size: 20px; margin-bottom: 4px;"></div>
                                            <p style="margin: 0; font-size: 10px; color: #64748b;">Quality</p>
                                        </div>
                                        <div style="text-align: center;">
                                            <div style="font-size: 20px; margin-bottom: 4px;"></div>
                                            <p style="margin: 0; font-size: 10px; color: #64748b;">Innovation</p>
                                        </div>
                                        <div style="text-align: center;">
                                            <div style="font-size: 20px; margin-bottom: 4px;"></div>
                                            <p style="margin: 0; font-size: 10px; color: #64748b;">Care</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="section-details">
                            <h3 class="section-title">About Us</h3>
                            <p class="section-description">Tell your brand story with text and images to connect with
                                your customers and build trust</p>
                            <button class="use-section-btn">Use this section</button>
                        </div>
                    </div>

                    <!-- Contact Form Section -->
                    <div class="section-card" data-section="contact-form">
                        <div class="section-preview">
                            <div class="preview-mockup">
                                <div class="mockup-contact" style="padding: 16px; background: #f8fafc;">
                                    <h3
                                        style="margin: 0 0 12px 0; font-size: 16px; color: #1e293b; text-align: center;">
                                        Get In Touch</h3>
                                    <div style="display: flex; flex-direction: column; gap: 8px;">
                                        <input type="text" placeholder="Name"
                                            style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 10px;">
                                        <input type="email" placeholder="Email"
                                            style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 10px;">
                                        <textarea placeholder="Message" rows="2"
                                            style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 10px; resize: none;"></textarea>
                                        <button
                                            style="background: #2563eb; color: white; border: none; padding: 8px; border-radius: 4px; font-size: 10px;">Send
                                            Message</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="section-details">
                            <h3 class="section-title">Contact Form</h3>
                            <p class="section-description">Customer inquiry form with validation to let customers get in
                                touch with you easily</p>
                            <button class="use-section-btn">Use this section</button>
                        </div>
                    </div>

                    <!-- Hero Banner Section -->
                    <div class="section-card" data-section="hero-banner">
                        <div class="section-preview">
                            <div class="preview-mockup">
                                <div class="mockup-hero"
                                    style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; text-align: center; border-radius: 8px;">
                                    <h3 style="margin: 0 0 8px 0; font-size: 14px; font-weight: 600;">Welcome to Your
                                        Website</h3>
                                    <p style="margin: 0 0 12px 0; font-size: 10px; opacity: 0.9;">Create amazing
                                        experiences with our professional website builder</p>
                                    <div style="display: flex; gap: 8px; justify-content: center;">
                                        <button
                                            style="background: white; color: #667eea; border: none; padding: 4px 8px; border-radius: 4px; font-size: 8px;">Get
                                            Started</button>
                                        <button
                                            style="background: transparent; color: white; border: 1px solid white; padding: 4px 8px; border-radius: 4px; font-size: 8px;">Learn
                                            More</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="section-details">
                            <h3 class="section-title">Hero Banner</h3>
                            <p class="section-description">Eye-catching hero banner with call-to-action buttons</p>
                            <button class="use-section-btn">Use this section</button>
                        </div>
                    </div>

                    <!-- Header Simple Section -->
                    <div class="section-card" data-section="header-simple">
                        <div class="section-preview">
                            <div class="preview-mockup">
                                <div class="mockup-header"
                                    style="background: white; padding: 16px; text-align: center; border-bottom: 1px solid #e2e8f0;">
                                    <h3 style="margin: 0 0 4px 0; font-size: 14px; font-weight: 700; color: #1e293b;">
                                        Your Brand Name</h3>
                                    <p style="margin: 0; color: #64748b; font-size: 10px;">Simple and elegant header
                                        design</p>
                                </div>
                            </div>
                        </div>
                        <div class="section-details">
                            <h3 class="section-title">Header Simple</h3>
                            <p class="section-description">Clean and simple header design</p>
                            <button class="use-section-btn">Use this section</button>
                        </div>
                    </div>

                    <!-- Text Content Section -->
                    <div class="section-card" data-section="text-content">
                        <div class="section-preview">
                            <div class="preview-mockup">
                                <div class="mockup-text" style="padding: 16px; background: white; text-align: center;">
                                    <h3 style="margin: 0 0 8px 0; font-size: 14px; font-weight: 700; color: #1e293b;">
                                        Your Content Title</h3>
                                    <p style="margin: 0; color: #64748b; font-size: 10px; line-height: 1.4;">This is a
                                        simple text content section. Perfect for descriptions and announcements.</p>
                                </div>
                            </div>
                        </div>
                        <div class="section-details">
                            <h3 class="section-title">Text Content</h3>
                            <p class="section-description">Simple text content section for descriptions and
                                announcements</p>
                            <button class="use-section-btn">Use this section</button>
                        </div>
                    </div>

                    <!-- Image Gallery Section -->
                    <div class="section-card" data-section="image-gallery">
                        <div class="section-preview">
                            <div class="preview-mockup">
                                <div class="mockup-gallery" style="padding: 16px; background: #f8fafc;">
                                    <h3
                                        style="margin: 0 0 12px 0; font-size: 14px; font-weight: 700; color: #1e293b; text-align: center;">
                                        Image Gallery</h3>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                                        <div
                                            style="height: 30px; background: linear-gradient(135deg, #e2e8f0, #cbd5e1); border-radius: 4px; display: flex; align-items: center; justify-content: center; color: #64748b; font-size: 8px;">
                                            Image</div>
                                        <div
                                            style="height: 30px; background: linear-gradient(135deg, #e2e8f0, #cbd5e1); border-radius: 4px; display: flex; align-items: center; justify-content: center; color: #64748b; font-size: 8px;">
                                            Image</div>
                                        <div
                                            style="height: 30px; background: linear-gradient(135deg, #e2e8f0, #cbd5e1); border-radius: 4px; display: flex; align-items: center; justify-content: center; color: #64748b; font-size: 8px;">
                                            Image</div>
                                        <div
                                            style="height: 30px; background: linear-gradient(135deg, #e2e8f0, #cbd5e1); border-radius: 4px; display: flex; align-items: center; justify-content: center; color: #64748b; font-size: 8px;">
                                            Image</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="section-details">
                            <h3 class="section-title">Image Gallery</h3>
                            <p class="section-description">Showcase your images in a beautiful gallery layout</p>
                            <button class="use-section-btn">Use this section</button>
                        </div>
                    </div>

                    <!-- Footer Simple Section -->
                    <div class="section-card" data-section="footer-simple">
                        <div class="section-preview">
                            <div class="preview-mockup">
                                <div class="mockup-footer"
                                    style="background: #1e293b; color: white; padding: 16px; text-align: center;">
                                    <h3 style="margin: 0 0 8px 0; font-size: 14px; font-weight: 700;">Your Brand</h3>
                                    <p style="margin: 0 0 8px 0; color: #94a3b8; font-size: 10px;">Building amazing
                                        websites with professional tools.</p>
                                    <div style="display: flex; justify-content: center; gap: 12px; margin-bottom: 8px;">
                                        <a href="#" style="color: #94a3b8; font-size: 8px;">Privacy</a>
                                        <a href="#" style="color: #94a3b8; font-size: 8px;">Terms</a>
                                        <a href="#" style="color: #94a3b8; font-size: 8px;">Contact</a>
                                    </div>
                                    <p style="margin: 0; color: #64748b; font-size: 8px;"> 2024 Your Brand. All rights
                                        reserved.</p>
                                </div>
                            </div>
                        </div>
                        <div class="section-details">
                            <h3 class="section-title">Footer Simple</h3>
                            <p class="section-description">Simple footer with links and copyright information</p>
                            <button class="use-section-btn">Use this section</button>
                        </div>
                    </div>

                    <!-- Modal Popup Section -->
                    <div class="section-card" data-section="modal-popup">
                        <div class="section-preview">
                            <div class="preview-mockup">
                                <div class="mockup-modal" style="padding: 16px; background: white; text-align: center;">
                                    <h3 style="margin: 0 0 8px 0; font-size: 14px; font-weight: 700; color: #1e293b;">
                                        Modal Popup</h3>
                                    <p style="margin: 0 0 12px 0; color: #64748b; font-size: 10px;">Interactive popup
                                        functionality</p>
                                    <button
                                        style="background: #2D5A27; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 8px;">Open
                                        Modal</button>
                                </div>
                            </div>
                        </div>
                        <div class="section-details">
                            <h3 class="section-title">Modal Popup</h3>
                            <p class="section-description">Interactive popup for forms or content</p>
                            <button class="use-section-btn">Use this section</button>
                        </div>
                    </div>

                    <!-- Floating Button Section -->
                    <div class="section-card" data-section="floating-button">
                        <div class="section-preview">
                            <div class="preview-mockup">
                                <div class="mockup-floating"
                                    style="padding: 16px; background: #f8fafc; text-align: center; position: relative;">
                                    <h3 style="margin: 0 0 8px 0; font-size: 14px; font-weight: 700; color: #1e293b;">
                                        Floating Action Button</h3>
                                    <p style="margin: 0; color: #64748b; font-size: 10px;">Floating button that stays
                                        visible</p>
                                    <div
                                        style="position: absolute; bottom: 8px; right: 8px; width: 20px; height: 20px; background: #2D5A27; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 8px;">
                                        +</div>
                                </div>
                            </div>
                        </div>
                        <div class="section-details">
                            <h3 class="section-title">Floating Button</h3>
                            <p class="section-description">Floating action button for quick actions</p>
                            <button class="use-section-btn">Use this section</button>
                        </div>
                    </div>

                    <!-- Accordion Section -->
                    <div class="section-card" data-section="accordion">
                        <div class="section-preview">
                            <div class="preview-mockup">
                                <div class="mockup-accordion" style="padding: 16px; background: white;">
                                    <h3
                                        style="margin: 0 0 12px 0; font-size: 14px; font-weight: 700; color: #1e293b; text-align: center;">
                                        FAQ Section</h3>
                                    <div style="border: 1px solid #e2e8f0; border-radius: 4px; margin-bottom: 8px;">
                                        <div
                                            style="background: #f8fafc; padding: 8px; display: flex; justify-content: space-between; align-items: center;">
                                            <span style="font-size: 10px; font-weight: 600; color: #1e293b;">What
                                                services do you offer?</span>
                                            <span style="color: #64748b; font-size: 8px;"></span>
                                        </div>
                                    </div>
                                    <div style="border: 1px solid #e2e8f0; border-radius: 4px;">
                                        <div
                                            style="background: #f8fafc; padding: 8px; display: flex; justify-content: space-between; align-items: center;">
                                            <span style="font-size: 10px; font-weight: 600; color: #1e293b;">How long
                                                does it take?</span>
                                            <span style="color: #64748b; font-size: 8px;"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="section-details">
                            <h3 class="section-title">Accordion</h3>
                            <p class="section-description">Collapsible content sections for FAQs</p>
                            <button class="use-section-btn">Use this section</button>
                        </div>
                    </div>

                    <!-- Tabs Section -->
                    <div class="section-card" data-section="tabs">
                        <div class="section-preview">
                            <div class="preview-mockup">
                                <div class="mockup-tabs" style="padding: 16px; background: white;">
                                    <h3
                                        style="margin: 0 0 12px 0; font-size: 14px; font-weight: 700; color: #1e293b; text-align: center;">
                                        Our Services</h3>
                                    <div style="display: flex; border-bottom: 2px solid #e2e8f0; margin-bottom: 8px;">
                                        <button
                                            style="background: none; border: none; padding: 4px 8px; font-size: 8px; font-weight: 600; color: #2D5A27; border-bottom: 2px solid #2D5A27;">Web
                                            Design</button>
                                        <button
                                            style="background: none; border: none; padding: 4px 8px; font-size: 8px; color: #64748b;">Development</button>
                                        <button
                                            style="background: none; border: none; padding: 4px 8px; font-size: 8px; color: #64748b;">Marketing</button>
                                    </div>
                                    <div style="padding: 8px; background: #f8fafc; border-radius: 4px;">
                                        <p style="margin: 0; color: #64748b; font-size: 10px;">We create beautiful,
                                            user-friendly websites that engage your audience.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="section-details">
                            <h3 class="section-title">Tabs</h3>
                            <p class="section-description">Organized content in tabbed interface</p>
                            <button class="use-section-btn">Use this section</button>
                        </div>
                    </div>

                    <!-- Countdown Timer Section -->
                    <div class="section-card" data-section="countdown-timer">
                        <div class="section-preview">
                            <div class="preview-mockup">
                                <div class="mockup-countdown"
                                    style="background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%); color: white; padding: 16px; text-align: center; border-radius: 8px;">
                                    <h3 style="margin: 0 0 8px 0; font-size: 14px; font-weight: 700;">Limited Time
                                        Offer!</h3>
                                    <p style="margin: 0 0 12px 0; font-size: 10px; opacity: 0.9;">Don't miss out on our
                                        special promotion</p>
                                    <div style="display: flex; justify-content: center; gap: 8px; margin-bottom: 8px;">
                                        <div style="text-align: center;">
                                            <div
                                                style="font-size: 12px; font-weight: 700; background: rgba(255,255,255,0.2); padding: 4px; border-radius: 4px; margin-bottom: 2px;">
                                                05</div>
                                            <div style="font-size: 6px; opacity: 0.8;">Days</div>
                                        </div>
                                        <div style="text-align: center;">
                                            <div
                                                style="font-size: 12px; font-weight: 700; background: rgba(255,255,255,0.2); padding: 4px; border-radius: 4px; margin-bottom: 2px;">
                                                12</div>
                                            <div style="font-size: 6px; opacity: 0.8;">Hours</div>
                                        </div>
                                    </div>
                                    <button
                                        style="background: white; color: #ff6b6b; border: none; padding: 4px 8px; border-radius: 4px; font-size: 8px;">Claim
                                        Offer</button>
                                </div>
                            </div>
                        </div>
                        <div class="section-details">
                            <h3 class="section-title">Countdown Timer</h3>
                            <p class="section-description">Urgency timer for sales and events</p>
                            <button class="use-section-btn">Use this section</button>
                        </div>
                    </div>

                    <!-- Progress Bar Section -->
                    <div class="section-card" data-section="progress-bar">
                        <div class="section-preview">
                            <div class="preview-mockup">
                                <div class="mockup-progress" style="padding: 16px; background: #f8fafc;">
                                    <h3
                                        style="margin: 0 0 12px 0; font-size: 14px; font-weight: 700; color: #1e293b; text-align: center;">
                                        Our Progress</h3>
                                    <div style="margin-bottom: 8px;">
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                                            <span style="font-size: 10px; font-weight: 600; color: #1e293b;">Project
                                                Completion</span>
                                            <span style="color: #64748b; font-size: 8px;">85%</span>
                                        </div>
                                        <div
                                            style="background: #e2e8f0; height: 4px; border-radius: 2px; overflow: hidden;">
                                            <div style="background: #2D5A27; height: 100%; width: 85%;"></div>
                                        </div>
                                    </div>
                                    <div>
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                                            <span style="font-size: 10px; font-weight: 600; color: #1e293b;">Customer
                                                Satisfaction</span>
                                            <span style="color: #64748b; font-size: 8px;">92%</span>
                                        </div>
                                        <div
                                            style="background: #e2e8f0; height: 4px; border-radius: 2px; overflow: hidden;">
                                            <div style="background: #2D5A27; height: 100%; width: 92%;"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="section-details">
                            <h3 class="section-title">Progress Bar</h3>
                            <p class="section-description">Visual progress indicators and stats</p>
                            <button class="use-section-btn">Use this section</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Spacing Control Modal -->
    <div class="spacing-modal" id="spacing-modal">
        <div class="spacing-modal-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="margin: 0; font-size: 20px; font-weight: 600; color: #1e293b;">Section Spacing</h3>
                <button id="close-spacing-modal"
                    style="background: none; border: none; font-size: 24px; cursor: pointer; color: #6b7280;">&times;</button>
            </div>

            <div class="spacing-controls">
                <div>
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">Spacing
                        Value</label>
                    <div class="spacing-value" id="spacing-value">20px</div>
                    <input type="range" class="spacing-slider" id="spacing-slider" min="0" max="100" value="20">
                </div>

                <div>
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">Quick
                        Presets</label>
                    <div class="spacing-presets">
                        <div class="spacing-preset" data-value="0">None</div>
                        <div class="spacing-preset" data-value="10">Small</div>
                        <div class="spacing-preset" data-value="20">Medium</div>
                        <div class="spacing-preset" data-value="30">Large</div>
                        <div class="spacing-preset" data-value="40">XL</div>
                        <div class="spacing-preset" data-value="60">XXL</div>
                    </div>
                </div>

                <div style="display: flex; gap: 12px; margin-top: 16px;">
                    <button class="btn btn-secondary" id="apply-spacing" style="flex: 1;">Apply</button>
                    <button class="btn btn-secondary" id="reset-spacing" style="flex: 1;">Reset</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Grid Layout Modal -->
    <div class="spacing-modal" id="grid-layout-modal">
        <div class="spacing-modal-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="margin: 0; font-size: 20px; font-weight: 600; color: #1e293b;">Grid Layout</h3>
                <button id="close-grid-modal"
                    style="background: none; border: none; font-size: 24px; cursor: pointer; color: #6b7280;">&times;</button>
            </div>

            <div class="spacing-controls">
                <div>
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">Layout
                        Type</label>
                    <div class="spacing-presets">
                        <div class="spacing-preset grid-preset" data-layout="single">Single Column</div>
                        <div class="spacing-preset grid-preset" data-layout="two">Two Columns</div>
                        <div class="spacing-preset grid-preset" data-layout="three">Three Columns</div>
                        <div class="spacing-preset grid-preset" data-layout="four">Four Columns</div>
                        <div class="spacing-preset grid-preset" data-layout="masonry">Masonry</div>
                        <div class="spacing-preset grid-preset" data-layout="auto">Auto Fit</div>
                    </div>
                </div>

                <div>
                    <label style="display: block; margin-bottom: 8px; font-weight: 500; color: #374151;">Gap Size: <span
                            id="grid-gap-value">20px</span></label>
                    <input type="range" class="spacing-slider" id="grid-gap-slider" min="0" max="50" value="20">
                </div>

                <div style="display: flex; gap: 12px; margin-top: 16px;">
                    <button class="btn btn-secondary" id="apply-grid" style="flex: 1;">Apply Layout</button>
                    <button class="btn btn-secondary" id="reset-grid" style="flex: 1;">Reset</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Menu Item Modal -->
    <div class="spacing-modal" id="menu-item-modal">
        <div class="spacing-modal-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="margin: 0; font-size: 20px; font-weight: 600; color: #1e293b;">Add Menu Item</h3>
                <button id="close-menu-modal"
                    style="background: none; border: none; font-size: 24px; cursor: pointer; color: #6b7280;">&times;</button>
            </div>

            <div class="spacing-controls">
                <div class="form-group">
                    <label class="form-label">Menu Item Name</label>
                    <input type="text" class="form-input" id="menu-item-name" placeholder="e.g., Men's Clothing">
                </div>

                <div class="form-group">
                    <label class="form-label">Collection</label>
                    <select class="form-select" id="menu-item-collection">
                        <option value="">Select Collection</option>
                        <option value="sample-1">Men's Shoes Collection</option>
                        <option value="sample-2">Women's Shoes Collection</option>
                        <option value="sample-3">Kids' Shoes Collection</option>
                        <option value="sample-4">Sports Collection</option>
                    </select>
                </div>

                <div style="display: flex; gap: 12px; margin-top: 16px;">
                    <button class="btn btn-primary" id="add-menu-item-confirm" style="flex: 1;">Add Menu Item</button>
                    <button class="btn btn-secondary" id="cancel-menu-item" style="flex: 1;">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        console.log('Professional Builder script loaded! Version: ' + new Date().getTime());

        // Hero Slider Class
        class HeroSlider {
            constructor(section) {
                this.section = section;
                this.slides = [];
                this.currentSlide = 0;
                this.autoplayDuration = 5000; // 5 seconds default
                this.autoplayInterval = null;
                this.isAutoPlaying = false;

                this.init();
            }

            init() {
                console.log('Initializing HeroSlider for section:', this.section);
                this.loadSlides();
                this.setupEventListeners();
            }

            loadSlides() {
                // Load slides from the section HTML
                const slideElements = this.section.querySelectorAll('.hero-slide');
                this.slides = Array.from(slideElements);
                console.log('Loaded slides:', this.slides.length);
            }

            setupEventListeners() {
                // Add click handlers for navigation
                const prevBtn = this.section.querySelector('.hero-prev');
                const nextBtn = this.section.querySelector('.hero-next');

                if (prevBtn) {
                    prevBtn.addEventListener('click', () => this.previousSlide());
                }

                if (nextBtn) {
                    nextBtn.addEventListener('click', () => this.nextSlide());
                }

                // Add dot navigation
                const dots = this.section.querySelectorAll('.hero-dot');
                dots.forEach((dot, index) => {
                    dot.addEventListener('click', () => this.goToSlide(index));
                });
            }

            setAutoplayDuration(duration) {
                this.autoplayDuration = parseInt(duration) * 1000; // Convert to milliseconds
                console.log('Autoplay duration set to:', this.autoplayDuration);

                if (this.isAutoPlaying) {
                    this.stopAutoPlay();
                    this.startAutoPlay();
                }
            }

            startAutoPlay() {
                if (this.slides.length <= 1) return; // Don't autoplay if only one slide

                this.stopAutoPlay(); // Clear any existing interval
                this.isAutoPlaying = true;

                this.autoplayInterval = setInterval(() => {
                    this.nextSlide();
                }, this.autoplayDuration);

                console.log('Autoplay started with duration:', this.autoplayDuration);
            }

            stopAutoPlay() {
                if (this.autoplayInterval) {
                    clearInterval(this.autoplayInterval);
                    this.autoplayInterval = null;
                }
                this.isAutoPlaying = false;
                console.log('Autoplay stopped');
            }

            nextSlide() {
                if (this.slides.length === 0) return;

                this.currentSlide = (this.currentSlide + 1) % this.slides.length;
                this.updateSlideDisplay();
            }

            previousSlide() {
                if (this.slides.length === 0) return;

                this.currentSlide = this.currentSlide === 0 ? this.slides.length - 1 : this.currentSlide - 1;
                this.updateSlideDisplay();
            }

            goToSlide(index) {
                if (index >= 0 && index < this.slides.length) {
                    this.currentSlide = index;
                    this.updateSlideDisplay();
                }
            }

            updateSlideDisplay() {
                // Hide all slides
                this.slides.forEach((slide, index) => {
                    slide.style.display = index === this.currentSlide ? 'block' : 'none';
                });

                // Update dots
                const dots = this.section.querySelectorAll('.hero-dot');
                dots.forEach((dot, index) => {
                    dot.classList.toggle('active', index === this.currentSlide);
                });

                console.log('Updated slide display to slide:', this.currentSlide);
            }

            destroy() {
                this.stopAutoPlay();
                console.log('HeroSlider destroyed');
            }
        }

        class ProfessionalBuilder {
            constructor() {
                this.initialized = false;
                this.themeLoaded = false;
                this.sectionButtonsSetup = false;
                this.addingSection = false;
                this.addingSectionToCanvas = false;
                this.sections = [];
                this.currentTheme = null;
                this.isNewTheme = false;
                this.menuModalOpen = false;
                this.menuModalListenersSetup = false;

                // Unified storage configuration
                this.STORAGE_KEYS = {
                    THEMES: 'madas_themes',
                    CURRENT_THEME: 'madas_current_theme',
                    EDIT_THEME_DATA: 'madas_edit_theme_data',
                    NEW_THEME_DATA: 'madas_new_theme_data',
                    USER_PREFERENCES: 'madas_user_preferences'
                };

                // Data validation functions
                this.validateThemeData = (themeData) => {
                    if (!themeData || typeof themeData !== 'object') {
                        throw new Error('Invalid theme data: must be an object');
                    }

                    return {
                        id: themeData.id || this.generateUniqueId(),
                        name: themeData.name && themeData.name.trim() !== '' ? themeData.name.trim() : 'My Website',
                        description: themeData.description || '',
                        sections: Array.isArray(themeData.sections) ? themeData.sections : [],
                        status: themeData.status || 'draft',
                        createdAt: themeData.createdAt || new Date().toISOString(),
                        lastModified: new Date().toISOString(),
                        userId: themeData.userId || 'demo-user',
                        uniqueId: themeData.uniqueId || this.generateUniqueId()
                    };
                };

                this.generateUniqueId = () => {
                    return 'unique-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
                };

                this.ensureDataConsistency = () => {
                    try {
                        console.log(' Ensuring data consistency...');

                        // Get all theme data from different sources
                        const savedThemes = JSON.parse(localStorage.getItem('savedThemes') || '[]');
                        const firebaseThemes = JSON.parse(localStorage.getItem('firebase_themes') || '[]');
                        const madasThemes = JSON.parse(localStorage.getItem(this.STORAGE_KEYS.THEMES) || '[]');

                        // Merge and deduplicate themes
                        const allThemes = [...savedThemes, ...firebaseThemes, ...madasThemes];
                        const uniqueThemes = this.deduplicateThemes(allThemes);

                        // Save unified themes
                        localStorage.setItem(this.STORAGE_KEYS.THEMES, JSON.stringify(uniqueThemes));

                        console.log(` Data consistency ensured: ${uniqueThemes.length} unique themes`);
                        return uniqueThemes;
                    } catch (error) {
                        console.error(' Error ensuring data consistency:', error);
                        return [];
                    }
                };

                this.deduplicateThemes = (themes) => {
                    const seen = new Set();
                    return themes.filter(theme => {
                        const key = theme.id || theme.uniqueId;
                        if (seen.has(key)) {
                            return false;
                        }
                        seen.add(key);
                        return true;
                    });
                };

                // Message functions
                this.showSuccessMessage = (message) => {
                    this.showMessage(message, 'success');
                };

                this.showErrorMessage = (message) => {
                    this.showMessage(message, 'error');
                };

                this.showMessage = (message, type) => {
                    if (type === undefined) type = 'success';
                    try {
                        const existing = document.querySelector('.dynamic-message');
                        if (existing) existing.remove();

                        const messageElement = document.createElement('div');
                        messageElement.className = `dynamic-message fixed top-20 left-1/2 transform -translate-x-1/2 px-4 py-2 rounded-lg shadow-md z-50 text-sm 
                            ${type === 'success' ? 'bg-green-500 text-white' : 'bg-red-500 text-white'} 
                            transition-all duration-300 ease-in-out opacity-100`;

                        messageElement.setAttribute('role', 'alert');
                        messageElement.setAttribute('aria-live', 'assertive');

                        messageElement.innerHTML = `
                            <div class="flex items-center gap-2">
                                <span>${message}</span>
                                <button class="ml-2 text-white hover:text-gray-200 focus:outline-none">&times;</button>
                            </div>
                        `;

                        const closeButton = messageElement.querySelector('button');
                        closeButton.addEventListener('click', () => {
                            messageElement.remove();
                        });

                        document.body.appendChild(messageElement);

                        setTimeout(() => {
                            if (document.body.contains(messageElement)) {
                                messageElement.remove();
                            }
                        }, 5000);

                    } catch (error) {
                        console.error('Error showing message:', error);
                    }
                };

                this.showClearStorageOption = () => {
                    const modal = document.createElement('div');
                    modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center';
                    modal.innerHTML = `
                        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4">
                            <div class="text-center">
                                <div class="w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <span class="material-icons text-orange-600 text-2xl">storage</span>
                                </div>
                                <h3 class="text-xl font-bold text-gray-900 mb-2">Storage Quota Exceeded</h3>
                                <p class="text-gray-600 mb-6">Your browser's local storage is full. You can either:</p>
                                
                                <div class="space-y-3 mb-6">
                                    <div class="bg-blue-50 p-3 rounded-lg">
                                        <h4 class="font-semibold text-blue-900 mb-1">Option 1: Sign In (Recommended)</h4>
                                        <p class="text-sm text-blue-700">Use cloud storage with unlimited space</p>
                                    </div>
                                    <div class="bg-orange-50 p-3 rounded-lg">
                                        <h4 class="font-semibold text-orange-900 mb-1">Option 2: Clear Local Data</h4>
                                        <p class="text-sm text-orange-700">Remove old themes to free up space</p>
                                    </div>
                                </div>

                                <div class="flex space-x-3">
                                    <button id="clear-storage" class="flex-1 px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors">
                                        Clear Storage
                                    </button>
                                    <button id="sign-in" class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                        Sign In
                                    </button>
                                    <button id="close-modal" class="flex-1 px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;

                    document.body.appendChild(modal);

                    // Handle clear storage
                    modal.querySelector('#clear-storage').addEventListener('click', () => {
                        this.clearLocalStorage();
                        modal.remove();
                    });

                    // Handle sign in
                    modal.querySelector('#sign-in').addEventListener('click', () => {
                        this.showSignInPrompt();
                        modal.remove();
                    });

                    // Handle close
                    modal.querySelector('#close-modal').addEventListener('click', () => {
                        modal.remove();
                    });

                    // Handle backdrop click
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) {
                            modal.remove();
                        }
                    });
                };

                this.clearLocalStorage = () => {
                    try {
                        // Clear theme-related localStorage
                        localStorage.removeItem('savedThemes');
                        localStorage.removeItem('firebase_themes');
                        localStorage.removeItem('newThemeData');
                        localStorage.removeItem('editThemeData');
                        localStorage.removeItem('newThemeMetadata');

                        this.showSuccessMessage('Local storage cleared successfully! You can now save your theme.');
                    } catch (error) {
                        console.error('Error clearing localStorage:', error);
                        this.showErrorMessage('Failed to clear storage. Please try signing in instead.');
                    }
                };

                this.showSignInPrompt = () => {
                    const modal = document.createElement('div');
                    modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center';
                    modal.innerHTML = `
                        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4">
                            <div class="text-center">
                                <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <span class="material-icons text-blue-600 text-2xl">cloud_upload</span>
                                </div>
                                <h3 class="text-xl font-bold text-gray-900 mb-2">Sign In for Cloud Storage</h3>
                                <p class="text-gray-600 mb-6">Sign in to use unlimited cloud storage for your themes. Your themes will be saved securely and accessible from any device.</p>
                                
                                <div class="space-y-3 mb-6">
                                    <div class="bg-green-50 p-3 rounded-lg">
                                        <h4 class="font-semibold text-green-900 mb-1">Benefits of Cloud Storage:</h4>
                                        <ul class="text-sm text-green-700 text-left space-y-1">
                                            <li> Unlimited storage space</li>
                                            <li> Access from any device</li>
                                            <li> Automatic backups</li>
                                            <li> Secure and reliable</li>
                                        </ul>
                                    </div>
                                </div>

                                <div class="flex space-x-3">
                                    <button id="sign-in-google" class="flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
                                        Sign in with Google
                                    </button>
                                    <button id="close-signin" class="flex-1 px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                                        Maybe Later
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;

                    document.body.appendChild(modal);

                    // Handle Google sign in
                    modal.querySelector('#sign-in-google').addEventListener('click', () => {
                        this.initiateGoogleSignIn();
                        modal.remove();
                    });

                    // Handle close
                    modal.querySelector('#close-signin').addEventListener('click', () => {
                        modal.remove();
                    });

                    // Handle backdrop click
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) {
                            modal.remove();
                        }
                    });
                };

                this.initiateGoogleSignIn = () => {
                    try {
                        if (this.checkBridgeService()) {
                            // Use the bridge service to sign in
                            window.bridgeService.signInWithGoogle().then(() => {
                                this.showSuccessMessage('Signed in successfully! You can now use cloud storage.');
                                // Automatically retry saving the current theme
                                this.retrySaveAfterSignIn();
                            }).catch((error) => {
                                console.error('Sign in failed:', error);
                                this.showErrorMessage('Sign in failed. Please try again.');
                            });
                        } else {
                            this.showServiceUnavailableModal();
                        }
                    } catch (error) {
                        console.error('Error initiating sign in:', error);
                        this.showErrorMessage('Error starting sign in process.');
                    }
                };

                this.retrySaveAfterSignIn = () => {
                    // Wait a moment for authentication to complete
                    setTimeout(() => {
                        if (this.currentTheme) {
                            console.log('Retrying save after sign in...');
                            this.saveTheme();
                        }
                    }, 1000);
                };

                this.showPreviewSignInPrompt = () => {
                    const modal = document.createElement('div');
                    modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center';
                    modal.innerHTML = `
                        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4">
                            <div class="text-center">
                                <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <span class="material-icons text-purple-600 text-2xl">visibility</span>
                                </div>
                                <h3 class="text-xl font-bold text-gray-900 mb-2">Sign In to Create Preview</h3>
                                <p class="text-gray-600 mb-6">Sign in to create a preview link for your theme. Preview links allow you to share your work with others before publishing.</p>
                                
                                <div class="space-y-3 mb-6">
                                    <div class="bg-purple-50 p-3 rounded-lg">
                                        <h4 class="font-semibold text-purple-900 mb-1">Preview Features:</h4>
                                        <ul class="text-sm text-purple-700 text-left space-y-1">
                                            <li> Share your theme with others</li>
                                            <li> Get feedback before publishing</li>
                                            <li> 24-hour temporary links</li>
                                            <li> Secure and private</li>
                                        </ul>
                                    </div>
                                </div>

                                <div class="flex space-x-3">
                                    <button id="preview-sign-in-google" class="flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
                                        Sign in with Google
                                    </button>
                                    <button id="preview-close-signin" class="flex-1 px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                                        Maybe Later
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;

                    document.body.appendChild(modal);

                    // Handle Google sign in
                    modal.querySelector('#preview-sign-in-google').addEventListener('click', () => {
                        this.initiatePreviewSignIn();
                        modal.remove();
                    });

                    // Handle close
                    modal.querySelector('#preview-close-signin').addEventListener('click', () => {
                        modal.remove();
                    });

                    // Handle backdrop click
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) {
                            modal.remove();
                        }
                    });
                };

                this.initiatePreviewSignIn = () => {
                    try {
                        if (this.checkBridgeService()) {
                            // Use the bridge service to sign in
                            window.bridgeService.signInWithGoogle().then(() => {
                                this.showSuccessMessage('Signed in successfully! Creating preview...');
                                // Automatically retry creating preview after sign in
                                this.retryPreviewAfterSignIn();
                            }).catch((error) => {
                                console.error('Sign in failed:', error);
                                this.showErrorMessage('Sign in failed. Please try again.');
                            });
                        } else {
                            this.showServiceUnavailableModal();
                        }
                    } catch (error) {
                        console.error('Error initiating sign in:', error);
                        this.showErrorMessage('Error starting sign in process.');
                    }
                };

                this.retryPreviewAfterSignIn = () => {
                    // Wait a moment for authentication to complete
                    setTimeout(() => {
                        console.log('Retrying preview creation after sign in...');
                        this.createPreview();
                    }, 1000);
                };

                this.showPublishSignInPrompt = () => {
                    const modal = document.createElement('div');
                    modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center';
                    modal.innerHTML = `
                        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4">
                            <div class="text-center">
                                <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <span class="material-icons text-green-600 text-2xl">publish</span>
                                </div>
                                <h3 class="text-xl font-bold text-gray-900 mb-2">Sign In to Publish</h3>
                                <p class="text-gray-600 mb-6">Sign in to publish your theme and make it live on the web. Publishing creates a public website that others can visit.</p>
                                
                                <div class="space-y-3 mb-6">
                                    <div class="bg-green-50 p-3 rounded-lg">
                                        <h4 class="font-semibold text-green-900 mb-1">Publishing Benefits:</h4>
                                        <ul class="text-sm text-green-700 text-left space-y-1">
                                            <li> Make your website live on the internet</li>
                                            <li> Get a custom subdomain (username.myapp.com)</li>
                                            <li> Connect your own domain name</li>
                                            <li> Professional hosting with Firebase</li>
                                        </ul>
                                    </div>
                                </div>

                                <div class="flex space-x-3">
                                    <button id="publish-sign-in-google" class="flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
                                        Sign in with Google
                                    </button>
                                    <button id="publish-close-signin" class="flex-1 px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                                        Maybe Later
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;

                    document.body.appendChild(modal);

                    // Handle Google sign in
                    modal.querySelector('#publish-sign-in-google').addEventListener('click', () => {
                        this.initiatePublishSignIn();
                        modal.remove();
                    });

                    // Handle close
                    modal.querySelector('#publish-close-signin').addEventListener('click', () => {
                        modal.remove();
                        // Save locally when user chooses not to sign in
                        this.saveLocallyAndShowMessage();
                    });

                    // Handle backdrop click
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) {
                            modal.remove();
                        }
                    });
                };

                this.initiatePublishSignIn = () => {
                    try {
                        if (this.checkBridgeService()) {
                            // Use the bridge service to sign in
                            window.bridgeService.signInWithGoogle().then(() => {
                                this.showSuccessMessage('Signed in successfully! Publishing your theme...');
                                // Automatically retry publishing after sign in
                                this.retryPublishAfterSignIn();
                            }).catch((error) => {
                                console.error('Sign in failed:', error);
                                this.showErrorMessage('Sign in failed. Please try again.');
                            });
                        } else {
                            this.showServiceUnavailableModal();
                        }
                    } catch (error) {
                        console.error('Error initiating sign in:', error);
                        this.showErrorMessage('Error starting sign in process.');
                    }
                };

                this.retryPublishAfterSignIn = () => {
                    // Wait a moment for authentication to complete
                    setTimeout(() => {
                        console.log('Retrying publish after sign in...');
                        this.confirmPublish();
                    }, 1000);
                };

                this.checkBridgeService = () => {
                    try {
                        // Check if bridge service exists and is initialized
                        if (!window.bridgeService) {
                            console.error('Bridge service not found');
                            return false;
                        }

                        if (!window.bridgeService.isInitialized) {
                            console.error('Bridge service not initialized');
                            return false;
                        }

                        if (!window.bridgeService.firebase || !window.bridgeService.auth) {
                            console.error('Firebase not properly initialized in bridge service');
                            return false;
                        }

                        return true;
                    } catch (error) {
                        console.error('Error checking bridge service:', error);
                        return false;
                    }
                };

                this.saveLocallyAndShowMessage = () => {
                    try {
                        // Save theme locally without authentication
                        const themeData = this.getCurrentThemeData();
                        this.saveWithLocalStorage(themeData);

                        this.showSuccessMessage('Theme saved locally! You can sign in later to publish it online.');

                        // Show info about local vs cloud saving
                        setTimeout(() => {
                            this.showInfoMessage('Your theme is saved locally. To publish it online and make it live, please sign in.');
                        }, 2000);
                    } catch (error) {
                        console.error('Error saving locally:', error);
                        this.showErrorMessage('Failed to save theme locally. Please try again.');
                    }
                };

                this.showServiceUnavailableModal = () => {
                    const modal = document.createElement('div');
                    modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center';
                    modal.innerHTML = `
                        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4">
                            <div class="text-center">
                                <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <span class="material-icons text-red-600 text-2xl">error</span>
                                </div>
                                <h3 class="text-xl font-bold text-gray-900 mb-2">Service Unavailable</h3>
                                <p class="text-gray-600 mb-6">The authentication service is not available. This might be due to a network issue or the service is still loading.</p>
                                
                                <div class="space-y-3 mb-6">
                                    <div class="bg-yellow-50 p-3 rounded-lg">
                                        <h4 class="font-semibold text-yellow-900 mb-1">What you can do:</h4>
                                        <ul class="text-sm text-yellow-700 text-left space-y-1">
                                            <li> Refresh the page to reload services</li>
                                            <li> Check your internet connection</li>
                                            <li> Try again in a few moments</li>
                                            <li> Use local storage for now</li>
                                        </ul>
                                    </div>
                                </div>

                                <div class="flex space-x-3">
                                    <button id="refresh-page" class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                        Refresh Page
                                    </button>
                                    <button id="retry-service" class="flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                                        Retry
                                    </button>
                                    <button id="close-service-modal" class="flex-1 px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                                        Close
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;

                    document.body.appendChild(modal);

                    // Handle refresh page
                    modal.querySelector('#refresh-page').addEventListener('click', () => {
                        window.location.reload();
                    });

                    // Handle retry
                    modal.querySelector('#retry-service').addEventListener('click', () => {
                        this.retryServiceInitialization();
                        modal.remove();
                    });

                    // Handle close
                    modal.querySelector('#close-service-modal').addEventListener('click', () => {
                        modal.remove();
                    });

                    // Handle backdrop click
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) {
                            modal.remove();
                        }
                    });
                };

                this.retryServiceInitialization = () => {
                    this.showSuccessMessage('Retrying service initialization...');

                    // Wait a moment and check again
                    setTimeout(() => {
                        if (this.checkBridgeService()) {
                            this.showSuccessMessage('Services are now available! You can sign in.');
                        } else {
                            this.showErrorMessage('Services are still not available. Please try refreshing the page.');
                        }
                    }, 2000);
                };

                this.waitForBridgeService = (maxAttempts = 10, interval = 1000) => {
                    return new Promise((resolve, reject) => {
                        let attempts = 0;

                        const checkService = () => {
                            attempts++;

                            if (this.checkBridgeService()) {
                                console.log('Bridge service is now available');
                                resolve(true);
                            } else if (attempts >= maxAttempts) {
                                console.log('Bridge service not available after maximum attempts');
                                reject(new Error('Bridge service not available'));
                            } else {
                                console.log(`Waiting for bridge service... attempt ${attempts}/${maxAttempts}`);
                                setTimeout(checkService, interval);
                            }
                        };

                        checkService();
                    });
                };

                this.showServiceStatus = () => {
                    const status = this.getServiceStatus();
                    const modal = document.createElement('div');
                    modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center';
                    modal.innerHTML = `
                        <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4">
                            <div class="text-center">
                                <div class="w-16 h-16 ${status.bridgeService ? 'bg-green-100' : 'bg-red-100'} rounded-full flex items-center justify-center mx-auto mb-4">
                                    <span class="material-icons ${status.bridgeService ? 'text-green-600' : 'text-red-600'} text-2xl">${status.bridgeService ? 'check_circle' : 'error'}</span>
                                </div>
                                <h3 class="text-xl font-bold text-gray-900 mb-2">Service Status</h3>
                                
                                <div class="space-y-3 mb-6">
                                    <div class="bg-gray-50 p-3 rounded-lg text-left">
                                        <h4 class="font-semibold text-gray-900 mb-2">Service Status:</h4>
                                        <div class="space-y-2">
                                            <div class="flex items-center justify-between">
                                                <span class="text-sm text-gray-600">Bridge Service:</span>
                                                <span class="text-sm font-medium ${status.bridgeService ? 'text-green-600' : 'text-red-600'}">
                                                    ${status.bridgeService ? 'Available' : 'Unavailable'}
                                                </span>
                                            </div>
                                            <div class="flex items-center justify-between">
                                                <span class="text-sm text-gray-600">Firebase:</span>
                                                <span class="text-sm font-medium ${status.firebase ? 'text-green-600' : 'text-red-600'}">
                                                    ${status.firebase ? 'Available' : 'Unavailable'}
                                                </span>
                                            </div>
                                            <div class="flex items-center justify-between">
                                                <span class="text-sm text-gray-600">Authentication:</span>
                                                <span class="text-sm font-medium ${status.auth ? 'text-green-600' : 'text-red-600'}">
                                                    ${status.auth ? 'Available' : 'Unavailable'}
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="flex space-x-3">
                                    <button id="close-status" class="flex-1 px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                                        Close
                                    </button>
                                    ${!status.bridgeService ? `
                                        <button id="retry-status" class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                            Retry
                                        </button>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    `;

                    document.body.appendChild(modal);

                    // Handle close
                    modal.querySelector('#close-status').addEventListener('click', () => {
                        modal.remove();
                    });

                    // Handle retry if available
                    const retryBtn = modal.querySelector('#retry-status');
                    if (retryBtn) {
                        retryBtn.addEventListener('click', () => {
                            modal.remove();
                            this.retryServiceInitialization();
                        });
                    }

                    // Handle backdrop click
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) {
                            modal.remove();
                        }
                    });
                };

                this.getServiceStatus = () => {
                    return {
                        bridgeService: !!window.bridgeService,
                        firebase: !!(window.bridgeService && window.bridgeService.firebase),
                        auth: !!(window.bridgeService && window.bridgeService.auth),
                        initialized: !!(window.bridgeService && window.bridgeService.isInitialized)
                    };
                };
            }

            init() {
                if (this.initialized) {
                    console.log('Builder already initialized, skipping...');
                    return;
                }

                console.log('=== INITIALIZING PROFESSIONAL BUILDER ===');

                try {
                    this.checkForThemeData();
                    this.renderDefaultWebsite();
                    this.setupEventListeners();
                    this.setupSectionButtons();
                    this.updateLiveSiteButtonVisibility();

                    this.initialized = true;
                    console.log('=== PROFESSIONAL BUILDER INITIALIZATION COMPLETE ===');
                } catch (error) {
                    console.error('Error during initialization:', error);
                }
            }

            // Clear current theme data to prevent contamination
            clearCurrentTheme() {
                console.log(' Clearing current theme data...');
                this.currentTheme = null;
                this.themeLoaded = false;
                this.sectionButtonsSetup = false;
                this.addingSection = false;
                this.addingSectionToCanvas = false;

                // Clear localStorage flags
                localStorage.removeItem('editThemeData');
                localStorage.removeItem('newThemeData');

                console.log(' Current theme data cleared');
            }

            async checkForThemeData() {
                // Check URL parameters for theme data
                const urlParams = new URLSearchParams(window.location.search);
                const mode = urlParams.get('mode');
                const themeId = urlParams.get('theme');

                if (mode === 'new' && themeId) {
                    // Clear any existing theme data for new theme
                    this.clearCurrentTheme();
                    this.isNewTheme = true;
                    this.themeLoaded = false; // Reset for new theme
                    console.log('New theme mode detected, theme ID:', themeId);

                    // Try Firebase first, then localStorage
                    let themeMetadata = null;
                    if (window.bridgeService && typeof window.bridgeService.isAuthenticated === 'function' && window.bridgeService.isAuthenticated()) {
                        try {
                            const firebaseTheme = await this.loadCurrentThemeFromFirebase();
                            if (firebaseTheme) {
                                themeMetadata = firebaseTheme;
                                console.log('Loaded new theme metadata from Firebase:', themeMetadata);
                            }
                        } catch (error) {
                            console.log('Firebase load failed, trying localStorage...');
                        }
                    } else {
                        console.log('Bridge service not available or not authenticated, using localStorage...');
                    }

                    if (!themeMetadata) {
                        const localThemeMetadata = localStorage.getItem('newThemeMetadata');
                        if (localThemeMetadata) {
                            themeMetadata = JSON.parse(localThemeMetadata);
                            console.log('Loaded new theme metadata from localStorage:', themeMetadata);
                        }
                    }

                    if (themeMetadata) {
                        this.currentTheme = themeMetadata;
                        // Update the page title with theme name
                        if (this.currentTheme.name) {
                            document.title = `Building: ${this.currentTheme.name} - MADAS Website Builder`;
                        }
                    }
                } else if (mode === 'edit' && themeId) {
                    // Clear any existing theme data for edit mode
                    this.clearCurrentTheme();
                    // Editing existing theme
                    this.isNewTheme = false;
                    this.themeLoaded = false; // Reset for edit mode
                    console.log('Edit mode detected, theme ID:', themeId);

                    // Try Firebase first, then localStorage
                    let editThemeData = null;
                    if (window.bridgeService && typeof window.bridgeService.isAuthenticated === 'function' && window.bridgeService.isAuthenticated()) {
                        try {
                            const firebaseTheme = await this.loadCurrentThemeFromFirebase();
                            if (firebaseTheme) {
                                editThemeData = firebaseTheme;
                                console.log('Loaded existing theme for editing from Firebase:', editThemeData);
                            }
                        } catch (error) {
                            console.log('Firebase load failed, trying localStorage...');
                        }
                    } else {
                        console.log('Bridge service not available or not authenticated, using localStorage...');
                    }

                    if (!editThemeData) {
                        const localEditThemeData = localStorage.getItem('editThemeData');
                        if (localEditThemeData) {
                            editThemeData = JSON.parse(localEditThemeData);
                            console.log('Loaded existing theme for editing from localStorage:', editThemeData);
                        }
                    }

                    if (editThemeData) {
                        // Ensure theme isolation when loading for editing
                        const isolatedEditTheme = this.ensureThemeIsolation(editThemeData);
                        this.currentTheme = isolatedEditTheme;
                        console.log(' Loaded isolated theme for editing:', isolatedEditTheme.name);
                        console.log(' Theme details:', {
                            id: isolatedEditTheme.id,
                            name: isolatedEditTheme.name,
                            sections: isolatedEditTheme.sections?.length || 0
                        });

                        // Update the page title with theme name
                        if (this.currentTheme.name) {
                            document.title = `Editing: ${this.currentTheme.name} - MADAS Website Builder`;
                        }

                        // Update the theme name input field if it exists
                        const themeNameInput = document.getElementById('theme-name');
                        if (themeNameInput && this.currentTheme.name) {
                            themeNameInput.value = this.currentTheme.name;
                            console.log(' Updated theme name input to:', this.currentTheme.name);
                        }
                    } else {
                        console.error('No theme data found for editing');
                        this.showSuccessMessage('Error: Theme data not found. Redirecting to new theme creation.');
                        setTimeout(() => {
                            window.location.href = 'theme-library.html';
                        }, 2000);
                    }
                } else {
                    // Default case - no specific mode
                    console.log('No specific mode detected, starting with blank canvas');
                }

                // Check localStorage for theme data
                const themeData = localStorage.getItem('newThemeData');
                const editThemeData = localStorage.getItem('editThemeData');

                if (themeData) {
                    try {
                        this.currentTheme = JSON.parse(themeData);
                        console.log('New theme data loaded:', this.currentTheme);

                        // If template is specified, load it after a short delay
                        if (this.currentTheme.template) {
                            setTimeout(() => {
                                this.loadTemplate(this.currentTheme.template);
                            }, 1000);
                        }

                        // Clear the theme data from localStorage after loading
                        localStorage.removeItem('newThemeData');
                    } catch (error) {
                        console.error('Error parsing theme data:', error);
                    }
                } else if (editThemeData) {
                    try {
                        const parsedEditTheme = JSON.parse(editThemeData);
                        // Ensure theme isolation when loading from localStorage
                        const isolatedEditTheme = this.ensureThemeIsolation(parsedEditTheme);
                        this.currentTheme = isolatedEditTheme;
                        console.log(' Edit theme data loaded with isolation:', this.currentTheme);
                        console.log(' Theme name preserved:', this.currentTheme.name);

                        // Update the theme name input field if it exists
                        const themeNameInput = document.getElementById('theme-name');
                        if (themeNameInput && this.currentTheme.name) {
                            themeNameInput.value = this.currentTheme.name;
                            console.log(' Updated theme name input to:', this.currentTheme.name);
                        }

                        // Load existing theme sections
                        if (!this.themeLoaded) {
                            setTimeout(() => {
                                this.loadExistingTheme(this.currentTheme);
                            }, 500);
                        } else {
                            console.log('Theme already loaded, skipping duplicate load in checkForThemeData');
                        }

                        // Clear the theme data from localStorage after loading
                        localStorage.removeItem('editThemeData');
                    } catch (error) {
                        console.error('Error parsing edit theme data:', error);
                    }
                }
            }

            renderDefaultWebsite() {
                const canvas = document.getElementById('canvas');
                if (!canvas) {
                    console.error('Canvas element not found!');
                    return;
                }

                // If we have theme data, show a welcome message for the new theme
                if (this.currentTheme && this.isNewTheme) {
                    console.log('Rendering new theme welcome...');
                    canvas.innerHTML = `
                        <div style="display: flex; align-items: center; justify-content: center; min-height: 400px; color: #1e293b; text-align: center; font-size: 18px; background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%); border-radius: 12px; padding: 40px;">
                            <div>
                                <div style="font-size: 48px; margin-bottom: 16px;"></div>
                                <h2 style="font-size: 24px; font-weight: 700; margin: 0 0 12px 0; color: #1e293b;">Welcome to "${this.currentTheme.name}"</h2>
                                <p style="margin: 0 0 24px 0; color: #64748b; font-size: 16px;">${this.currentTheme.description || 'Your new theme is ready to be customized!'}</p>
                                <p style="margin: 0; color: #9ca3af; font-size: 14px;">Click "Add Section" to start building your website</p>
                            </div>
                        </div>
                    `;
                } else if (this.currentTheme && !this.isNewTheme) {
                    // This is an edit mode, load the existing theme
                    console.log('Edit mode detected, loading existing theme...');
                    if (!this.themeLoaded) {
                        setTimeout(() => {
                            this.loadExistingTheme(this.currentTheme);
                        }, 500);
                    } else {
                        console.log('Theme already loaded, skipping duplicate load in renderDefaultWebsite');
                    }
                } else {
                    // Only show empty canvas if there's no content
                    this.checkAndShowPlaceholder();
                }
            }

            setupEventListeners() {
                console.log('Setting up event listeners...');

                // Prevent duplicate event listeners
                if (this.eventListenersSetup) {
                    console.log('Event listeners already setup, skipping...');
                    return;
                }

                // Back button
                const backBtn = document.getElementById('back-btn');
                if (backBtn) {
                    console.log('Setting up back button...');
                    backBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        console.log('Back button clicked!');
                        // Navigate back to theme library
                        window.location.href = 'theme-library.html';
                    });
                } else {
                    console.error('Back button not found!');
                }

                // Add section button
                const addSectionBtn = document.getElementById('add-section-btn');
                if (addSectionBtn) {
                    console.log('Add section button found, adding event listener...');

                    // Remove existing event listeners to prevent duplicates
                    const newAddSectionBtn = addSectionBtn.cloneNode(true);
                    addSectionBtn.parentNode.replaceChild(newAddSectionBtn, addSectionBtn);

                    newAddSectionBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        console.log('Add section button clicked!');
                        this.showAddSectionModal();
                    });
                } else {
                    console.error('Add section button not found!');
                }

                // Mark event listeners as setup
                this.eventListenersSetup = true;

                // Save button
                const saveBtn = document.getElementById('save-btn');
                if (saveBtn) {
                    console.log('Save button found, adding event listener...');
                    saveBtn.addEventListener('click', () => {
                        console.log('Save button clicked!');
                        this.showSaveConfirmation();
                    });
                } else {
                    console.error('Save button not found!');
                }

                // Publish button
                const publishBtn = document.getElementById('publish-btn');
                if (publishBtn) {
                    console.log('Publish button found, adding event listener...');
                    publishBtn.addEventListener('click', () => {
                        console.log('Publish button clicked!');
                        this.publishTheme();
                    });
                } else {
                    console.error('Publish button not found!');
                }

                // Setup preview button
                const previewBtn = document.getElementById('preview-btn');
                if (previewBtn) {
                    console.log('Preview button found, adding event listener...');
                    previewBtn.addEventListener('click', () => {
                        console.log('Preview button clicked!');
                        this.createPreview();
                    });
                }

                // Setup debug button
                const debugBtn = document.getElementById('debug-btn');
                if (debugBtn) {
                    console.log('Debug button found, adding event listener...');
                    debugBtn.addEventListener('click', () => {
                        console.log('Debug button clicked!');
                        this.debugCanvas();
                    });
                }

                // Setup storage button
                const storageBtn = document.getElementById('show-storage-btn');
                if (storageBtn) {
                    console.log('Storage button found, adding event listener...');
                    storageBtn.addEventListener('click', () => {
                        console.log('Storage button clicked!');
                        this.showStorageInfo();
                    });
                } else {
                    console.error('Debug button not found!');
                }

                // Setup debug preview button
                const debugPreviewBtn = document.getElementById('debug-preview-btn');
                if (debugPreviewBtn) {
                    console.log('Debug preview button found, adding event listener...');
                    debugPreviewBtn.addEventListener('click', () => {
                        console.log('Debug preview button clicked!');
                        this.debugPreviewData();
                    });
                } else {
                    console.error('Debug preview button not found!');
                }
                // Live Site button
                const liveSiteBtn = document.getElementById('live-site-btn');
                if (liveSiteBtn) {
                    console.log('Live site button found, adding event listener...');
                    liveSiteBtn.addEventListener('click', () => {
                        console.log('Live site button clicked!');
                        this.redirectToLiveSite();
                    });
                } else {
                    console.error('Live site button not found!');
                }

                // Preview modes
                const previewModes = document.querySelectorAll('.preview-mode');
                console.log('Found preview modes:', previewModes.length);
                previewModes.forEach(mode => {
                    mode.addEventListener('click', (e) => {
                        console.log('Preview mode clicked:', mode.dataset.mode);
                        document.querySelectorAll('.preview-mode').forEach(m => m.classList.remove('active'));
                        mode.classList.add('active');
                        this.setPreviewMode(mode.dataset.mode);
                    });
                });

                // Modal close button
                const modalCloseBtn = document.getElementById('modal-close-btn');
                if (modalCloseBtn) {
                    console.log('Modal close button found, adding event listener...');
                    modalCloseBtn.addEventListener('click', () => {
                        console.log('Modal close button clicked!');
                        this.hideAddSectionModal();
                    });
                } else {
                    console.error('Modal close button not found!');
                }

                // Modal backdrop click
                const modal = document.getElementById('add-section-modal');
                if (modal) {
                    console.log('Modal found, adding click outside listener...');
                    modal.addEventListener('click', (e) => {
                        if (e.target.id === 'add-section-modal') {
                            console.log('Modal backdrop clicked, closing modal...');
                            this.hideAddSectionModal();
                        }
                    });
                } else {
                    console.error('Modal not found!');
                }

                // Click outside to deselect sections (but not when clicking in editor or modal)
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('.canvas-section') &&
                        !e.target.closest('#component-editor') &&
                        !e.target.closest('#menu-item-modal') &&
                        !this.menuModalOpen) {
                        this.deselectAllSections();
                    }
                });

                // Close editor button
                const closeEditorBtn = document.getElementById('close-editor');
                if (closeEditorBtn) {
                    console.log('Close editor button found, adding event listener...');
                    closeEditorBtn.addEventListener('click', () => {
                        console.log('Close editor button clicked!');
                        this.closeComponentEditor();
                    });
                } else {
                    console.error('Close editor button not found!');
                }

                // Left sidebar functionality
                this.setupLeftSidebar();

                // Spacing control functionality
                this.setupSpacingControl();

                // Style section functionality
                this.setupStyleSectionButton();

                // Connect sections functionality
                this.setupConnectSections();

                // Grid layout functionality
                this.setupGridLayout();
            }

            setupSectionButtons() {
                // Prevent duplicate setup
                if (this.sectionButtonsSetup) {
                    console.log('Section buttons already setup, skipping...');
                    return;
                }

                console.log('=== SETTING UP SECTION BUTTONS ===');
                const sectionCards = document.querySelectorAll('.section-card');
                console.log('Setting up modal section cards, found:', sectionCards.length);

                sectionCards.forEach(card => {
                    console.log('Setting up section card:', card.dataset.section);

                    // Only handle button click to prevent duplicates
                    const useBtn = card.querySelector('.use-section-btn');
                    if (useBtn) {
                        useBtn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            e.preventDefault();

                            // Prevent duplicate calls
                            if (useBtn.disabled) {
                                console.log('Button already processing, ignoring click');
                                return;
                            }

                            const sectionType = card.dataset.section;

                            // Add loading state
                            useBtn.textContent = 'Adding...';
                            useBtn.disabled = true;

                            console.log('Adding section type:', sectionType);
                            this.addSection(sectionType);

                            // Reset button state after a short delay
                            setTimeout(() => {
                                useBtn.textContent = 'Use this section';
                                useBtn.disabled = false;
                            }, 200);
                        });
                    }
                });

                // Mark section buttons as setup
                this.sectionButtonsSetup = true;
                console.log('Modal section cards setup complete');
            }

            setPreviewMode(mode) {
                console.log('Setting preview mode:', mode);
                const canvas = document.getElementById('canvas');
                const body = document.body;

                // Remove existing preview classes
                body.classList.remove('preview-desktop', 'preview-tablet', 'preview-mobile');
                canvas.classList.remove('preview-desktop', 'preview-tablet', 'preview-mobile');

                switch (mode) {
                    case 'desktop':
                        canvas.style.maxWidth = '100%';
                        canvas.style.width = '100%';
                        canvas.style.margin = '0 auto';
                        canvas.style.border = 'none';
                        canvas.style.borderRadius = '0';
                        canvas.style.boxShadow = 'none';
                        body.classList.add('preview-desktop');
                        canvas.classList.add('preview-desktop');
                        break;
                    case 'tablet':
                        canvas.style.maxWidth = '768px';
                        canvas.style.width = '768px';
                        canvas.style.margin = '20px auto';
                        canvas.style.border = '2px solid #e2e8f0';
                        canvas.style.borderRadius = '12px';
                        canvas.style.boxShadow = '0 10px 25px rgba(0, 0, 0, 0.1)';
                        body.classList.add('preview-tablet');
                        canvas.classList.add('preview-tablet');
                        break;
                    case 'mobile':
                        canvas.style.maxWidth = '375px';
                        canvas.style.width = '375px';
                        canvas.style.margin = '20px auto';
                        canvas.style.border = '2px solid #e2e8f0';
                        canvas.style.borderRadius = '20px';
                        canvas.style.boxShadow = '0 10px 25px rgba(0, 0, 0, 0.15)';
                        body.classList.add('preview-mobile');
                        canvas.classList.add('preview-mobile');
                        break;
                }

                console.log('Preview mode set to:', mode);
            }

            showAddSectionModal() {
                console.log('Showing add section modal...');
                const modal = document.getElementById('add-section-modal');
                if (modal) {
                    modal.classList.add('active');
                    console.log('Modal shown successfully');
                } else {
                    console.error('Modal element not found!');
                }
            }

            hideAddSectionModal() {
                console.log('Hiding add section modal...');
                const modal = document.getElementById('add-section-modal');
                if (modal) {
                    modal.classList.remove('active');
                    console.log('Modal hidden successfully');
                } else {
                    console.error('Modal element not found!');
                }
            }

            addSection(sectionType) {
                // Prevent duplicate section addition
                if (this.addingSection) {
                    console.log('Section already being added, ignoring duplicate call');
                    return;
                }

                if (sectionType) {
                    // Mark as adding section to prevent duplicates
                    this.addingSection = true;

                    console.log('Adding section type:', sectionType);

                    // Add the section to canvas
                    this.addSectionToCanvas(sectionType);

                    // Hide modal and show success message
                    this.hideAddSectionModal();
                    this.showSuccessMessage(`Section "${sectionType}" added successfully!`);

                    // Reset flag after completion
                    setTimeout(() => {
                        this.addingSection = false;
                        console.log('Section addition completed, flag reset');
                    }, 2000);
                } else {
                    // If no sectionType, show the modal for selection
                    console.log('Showing add section modal');
                    this.showAddSectionModal();
                }
            }

            // Check for selected section from sections page (no longer needed since we use modal)
            checkForSelectedSection() {
                // This method is no longer needed since we use the built-in modal
                // Keeping it for compatibility but it won't do anything
                console.log('checkForSelectedSection called - using built-in modal now');
            }

            addSectionToCanvas(sectionType) {
                console.log('Adding section to canvas:', sectionType);

                // Prevent duplicate section addition
                if (this.addingSectionToCanvas) {
                    console.log('Section already being added to canvas, ignoring duplicate call');
                    return;
                }

                this.addingSectionToCanvas = true;
                const canvas = document.getElementById('canvas');

                // Initialize current theme if it doesn't exist - ensure it's completely new
                if (!this.currentTheme) {
                    const newThemeId = 'theme-' + Date.now() + '-' + Math.random().toString(36).substr(2, 5);
                    const newUniqueId = 'unique-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);

                    this.currentTheme = {
                        id: newThemeId,
                        name: 'My Website',
                        description: '',
                        sections: [],
                        status: 'draft',
                        createdAt: new Date().toISOString(),
                        userId: 'demo-user',
                        uniqueId: newUniqueId
                    };

                    console.log(' Created new theme:', this.currentTheme);
                } else {
                    console.log(' Using existing theme:', this.currentTheme);
                }

                let sectionHTML = '';

                // Get the appropriate section HTML based on type
                switch (sectionType) {
                    case 'navbar':
                    case 'header-nav':
                        sectionHTML = this.createNavbarSection();
                        break;
                    case 'hero-banner':
                        sectionHTML = this.createHeroBannerSection();
                        break;
                    case 'hero-slider':
                        sectionHTML = this.createHeroSliderSection();
                        break;
                    case 'about-us':
                        sectionHTML = this.createAboutUsSection();
                        break;
                    case 'contact-form':
                        sectionHTML = this.createContactFormSection();
                        break;
                    case 'newsletter':
                        sectionHTML = this.createNewsletterSection();
                        break;
                    case 'testimonials':
                        sectionHTML = this.createTestimonialsSection();
                        break;
                    case 'product-slider':
                    case 'product-grid':
                        sectionHTML = this.createProductSliderSection();
                        break;
                    case 'image-text':
                        sectionHTML = this.createImageTextSection();
                        break;
                    case 'header-simple':
                        sectionHTML = this.createHeaderSimpleSection();
                        break;
                    case 'text-content':
                        sectionHTML = this.createTextContentSection();
                        break;
                    case 'image-gallery':
                        sectionHTML = this.createImageGallerySection();
                        break;
                    case 'footer-simple':
                        sectionHTML = this.createFooterSimpleSection();
                        break;
                    case 'announcement-bar':
                        sectionHTML = this.createAnnouncementBarSection();
                        break;
                    case 'modal-popup':
                        sectionHTML = this.createModalPopupSection();
                        break;
                    case 'floating-button':
                        sectionHTML = this.createFloatingButtonSection();
                        break;
                    case 'accordion':
                        sectionHTML = this.createAccordionSection();
                        break;
                    case 'tabs':
                        sectionHTML = this.createTabsSection();
                        break;
                    case 'countdown-timer':
                        sectionHTML = this.createCountdownTimerSection();
                        break;
                    case 'progress-bar':
                        sectionHTML = this.createProgressBarSection();
                        break;
                    default:
                        console.log('Unknown section type:', sectionType);
                        this.showErrorMessage(`Unknown section type: ${sectionType}`);
                        return;
                }

                if (sectionHTML) {
                    // Clear the empty canvas message if it exists
                    const emptyMessage = canvas.querySelector('div[style*="add_circle_outline"]');
                    if (emptyMessage) {
                        emptyMessage.remove();
                    }

                    // Clear the welcome message if it exists
                    const welcomeMessage = canvas.querySelector('div[style*="Welcome to"]');
                    if (welcomeMessage) {
                        welcomeMessage.remove();
                    }

                    // Also clear any welcome message by looking for the specific gradient background
                    const welcomeDiv = canvas.querySelector('div[style*="linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)"]');
                    if (welcomeDiv) {
                        welcomeDiv.remove();
                    }

                    // Mark that this is no longer a new theme (user has started building)
                    this.isNewTheme = false;

                    // Add the section to the canvas at the beginning
                    canvas.insertAdjacentHTML('afterbegin', sectionHTML);

                    // Add unique ID to the new section
                    const newSection = canvas.firstElementChild;
                    if (newSection && newSection.classList.contains('canvas-section')) {
                        const sectionId = `section-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
                        newSection.id = sectionId;

                        // Make form IDs unique to prevent duplicates
                        this.makeFormIdsUnique(newSection);

                        // Setup controls for the new section
                        this.setupSectionControls();

                        // Select the new section
                        this.selectSection(newSection);

                        console.log('Section added successfully with ID:', sectionId);

                        // Update the theme name in the UI if it's still the default
                        const themeNameElement = document.getElementById('theme-name');
                        if (themeNameElement && (this.currentTheme.name === 'Untitled Theme' || this.currentTheme.name === 'My Website')) {
                            // Keep the current name or set a better default
                            if (this.currentTheme.name === 'Untitled Theme') {
                                this.currentTheme.name = 'My Website';
                                themeNameElement.value = 'My Website';
                            }
                        }
                    }
                }

                // Reset the flag after section is added
                this.addingSectionToCanvas = false;
                console.log('Section addition to canvas completed, flag reset');
            }
            setupSectionControls() {
                console.log('Setting up section controls...');
                const sections = document.querySelectorAll('.canvas-section');

                // Add global click handler for delete buttons as fallback
                document.addEventListener('click', (e) => {
                    if (e.target.closest('.delete-section-btn')) {
                        e.preventDefault();
                        e.stopPropagation();
                        const section = e.target.closest('.canvas-section');
                        if (section) {
                            console.log('Global delete button clicked for section:', section.id);
                            this.deleteSection(section);
                        }
                    }
                });

                sections.forEach(section => {
                    // Add control buttons if they don't exist
                    if (!section.querySelector('.section-controls')) {
                        const controlsDiv = document.createElement('div');
                        controlsDiv.className = 'section-controls';
                        controlsDiv.innerHTML = `
                            <button class="section-control-btn delete-section-btn" title="Delete Section">
                                <span class="material-icons" style="font-size: 14px;">delete</span>
                            </button>
                        `;
                        section.appendChild(controlsDiv);
                    }

                    // Setup control buttons
                    const controlsDiv = section.querySelector('.section-controls');
                    if (controlsDiv && !controlsDiv.hasAttribute('data-listener-added')) {
                        controlsDiv.setAttribute('data-listener-added', 'true');

                        // Setup delete button
                        const deleteBtn = controlsDiv.querySelector('.delete-section-btn');
                        if (deleteBtn) {
                            console.log('Setting up delete button for section:', section.id);
                            deleteBtn.addEventListener('click', (e) => {
                                e.preventDefault();
                                e.stopPropagation();
                                console.log('Delete button clicked for section:', section.id);
                                this.deleteSection(section);
                            });
                        } else {
                            console.error('Delete button not found for section:', section.id);
                        }
                    }

                    // Setup section selection
                    if (!section.hasAttribute('data-selection-added')) {
                        section.setAttribute('data-selection-added', 'true');
                        section.addEventListener('click', (e) => {
                            e.stopPropagation();
                            console.log('Section clicked for selection!');
                            this.selectSection(section);
                        });
                    }

                    // Setup drag and drop
                    if (!section.hasAttribute('data-drag-added')) {
                        section.setAttribute('data-drag-added', 'true');
                        this.setupDragAndDrop(section);
                    }
                });
            }

            setupDragAndDrop(section) {
                console.log('Setting up drag and drop for section:', section.dataset.type);

                // Drag start
                section.addEventListener('dragstart', (e) => {
                    console.log('Drag started for:', section.dataset.type);
                    section.classList.add('dragging');
                    e.dataTransfer.effectAllowed = 'move';
                    e.dataTransfer.setData('text/html', section.outerHTML);
                });

                // Drag end
                section.addEventListener('dragend', (e) => {
                    console.log('Drag ended for:', section.dataset.type);
                    section.classList.remove('dragging');
                    document.querySelectorAll('.canvas-section').forEach(s => {
                        s.classList.remove('drag-over');
                    });
                });

                // Drag over
                section.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';

                    const draggingSection = document.querySelector('.dragging');
                    if (draggingSection && draggingSection !== section) {
                        section.classList.add('drag-over');
                    }
                });

                // Drag leave
                section.addEventListener('dragleave', (e) => {
                    section.classList.remove('drag-over');
                });

                // Drop
                section.addEventListener('drop', (e) => {
                    e.preventDefault();
                    section.classList.remove('drag-over');

                    const draggingSection = document.querySelector('.dragging');
                    if (draggingSection && draggingSection !== section) {
                        console.log('Dropping section:', draggingSection.dataset.type, 'onto:', section.dataset.type);

                        // Get the canvas container
                        const canvas = document.getElementById('canvas');

                        // Insert the dragged section before the drop target
                        canvas.insertBefore(draggingSection, section);

                        console.log('Section reordered successfully!');
                        this.showSuccessMessage('Section reordered successfully!');
                    }
                });
            }

            selectSection(section) {
                console.log('selectSection called for:', section.dataset.type, 'ID:', section.id);
                console.log('Section already selected?', section.classList.contains('selected'));

                // Check if this section is already selected
                if (section.classList.contains('selected')) {
                    console.log('Section already selected, skipping editor opening');
                    return;
                }

                // Remove selection from all sections
                document.querySelectorAll('.canvas-section').forEach(s => {
                    s.classList.remove('selected');
                });

                // Add selection to clicked section
                section.classList.add('selected');

                console.log('Section selected:', section.dataset.type);

                // If this is a navbar section, ensure mobile menu items are updated
                if (section.dataset.type === 'navbar' || section.dataset.type === 'header-nav') {
                    setTimeout(() => {
                        this.updateNavbarMenuItems(section);
                    }, 100);
                }

                // Check if we're in styling mode (component editor is open and showing styling panel)
                const editor = document.getElementById('component-editor');
                const editorContent = document.getElementById('editor-content');
                const isStylingMode = editor && editor.style.display === 'block' &&
                    editorContent && editorContent.innerHTML.includes('section-margin');

                if (isStylingMode) {
                    console.log('In styling mode - not opening component editor');
                    return;
                }

                // Open component editor for this section (normal mode)
                this.openComponentEditor(section);
            }

            // Method to select navbar section when navigation links are clicked
            selectNavbarSection() {
                console.log('selectNavbarSection called - returning to navigation section');

                // Find the navbar section
                const navbarSection = document.querySelector('.canvas-section[data-type="navbar"]');

                if (navbarSection) {
                    console.log('Found navbar section, selecting it');

                    // Remove selection from all sections
                    document.querySelectorAll('.canvas-section').forEach(s => {
                        s.classList.remove('selected');
                    });

                    // Add selection to navbar section
                    navbarSection.classList.add('selected');

                    // Open component editor for navbar section
                    this.openComponentEditor(navbarSection);

                    // Show success message
                    this.showSuccessMessage('Navigation section selected');
                } else {
                    console.log('No navbar section found');
                    this.showSuccessMessage('No navigation section found');
                }
            }

            deselectAllSections() {
                document.querySelectorAll('.canvas-section').forEach(s => {
                    s.classList.remove('selected');
                });
                console.log('All sections deselected');

                // Only close editor if it's currently open
                const editor = document.getElementById('component-editor');
                if (editor && editor.style.display !== 'none') {
                    this.closeComponentEditor();
                }
            }

            openComponentEditor(section) {
                console.log('Opening component editor for:', section.dataset.type);

                const editor = document.getElementById('component-editor');
                const editorContent = document.getElementById('editor-content');
                const panelTitle = document.getElementById('panel-title');

                if (!editor || !editorContent) {
                    console.error('Component editor elements not found!');
                    return;
                }

                // Check if editor is already open for this exact section
                const currentSectionId = editor.dataset.currentSectionId;
                const currentSectionType = editor.dataset.currentSectionType;
                if (currentSectionId === section.id && currentSectionType === section.dataset.type && editor.style.display === 'block') {
                    console.log('Editor already open for this exact section, skipping regeneration');
                    return;
                }

                // Hide the sections panel and show the editor
                document.querySelector('.right-panel > div:first-child').style.display = 'none';
                document.querySelector('.right-panel > div:nth-child(2)').style.display = 'none';
                editor.style.display = 'block';
                editor.dataset.currentSectionType = section.dataset.type;
                editor.dataset.currentSectionId = section.id;

                // Clear editor content first to prevent duplication
                console.log('Clearing editor content, current content length:', editorContent.innerHTML.length);
                editorContent.innerHTML = '';
                console.log('Editor content cleared, new length:', editorContent.innerHTML.length);

                // Generate editor content based on section type
                const editorHTML = this.generateEditorContent(section);
                console.log('Generated editor HTML length:', editorHTML.length);
                editorContent.innerHTML = editorHTML;
                console.log('Editor content set, final length:', editorContent.innerHTML.length);

                console.log('Editor content generated and set for section:', section.dataset.type);

                // Setup editor event listeners
                this.setupEditorListeners(section);

                console.log('Component editor opened successfully');
            }

            closeComponentEditor() {
                console.log('Closing component editor');

                const editor = document.getElementById('component-editor');
                const editorContent = document.getElementById('editor-content');

                if (editor) {
                    editor.style.display = 'none';

                    // Clear editor state
                    editor.dataset.currentSectionType = '';
                    editor.dataset.currentSectionId = '';
                    editor.dataset.listenersSetup = 'false';

                    // Clear editor content
                    if (editorContent) {
                        editorContent.innerHTML = '';
                    }

                    // Show the sections panel again
                    document.querySelector('.right-panel > div:first-child').style.display = 'block';
                    document.querySelector('.right-panel > div:nth-child(2)').style.display = 'block';
                }

                console.log('Component editor closed');
            }

            generateEditorContent(section) {
                const sectionType = section.dataset.type;
                console.log('Generating editor content for:', sectionType);

                switch (sectionType) {
                    case 'hero-slider':
                        return this.generateHeroSliderEditor(section);
                    case 'hero-banner':
                        return this.generateHeroBannerEditor(section);
                    case 'product-slider':
                        return this.generateProductSliderEditor(section);
                    case 'product-grid':
                        return this.generateProductGridEditor(section);
                    case 'announcement-bar':
                        return this.generateAnnouncementBarEditor(section);
                    case 'testimonials':
                        return this.generateTestimonialsEditor(section);
                    case 'newsletter':
                        return this.generateNewsletterEditor(section);
                    case 'contact-form':
                        return this.generateContactFormEditor(section);
                    case 'about-us':
                        return this.generateAboutUsEditor(section);
                    case 'navbar':
                        return this.generateNavbarEditor(section);
                    case 'image-text':
                        return this.generateImageTextEditor(section);
                    case 'announcement-bar':
                        return this.generateAnnouncementBarEditor(section);
                    case 'hero-slider':
                        return this.generateHeroSliderEditor(section);
                    default:
                        return this.generateDefaultEditor(section);
                }
            }

            generateAnnouncementBarEditor(section) {
                console.log(' GENERATING PREMIUM ANNOUNCEMENT BAR CUSTOMIZER');

                // Get current content data from the new premium design
                const container = section.querySelector('.announcement-bar-container');
                const announcementText = container?.querySelector('.announcement-text');
                const badgeElement = announcementText?.querySelector('span:first-child');
                const mainText = announcementText?.querySelector('span:nth-child(2)');
                const ctaButton = announcementText?.querySelector('a');

                // Extract current values with fallbacks
                const badgeText = badgeElement?.textContent || ' Limited Time';
                const mainMessage = mainText?.textContent || 'MEGA SALE! Get up to 70% off on all items';
                const ctaText = ctaButton?.textContent || 'Shop Now ';
                const ctaLink = ctaButton?.href || '#';

                // Get current styling
                const bgGradient = container?.style.background || 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                const textColor = container?.style.color || '#ffffff';
                const padding = container?.style.padding || '16px 24px';
                const borderRadius = container?.style.borderRadius || '12px';
                const fontSize = container?.style.fontSize || '15px';
                const fontWeight = container?.style.fontWeight || '600';

                return `
                    <div class="editor-form" style="padding: 20px; background: #f8f9fa; border-radius: 8px;">
                        <!-- Header -->
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 16px; border-radius: 8px; margin-bottom: 20px; text-align: center; position: relative;">
                            <h3 style="margin: 0; font-size: 18px; font-weight: 600;"> Premium Announcement Bar Customizer</h3>
                            <p style="margin: 8px 0 0 0; opacity: 0.9; font-size: 14px;">Customize every element of your premium announcement bar</p>
                            <button id="delete-announcement-section" style="position: absolute; top: 12px; right: 12px; background: rgba(255, 255, 255, 0.2); border: none; color: white; width: 32px; height: 32px; border-radius: 50%; cursor: pointer; font-size: 16px; display: flex; align-items: center; justify-content: center; transition: background 0.2s;" onmouseover="this.style.background='rgba(255, 255, 255, 0.3)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.2)'" title="Delete this section">
                                
                            </button>
                        </div>

                        <!-- Content Settings -->
                        <div class="editor-section" style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 16px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <h4 class="editor-section-title" style="color: #2c3e50; margin-bottom: 16px; font-size: 16px; font-weight: 600; border-bottom: 2px solid #3498db; padding-bottom: 8px;">
                                 Content Settings
                            </h4>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                            <div class="form-group">
                                    <label class="form-label" style="display: block; margin-bottom: 8px; font-weight: 500; color: #34495e;">Badge Text</label>
                                    <input type="text" class="form-input" id="announcement-badge" value="${badgeText}" placeholder=" Limited Time" style="width: 100%; padding: 12px; border: 2px solid #e1e8ed; border-radius: 6px; font-size: 14px; transition: border-color 0.3s;">
                            </div>
                            
                            <div class="form-group">
                                    <label class="form-label" style="display: block; margin-bottom: 8px; font-weight: 500; color: #34495e;">CTA Button Text</label>
                                    <input type="text" class="form-input" id="announcement-cta" value="${ctaText}" placeholder="Shop Now " style="width: 100%; padding: 12px; border: 2px solid #e1e8ed; border-radius: 6px; font-size: 14px; transition: border-color 0.3s;">
                            </div>
                        </div>
                        
                            <div class="form-group" style="margin-bottom: 16px;">
                                <label class="form-label" style="display: block; margin-bottom: 8px; font-weight: 500; color: #34495e;">Main Message</label>
                                <textarea class="form-textarea" id="announcement-main" rows="2" style="width: 100%; padding: 12px; border: 2px solid #e1e8ed; border-radius: 6px; font-size: 14px; resize: vertical; transition: border-color 0.3s;" placeholder="Enter your main announcement message...">${mainMessage}</textarea>
                            </div>
                            
                            <div class="form-group" style="margin-bottom: 16px;">
                                <label class="form-label" style="display: block; margin-bottom: 8px; font-weight: 500; color: #34495e;">CTA Link URL</label>
                                <input type="url" class="form-input" id="announcement-link" value="${ctaLink}" placeholder="https://example.com" style="width: 100%; padding: 12px; border: 2px solid #e1e8ed; border-radius: 6px; font-size: 14px; transition: border-color 0.3s;">
                            </div>
                        </div>

                        <!-- Animation Settings -->
                        <div class="editor-section" style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 16px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <h4 class="editor-section-title" style="color: #2c3e50; margin-bottom: 16px; font-size: 16px; font-weight: 600; border-bottom: 2px solid #e74c3c; padding-bottom: 8px;">
                                 Animation Settings
                            </h4>
                            
                            <div class="form-group" style="margin-bottom: 16px;">
                                <label class="form-label" style="display: block; margin-bottom: 8px; font-weight: 500; color: #34495e;">Animation Type</label>
                                <select class="form-select" id="announcement-animation" style="width: 100%; padding: 12px; border: 2px solid #e1e8ed; border-radius: 6px; font-size: 14px; background: white;">
                                    <option value="none">None - Static</option>
                                    <option value="slide">Slide In - Smooth entrance</option>
                                    <option value="pulse">Pulse - Breathing effect</option>
                                    <option value="bounce">Bounce - Playful bounce</option>
                                    <option value="shimmer">Shimmer - Shine effect</option>
                                </select>
                            </div>
                            
                            <div class="form-group" style="margin-bottom: 16px;">
                                <label class="form-label" style="display: block; margin-bottom: 8px; font-weight: 500; color: #34495e;">Animation Duration</label>
                                <input type="range" class="form-range" id="announcement-duration" min="1" max="5" value="2" style="width: 100%; margin: 8px 0;">
                                <div class="range-value" style="display: flex; justify-content: space-between; align-items: center; font-size: 12px; color: #6b7280;">
                                    <span>1s</span>
                                    <span id="announcement-duration-value" style="font-weight: 600; color: #3498db;">2s</span>
                                    <span>5s</span>
                                </div>
                            </div>
                            
                            <div class="form-group" style="margin-bottom: 16px;">
                                <label class="checkbox-label" style="display: flex; align-items: center; cursor: pointer;">
                                    <input type="checkbox" id="announcement-loop" checked style="margin-right: 8px; transform: scale(1.2);">
                                    <span style="font-weight: 500; color: #34495e;">Loop Animation Continuously</span>
                                </label>
                            </div>
                        </div>
                        
                        <!-- Styling Settings -->
                        <div class="editor-section" style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 16px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <h4 class="editor-section-title" style="color: #2c3e50; margin-bottom: 16px; font-size: 16px; font-weight: 600; border-bottom: 2px solid #f39c12; padding-bottom: 8px;">
                                 Premium Styling
                            </h4>
                            
                            <!-- Gradient Background -->
                            <div style="margin-bottom: 20px;">
                                <label class="form-label" style="display: block; margin-bottom: 12px; font-weight: 500; color: #34495e;">Gradient Background</label>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                            <div class="form-group">
                                        <label style="display: block; margin-bottom: 6px; font-size: 12px; color: #7f8c8d;">Start Color</label>
                                        <div class="color-picker" style="display: flex; align-items: center; gap: 8px;">
                                            <input type="color" class="color-input" id="announcement-gradient-start" value="#667eea" style="width: 40px; height: 40px; border: none; border-radius: 6px; cursor: pointer;">
                                            <input type="text" class="form-input" id="announcement-gradient-start-text" value="#667eea" style="flex: 1; padding: 10px; border: 2px solid #e1e8ed; border-radius: 6px; font-size: 14px;">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                        <label style="display: block; margin-bottom: 6px; font-size: 12px; color: #7f8c8d;">End Color</label>
                                        <div class="color-picker" style="display: flex; align-items: center; gap: 8px;">
                                            <input type="color" class="color-input" id="announcement-gradient-end" value="#764ba2" style="width: 40px; height: 40px; border: none; border-radius: 6px; cursor: pointer;">
                                            <input type="text" class="form-input" id="announcement-gradient-end-text" value="#764ba2" style="flex: 1; padding: 10px; border: 2px solid #e1e8ed; border-radius: 6px; font-size: 14px;">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Text Colors -->
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                            <div class="form-group">
                                    <label class="form-label" style="display: block; margin-bottom: 8px; font-weight: 500; color: #34495e;">Text Color</label>
                                    <div class="color-picker" style="display: flex; align-items: center; gap: 8px;">
                                        <input type="color" class="color-input" id="announcement-text-color" value="${this.rgbToHex(textColor)}" style="width: 40px; height: 40px; border: none; border-radius: 6px; cursor: pointer;">
                                        <input type="text" class="form-input" id="announcement-text-color-text" value="${this.rgbToHex(textColor)}" style="flex: 1; padding: 10px; border: 2px solid #e1e8ed; border-radius: 6px; font-size: 14px;">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                    <label class="form-label" style="display: block; margin-bottom: 8px; font-weight: 500; color: #34495e;">CTA Button Color</label>
                                    <div class="color-picker" style="display: flex; align-items: center; gap: 8px;">
                                        <input type="color" class="color-input" id="announcement-cta-color" value="#fbbf24" style="width: 40px; height: 40px; border: none; border-radius: 6px; cursor: pointer;">
                                        <input type="text" class="form-input" id="announcement-cta-color-text" value="#fbbf24" style="flex: 1; padding: 10px; border: 2px solid #e1e8ed; border-radius: 6px; font-size: 14px;">
                                    </div>
                                </div>
                            </div>

                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                                <div class="form-group">
                                    <label class="form-label" style="display: block; margin-bottom: 8px; font-weight: 500; color: #34495e;">Padding</label>
                                    <input type="range" class="form-range" id="announcement-padding" min="8" max="40" value="12" style="width: 100%; margin: 8px 0;">
                                    <div class="range-value" style="text-align: center; font-size: 12px; font-weight: 600; color: #3498db;">
                                    <span id="announcement-padding-value">12px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                    <label class="form-label" style="display: block; margin-bottom: 8px; font-weight: 500; color: #34495e;">Font Size</label>
                                    <input type="range" class="form-range" id="announcement-font-size" min="12" max="24" value="14" style="width: 100%; margin: 8px 0;">
                                    <div class="range-value" style="text-align: center; font-size: 12px; font-weight: 600; color: #3498db;">
                                    <span id="announcement-font-size-value">14px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                    <label class="form-label" style="display: block; margin-bottom: 8px; font-weight: 500; color: #34495e;">Border Radius</label>
                                    <input type="range" class="form-range" id="announcement-border-radius" min="0" max="20" value="8" style="width: 100%; margin: 8px 0;">
                                    <div class="range-value" style="text-align: center; font-size: 12px; font-weight: 600; color: #3498db;">
                                    <span id="announcement-border-radius-value">8px</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group" style="margin-bottom: 16px;">
                                <label class="form-label" style="display: block; margin-bottom: 8px; font-weight: 500; color: #34495e;">Box Shadow</label>
                                <input type="range" class="form-range" id="announcement-shadow" min="0" max="20" value="0" style="width: 100%; margin: 8px 0;">
                                <div class="range-value" style="display: flex; justify-content: space-between; align-items: center; font-size: 12px; color: #6b7280;">
                                    <span>None</span>
                                    <span id="announcement-shadow-value" style="font-weight: 600; color: #3498db;">0px</span>
                                    <span>Heavy</span>
                                </div>
                            </div>
                        </div>

                        <!-- Advanced Settings -->
                        <div class="editor-section" style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 16px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                            <h4 class="editor-section-title" style="color: #2c3e50; margin-bottom: 16px; font-size: 16px; font-weight: 600; border-bottom: 2px solid #9b59b6; padding-bottom: 8px;">
                                 Advanced Settings
                            </h4>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                            <div class="form-group">
                                    <label class="form-label" style="display: block; margin-bottom: 8px; font-weight: 500; color: #34495e;">Font Weight</label>
                                    <select class="form-select" id="announcement-font-weight" style="width: 100%; padding: 12px; border: 2px solid #e1e8ed; border-radius: 6px; font-size: 14px; background: white;">
                                        <option value="300">Light (300)</option>
                                        <option value="400">Normal (400)</option>
                                        <option value="500" selected>Medium (500)</option>
                                        <option value="600">Semi Bold (600)</option>
                                        <option value="700">Bold (700)</option>
                                        <option value="800">Extra Bold (800)</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" style="display: block; margin-bottom: 8px; font-weight: 500; color: #34495e;">Text Transform</label>
                                    <select class="form-select" id="announcement-text-transform" style="width: 100%; padding: 12px; border: 2px solid #e1e8ed; border-radius: 6px; font-size: 14px; background: white;">
                                        <option value="none">None</option>
                                        <option value="uppercase">UPPERCASE</option>
                                        <option value="lowercase">lowercase</option>
                                        <option value="capitalize">Capitalize</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                            <div class="form-group">
                                    <label class="form-label" style="display: block; margin-bottom: 8px; font-weight: 500; color: #34495e;">Text Alignment</label>
                                    <select class="form-select" id="announcement-text-align" style="width: 100%; padding: 12px; border: 2px solid #e1e8ed; border-radius: 6px; font-size: 14px; background: white;">
                                        <option value="left">Left</option>
                                        <option value="center" selected>Center</option>
                                        <option value="right">Right</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label" style="display: block; margin-bottom: 8px; font-weight: 500; color: #34495e;">Background Pattern</label>
                                    <select class="form-select" id="announcement-bg-pattern" style="width: 100%; padding: 12px; border: 2px solid #e1e8ed; border-radius: 6px; font-size: 14px; background: white;">
                                        <option value="none">None</option>
                                        <option value="gradient">Gradient</option>
                                        <option value="stripes">Stripes</option>
                                        <option value="dots">Dots</option>
                                        <option value="waves">Waves</option>
                                    </select>
                            </div>
                        </div>
                        
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                                <div class="form-group">
                                    <label class="checkbox-label" style="display: flex; align-items: center; cursor: pointer;">
                                        <input type="checkbox" id="announcement-dismissible" style="margin-right: 8px; transform: scale(1.2);">
                                        <span style="font-weight: 500; color: #34495e;">Add Dismiss Button (X)</span>
                                    </label>
                                </div>
                                
                                <div class="form-group">
                                    <label class="checkbox-label" style="display: flex; align-items: center; cursor: pointer;">
                                        <input type="checkbox" id="announcement-sticky" style="margin-right: 8px; transform: scale(1.2);">
                                        <span style="font-weight: 500; color: #34495e;">Sticky to Top</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div style="display: flex; gap: 12px; justify-content: center; margin-top: 20px;">
                            <button class="btn-small btn-small-primary" id="apply-changes" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 12px 24px; border-radius: 6px; font-weight: 600; cursor: pointer; transition: transform 0.2s; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);">
                                 Apply Changes
                            </button>
                            <button class="btn-small btn-small-secondary" id="reset-changes" style="background: #95a5a6; color: white; border: none; padding: 12px 24px; border-radius: 6px; font-weight: 600; cursor: pointer; transition: transform 0.2s;">
                                 Reset
                            </button>
                        </div>
                    </div>
                `;
            }

            generateImageTextEditor(section) {
                // Get current content data
                const title = section.querySelector('h3')?.textContent || 'Your Content Title';
                const text = section.querySelector('p')?.textContent || 'Add your content here...';
                const buttonText = section.querySelector('button')?.textContent || 'Learn More';
                const buttonLink = section.querySelector('button')?.onclick || '#';

                return `
                    <div class="editor-form">
                        <div class="editor-section">
                            <h4 class="editor-section-title">Content Settings</h4>
                            
                            <div class="form-group">
                                <label class="form-label">Title</label>
                                <input type="text" class="form-input" id="image-text-title" value="${title}">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Description Text</label>
                                <textarea class="form-textarea" id="image-text-description" rows="4">${text}</textarea>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Button Text</label>
                                <input type="text" class="form-input" id="image-text-button-text" value="${buttonText}">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Button Link</label>
                                <input type="url" class="form-input" id="image-text-button-link" value="${buttonLink}" placeholder="https://example.com">
                            </div>
                        </div>
                        
                        <div class="editor-section">
                            <h4 class="editor-section-title">Image Settings</h4>
                            
                            <div class="form-group">
                                <label class="form-label">Image Upload</label>
                                <input type="file" class="form-input" id="image-text-upload" accept="image/*">
                                <div id="image-text-preview" class="image-preview"></div>
                                <button type="button" class="btn-small btn-small-danger" id="image-text-delete" style="margin-top: 8px; display: none;">Delete Image</button>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Image Width</label>
                                <input type="range" class="form-range" id="image-text-width" min="100" max="800" value="400">
                                <div class="range-value">
                                    <span id="image-text-width-value">400px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Image Height</label>
                                <input type="range" class="form-range" id="image-text-height" min="100" max="600" value="300">
                                <div class="range-value">
                                    <span id="image-text-height-value">300px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Image Position</label>
                                <select class="form-select" id="image-text-position">
                                    <option value="left">Left</option>
                                    <option value="right">Right</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Image Border Radius</label>
                                <input type="range" class="form-range" id="image-text-border-radius" min="0" max="50" value="8">
                                <div class="range-value">
                                    <span id="image-text-border-radius-value">8px</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="editor-section">
                            <h4 class="editor-section-title">Section Styling</h4>
                            
                            <div class="form-group">
                                <label class="form-label">Section Padding</label>
                                <input type="range" class="form-range" id="image-text-section-padding" min="0" max="200" value="60">
                                <div class="range-value">
                                    <span id="image-text-section-padding-value">60px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Section Margin</label>
                                <input type="range" class="form-range" id="image-text-section-margin" min="0" max="100" value="0">
                                <div class="range-value">
                                    <span id="image-text-section-margin-value">0px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Border Width</label>
                                <input type="range" class="form-range" id="image-text-border-width" min="0" max="20" value="0">
                                <div class="range-value">
                                    <span id="image-text-border-width-value">0px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Border Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="image-text-border-color" value="#000000">
                                    <input type="text" class="form-input" id="image-text-border-color-text" value="#000000">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Section Border Radius</label>
                                <input type="range" class="form-range" id="image-text-section-border-radius" min="0" max="50" value="8">
                                <div class="range-value">
                                    <span id="image-text-section-border-radius-value">8px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Box Shadow</label>
                                <input type="range" class="form-range" id="image-text-shadow" min="0" max="50" value="0">
                                <div class="range-value">
                                    <span id="image-text-shadow-value">0px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Shadow Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="image-text-shadow-color" value="#000000">
                                    <input type="text" class="form-input" id="image-text-shadow-color-text" value="#000000">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Background Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="image-text-bg-color" value="#ffffff">
                                    <input type="text" class="form-input" id="image-text-bg-color-text" value="#ffffff">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Background Image</label>
                                <input type="file" class="form-input" id="image-text-bg-image" accept="image/*">
                                <div id="image-text-bg-preview" class="image-preview"></div>
                                <button type="button" class="btn-small btn-small-danger" id="image-text-bg-delete" style="margin-top: 8px; display: none;">Delete Background</button>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Opacity</label>
                                <input type="range" class="form-range" id="image-text-opacity" min="0" max="100" value="100">
                                <div class="range-value">
                                    <span id="image-text-opacity-value">100%</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Transform Scale</label>
                                <input type="range" class="form-range" id="image-text-scale" min="50" max="150" value="100">
                                <div class="range-value">
                                    <span id="image-text-scale-value">100%</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="editor-section">
                            <h4 class="editor-section-title">Typography</h4>
                            
                            <div class="form-group">
                                <label class="form-label">Title Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="image-text-title-color" value="#1e293b">
                                    <input type="text" class="form-input" id="image-text-title-color-text" value="#1e293b">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Title Font Size</label>
                                <input type="range" class="form-range" id="image-text-title-size" min="16" max="48" value="24">
                                <div class="range-value">
                                    <span id="image-text-title-size-value">24px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Text Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="image-text-text-color" value="#64748b">
                                    <input type="text" class="form-input" id="image-text-text-color-text" value="#64748b">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Text Font Size</label>
                                <input type="range" class="form-range" id="image-text-text-size" min="12" max="24" value="16">
                                <div class="range-value">
                                    <span id="image-text-text-size-value">16px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Button Background Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="image-text-button-bg" value="#3b82f6">
                                    <input type="text" class="form-input" id="image-text-button-bg-text" value="#3b82f6">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Button Text Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="image-text-button-text-color" value="#ffffff">
                                    <input type="text" class="form-input" id="image-text-button-text-color-text" value="#ffffff">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Button Border Radius</label>
                                <input type="range" class="form-range" id="image-text-button-radius" min="0" max="20" value="6">
                                <div class="range-value">
                                    <span id="image-text-button-radius-value">6px</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="btn-group">
                            <button class="btn-small btn-small-primary" id="apply-changes">Apply Changes</button>
                            <button class="btn-small btn-small-secondary" id="reset-changes">Reset</button>
                        </div>
                    </div>
                `;
            }

            generateHeroSliderEditor(section) {
                // Get current slide data
                const slides = section.querySelectorAll('.slide');
                const slideData = Array.from(slides).map((slide, index) => {
                    const h1 = slide.querySelector('h1');
                    const p = slide.querySelector('p');
                    return {
                        title: h1 ? h1.innerHTML : `Slide ${index + 1} Title`,
                        subtitle: p ? p.textContent : `Slide ${index + 1} Subtitle`,
                        index: index
                    };
                });

                return `
                    <div class="editor-form">
                        <div class="editor-section">
                            <h4 class="editor-section-title">Slider Settings</h4>
                            
                        <div class="form-group">
                                <label class="form-label">Auto-play Duration (seconds)</label>
                                <input type="range" class="form-range" id="slider-autoplay" min="2" max="10" value="4">
                                <div class="range-value">
                                    <span id="slider-autoplay-value">4s</span>
                        </div>
                            </div>
                            
                        <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="slider-autoplay-enabled" checked>
                                    <span class="checkmark"></span>
                                    Enable Auto-play
                                </label>
                        </div>
                            
                        <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="slider-show-dots" checked>
                                    <span class="checkmark"></span>
                                    Show Navigation Dots
                                </label>
                        </div>
                            
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="slider-show-arrows" checked>
                                    <span class="checkmark"></span>
                                    Show Arrow Controls
                                </label>
                            </div>
                        </div>
                        
                        <div class="editor-section">
                            <h4 class="editor-section-title">Hero Slider Styling</h4>
                            
                            <div class="form-group">
                                <label class="form-label">Section Padding</label>
                                <input type="range" class="form-range" id="hero-section-padding" min="0" max="200" value="128">
                                <div class="range-value">
                                    <span id="hero-section-padding-value">128px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Section Margin</label>
                                <input type="range" class="form-range" id="hero-section-margin" min="0" max="100" value="0">
                                <div class="range-value">
                                    <span id="hero-section-margin-value">0px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Border Width</label>
                                <input type="range" class="form-range" id="hero-border-width" min="0" max="20" value="0">
                                <div class="range-value">
                                    <span id="hero-border-width-value">0px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Border Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="hero-border-color" value="#000000">
                                    <input type="text" class="form-input" id="hero-border-color-text" value="#000000">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Border Radius</label>
                                <input type="range" class="form-range" id="hero-border-radius" min="0" max="50" value="0">
                                <div class="range-value">
                                    <span id="hero-border-radius-value">0px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Box Shadow</label>
                                <input type="range" class="form-range" id="hero-shadow" min="0" max="50" value="0">
                                <div class="range-value">
                                    <span id="hero-shadow-value">0px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Shadow Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="hero-shadow-color" value="#000000">
                                    <input type="text" class="form-input" id="hero-shadow-color-text" value="#000000">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Background Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="hero-bg-color" value="#ffffff">
                                    <input type="text" class="form-input" id="hero-bg-color-text" value="#ffffff">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Background Image</label>
                                <input type="file" class="form-input" id="hero-bg-image" accept="image/*">
                                <div id="hero-bg-preview" class="image-preview"></div>
                                <button type="button" class="btn-small btn-small-danger" id="hero-bg-delete" style="margin-top: 8px; display: none;">Delete Background</button>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Background Image Width</label>
                                <input type="range" class="form-range" id="hero-bg-width" min="100" max="1920" value="1920">
                                <div class="range-value">
                                    <span id="hero-bg-width-value">1920px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Background Image Height</label>
                                <input type="range" class="form-range" id="hero-bg-height" min="100" max="1080" value="600">
                                <div class="range-value">
                                    <span id="hero-bg-height-value">600px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Opacity</label>
                                <input type="range" class="form-range" id="hero-opacity" min="0" max="100" value="100">
                                <div class="range-value">
                                    <span id="hero-opacity-value">100%</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Transform Scale</label>
                                <input type="range" class="form-range" id="hero-scale" min="50" max="150" value="100">
                                <div class="range-value">
                                    <span id="hero-scale-value">100%</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Min Height</label>
                                <input type="range" class="form-range" id="hero-min-height" min="200" max="800" value="400">
                                <div class="range-value">
                                    <span id="hero-min-height-value">400px</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="editor-section">
                            <h4 class="editor-section-title">Slide Management</h4>
                            
                            <div class="form-group">
                                <label class="form-label">Current Slides</label>
                                <div id="slider-slides-list" class="slides-list">
                                    ${slideData.map((slide, index) => `
                                        <div class="slide-item" data-slide-index="${index}">
                                            <div class="slide-item-header">
                                                <span class="slide-number">Slide ${index + 1}</span>
                                                <div class="slide-item-controls">
                                                    <button type="button" class="btn-edit-slide" data-slide-index="${index}">Edit</button>
                                                    <button type="button" class="btn-remove-slide" data-slide-index="${index}"></button>
                                                </div>
                                            </div>
                                            <div class="slide-preview">
                                                <div class="slide-preview-content">
                                                    <div class="slide-preview-title">${slide.title.replace(/<[^>]*>/g, '').substring(0, 30)}...</div>
                                                    <div class="slide-preview-subtitle">${slide.subtitle.substring(0, 50)}...</div>
                                                </div>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <button type="button" class="btn-add-slide" id="add-new-slide">+ Add New Slide</button>
                            </div>
                        </div>
                        
                        <div class="editor-section" id="slide-editor-section" style="display: none;">
                            <h4 class="editor-section-title">Edit Slide <span id="current-slide-number">1</span></h4>
                            
                            <div class="form-group">
                                <label class="form-label">Slide Background Image</label>
                                <input type="file" class="form-input" id="slide-bg-image" accept="image/*">
                                <div id="slide-bg-preview" class="image-preview"></div>
                                <button type="button" class="btn-small btn-small-danger" id="slide-bg-delete" style="margin-top: 8px; display: none;">Delete Slide Background</button>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Slide Image Width</label>
                                <input type="range" class="form-range" id="slide-bg-width" min="100" max="1920" value="1920">
                                <div class="range-value">
                                    <span id="slide-bg-width-value">1920px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Slide Image Height</label>
                                <input type="range" class="form-range" id="slide-bg-height" min="100" max="1080" value="600">
                                <div class="range-value">
                                    <span id="slide-bg-height-value">600px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Slide Background Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="slide-bg-color" value="#ffffff">
                                    <input type="text" class="form-input" id="slide-bg-color-text" value="#ffffff">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Main Title (Rich Text)</label>
                                <div class="rich-text-editor" id="slide-title-editor">
                                    <div class="rich-text-toolbar">
                                        <button type="button" class="rich-text-btn" data-command="bold" title="Bold">
                                            <span class="material-icons">format_bold</span>
                                        </button>
                                        <button type="button" class="rich-text-btn" data-command="italic" title="Italic">
                                            <span class="material-icons">format_italic</span>
                                        </button>
                                        <button type="button" class="rich-text-btn" data-command="underline" title="Underline">
                                            <span class="material-icons">format_underlined</span>
                                        </button>
                                        <button type="button" class="rich-text-btn" data-command="strikeThrough" title="Strikethrough">
                                            <span class="material-icons">format_strikethrough</span>
                                        </button>
                                        <div class="rich-text-separator"></div>
                                        <button type="button" class="rich-text-btn" data-command="justifyLeft" title="Align Left">
                                            <span class="material-icons">format_align_left</span>
                                        </button>
                                        <button type="button" class="rich-text-btn" data-command="justifyCenter" title="Align Center">
                                            <span class="material-icons">format_align_center</span>
                                        </button>
                                        <button type="button" class="rich-text-btn" data-command="justifyRight" title="Align Right">
                                            <span class="material-icons">format_align_right</span>
                                        </button>
                                        <div class="rich-text-separator"></div>
                                        <input type="color" class="rich-text-color" id="slide-title-color" value="#2b4a24" title="Text Color">
                                        <select class="rich-text-select" id="slide-title-font-size">
                                            <option value="text-4xl">Small (4xl)</option>
                                            <option value="text-5xl">Medium (5xl)</option>
                                            <option value="text-6xl" selected>Large (6xl)</option>
                                            <option value="text-7xl">X-Large (7xl)</option>
                                            <option value="text-8xl">XX-Large (8xl)</option>
                                        </select>
                                    </div>
                                    <div class="rich-text-content" id="slide-title-content" contenteditable="true">
                                        DISCOVER LIMITED<br><span style="color: #f0c9e0;">SNEAKERS</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Subtitle (Rich Text)</label>
                                <div class="rich-text-editor" id="slide-subtitle-editor">
                                    <div class="rich-text-toolbar">
                                        <button type="button" class="rich-text-btn" data-command="bold" title="Bold">
                                            <span class="material-icons">format_bold</span>
                                        </button>
                                        <button type="button" class="rich-text-btn" data-command="italic" title="Italic">
                                            <span class="material-icons">format_italic</span>
                                        </button>
                                        <button type="button" class="rich-text-btn" data-command="underline" title="Underline">
                                            <span class="material-icons">format_underlined</span>
                                        </button>
                                        <div class="rich-text-separator"></div>
                                        <button type="button" class="rich-text-btn" data-command="justifyLeft" title="Align Left">
                                            <span class="material-icons">format_align_left</span>
                                        </button>
                                        <button type="button" class="rich-text-btn" data-command="justifyCenter" title="Align Center">
                                            <span class="material-icons">format_align_center</span>
                                        </button>
                                        <button type="button" class="rich-text-btn" data-command="justifyRight" title="Align Right">
                                            <span class="material-icons">format_align_right</span>
                                        </button>
                                        <div class="rich-text-separator"></div>
                                        <input type="color" class="rich-text-color" id="slide-subtitle-color" value="#2b4a24" title="Text Color">
                                        <select class="rich-text-select" id="slide-subtitle-font-size">
                                            <option value="text-lg">Small (lg)</option>
                                            <option value="text-xl">Medium (xl)</option>
                                            <option value="text-2xl" selected>Large (2xl)</option>
                                            <option value="text-3xl">X-Large (3xl)</option>
                                        </select>
                                    </div>
                                    <div class="rich-text-content" id="slide-subtitle-content" contenteditable="true">
                                        WITHOUT LIMITATION
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <button type="button" class="btn-save-slide" id="save-slide-changes">Save Slide Changes</button>
                            </div>
                        </div>
                        
                        <div class="btn-group">
                            <button class="btn-small btn-small-primary" id="apply-changes">Apply Changes</button>
                            <button class="btn-small btn-small-secondary" id="reset-changes">Reset</button>
                        </div>
                    </div>
                `;
            }

            generateHeroBannerEditor(section) {
                const title = section.querySelector('h1')?.textContent || 'Build Your Dream Store';
                const subtitle = section.querySelector('p')?.textContent || 'Create stunning e-commerce websites with ease';
                const button1 = section.querySelector('button:first-of-type')?.textContent || 'Start Building';
                const button2 = section.querySelector('button:last-of-type')?.textContent || 'View Demo';

                return `
                    <div class="editor-form">
                        <div class="form-group">
                            <label class="form-label">Main Title</label>
                            <input type="text" class="form-input" id="banner-title" value="${title}">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Subtitle</label>
                            <textarea class="form-textarea" id="banner-subtitle">${subtitle}</textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Primary Button Text</label>
                            <input type="text" class="form-input" id="banner-button1" value="${button1}">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Secondary Button Text</label>
                            <input type="text" class="form-input" id="banner-button2" value="${button2}">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Background Color</label>
                            <div class="color-picker">
                                <input type="color" class="color-input" id="banner-bg-color" value="#667eea">
                                <input type="text" class="form-input" id="banner-bg-color-text" value="#667eea">
                            </div>
                        </div>
                        <div class="btn-group">
                            <button class="btn-small btn-small-primary" id="apply-changes">Apply Changes</button>
                            <button class="btn-small btn-small-secondary" id="reset-changes">Reset</button>
                        </div>
                    </div>
                `;
            }

            generateProductSliderEditor(section) {
                const title = section.querySelector('h2')?.textContent || 'Featured Products';
                const subtitle = section.querySelector('p')?.textContent || 'Discover our best-selling items';

                return `
                    <div class="editor-form">
                        <div class="editor-section">
                            <h4 class="editor-section-title">Content Settings</h4>
                            
                            <div class="form-group">
                                <label class="form-label">Section Title</label>
                                <input type="text" class="form-input" id="product-slider-title" value="${title}">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Section Subtitle</label>
                                <textarea class="form-textarea" id="product-slider-subtitle" rows="2">${subtitle}</textarea>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Products Per View</label>
                                <input type="range" class="form-range" id="product-slider-per-view" min="1" max="6" value="4">
                                <div class="range-value">
                                    <span id="product-slider-per-view-value">4</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="product-slider-autoplay" checked>
                                    <span class="checkmark"></span>
                                    Enable Autoplay
                                </label>
                            </div>
                            
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="product-slider-arrows" checked>
                                    <span class="checkmark"></span>
                                    Show Navigation Arrows
                                </label>
                            </div>
                            
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="product-slider-dots" checked>
                                    <span class="checkmark"></span>
                                    Show Dots Navigation
                                </label>
                            </div>
                        </div>
                        
                        <div class="editor-section">
                            <h4 class="editor-section-title">Product Management</h4>
                            
                            <div class="form-group">
                                <label class="form-label">Add New Product</label>
                                <button class="btn-small btn-small-secondary" id="add-product-btn">+ Add Product</button>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Current Products</label>
                                <div id="product-list" class="product-list">
                                    <!-- Products will be listed here -->
                                </div>
                            </div>
                        </div>
                        
                        <div class="editor-section">
                            <h4 class="editor-section-title">Section Styling</h4>
                            
                            <div class="form-group">
                                <label class="form-label">Section Padding</label>
                                <input type="range" class="form-range" id="product-slider-section-padding" min="0" max="200" value="60">
                                <div class="range-value">
                                    <span id="product-slider-section-padding-value">60px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Section Margin</label>
                                <input type="range" class="form-range" id="product-slider-section-margin" min="0" max="100" value="0">
                                <div class="range-value">
                                    <span id="product-slider-section-margin-value">0px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Background Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="product-slider-bg-color" value="#f8fafc">
                                    <input type="text" class="form-input" id="product-slider-bg-color-text" value="#f8fafc">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Background Image</label>
                                <input type="file" class="form-input" id="product-slider-bg-image" accept="image/*">
                                <div id="product-slider-bg-preview" class="image-preview"></div>
                                <button type="button" class="btn-small btn-small-danger" id="product-slider-bg-delete" style="margin-top: 8px; display: none;">Delete Background</button>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Background Image Width</label>
                                <input type="range" class="form-range" id="product-slider-bg-width" min="100" max="1920" value="1920">
                                <div class="range-value">
                                    <span id="product-slider-bg-width-value">1920px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Background Image Height</label>
                                <input type="range" class="form-range" id="product-slider-bg-height" min="100" max="1080" value="600">
                                <div class="range-value">
                                    <span id="product-slider-bg-height-value">600px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Border Width</label>
                                <input type="range" class="form-range" id="product-slider-border-width" min="0" max="20" value="0">
                                <div class="range-value">
                                    <span id="product-slider-border-width-value">0px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Border Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="product-slider-border-color" value="#000000">
                                    <input type="text" class="form-input" id="product-slider-border-color-text" value="#000000">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Border Radius</label>
                                <input type="range" class="form-range" id="product-slider-border-radius" min="0" max="50" value="8">
                                <div class="range-value">
                                    <span id="product-slider-border-radius-value">8px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Box Shadow</label>
                                <input type="range" class="form-range" id="product-slider-shadow" min="0" max="50" value="0">
                                <div class="range-value">
                                    <span id="product-slider-shadow-value">0px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Shadow Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="product-slider-shadow-color" value="#000000">
                                    <input type="text" class="form-input" id="product-slider-shadow-color-text" value="#000000">
                                </div>
                            </div>
                        </div>
                        
                        <div class="editor-section">
                            <h4 class="editor-section-title">Typography</h4>
                            
                            <div class="form-group">
                                <label class="form-label">Title Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="product-slider-title-color" value="#1e293b">
                                    <input type="text" class="form-input" id="product-slider-title-color-text" value="#1e293b">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Title Font Size</label>
                                <input type="range" class="form-range" id="product-slider-title-size" min="20" max="48" value="32">
                                <div class="range-value">
                                    <span id="product-slider-title-size-value">32px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Subtitle Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="product-slider-subtitle-color" value="#64748b">
                                    <input type="text" class="form-input" id="product-slider-subtitle-color-text" value="#64748b">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Subtitle Font Size</label>
                                <input type="range" class="form-range" id="product-slider-subtitle-size" min="12" max="24" value="18">
                                <div class="range-value">
                                    <span id="product-slider-subtitle-size-value">18px</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="btn-group">
                            <button class="btn-small btn-small-primary" id="apply-changes">Apply Changes</button>
                            <button class="btn-small btn-small-secondary" id="reset-changes">Reset</button>
                        </div>
                    </div>
                `;
            }

            generateProductGridEditor(section) {
                const title = section.querySelector('h2')?.textContent || 'Our Products';
                const subtitle = section.querySelector('p')?.textContent || 'Shop our complete collection';

                return `
                    <div class="editor-form">
                        <div class="form-group">
                            <label class="form-label">Section Title</label>
                            <input type="text" class="form-input" id="grid-title" value="${title}">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Section Subtitle</label>
                            <textarea class="form-textarea" id="grid-subtitle">${subtitle}</textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Background Color</label>
                            <div class="color-picker">
                                <input type="color" class="color-input" id="grid-bg-color" value="#f8fafc">
                                <input type="text" class="form-input" id="grid-bg-color-text" value="#f8fafc">
                            </div>
                        </div>
                        <div class="btn-group">
                            <button class="btn-small btn-small-primary" id="apply-changes">Apply Changes</button>
                            <button class="btn-small btn-small-secondary" id="reset-changes">Reset</button>
                        </div>
                    </div>
                `;
            }
            generateTestimonialsEditor(section) {
                const title = section.querySelector('h2')?.textContent || 'What Our Customers Say';
                const subtitle = section.querySelector('p')?.textContent || 'Real reviews from satisfied customers';

                return `
                    <div class="editor-form">
                        <div class="editor-section">
                            <h4 class="editor-section-title">Content Settings</h4>
                            
                            <div class="form-group">
                                <label class="form-label">Section Title</label>
                                <input type="text" class="form-input" id="testimonials-title" value="${title}">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Section Subtitle</label>
                                <textarea class="form-textarea" id="testimonials-subtitle" rows="2">${subtitle}</textarea>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Layout Style</label>
                                <select class="form-select" id="testimonials-layout">
                                    <option value="grid">Grid Layout</option>
                                    <option value="carousel">Carousel</option>
                                    <option value="masonry">Masonry</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Testimonials Per Row</label>
                                <input type="range" class="form-range" id="testimonials-per-row" min="1" max="4" value="3">
                                <div class="range-value">
                                    <span id="testimonials-per-row-value">3</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="testimonials-show-ratings" checked>
                                    <span class="checkmark"></span>
                                    Show Star Ratings
                                </label>
                            </div>
                            
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="testimonials-show-avatars" checked>
                                    <span class="checkmark"></span>
                                    Show Customer Avatars
                                </label>
                            </div>
                        </div>
                        
                        <div class="editor-section">
                            <h4 class="editor-section-title">Testimonial Management</h4>
                            
                            <div class="form-group">
                                <label class="form-label">Add New Testimonial</label>
                                <button class="btn-small btn-small-secondary" id="add-testimonial-btn">+ Add Testimonial</button>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Current Testimonials</label>
                                <div id="testimonial-list" class="testimonial-list">
                                    <!-- Testimonials will be listed here -->
                                </div>
                            </div>
                        </div>
                        
                        <div class="editor-section">
                            <h4 class="editor-section-title">Section Styling</h4>
                            
                            <div class="form-group">
                                <label class="form-label">Section Padding</label>
                                <input type="range" class="form-range" id="testimonials-section-padding" min="0" max="200" value="60">
                                <div class="range-value">
                                    <span id="testimonials-section-padding-value">60px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Section Margin</label>
                                <input type="range" class="form-range" id="testimonials-section-margin" min="0" max="100" value="0">
                                <div class="range-value">
                                    <span id="testimonials-section-margin-value">0px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Background Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="testimonials-bg-color" value="#f8fafc">
                                    <input type="text" class="form-input" id="testimonials-bg-color-text" value="#f8fafc">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Background Image</label>
                                <input type="file" class="form-input" id="testimonials-bg-image" accept="image/*">
                                <div id="testimonials-bg-preview" class="image-preview"></div>
                                <button type="button" class="btn-small btn-small-danger" id="testimonials-bg-delete" style="margin-top: 8px; display: none;">Delete Background</button>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Border Width</label>
                                <input type="range" class="form-range" id="testimonials-border-width" min="0" max="20" value="0">
                                <div class="range-value">
                                    <span id="testimonials-border-width-value">0px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Border Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="testimonials-border-color" value="#000000">
                                    <input type="text" class="form-input" id="testimonials-border-color-text" value="#000000">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Border Radius</label>
                                <input type="range" class="form-range" id="testimonials-border-radius" min="0" max="50" value="8">
                                <div class="range-value">
                                    <span id="testimonials-border-radius-value">8px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Box Shadow</label>
                                <input type="range" class="form-range" id="testimonials-shadow" min="0" max="50" value="0">
                                <div class="range-value">
                                    <span id="testimonials-shadow-value">0px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Shadow Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="testimonials-shadow-color" value="#000000">
                                    <input type="text" class="form-input" id="testimonials-shadow-color-text" value="#000000">
                                </div>
                            </div>
                        </div>
                        
                        <div class="editor-section">
                            <h4 class="editor-section-title">Typography</h4>
                            
                            <div class="form-group">
                                <label class="form-label">Title Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="testimonials-title-color" value="#1e293b">
                                    <input type="text" class="form-input" id="testimonials-title-color-text" value="#1e293b">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Title Font Size</label>
                                <input type="range" class="form-range" id="testimonials-title-size" min="20" max="48" value="32">
                                <div class="range-value">
                                    <span id="testimonials-title-size-value">32px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Subtitle Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="testimonials-subtitle-color" value="#64748b">
                                    <input type="text" class="form-input" id="testimonials-subtitle-color-text" value="#64748b">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Subtitle Font Size</label>
                                <input type="range" class="form-range" id="testimonials-subtitle-size" min="12" max="24" value="18">
                                <div class="range-value">
                                    <span id="testimonials-subtitle-size-value">18px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Testimonial Text Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="testimonials-text-color" value="#374151">
                                    <input type="text" class="form-input" id="testimonials-text-color-text" value="#374151">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Customer Name Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="testimonials-name-color" value="#1e293b">
                                    <input type="text" class="form-input" id="testimonials-name-color-text" value="#1e293b">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Star Rating Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="testimonials-rating-color" value="#fbbf24">
                                    <input type="text" class="form-input" id="testimonials-rating-color-text" value="#fbbf24">
                                </div>
                            </div>
                        </div>
                        
                        <div class="btn-group">
                            <button class="btn-small btn-small-primary" id="apply-changes">Apply Changes</button>
                            <button class="btn-small btn-small-secondary" id="reset-changes">Reset</button>
                        </div>
                    </div>
                `;
            }

            generateNewsletterEditor(section) {
                const title = section.querySelector('h2')?.textContent || 'Stay Updated';
                const subtitle = section.querySelector('p')?.textContent || 'Subscribe to our newsletter for exclusive offers and updates';
                const buttonText = section.querySelector('button')?.textContent || 'Subscribe';
                const placeholderText = section.querySelector('input[type="email"]')?.placeholder || 'Enter your email';

                return `
                    <div class="editor-form">
                        <div class="editor-section">
                            <h4 class="editor-section-title">Content Settings</h4>
                            
                            <div class="form-group">
                                <label class="form-label">Section Title</label>
                                <input type="text" class="form-input" id="newsletter-title" value="${title}">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Section Subtitle</label>
                                <textarea class="form-textarea" id="newsletter-subtitle" rows="2">${subtitle}</textarea>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Email Placeholder Text</label>
                                <input type="text" class="form-input" id="newsletter-placeholder" value="${placeholderText}">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Button Text</label>
                                <input type="text" class="form-input" id="newsletter-button-text" value="${buttonText}">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Layout Style</label>
                                <select class="form-select" id="newsletter-layout">
                                    <option value="centered">Centered</option>
                                    <option value="left-aligned">Left Aligned</option>
                                    <option value="split">Split Layout</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="newsletter-show-privacy" checked>
                                    <span class="checkmark"></span>
                                    Show Privacy Policy Link
                                </label>
                            </div>
                            
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="newsletter-show-social" checked>
                                    <span class="checkmark"></span>
                                    Show Social Media Links
                                </label>
                            </div>
                        </div>
                        
                        <div class="editor-section">
                            <h4 class="editor-section-title">Form Styling</h4>
                            
                            <div class="form-group">
                                <label class="form-label">Form Background Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="newsletter-form-bg" value="#ffffff">
                                    <input type="text" class="form-input" id="newsletter-form-bg-text" value="#ffffff">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Input Border Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="newsletter-input-border" value="#d1d5db">
                                    <input type="text" class="form-input" id="newsletter-input-border-text" value="#d1d5db">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Input Border Radius</label>
                                <input type="range" class="form-range" id="newsletter-input-radius" min="0" max="20" value="6">
                                <div class="range-value">
                                    <span id="newsletter-input-radius-value">6px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Button Background Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="newsletter-button-bg" value="#3b82f6">
                                    <input type="text" class="form-input" id="newsletter-button-bg-text" value="#3b82f6">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Button Text Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="newsletter-button-text-color" value="#ffffff">
                                    <input type="text" class="form-input" id="newsletter-button-text-color-text" value="#ffffff">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Button Border Radius</label>
                                <input type="range" class="form-range" id="newsletter-button-radius" min="0" max="20" value="6">
                                <div class="range-value">
                                    <span id="newsletter-button-radius-value">6px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Button Hover Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="newsletter-button-hover" value="#2563eb">
                                    <input type="text" class="form-input" id="newsletter-button-hover-text" value="#2563eb">
                                </div>
                            </div>
                        </div>
                        
                        <div class="editor-section">
                            <h4 class="editor-section-title">Section Styling</h4>
                            
                            <div class="form-group">
                                <label class="form-label">Section Padding</label>
                                <input type="range" class="form-range" id="newsletter-section-padding" min="0" max="200" value="60">
                                <div class="range-value">
                                    <span id="newsletter-section-padding-value">60px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Section Margin</label>
                                <input type="range" class="form-range" id="newsletter-section-margin" min="0" max="100" value="0">
                                <div class="range-value">
                                    <span id="newsletter-section-margin-value">0px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Background Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="newsletter-bg-color" value="#ffecd2">
                                    <input type="text" class="form-input" id="newsletter-bg-color-text" value="#ffecd2">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Background Image</label>
                                <input type="file" class="form-input" id="newsletter-bg-image" accept="image/*">
                                <div id="newsletter-bg-preview" class="image-preview"></div>
                                <button type="button" class="btn-small btn-small-danger" id="newsletter-bg-delete" style="margin-top: 8px; display: none;">Delete Background</button>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Border Width</label>
                                <input type="range" class="form-range" id="newsletter-border-width" min="0" max="20" value="0">
                                <div class="range-value">
                                    <span id="newsletter-border-width-value">0px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Border Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="newsletter-border-color" value="#000000">
                                    <input type="text" class="form-input" id="newsletter-border-color-text" value="#000000">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Border Radius</label>
                                <input type="range" class="form-range" id="newsletter-border-radius" min="0" max="50" value="8">
                                <div class="range-value">
                                    <span id="newsletter-border-radius-value">8px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Box Shadow</label>
                                <input type="range" class="form-range" id="newsletter-shadow" min="0" max="50" value="0">
                                <div class="range-value">
                                    <span id="newsletter-shadow-value">0px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Shadow Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="newsletter-shadow-color" value="#000000">
                                    <input type="text" class="form-input" id="newsletter-shadow-color-text" value="#000000">
                                </div>
                            </div>
                        </div>
                        
                        <div class="editor-section">
                            <h4 class="editor-section-title">Typography</h4>
                            
                            <div class="form-group">
                                <label class="form-label">Title Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="newsletter-title-color" value="#1e293b">
                                    <input type="text" class="form-input" id="newsletter-title-color-text" value="#1e293b">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Title Font Size</label>
                                <input type="range" class="form-range" id="newsletter-title-size" min="20" max="48" value="32">
                                <div class="range-value">
                                    <span id="newsletter-title-size-value">32px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Subtitle Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="newsletter-subtitle-color" value="#64748b">
                                    <input type="text" class="form-input" id="newsletter-subtitle-color-text" value="#64748b">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Subtitle Font Size</label>
                                <input type="range" class="form-range" id="newsletter-subtitle-size" min="12" max="24" value="18">
                                <div class="range-value">
                                    <span id="newsletter-subtitle-size-value">18px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Input Text Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="newsletter-input-text-color" value="#374151">
                                    <input type="text" class="form-input" id="newsletter-input-text-color-text" value="#374151">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Input Placeholder Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="newsletter-placeholder-color" value="#9ca3af">
                                    <input type="text" class="form-input" id="newsletter-placeholder-color-text" value="#9ca3af">
                                </div>
                            </div>
                        </div>
                        
                        <div class="btn-group">
                            <button class="btn-small btn-small-primary" id="apply-changes">Apply Changes</button>
                            <button class="btn-small btn-small-secondary" id="reset-changes">Reset</button>
                        </div>
                    </div>
                `;
            }

            generateAboutUsEditor(section) {
                const title = section.querySelector('h2')?.textContent || 'About Us';
                const subtitle = section.querySelector('p')?.textContent || 'Learn more about our company and mission';
                const description = section.querySelector('.about-description')?.textContent || 'We are a passionate team dedicated to delivering exceptional products and services to our customers.';

                return `
                    <div class="editor-form">
                        <div class="editor-section">
                            <h4 class="editor-section-title">Content Settings</h4>
                            
                            <div class="form-group">
                                <label class="form-label">Section Title</label>
                                <input type="text" class="form-input" id="about-title" value="${title}">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Section Subtitle</label>
                                <textarea class="form-textarea" id="about-subtitle" rows="2">${subtitle}</textarea>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Description</label>
                                <textarea class="form-textarea" id="about-description" rows="4">${description}</textarea>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Layout Style</label>
                                <select class="form-select" id="about-layout">
                                    <option value="text-left">Text Left, Image Right</option>
                                    <option value="text-right">Text Right, Image Left</option>
                                    <option value="centered">Centered</option>
                                    <option value="full-width">Full Width</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="about-show-stats" checked>
                                    <span class="checkmark"></span>
                                    Show Statistics
                                </label>
                            </div>
                            
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="about-show-team" checked>
                                    <span class="checkmark"></span>
                                    Show Team Section
                                </label>
                            </div>
                            
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="about-show-values" checked>
                                    <span class="checkmark"></span>
                                    Show Company Values
                                </label>
                            </div>
                        </div>
                        
                        <div class="editor-section">
                            <h4 class="editor-section-title">Image Settings</h4>
                            
                            <div class="form-group">
                                <label class="form-label">Main Image Upload</label>
                                <input type="file" class="form-input" id="about-main-image" accept="image/*">
                                <div id="about-main-preview" class="image-preview"></div>
                                <button type="button" class="btn-small btn-small-danger" id="about-main-delete" style="margin-top: 8px; display: none;">Delete Image</button>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Image Width</label>
                                <input type="range" class="form-range" id="about-main-width" min="100" max="800" value="400">
                                <div class="range-value">
                                    <span id="about-main-width-value">400px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Image Height</label>
                                <input type="range" class="form-range" id="about-main-height" min="100" max="600" value="300">
                                <div class="range-value">
                                    <span id="about-main-height-value">300px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Image Border Radius</label>
                                <input type="range" class="form-range" id="about-image-radius" min="0" max="50" value="8">
                                <div class="range-value">
                                    <span id="about-image-radius-value">8px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Image Shadow</label>
                                <input type="range" class="form-range" id="about-image-shadow" min="0" max="30" value="0">
                                <div class="range-value">
                                    <span id="about-image-shadow-value">0px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Shadow Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="about-image-shadow-color" value="#000000">
                                    <input type="text" class="form-input" id="about-image-shadow-color-text" value="#000000">
                                </div>
                            </div>
                        </div>
                        
                        <div class="editor-section">
                            <h4 class="editor-section-title">Section Styling</h4>
                            
                            <div class="form-group">
                                <label class="form-label">Section Padding</label>
                                <input type="range" class="form-range" id="about-section-padding" min="0" max="200" value="60">
                                <div class="range-value">
                                    <span id="about-section-padding-value">60px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Section Margin</label>
                                <input type="range" class="form-range" id="about-section-margin" min="0" max="100" value="0">
                                <div class="range-value">
                                    <span id="about-section-margin-value">0px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Background Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="about-bg-color" value="#f8fafc">
                                    <input type="text" class="form-input" id="about-bg-color-text" value="#f8fafc">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Background Image</label>
                                <input type="file" class="form-input" id="about-bg-image" accept="image/*">
                                <div id="about-bg-preview" class="image-preview"></div>
                                <button type="button" class="btn-small btn-small-danger" id="about-bg-delete" style="margin-top: 8px; display: none;">Delete Background</button>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Border Width</label>
                                <input type="range" class="form-range" id="about-border-width" min="0" max="20" value="0">
                                <div class="range-value">
                                    <span id="about-border-width-value">0px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Border Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="about-border-color" value="#000000">
                                    <input type="text" class="form-input" id="about-border-color-text" value="#000000">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Border Radius</label>
                                <input type="range" class="form-range" id="about-border-radius" min="0" max="50" value="8">
                                <div class="range-value">
                                    <span id="about-border-radius-value">8px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Box Shadow</label>
                                <input type="range" class="form-range" id="about-shadow" min="0" max="50" value="0">
                                <div class="range-value">
                                    <span id="about-shadow-value">0px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Shadow Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="about-shadow-color" value="#000000">
                                    <input type="text" class="form-input" id="about-shadow-color-text" value="#000000">
                                </div>
                            </div>
                        </div>
                        
                        <div class="editor-section">
                            <h4 class="editor-section-title">Typography</h4>
                            
                            <div class="form-group">
                                <label class="form-label">Title Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="about-title-color" value="#1e293b">
                                    <input type="text" class="form-input" id="about-title-color-text" value="#1e293b">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Title Font Size</label>
                                <input type="range" class="form-range" id="about-title-size" min="20" max="48" value="32">
                                <div class="range-value">
                                    <span id="about-title-size-value">32px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Subtitle Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="about-subtitle-color" value="#64748b">
                                    <input type="text" class="form-input" id="about-subtitle-color-text" value="#64748b">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Subtitle Font Size</label>
                                <input type="range" class="form-range" id="about-subtitle-size" min="12" max="24" value="18">
                                <div class="range-value">
                                    <span id="about-subtitle-size-value">18px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Description Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="about-description-color" value="#374151">
                                    <input type="text" class="form-input" id="about-description-color-text" value="#374151">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Description Font Size</label>
                                <input type="range" class="form-range" id="about-description-size" min="12" max="20" value="16">
                                <div class="range-value">
                                    <span id="about-description-size-value">16px</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="btn-group">
                            <button class="btn-small btn-small-primary" id="apply-changes">Apply Changes</button>
                            <button class="btn-small btn-small-secondary" id="reset-changes">Reset</button>
                        </div>
                    </div>
                `;
            }

            generateContactFormEditor(section) {
                const title = section.querySelector('h2')?.textContent || 'Get In Touch';
                const subtitle = section.querySelector('p')?.textContent || 'We\'d love to hear from you. Send us a message!';
                const buttonText = section.querySelector('button')?.textContent || 'Send Message';

                return `
                    <div class="editor-form">
                        <div class="editor-section">
                            <h4 class="editor-section-title">Content Settings</h4>
                            
                            <div class="form-group">
                                <label class="form-label">Section Title</label>
                                <input type="text" class="form-input" id="contact-title" value="${title}">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Section Subtitle</label>
                                <textarea class="form-textarea" id="contact-subtitle" rows="2">${subtitle}</textarea>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Button Text</label>
                                <input type="text" class="form-input" id="contact-button-text" value="${buttonText}">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Form Layout</label>
                                <select class="form-select" id="contact-layout">
                                    <option value="single-column">Single Column</option>
                                    <option value="two-column">Two Column</option>
                                    <option value="split">Split Layout</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Form Fields</label>
                                <div class="checkbox-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="contact-field-name" checked>
                                        <span class="checkmark"></span>
                                        Name Field
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="contact-field-email" checked>
                                        <span class="checkmark"></span>
                                        Email Field
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="contact-field-phone" checked>
                                        <span class="checkmark"></span>
                                        Phone Field
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="contact-field-company">
                                        <span class="checkmark"></span>
                                        Company Field
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="contact-field-subject" checked>
                                        <span class="checkmark"></span>
                                        Subject Field
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="contact-field-message" checked>
                                        <span class="checkmark"></span>
                                        Message Field
                                    </label>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="contact-show-privacy" checked>
                                    <span class="checkmark"></span>
                                    Show Privacy Policy Link
                                </label>
                            </div>
                            
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="contact-show-captcha">
                                    <span class="checkmark"></span>
                                    Show CAPTCHA
                                </label>
                            </div>
                        </div>
                        
                        <div class="editor-section">
                            <h4 class="editor-section-title">Form Styling</h4>
                            
                            <div class="form-group">
                                <label class="form-label">Form Background Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="contact-form-bg" value="#ffffff">
                                    <input type="text" class="form-input" id="contact-form-bg-text" value="#ffffff">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Input Border Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="contact-input-border" value="#d1d5db">
                                    <input type="text" class="form-input" id="contact-input-border-text" value="#d1d5db">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Input Focus Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="contact-input-focus" value="#3b82f6">
                                    <input type="text" class="form-input" id="contact-input-focus-text" value="#3b82f6">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Input Border Radius</label>
                                <input type="range" class="form-range" id="contact-input-radius" min="0" max="20" value="6">
                                <div class="range-value">
                                    <span id="contact-input-radius-value">6px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Input Padding</label>
                                <input type="range" class="form-range" id="contact-input-padding" min="8" max="24" value="12">
                                <div class="range-value">
                                    <span id="contact-input-padding-value">12px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Button Background Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="contact-button-bg" value="#3b82f6">
                                    <input type="text" class="form-input" id="contact-button-bg-text" value="#3b82f6">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Button Text Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="contact-button-text-color" value="#ffffff">
                                    <input type="text" class="form-input" id="contact-button-text-color-text" value="#ffffff">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Button Border Radius</label>
                                <input type="range" class="form-range" id="contact-button-radius" min="0" max="20" value="6">
                                <div class="range-value">
                                    <span id="contact-button-radius-value">6px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Button Hover Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="contact-button-hover" value="#2563eb">
                                    <input type="text" class="form-input" id="contact-button-hover-text" value="#2563eb">
                                </div>
                            </div>
                        </div>
                        
                        <div class="editor-section">
                            <h4 class="editor-section-title">Section Styling</h4>
                            
                            <div class="form-group">
                                <label class="form-label">Section Padding</label>
                                <input type="range" class="form-range" id="contact-section-padding" min="0" max="200" value="60">
                                <div class="range-value">
                                    <span id="contact-section-padding-value">60px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Section Margin</label>
                                <input type="range" class="form-range" id="contact-section-margin" min="0" max="100" value="0">
                                <div class="range-value">
                                    <span id="contact-section-margin-value">0px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Background Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="contact-bg-color" value="#f8fafc">
                                    <input type="text" class="form-input" id="contact-bg-color-text" value="#f8fafc">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Background Image</label>
                                <input type="file" class="form-input" id="contact-bg-image" accept="image/*">
                                <div id="contact-bg-preview" class="image-preview"></div>
                                <button type="button" class="btn-small btn-small-danger" id="contact-bg-delete" style="margin-top: 8px; display: none;">Delete Background</button>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Border Width</label>
                                <input type="range" class="form-range" id="contact-border-width" min="0" max="20" value="0">
                                <div class="range-value">
                                    <span id="contact-border-width-value">0px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Border Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="contact-border-color" value="#000000">
                                    <input type="text" class="form-input" id="contact-border-color-text" value="#000000">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Border Radius</label>
                                <input type="range" class="form-range" id="contact-border-radius" min="0" max="50" value="8">
                                <div class="range-value">
                                    <span id="contact-border-radius-value">8px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Box Shadow</label>
                                <input type="range" class="form-range" id="contact-shadow" min="0" max="50" value="0">
                                <div class="range-value">
                                    <span id="contact-shadow-value">0px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Shadow Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="contact-shadow-color" value="#000000">
                                    <input type="text" class="form-input" id="contact-shadow-color-text" value="#000000">
                                </div>
                            </div>
                        </div>
                        
                        <div class="editor-section">
                            <h4 class="editor-section-title">Typography</h4>
                            
                            <div class="form-group">
                                <label class="form-label">Title Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="contact-title-color" value="#1e293b">
                                    <input type="text" class="form-input" id="contact-title-color-text" value="#1e293b">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Title Font Size</label>
                                <input type="range" class="form-range" id="contact-title-size" min="20" max="48" value="32">
                                <div class="range-value">
                                    <span id="contact-title-size-value">32px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Subtitle Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="contact-subtitle-color" value="#64748b">
                                    <input type="text" class="form-input" id="contact-subtitle-color-text" value="#64748b">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Subtitle Font Size</label>
                                <input type="range" class="form-range" id="contact-subtitle-size" min="12" max="24" value="18">
                                <div class="range-value">
                                    <span id="contact-subtitle-size-value">18px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Label Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="contact-label-color" value="#374151">
                                    <input type="text" class="form-input" id="contact-label-color-text" value="#374151">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Input Text Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="contact-input-text-color" value="#374151">
                                    <input type="text" class="form-input" id="contact-input-text-color-text" value="#374151">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Input Placeholder Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="contact-placeholder-color" value="#9ca3af">
                                    <input type="text" class="form-input" id="contact-placeholder-color-text" value="#9ca3af">
                                </div>
                            </div>
                        </div>
                        
                        <div class="btn-group">
                            <button class="btn-small btn-small-primary" id="apply-changes">Apply Changes</button>
                            <button class="btn-small btn-small-secondary" id="reset-changes">Reset</button>
                        </div>
                    </div>
                `;
            }

            generateNavbarEditor(section) {
                const logo = section.querySelector('.navbar-logo-text')?.textContent || 'LOGO';
                const logoImg = section.querySelector('.navbar-logo-img')?.src || '';
                const logoLink = section.querySelector('.navbar-logo-link')?.href || '#';

                // Always get menu items from the actual navbar section (not from editor)
                const links = Array.from(section.querySelectorAll('.navbar-link')).map(link => ({
                    text: link.textContent,
                    collection: link.dataset.collection || ''
                }));

                const primaryBtn = section.querySelector('.navbar-btn-primary')?.textContent || 'Sign In';
                const secondaryBtn = section.querySelector('.navbar-btn-secondary')?.textContent || 'Sign Up';
                const bgColor = section.querySelector('header')?.style.background || '#ffffff';
                const logoTextColor = section.querySelector('.navbar-logo-text')?.style.color || '#2b4a24';
                const logoBgColor = section.querySelector('.navbar-logo-text')?.style.background || 'transparent';

                return `
                    <div class="editor-form">
                        <div class="editor-section">
                            <h4 class="editor-section-title">Logo Settings</h4>
                            
                            <div class="form-group">
                                <label class="form-label">Logo Display</label>
                                <select class="form-select" id="navbar-logo-display">
                                    <option value="logo-text">Logo + Text</option>
                                    <option value="logo-only">Logo Only</option>
                                    <option value="text-only">Text Only</option>
                                </select>
                            </div>
                            
                            
                            <div class="form-group" id="logo-text-group">
                                <label class="form-label">Logo Text</label>
                                <input type="text" class="form-input" id="navbar-logo-text" value="${logo}">
                            </div>
                            
                            <div class="form-group" id="logo-text-color-group">
                                <label class="form-label">Logo Text Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="navbar-logo-text-color" value="${logoTextColor}">
                                    <input type="text" class="form-input" id="navbar-logo-text-color-text" value="${logoTextColor}">
                                </div>
                            </div>
                            
                            <div class="form-group" id="logo-bg-color-group">
                                <label class="form-label">Logo Background Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="navbar-logo-bg" value="${logoBgColor}">
                                    <input type="text" class="form-input" id="navbar-logo-bg-text" value="${logoBgColor}">
                                </div>
                            </div>
                            
                            <div class="form-group" id="logo-image-group">
                                <label class="form-label">Logo Image</label>
                                <input type="file" class="form-input" id="navbar-logo-image" accept="image/*">
                                <div id="logo-image-preview" style="margin-top: 10px;">
                                    ${logoImg ? `<img src="${logoImg}" style="max-width: 100px; max-height: 50px; border-radius: 4px;">` : ''}
                                </div>
                                <button type="button" class="btn-small btn-small-danger" id="navbar-logo-delete" style="margin-top: 8px; display: none;">Delete Logo</button>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Logo Width</label>
                                <input type="range" class="form-range" id="navbar-logo-width" min="50" max="300" value="100">
                                <div class="range-value">
                                    <span id="navbar-logo-width-value">100px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Logo Height</label>
                                <input type="range" class="form-range" id="navbar-logo-height" min="30" max="150" value="50">
                                <div class="range-value">
                                    <span id="navbar-logo-height-value">50px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Logo Link URL</label>
                                <input type="url" class="form-input" id="navbar-logo-link" value="${logoLink}" placeholder="https://your-website.com">
                                <div class="form-help">The URL where the logo will redirect when clicked (your published website)</div>
                            </div>
                        </div>
                        
                        <div class="editor-section">
                            <h4 class="editor-section-title">Menu Items</h4>
                            
                            <div class="form-group">
                                <label class="form-label">Current Menu Items</label>
                                <div id="navbar-menu-items">
                                    ${links.map((link, index) => `
                                        <div class="menu-item" data-index="${index}">
                                            <span class="menu-item-text">${link.text}</span>
                                            <span class="menu-item-collection">${link.collection || 'No Collection'}</span>
                                            <button type="button" class="btn-remove-menu-item" data-index="${index}"></button>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <button type="button" class="btn btn-secondary" id="add-menu-item">
                                    <span class="material-icons" style="font-size: 16px; margin-right: 8px;">add</span>
                                    Add Menu Item
                                </button>
                            </div>
                        </div>
                        
                        
                        <div class="editor-section">
                            <h4 class="editor-section-title">Icons & Features</h4>
                            
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="navbar-cart-icon" checked>
                                    <span class="checkmark"></span>
                                    <span class="material-icons" style="font-size: 18px; margin-right: 8px; color: #3b82f6;">shopping_cart</span>
                                    Show Cart Icon
                                </label>
                            </div>
                            
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="navbar-favorite-icon" checked>
                                    <span class="checkmark"></span>
                                    <span class="material-icons" style="font-size: 18px; margin-right: 8px; color: #ef4444;">favorite</span>
                                    Show Favorite Icon
                                </label>
                            </div>
                            
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="navbar-search-icon" checked>
                                    <span class="checkmark"></span>
                                    <span class="material-icons" style="font-size: 18px; margin-right: 8px; color: #6b7280;">search</span>
                                    Show Search Bar
                                </label>
                            </div>
                            
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="navbar-profile-icon" checked>
                                    <span class="checkmark"></span>
                                    <span class="material-icons" style="font-size: 18px; margin-right: 8px; color: #8b5cf6;">account_circle</span>
                                    Show Profile Icon
                                </label>
                            </div>
                        </div>
                        
                        <div class="editor-section">
                            <h4 class="editor-section-title">Styling</h4>
                            
                            <div class="form-group">
                                <label class="form-label">Background Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="navbar-bg-color" value="${bgColor}">
                                    <input type="text" class="form-input" id="navbar-bg-color-text" value="${bgColor}">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Menu Text Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="navbar-text-color" value="#2b4a24">
                                    <input type="text" class="form-input" id="navbar-text-color-text" value="#2b4a24">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Menu Hover Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="navbar-hover-color" value="#f0c9e0">
                                    <input type="text" class="form-input" id="navbar-hover-color-text" value="#f0c9e0">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Font Family</label>
                                <select class="form-select" id="navbar-font-family">
                                    <option value="var(--madas-font-family)">MADAS Font (Lama Sans)</option>
                                    <option value="Inter, sans-serif">Inter</option>
                                    <option value="Arial, sans-serif">Arial</option>
                                    <option value="Helvetica, sans-serif">Helvetica</option>
                                    <option value="Georgia, serif">Georgia</option>
                                    <option value="Times New Roman, serif">Times New Roman</option>
                                    <option value="Roboto, sans-serif">Roboto</option>
                                    <option value="Open Sans, sans-serif">Open Sans</option>
                                    <option value="Poppins, sans-serif">Poppins</option>
                                    <option value="Montserrat, sans-serif">Montserrat</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Font Weight</label>
                                <select class="form-select" id="navbar-font-weight">
                                    <option value="300">Light (300)</option>
                                    <option value="400">Normal (400)</option>
                                    <option value="500" selected>Medium (500)</option>
                                    <option value="600">Semi Bold (600)</option>
                                    <option value="700">Bold (700)</option>
                                    <option value="800">Extra Bold (800)</option>
                                    <option value="900">Black (900)</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Font Size</label>
                                <input type="range" class="form-range" id="navbar-font-size" min="12" max="24" value="16">
                                <div class="range-value">
                                    <span id="navbar-font-size-value">16px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="navbar-text-uppercase" checked>
                                    <span class="checkmark"></span>
                                    Uppercase Text
                                </label>
                            </div>
                        </div>
                        
                        <div class="editor-section">
                            <h4 class="editor-section-title">Hover Effects</h4>
                            
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="navbar-enable-hover" checked>
                                    <span class="checkmark"></span>
                                    Enable Hover Effects
                                </label>
                            </div>
                            
                            <div class="form-group" id="hover-effects-group">
                                <label class="form-label">Hover Effect Type</label>
                                <select class="form-select" id="navbar-hover-effect">
                                    <option value="color">Color Change</option>
                                    <option value="underline">Underline</option>
                                    <option value="background">Background Change</option>
                                    <option value="scale">Scale Effect</option>
                                </select>
                            </div>
                            
                            <div class="form-group" id="hover-duration-group">
                                <label class="form-label">Hover Transition Duration</label>
                                <input type="range" class="form-range" id="navbar-hover-duration" min="0.1" max="1" step="0.1" value="0.3">
                                <div class="range-value">
                                    <span id="navbar-hover-duration-value">0.3s</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="btn-group">
                            <button class="btn-small btn-small-primary" id="apply-changes">Apply Changes</button>
                            <button class="btn-small btn-small-secondary" id="reset-changes">Reset</button>
                        </div>
                    </div>
                `;
            }

            generateDefaultEditor(section) {
                // Get current section styles
                const currentMargin = section.style.margin || '20px';
                const currentPadding = section.style.padding || '20px';
                const currentBorderRadius = section.style.borderRadius || '8px';
                const currentBorder = section.style.border || 'none';
                const currentBoxShadow = section.style.boxShadow || 'none';
                const currentBgColor = section.style.backgroundColor || '#ffffff';
                const currentBgImage = section.style.backgroundImage || 'none';

                // Parse current values
                const marginValue = parseInt(currentMargin) || 20;
                const paddingValue = parseInt(currentPadding) || 20;
                const borderRadiusValue = parseInt(currentBorderRadius) || 8;
                const borderWidthValue = currentBorder.includes('px') ? parseInt(currentBorder.split('px')[0]) : 0;

                return `
                    <div class="editor-form">
                        <div class="editor-section">
                            <h4 class="editor-section-title">Section Layout & Spacing</h4>
                            
                        <div class="form-group">
                            <label class="form-label">Section Type</label>
                            <input type="text" class="form-input" value="${section.dataset.type}" readonly>
                        </div>
                            
                            <div class="form-group">
                                <label class="form-label">Margin (outside spacing)</label>
                                <div class="range-group">
                                    <input type="range" class="form-range" id="section-margin" min="0" max="100" value="${marginValue}">
                                    <div class="range-value">
                                        <span id="section-margin-value">${marginValue}px</span>
                            </div>
                            </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Padding (inside spacing)</label>
                                <div class="range-group">
                                    <input type="range" class="form-range" id="section-padding" min="0" max="100" value="${paddingValue}">
                                    <div class="range-value">
                                        <span id="section-padding-value">${paddingValue}px</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="editor-section">
                            <h4 class="editor-section-title">Border & Corners</h4>
                            
                        <div class="form-group">
                                <label class="form-label">Border Radius (rounded corners)</label>
                                <div class="range-group">
                                    <input type="range" class="form-range" id="section-border-radius" min="0" max="50" value="${borderRadiusValue}">
                                    <div class="range-value">
                                        <span id="section-border-radius-value">${borderRadiusValue}px</span>
                            </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Border Width</label>
                                <div class="range-group">
                                    <input type="range" class="form-range" id="section-border-width" min="0" max="10" value="${borderWidthValue}">
                                    <div class="range-value">
                                        <span id="section-border-width-value">${borderWidthValue}px</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Border Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="section-border-color" value="#e5e7eb">
                                    <input type="text" class="form-input" id="section-border-color-text" value="#e5e7eb">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Border Style</label>
                                <select class="form-select" id="section-border-style">
                                    <option value="none">None</option>
                                    <option value="solid">Solid</option>
                                    <option value="dashed">Dashed</option>
                                    <option value="dotted">Dotted</option>
                                    <option value="double">Double</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="editor-section">
                            <h4 class="editor-section-title">Shadow & Effects</h4>
                            
                            <div class="form-group">
                                <label class="form-label">Box Shadow</label>
                                <select class="form-select" id="section-box-shadow">
                                    <option value="none" ${currentBoxShadow === 'none' ? 'selected' : ''}>None</option>
                                    <option value="0 1px 3px rgba(0, 0, 0, 0.1)" ${currentBoxShadow.includes('0 1px 3px') ? 'selected' : ''}>Small</option>
                                    <option value="0 4px 6px rgba(0, 0, 0, 0.1)" ${currentBoxShadow.includes('0 4px 6px') ? 'selected' : ''}>Medium</option>
                                    <option value="0 10px 15px rgba(0, 0, 0, 0.1)" ${currentBoxShadow.includes('0 10px 15px') ? 'selected' : ''}>Large</option>
                                    <option value="0 20px 25px rgba(0, 0, 0, 0.1)" ${currentBoxShadow.includes('0 20px 25px') ? 'selected' : ''}>Extra Large</option>
                                    <option value="0 0 0 3px rgba(59, 130, 246, 0.5)" ${currentBoxShadow.includes('0 0 0 3px') ? 'selected' : ''}>Glow</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Shadow Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="section-shadow-color" value="#000000">
                                    <input type="text" class="form-input" id="section-shadow-color-text" value="#000000">
                                </div>
                            </div>
                        </div>
                        
                        <div class="editor-section">
                            <h4 class="editor-section-title">Colors & Background</h4>
                            
                            <div class="form-group">
                                <label class="form-label">Background Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="section-bg-color" value="${this.rgbToHex(currentBgColor)}">
                                    <input type="text" class="form-input" id="section-bg-color-text" value="${this.rgbToHex(currentBgColor)}">
                            </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Background Image URL</label>
                                <input type="url" class="form-input" id="section-bg-image" placeholder="https://example.com/image.jpg" value="${currentBgImage !== 'none' ? currentBgImage.replace(/url\(['"]?([^'"]*)['"]?\)/, '$1') : ''}">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Background Size</label>
                                <select class="form-select" id="section-bg-size">
                                    <option value="cover">Cover</option>
                                    <option value="contain">Contain</option>
                                    <option value="100% 100%">Stretch</option>
                                    <option value="auto">Auto</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="editor-section">
                            <h4 class="editor-section-title">Quick Actions</h4>
                            
                            <div class="form-group">
                                <button class="btn btn-primary" id="reset-section-styles" style="width: 100%; margin-bottom: 8px;">
                                    <span class="material-icons" style="font-size: 16px; margin-right: 8px;">refresh</span>
                                    Reset to Default
                                </button>
                                
                                <button class="btn btn-secondary" id="apply-section-styles" style="width: 100%;">
                                    <span class="material-icons" style="font-size: 16px; margin-right: 8px;">save</span>
                                    Apply & Save
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }

            setupEditorListeners(section) {
                console.log('Setting up editor listeners for:', section.dataset.type);

                // Check if listeners are already set up for this section
                const editor = document.getElementById('component-editor');
                if (editor && editor.dataset.listenersSetup === 'true') {
                    console.log('Editor listeners already set up, skipping');
                    return;
                }

                // Prevent clicks inside editor from bubbling up
                if (editor) {
                    editor.addEventListener('click', (e) => {
                        e.stopPropagation();
                    });
                    editor.dataset.listenersSetup = 'true';
                }

                // Setup section styling controls
                this.setupSectionStylingControls(section);

                // Apply & Save button
                const applyBtn = document.getElementById('apply-section-styles');
                if (applyBtn) {
                    applyBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.applySectionStyles(section);
                        this.saveTheme();
                    });
                }

                // Reset button
                const resetBtn = document.getElementById('reset-section-styles');
                if (resetBtn) {
                    resetBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.resetSectionStyles(section);
                    });
                }

                // Color picker synchronization
                document.querySelectorAll('.color-input').forEach(colorInput => {
                    const textInput = colorInput.nextElementSibling;
                    if (textInput && textInput.classList.contains('form-input')) {
                        colorInput.addEventListener('input', (e) => {
                            textInput.value = e.target.value;
                        });
                        textInput.addEventListener('input', (e) => {
                            colorInput.value = e.target.value;
                        });
                    }
                });

                // Real-time slider updates
                const sliders = [
                    'padding-slider',
                    'margin-slider',
                    'border-width-slider',
                    'border-radius-slider',
                    'shadow-slider',
                    'font-size-slider',
                    'line-height-slider'
                ];

                sliders.forEach(sliderId => {
                    const slider = document.getElementById(sliderId);
                    const valueSpan = document.getElementById(sliderId.replace('-slider', '-value'));

                    if (slider && valueSpan) {
                        slider.addEventListener('input', (e) => {
                            if (sliderId === 'shadow-slider') {
                                const shadowValues = ['None', 'Light', 'Medium', 'Heavy'];
                                valueSpan.textContent = shadowValues[parseInt(e.target.value)];
                            } else if (sliderId === 'line-height-slider') {
                                valueSpan.textContent = e.target.value;
                            } else {
                                valueSpan.textContent = e.target.value + 'px';
                            }
                        });
                    }
                });

                // Prevent form inputs from triggering deselection
                document.querySelectorAll('#component-editor input, #component-editor textarea, #component-editor button').forEach(element => {
                    element.addEventListener('click', (e) => {
                        e.stopPropagation();
                    });
                });

                // Navbar-specific event listeners
                if (section.dataset.type === 'navbar') {
                    this.setupNavbarEditorListeners(section);
                }

                // Image-text-specific event listeners
                if (section.dataset.type === 'image-text') {
                    this.setupImageTextEditorListeners(section);
                }

                // Announcement bar-specific event listeners
                if (section.dataset.type === 'announcement-bar') {
                    this.setupAnnouncementBarEditorListeners(section);
                }

                // Product slider-specific event listeners
                if (section.dataset.type === 'product-slider') {
                    this.setupProductSliderEditorListeners(section);
                }

                // Testimonials-specific event listeners
                if (section.dataset.type === 'testimonials') {
                    this.setupTestimonialsEditorListeners(section);
                }

                // Newsletter-specific event listeners
                if (section.dataset.type === 'newsletter') {
                    this.setupNewsletterEditorListeners(section);
                }

                // Contact form-specific event listeners
                if (section.dataset.type === 'contact-form') {
                    this.setupContactFormEditorListeners(section);
                }

                // Hero slider-specific event listeners
                if (section.dataset.type === 'hero-slider') {
                    this.setupHeroSliderEditorListeners(section);
                }
                if (section.dataset.type === 'about-us') {
                    this.setupAboutUsEditorListeners(section);
                }
            }

            setupSectionStylingControls(section) {
                // Margin control
                const marginSlider = document.getElementById('section-margin');
                const marginValue = document.getElementById('section-margin-value');
                if (marginSlider && marginValue) {
                    marginSlider.addEventListener('input', () => {
                        marginValue.textContent = marginSlider.value + 'px';
                        section.style.margin = marginSlider.value + 'px';
                    });
                }

                // Padding control
                const paddingSlider = document.getElementById('section-padding');
                const paddingValue = document.getElementById('section-padding-value');
                if (paddingSlider && paddingValue) {
                    paddingSlider.addEventListener('input', () => {
                        paddingValue.textContent = paddingSlider.value + 'px';
                        section.style.padding = paddingSlider.value + 'px';
                    });
                }

                // Border radius control
                const borderRadiusSlider = document.getElementById('section-border-radius');
                const borderRadiusValue = document.getElementById('section-border-radius-value');
                if (borderRadiusSlider && borderRadiusValue) {
                    borderRadiusSlider.addEventListener('input', () => {
                        borderRadiusValue.textContent = borderRadiusSlider.value + 'px';
                        section.style.borderRadius = borderRadiusSlider.value + 'px';
                    });
                }

                // Border width control
                const borderWidthSlider = document.getElementById('section-border-width');
                const borderWidthValue = document.getElementById('section-border-width-value');
                if (borderWidthSlider && borderWidthValue) {
                    borderWidthSlider.addEventListener('input', () => {
                        borderWidthValue.textContent = borderWidthSlider.value + 'px';
                        const borderStyle = document.getElementById('section-border-style')?.value || 'solid';
                        const borderColor = document.getElementById('section-border-color')?.value || '#e5e7eb';
                        section.style.border = `${borderWidthSlider.value}px ${borderStyle} ${borderColor}`;
                    });
                }

                // Border style control
                const borderStyleSelect = document.getElementById('section-border-style');
                if (borderStyleSelect) {
                    borderStyleSelect.addEventListener('change', () => {
                        const borderWidth = document.getElementById('section-border-width')?.value || '0';
                        const borderColor = document.getElementById('section-border-color')?.value || '#e5e7eb';
                        section.style.border = `${borderWidth}px ${borderStyleSelect.value} ${borderColor}`;
                    });
                }

                // Border color control
                const borderColorInput = document.getElementById('section-border-color');
                const borderColorText = document.getElementById('section-border-color-text');
                if (borderColorInput && borderColorText) {
                    borderColorInput.addEventListener('input', () => {
                        borderColorText.value = borderColorInput.value;
                        const borderWidth = document.getElementById('section-border-width')?.value || '0';
                        const borderStyle = document.getElementById('section-border-style')?.value || 'solid';
                        section.style.border = `${borderWidth}px ${borderStyle} ${borderColorInput.value}`;
                    });
                    borderColorText.addEventListener('input', () => {
                        borderColorInput.value = borderColorText.value;
                        const borderWidth = document.getElementById('section-border-width')?.value || '0';
                        const borderStyle = document.getElementById('section-border-style')?.value || 'solid';
                        section.style.border = `${borderWidth}px ${borderStyle} ${borderColorText.value}`;
                    });
                }

                // Box shadow control
                const boxShadowSelect = document.getElementById('section-box-shadow');
                if (boxShadowSelect) {
                    boxShadowSelect.addEventListener('change', () => {
                        section.style.boxShadow = boxShadowSelect.value;
                    });
                }

            }

            applySectionStyles(section) {
                console.log('Applying section styles to:', section.dataset.type);
                // Styles are already applied in real-time by the controls
                this.showSuccessMessage('Section styles applied successfully!');
            }

            resetSectionStyles(section) {
                console.log('Resetting section styles for:', section.dataset.type);

                // Reset spacing, border, and shadow styles to default
                section.style.margin = '20px';
                section.style.padding = '20px';
                section.style.borderRadius = '8px';
                section.style.border = 'none';
                section.style.boxShadow = 'none';

                // Reset form controls
                document.getElementById('section-margin')?.setAttribute('value', '20');
                document.getElementById('section-padding')?.setAttribute('value', '20');
                document.getElementById('section-border-radius')?.setAttribute('value', '8');
                document.getElementById('section-border-width')?.setAttribute('value', '0');
                document.getElementById('section-border-color')?.setAttribute('value', '#e5e7eb');
                document.getElementById('section-border-style')?.setAttribute('value', 'none');
                document.getElementById('section-box-shadow')?.setAttribute('value', 'none');

                // Update value displays
                document.getElementById('section-margin-value').textContent = '20px';
                document.getElementById('section-padding-value').textContent = '20px';
                document.getElementById('section-border-radius-value').textContent = '8px';
                document.getElementById('section-border-width-value').textContent = '0px';

                this.showSuccessMessage('Section spacing, borders, and shadows reset to default!');
            }

            setupAboutUsEditorListeners(section) {
                // Content updates
                const titleInput = document.getElementById('about-title');
                const subtitleInput = document.getElementById('about-subtitle');
                const descriptionInput = document.getElementById('about-description');
                const layoutSelect = document.getElementById('about-layout');
                const showStatsCheckbox = document.getElementById('about-show-stats');
                const showTeamCheckbox = document.getElementById('about-show-team');
                const showValuesCheckbox = document.getElementById('about-show-values');

                if (titleInput) {
                    titleInput.addEventListener('input', () => {
                        this.applyAboutUsChanges(section);
                    });
                }

                if (subtitleInput) {
                    subtitleInput.addEventListener('input', () => {
                        this.applyAboutUsChanges(section);
                    });
                }

                if (descriptionInput) {
                    descriptionInput.addEventListener('input', () => {
                        this.applyAboutUsChanges(section);
                    });
                }

                if (layoutSelect) {
                    layoutSelect.addEventListener('change', () => {
                        this.applyAboutUsChanges(section);
                    });
                }

                if (showStatsCheckbox) {
                    showStatsCheckbox.addEventListener('change', () => {
                        this.applyAboutUsChanges(section);
                    });
                }

                if (showTeamCheckbox) {
                    showTeamCheckbox.addEventListener('change', () => {
                        this.applyAboutUsChanges(section);
                    });
                }

                if (showValuesCheckbox) {
                    showValuesCheckbox.addEventListener('change', () => {
                        this.applyAboutUsChanges(section);
                    });
                }

                // Image upload
                const mainImageInput = document.getElementById('about-main-image');
                if (mainImageInput) {
                    mainImageInput.addEventListener('change', (e) => {
                        const file = e.target.files[0];
                        if (file) {
                            const reader = new FileReader();
                            reader.onload = (e) => {
                                const preview = document.getElementById('about-main-preview');
                                if (preview) {
                                    preview.innerHTML = `<img src="${e.target.result}" style="max-width: 100%; height: auto; border-radius: 8px;">`;
                                }
                                this.applyAboutUsChanges(section);
                            };
                            reader.readAsDataURL(file);
                        }
                    });
                }

                // Background image upload
                const bgImageInput = document.getElementById('about-bg-image');
                if (bgImageInput) {
                    bgImageInput.addEventListener('change', (e) => {
                        const file = e.target.files[0];
                        if (file) {
                            const reader = new FileReader();
                            reader.onload = (e) => {
                                const preview = document.getElementById('about-bg-preview');
                                if (preview) {
                                    preview.innerHTML = `<img src="${e.target.result}" style="max-width: 100%; height: auto; border-radius: 8px;">`;
                                }
                                this.applyAboutUsSectionStyle(section, 'background-image', `url(${e.target.result})`);
                            };
                            reader.readAsDataURL(file);
                        }
                    });
                }

                // Setup live styling
                this.setupAboutUsLiveStyling(section);
            }

            setupContactFormEditorListeners(section) {
                console.log('Setting up contact-form editor listeners...');

                // Live content updates
                const liveUpdateInputs = [
                    'contact-title',
                    'contact-subtitle',
                    'contact-button-text'
                ];

                liveUpdateInputs.forEach(inputId => {
                    const input = document.getElementById(inputId);
                    if (input) {
                        input.addEventListener('input', () => {
                            this.applyContactFormChanges(section);
                        });
                    }
                });

                // Live styling updates
                this.setupContactFormLiveStyling(section);

                // Layout style handler
                const layoutSelect = document.getElementById('contact-layout');
                if (layoutSelect) {
                    layoutSelect.addEventListener('change', () => {
                        this.applyContactFormChanges(section);
                    });
                }

                // Form field checkboxes
                const fieldCheckboxes = [
                    'contact-field-name',
                    'contact-field-email',
                    'contact-field-phone',
                    'contact-field-company',
                    'contact-field-subject',
                    'contact-field-message'
                ];

                fieldCheckboxes.forEach(checkboxId => {
                    const checkbox = document.getElementById(checkboxId);
                    if (checkbox) {
                        checkbox.addEventListener('change', () => {
                            this.applyContactFormChanges(section);
                        });
                    }
                });

                // Other checkboxes
                const otherCheckboxes = [
                    'contact-show-privacy',
                    'contact-show-captcha'
                ];

                otherCheckboxes.forEach(checkboxId => {
                    const checkbox = document.getElementById(checkboxId);
                    if (checkbox) {
                        checkbox.addEventListener('change', () => {
                            this.applyContactFormChanges(section);
                        });
                    }
                });

                // Background image upload handler
                const bgImageUpload = document.getElementById('contact-bg-image');
                if (bgImageUpload) {
                    bgImageUpload.addEventListener('change', (e) => {
                        const file = e.target.files[0];
                        if (file) {
                            const reader = new FileReader();
                            reader.onload = function (e) {
                                const preview = document.getElementById('contact-bg-preview');
                                if (preview) {
                                    preview.innerHTML = `<img src="${e.target.result}" style="max-width: 200px; max-height: 150px; border-radius: 4px;">`;
                                }
                                // Apply background image to section
                                const sectionContainer = section.querySelector('div[style*="padding: 60px"]');
                                if (sectionContainer) {
                                    sectionContainer.style.backgroundImage = `url(${e.target.result})`;
                                    sectionContainer.style.backgroundSize = 'cover';
                                    sectionContainer.style.backgroundPosition = 'center';
                                }
                            };
                            reader.readAsDataURL(file);
                        }
                    });
                }
            }

            setupAboutUsLiveStyling(section) {
                // Section styling
                const sectionPadding = document.getElementById('about-section-padding');
                const sectionMargin = document.getElementById('about-section-margin');
                const bgColor = document.getElementById('about-bg-color');
                const bgColorText = document.getElementById('about-bg-color-text');
                const borderWidth = document.getElementById('about-border-width');
                const borderColor = document.getElementById('about-border-color');
                const borderColorText = document.getElementById('about-border-color-text');
                const borderRadius = document.getElementById('about-border-radius');
                const shadow = document.getElementById('about-shadow');
                const shadowColor = document.getElementById('about-shadow-color');
                const shadowColorText = document.getElementById('about-shadow-color-text');

                // Image styling
                const imageRadius = document.getElementById('about-image-radius');
                const imageShadow = document.getElementById('about-image-shadow');
                const imageShadowColor = document.getElementById('about-image-shadow-color');
                const imageShadowColorText = document.getElementById('about-image-shadow-color-text');

                // Typography
                const titleColor = document.getElementById('about-title-color');
                const titleColorText = document.getElementById('about-title-color-text');
                const titleSize = document.getElementById('about-title-size');
                const subtitleColor = document.getElementById('about-subtitle-color');
                const subtitleColorText = document.getElementById('about-subtitle-color-text');
                const subtitleSize = document.getElementById('about-subtitle-size');
                const descriptionColor = document.getElementById('about-description-color');
                const descriptionColorText = document.getElementById('about-description-color-text');
                const descriptionSize = document.getElementById('about-description-size');

                // Section styling sliders
                if (sectionPadding) {
                    sectionPadding.addEventListener('input', (e) => {
                        const value = e.target.value;
                        document.getElementById('about-section-padding-value').textContent = value + 'px';
                        this.applyAboutUsSectionStyle(section, 'padding', value + 'px');
                    });
                }

                if (sectionMargin) {
                    sectionMargin.addEventListener('input', (e) => {
                        const value = e.target.value;
                        document.getElementById('about-section-margin-value').textContent = value + 'px';
                        this.applyAboutUsSectionStyle(section, 'margin', value + 'px');
                    });
                }

                if (borderWidth) {
                    borderWidth.addEventListener('input', (e) => {
                        const value = e.target.value;
                        document.getElementById('about-border-width-value').textContent = value + 'px';
                        this.applyAboutUsSectionStyle(section, 'border-width', value + 'px');
                    });
                }

                if (borderRadius) {
                    borderRadius.addEventListener('input', (e) => {
                        const value = e.target.value;
                        document.getElementById('about-border-radius-value').textContent = value + 'px';
                        this.applyAboutUsSectionStyle(section, 'border-radius', value + 'px');
                    });
                }

                if (shadow) {
                    shadow.addEventListener('input', (e) => {
                        const value = e.target.value;
                        document.getElementById('about-shadow-value').textContent = value + 'px';
                        const shadowColorValue = shadowColor?.value || '#000000';
                        this.applyAboutUsSectionStyle(section, 'box-shadow', `0 4px ${value}px ${shadowColorValue}`);
                    });
                }

                // Color pickers
                if (bgColor && bgColorText) {
                    bgColor.addEventListener('input', (e) => {
                        bgColorText.value = e.target.value;
                        this.applyAboutUsSectionStyle(section, 'background-color', e.target.value);
                    });
                    bgColorText.addEventListener('input', (e) => {
                        bgColor.value = e.target.value;
                        this.applyAboutUsSectionStyle(section, 'background-color', e.target.value);
                    });
                }

                if (borderColor && borderColorText) {
                    borderColor.addEventListener('input', (e) => {
                        borderColorText.value = e.target.value;
                        this.applyAboutUsSectionStyle(section, 'border-color', e.target.value);
                    });
                    borderColorText.addEventListener('input', (e) => {
                        borderColor.value = e.target.value;
                        this.applyAboutUsSectionStyle(section, 'border-color', e.target.value);
                    });
                }

                if (shadowColor && shadowColorText) {
                    shadowColor.addEventListener('input', (e) => {
                        shadowColorText.value = e.target.value;
                        const shadowValue = shadow?.value || '0';
                        this.applyAboutUsSectionStyle(section, 'box-shadow', `0 4px ${shadowValue}px ${e.target.value}`);
                    });
                    shadowColorText.addEventListener('input', (e) => {
                        shadowColor.value = e.target.value;
                        const shadowValue = shadow?.value || '0';
                        this.applyAboutUsSectionStyle(section, 'box-shadow', `0 4px ${shadowValue}px ${e.target.value}`);
                    });
                }

                // Image styling
                if (imageRadius) {
                    imageRadius.addEventListener('input', (e) => {
                        const value = e.target.value;
                        document.getElementById('about-image-radius-value').textContent = value + 'px';
                        const image = section.querySelector('img');
                        if (image) {
                            image.style.borderRadius = value + 'px';
                        }
                    });
                }

                if (imageShadow) {
                    imageShadow.addEventListener('input', (e) => {
                        const value = e.target.value;
                        document.getElementById('about-image-shadow-value').textContent = value + 'px';
                        const image = section.querySelector('img');
                        if (image) {
                            const shadowColorValue = imageShadowColor?.value || '#000000';
                            image.style.boxShadow = `0 4px ${value}px ${shadowColorValue}`;
                        }
                    });
                }

                if (imageShadowColor && imageShadowColorText) {
                    imageShadowColor.addEventListener('input', (e) => {
                        imageShadowColorText.value = e.target.value;
                        const image = section.querySelector('img');
                        if (image) {
                            const shadowValue = imageShadow?.value || '0';
                            image.style.boxShadow = `0 4px ${shadowValue}px ${e.target.value}`;
                        }
                    });
                    imageShadowColorText.addEventListener('input', (e) => {
                        imageShadowColor.value = e.target.value;
                        const image = section.querySelector('img');
                        if (image) {
                            const shadowValue = imageShadow?.value || '0';
                            image.style.boxShadow = `0 4px ${shadowValue}px ${e.target.value}`;
                        }
                    });
                }

                // Typography
                if (titleColor && titleColorText) {
                    titleColor.addEventListener('input', (e) => {
                        titleColorText.value = e.target.value;
                        this.applyAboutUsTypographyStyle(section, 'title', 'color', e.target.value);
                    });
                    titleColorText.addEventListener('input', (e) => {
                        titleColor.value = e.target.value;
                        this.applyAboutUsTypographyStyle(section, 'title', 'color', e.target.value);
                    });
                }

                if (titleSize) {
                    titleSize.addEventListener('input', (e) => {
                        const value = e.target.value;
                        document.getElementById('about-title-size-value').textContent = value + 'px';
                        this.applyAboutUsTypographyStyle(section, 'title', 'font-size', value + 'px');
                    });
                }

                if (subtitleColor && subtitleColorText) {
                    subtitleColor.addEventListener('input', (e) => {
                        subtitleColorText.value = e.target.value;
                        this.applyAboutUsTypographyStyle(section, 'subtitle', 'color', e.target.value);
                    });
                    subtitleColorText.addEventListener('input', (e) => {
                        subtitleColor.value = e.target.value;
                        this.applyAboutUsTypographyStyle(section, 'subtitle', 'color', e.target.value);
                    });
                }

                if (subtitleSize) {
                    subtitleSize.addEventListener('input', (e) => {
                        const value = e.target.value;
                        document.getElementById('about-subtitle-size-value').textContent = value + 'px';
                        this.applyAboutUsTypographyStyle(section, 'subtitle', 'font-size', value + 'px');
                    });
                }

                if (descriptionColor && descriptionColorText) {
                    descriptionColor.addEventListener('input', (e) => {
                        descriptionColorText.value = e.target.value;
                        this.applyAboutUsTypographyStyle(section, 'description', 'color', e.target.value);
                    });
                    descriptionColorText.addEventListener('input', (e) => {
                        descriptionColor.value = e.target.value;
                        this.applyAboutUsTypographyStyle(section, 'description', 'color', e.target.value);
                    });
                }

                if (descriptionSize) {
                    descriptionSize.addEventListener('input', (e) => {
                        const value = e.target.value;
                        document.getElementById('about-description-size-value').textContent = value + 'px';
                        this.applyAboutUsTypographyStyle(section, 'description', 'font-size', value + 'px');
                    });
                }
            }

            setupContactFormLiveStyling(section) {
                // Section padding live update
                const sectionPaddingSlider = document.getElementById('contact-section-padding');
                const sectionPaddingValue = document.getElementById('contact-section-padding-value');
                if (sectionPaddingSlider && sectionPaddingValue) {
                    sectionPaddingSlider.addEventListener('input', (e) => {
                        sectionPaddingValue.textContent = e.target.value + 'px';
                        this.applyContactFormSectionStyle(section, 'padding', e.target.value + 'px');
                    });
                }

                // Section margin live update
                const sectionMarginSlider = document.getElementById('contact-section-margin');
                const sectionMarginValue = document.getElementById('contact-section-margin-value');
                if (sectionMarginSlider && sectionMarginValue) {
                    sectionMarginSlider.addEventListener('input', (e) => {
                        sectionMarginValue.textContent = e.target.value + 'px';
                        this.applyContactFormSectionStyle(section, 'margin', e.target.value + 'px');
                    });
                }

                // Background color live update
                const bgColorPicker = document.getElementById('contact-bg-color');
                const bgColorText = document.getElementById('contact-bg-color-text');
                if (bgColorPicker && bgColorText) {
                    bgColorPicker.addEventListener('input', (e) => {
                        bgColorText.value = e.target.value;
                        this.applyContactFormSectionStyle(section, 'backgroundColor', e.target.value);
                    });
                    bgColorText.addEventListener('input', (e) => {
                        bgColorPicker.value = e.target.value;
                        this.applyContactFormSectionStyle(section, 'backgroundColor', e.target.value);
                    });
                }

                // Form styling live updates
                this.setupContactFormFormStyling(section);

                // Border and shadow live updates
                this.setupContactFormBorderShadow(section);

                // Typography live updates
                this.setupContactFormTypographyListeners(section);
            }

            setupContactFormFormStyling(section) {
                // Form background color live update
                const formBgColorPicker = document.getElementById('contact-form-bg');
                const formBgColorText = document.getElementById('contact-form-bg-text');
                if (formBgColorPicker && formBgColorText) {
                    formBgColorPicker.addEventListener('input', (e) => {
                        formBgColorText.value = e.target.value;
                        this.applyContactFormFormStyle(section, 'backgroundColor', e.target.value);
                    });
                    formBgColorText.addEventListener('input', (e) => {
                        formBgColorPicker.value = e.target.value;
                        this.applyContactFormFormStyle(section, 'backgroundColor', e.target.value);
                    });
                }

                // Input styling live updates
                this.setupContactFormInputStyling(section);

                // Button styling live updates
                this.setupContactFormButtonStyling(section);
            }

            setupContactFormInputStyling(section) {
                // Input border color live update
                const inputBorderColorPicker = document.getElementById('contact-input-border');
                const inputBorderColorText = document.getElementById('contact-input-border-text');
                if (inputBorderColorPicker && inputBorderColorText) {
                    inputBorderColorPicker.addEventListener('input', (e) => {
                        inputBorderColorText.value = e.target.value;
                        this.applyContactFormInputStyle(section, 'borderColor', e.target.value);
                    });
                    inputBorderColorText.addEventListener('input', (e) => {
                        inputBorderColorPicker.value = e.target.value;
                        this.applyContactFormInputStyle(section, 'borderColor', e.target.value);
                    });
                }

                // Input focus color live update
                const inputFocusColorPicker = document.getElementById('contact-input-focus');
                const inputFocusColorText = document.getElementById('contact-input-focus-text');
                if (inputFocusColorPicker && inputFocusColorText) {
                    inputFocusColorPicker.addEventListener('input', (e) => {
                        inputFocusColorText.value = e.target.value;
                        this.applyContactFormInputStyle(section, 'focusColor', e.target.value);
                    });
                    inputFocusColorText.addEventListener('input', (e) => {
                        inputFocusColorPicker.value = e.target.value;
                        this.applyContactFormInputStyle(section, 'focusColor', e.target.value);
                    });
                }

                // Input border radius live update
                const inputRadiusSlider = document.getElementById('contact-input-radius');
                const inputRadiusValue = document.getElementById('contact-input-radius-value');
                if (inputRadiusSlider && inputRadiusValue) {
                    inputRadiusSlider.addEventListener('input', (e) => {
                        inputRadiusValue.textContent = e.target.value + 'px';
                        this.applyContactFormInputStyle(section, 'borderRadius', e.target.value + 'px');
                    });
                }

                // Input padding live update
                const inputPaddingSlider = document.getElementById('contact-input-padding');
                const inputPaddingValue = document.getElementById('contact-input-padding-value');
                if (inputPaddingSlider && inputPaddingValue) {
                    inputPaddingSlider.addEventListener('input', (e) => {
                        inputPaddingValue.textContent = e.target.value + 'px';
                        this.applyContactFormInputStyle(section, 'padding', e.target.value + 'px');
                    });
                }

                // Input text color live update
                const inputTextColorPicker = document.getElementById('contact-input-text-color');
                const inputTextColorText = document.getElementById('contact-input-text-color-text');
                if (inputTextColorPicker && inputTextColorText) {
                    inputTextColorPicker.addEventListener('input', (e) => {
                        inputTextColorText.value = e.target.value;
                        this.applyContactFormInputStyle(section, 'color', e.target.value);
                    });
                    inputTextColorText.addEventListener('input', (e) => {
                        inputTextColorPicker.value = e.target.value;
                        this.applyContactFormInputStyle(section, 'color', e.target.value);
                    });
                }

                // Input placeholder color live update
                const placeholderColorPicker = document.getElementById('contact-placeholder-color');
                const placeholderColorText = document.getElementById('contact-placeholder-color-text');
                if (placeholderColorPicker && placeholderColorText) {
                    placeholderColorPicker.addEventListener('input', (e) => {
                        placeholderColorText.value = e.target.value;
                        this.applyContactFormInputStyle(section, 'placeholderColor', e.target.value);
                    });
                    placeholderColorText.addEventListener('input', (e) => {
                        placeholderColorPicker.value = e.target.value;
                        this.applyContactFormInputStyle(section, 'placeholderColor', e.target.value);
                    });
                }
            }

            setupContactFormButtonStyling(section) {
                // Button background color live update
                const buttonBgColorPicker = document.getElementById('contact-button-bg');
                const buttonBgColorText = document.getElementById('contact-button-bg-text');
                if (buttonBgColorPicker && buttonBgColorText) {
                    buttonBgColorPicker.addEventListener('input', (e) => {
                        buttonBgColorText.value = e.target.value;
                        this.applyContactFormButtonStyle(section, 'backgroundColor', e.target.value);
                    });
                    buttonBgColorText.addEventListener('input', (e) => {
                        buttonBgColorPicker.value = e.target.value;
                        this.applyContactFormButtonStyle(section, 'backgroundColor', e.target.value);
                    });
                }

                // Button text color live update
                const buttonTextColorPicker = document.getElementById('contact-button-text-color');
                const buttonTextColorText = document.getElementById('contact-button-text-color-text');
                if (buttonTextColorPicker && buttonTextColorText) {
                    buttonTextColorPicker.addEventListener('input', (e) => {
                        buttonTextColorText.value = e.target.value;
                        this.applyContactFormButtonStyle(section, 'color', e.target.value);
                    });
                    buttonTextColorText.addEventListener('input', (e) => {
                        buttonTextColorPicker.value = e.target.value;
                        this.applyContactFormButtonStyle(section, 'color', e.target.value);
                    });
                }

                // Button border radius live update
                const buttonRadiusSlider = document.getElementById('contact-button-radius');
                const buttonRadiusValue = document.getElementById('contact-button-radius-value');
                if (buttonRadiusSlider && buttonRadiusValue) {
                    buttonRadiusSlider.addEventListener('input', (e) => {
                        buttonRadiusValue.textContent = e.target.value + 'px';
                        this.applyContactFormButtonStyle(section, 'borderRadius', e.target.value + 'px');
                    });
                }

                // Button hover color live update
                const buttonHoverColorPicker = document.getElementById('contact-button-hover');
                const buttonHoverColorText = document.getElementById('contact-button-hover-text');
                if (buttonHoverColorPicker && buttonHoverColorText) {
                    buttonHoverColorPicker.addEventListener('input', (e) => {
                        buttonHoverColorText.value = e.target.value;
                        this.applyContactFormButtonHoverStyle(section, e.target.value);
                    });
                    buttonHoverColorText.addEventListener('input', (e) => {
                        buttonHoverColorPicker.value = e.target.value;
                        this.applyContactFormButtonHoverStyle(section, e.target.value);
                    });
                }
            }

            setupContactFormBorderShadow(section) {
                // Border width live update
                const borderWidthSlider = document.getElementById('contact-border-width');
                const borderWidthValue = document.getElementById('contact-border-width-value');
                if (borderWidthSlider && borderWidthValue) {
                    borderWidthSlider.addEventListener('input', (e) => {
                        borderWidthValue.textContent = e.target.value + 'px';
                        this.applyContactFormSectionStyle(section, 'borderWidth', e.target.value + 'px');
                    });
                }

                // Border color live update
                const borderColorPicker = document.getElementById('contact-border-color');
                const borderColorText = document.getElementById('contact-border-color-text');
                if (borderColorPicker && borderColorText) {
                    borderColorPicker.addEventListener('input', (e) => {
                        borderColorText.value = e.target.value;
                        this.applyContactFormSectionStyle(section, 'borderColor', e.target.value);
                    });
                    borderColorText.addEventListener('input', (e) => {
                        borderColorPicker.value = e.target.value;
                        this.applyContactFormSectionStyle(section, 'borderColor', e.target.value);
                    });
                }

                // Border radius live update
                const borderRadiusSlider = document.getElementById('contact-border-radius');
                const borderRadiusValue = document.getElementById('contact-border-radius-value');
                if (borderRadiusSlider && borderRadiusValue) {
                    borderRadiusSlider.addEventListener('input', (e) => {
                        borderRadiusValue.textContent = e.target.value + 'px';
                        this.applyContactFormSectionStyle(section, 'borderRadius', e.target.value + 'px');
                    });
                }

                // Box shadow live update
                const shadowSlider = document.getElementById('contact-shadow');
                const shadowValue = document.getElementById('contact-shadow-value');
                const shadowColorPicker = document.getElementById('contact-shadow-color');
                const shadowColorText = document.getElementById('contact-shadow-color-text');

                if (shadowSlider && shadowValue) {
                    shadowSlider.addEventListener('input', (e) => {
                        shadowValue.textContent = e.target.value + 'px';
                        const shadowColor = shadowColorPicker ? shadowColorPicker.value : '#000000';
                        this.applyContactFormSectionStyle(section, 'boxShadow', `0 4px ${e.target.value}px ${shadowColor}`);
                    });
                }

                if (shadowColorPicker && shadowColorText) {
                    shadowColorPicker.addEventListener('input', (e) => {
                        shadowColorText.value = e.target.value;
                        const shadowSize = shadowSlider ? shadowSlider.value : '0';
                        this.applyContactFormSectionStyle(section, 'boxShadow', `0 4px ${shadowSize}px ${e.target.value}`);
                    });
                    shadowColorText.addEventListener('input', (e) => {
                        shadowColorPicker.value = e.target.value;
                        const shadowSize = shadowSlider ? shadowSlider.value : '0';
                        this.applyContactFormSectionStyle(section, 'boxShadow', `0 4px ${shadowSize}px ${e.target.value}`);
                    });
                }
            }

            setupContactFormTypographyListeners(section) {
                // Title color live update
                const titleColorPicker = document.getElementById('contact-title-color');
                const titleColorText = document.getElementById('contact-title-color-text');
                if (titleColorPicker && titleColorText) {
                    titleColorPicker.addEventListener('input', (e) => {
                        titleColorText.value = e.target.value;
                        this.applyContactFormTypographyStyle(section, 'title', 'color', e.target.value);
                    });
                    titleColorText.addEventListener('input', (e) => {
                        titleColorPicker.value = e.target.value;
                        this.applyContactFormTypographyStyle(section, 'title', 'color', e.target.value);
                    });
                }

                // Title size live update
                const titleSizeSlider = document.getElementById('contact-title-size');
                const titleSizeValue = document.getElementById('contact-title-size-value');
                if (titleSizeSlider && titleSizeValue) {
                    titleSizeSlider.addEventListener('input', (e) => {
                        titleSizeValue.textContent = e.target.value + 'px';
                        this.applyContactFormTypographyStyle(section, 'title', 'fontSize', e.target.value + 'px');
                    });
                }

                // Subtitle color live update
                const subtitleColorPicker = document.getElementById('contact-subtitle-color');
                const subtitleColorText = document.getElementById('contact-subtitle-color-text');
                if (subtitleColorPicker && subtitleColorText) {
                    subtitleColorPicker.addEventListener('input', (e) => {
                        subtitleColorText.value = e.target.value;
                        this.applyContactFormTypographyStyle(section, 'subtitle', 'color', e.target.value);
                    });
                    subtitleColorText.addEventListener('input', (e) => {
                        subtitleColorPicker.value = e.target.value;
                        this.applyContactFormTypographyStyle(section, 'subtitle', 'color', e.target.value);
                    });
                }

                // Subtitle size live update
                const subtitleSizeSlider = document.getElementById('contact-subtitle-size');
                const subtitleSizeValue = document.getElementById('contact-subtitle-size-value');
                if (subtitleSizeSlider && subtitleSizeValue) {
                    subtitleSizeSlider.addEventListener('input', (e) => {
                        subtitleSizeValue.textContent = e.target.value + 'px';
                        this.applyContactFormTypographyStyle(section, 'subtitle', 'fontSize', e.target.value + 'px');
                    });
                }

                // Label color live update
                const labelColorPicker = document.getElementById('contact-label-color');
                const labelColorText = document.getElementById('contact-label-color-text');
                if (labelColorPicker && labelColorText) {
                    labelColorPicker.addEventListener('input', (e) => {
                        labelColorText.value = e.target.value;
                        this.applyContactFormTypographyStyle(section, 'label', 'color', e.target.value);
                    });
                    labelColorText.addEventListener('input', (e) => {
                        labelColorPicker.value = e.target.value;
                        this.applyContactFormTypographyStyle(section, 'label', 'color', e.target.value);
                    });
                }
            }

            applyAboutUsChanges(section) {
                const title = document.getElementById('about-title')?.value || 'About Us';
                const subtitle = document.getElementById('about-subtitle')?.value || 'Learn more about our company and mission';
                const description = document.getElementById('about-description')?.value || 'We are a passionate team dedicated to delivering exceptional products and services to our customers.';
                const layout = document.getElementById('about-layout')?.value || 'text-left';
                const showStats = document.getElementById('about-show-stats')?.checked || false;
                const showTeam = document.getElementById('about-show-team')?.checked || false;
                const showValues = document.getElementById('about-show-values')?.checked || false;

                // Update content
                const titleElement = section.querySelector('h2');
                if (titleElement) {
                    titleElement.textContent = title;
                }

                const subtitleElement = section.querySelector('p');
                if (subtitleElement) {
                    subtitleElement.textContent = subtitle;
                }

                const descriptionElement = section.querySelector('.about-description');
                if (descriptionElement) {
                    descriptionElement.textContent = description;
                }

                // Update layout
                section.className = section.className.replace(/about-layout-\w+/g, '');
                section.classList.add(`about-layout-${layout}`);

                // Update visibility
                const statsElement = section.querySelector('.about-stats');
                if (statsElement) {
                    statsElement.style.display = showStats ? 'block' : 'none';
                }

                const teamElement = section.querySelector('.about-team');
                if (teamElement) {
                    teamElement.style.display = showTeam ? 'block' : 'none';
                }

                const valuesElement = section.querySelector('.about-values');
                if (valuesElement) {
                    valuesElement.style.display = showValues ? 'block' : 'none';
                }

                console.log('About Us changes applied:', { title, subtitle, description, layout, showStats, showTeam, showValues });
            }

            applyContactFormChanges(section) {
                // Update content
                const title = document.getElementById('contact-title')?.value;
                const subtitle = document.getElementById('contact-subtitle')?.value;
                const buttonText = document.getElementById('contact-button-text')?.value;
                const layout = document.getElementById('contact-layout')?.value;
                const showPrivacy = document.getElementById('contact-show-privacy')?.checked;
                const showCaptcha = document.getElementById('contact-show-captcha')?.checked;

                if (title) {
                    const titleEl = section.querySelector('h2');
                    if (titleEl) titleEl.textContent = title;
                }

                if (subtitle) {
                    const subtitleEl = section.querySelector('p');
                    if (subtitleEl) subtitleEl.textContent = subtitle;
                }

                if (buttonText) {
                    const buttonEl = section.querySelector('button');
                    if (buttonEl) buttonEl.textContent = buttonText;
                }

                // Update form field visibility
                const fieldCheckboxes = [
                    'contact-field-name',
                    'contact-field-email',
                    'contact-field-phone',
                    'contact-field-company',
                    'contact-field-subject',
                    'contact-field-message'
                ];

                fieldCheckboxes.forEach(checkboxId => {
                    const checkbox = document.getElementById(checkboxId);
                    if (checkbox) {
                        const fieldName = checkboxId.replace('contact-field-', '');
                        const fieldElement = section.querySelector(`input[name="${fieldName}"], textarea[name="${fieldName}"]`);
                        if (fieldElement) {
                            fieldElement.style.display = checkbox.checked ? 'block' : 'none';
                        }
                    }
                });

                // Update layout settings (these would be applied to the actual contact form component)
                console.log('Contact form settings:', { layout, showPrivacy, showCaptcha });
            }

            applyAboutUsSectionStyle(section, property, value) {
                section.style[property] = value;
            }

            applyContactFormSectionStyle(section, property, value) {
                const sectionContainer = section.querySelector('div[style*="padding: 60px"]');
                if (sectionContainer) {
                    sectionContainer.style[property] = value;
                }
            }

            applyContactFormFormStyle(section, property, value) {
                const formContainer = section.querySelector('form');
                if (formContainer) {
                    formContainer.style[property] = value;
                }
            }

            applyContactFormInputStyle(section, property, value) {
                const inputs = section.querySelectorAll('input, textarea');
                if (inputs) {
                    inputs.forEach(input => {
                        if (property === 'focusColor') {
                            input.style.setProperty('--focus-color', value);
                        } else if (property === 'placeholderColor') {
                            input.style.setProperty('--placeholder-color', value);
                        } else {
                            input.style[property] = value;
                        }
                    });
                }
            }

            applyContactFormButtonStyle(section, property, value) {
                const button = section.querySelector('button');
                if (button) {
                    button.style[property] = value;
                }
            }

            applyContactFormButtonHoverStyle(section, hoverColor) {
                const button = section.querySelector('button');
                if (button) {
                    button.style.setProperty('--hover-color', hoverColor);
                }
            }

            applyAboutUsTypographyStyle(section, elementType, property, value) {
                let element;
                switch (elementType) {
                    case 'title':
                        element = section.querySelector('h2');
                        break;
                    case 'subtitle':
                        element = section.querySelector('p');
                        break;
                    case 'description':
                        element = section.querySelector('.about-description');
                        break;
                }
                if (element) {
                    element.style[property] = value;
                }
            }

            applyContactFormTypographyStyle(section, elementType, property, value) {
                let elements;
                if (elementType === 'title') {
                    elements = section.querySelectorAll('h2');
                } else if (elementType === 'subtitle') {
                    elements = section.querySelectorAll('p');
                } else if (elementType === 'label') {
                    elements = section.querySelectorAll('label');
                }

                if (elements) {
                    elements.forEach(element => {
                        element.style[property] = value;
                    });
                }
            }

            setupNewsletterEditorListeners(section) {
                console.log('Setting up newsletter editor listeners...');

                // Live content updates
                const liveUpdateInputs = [
                    'newsletter-title',
                    'newsletter-subtitle',
                    'newsletter-placeholder',
                    'newsletter-button-text'
                ];

                liveUpdateInputs.forEach(inputId => {
                    const input = document.getElementById(inputId);
                    if (input) {
                        input.addEventListener('input', () => {
                            this.applyNewsletterChanges(section);
                        });
                    }
                });

                // Live styling updates
                this.setupNewsletterLiveStyling(section);

                // Layout style handler
                const layoutSelect = document.getElementById('newsletter-layout');
                if (layoutSelect) {
                    layoutSelect.addEventListener('change', () => {
                        this.applyNewsletterChanges(section);
                    });
                }

                // Checkbox handlers
                const checkboxes = [
                    'newsletter-show-privacy',
                    'newsletter-show-social'
                ];

                checkboxes.forEach(checkboxId => {
                    const checkbox = document.getElementById(checkboxId);
                    if (checkbox) {
                        checkbox.addEventListener('change', () => {
                            this.applyNewsletterChanges(section);
                        });
                    }
                });

                // Background image upload handler
                const bgImageUpload = document.getElementById('newsletter-bg-image');
                if (bgImageUpload) {
                    bgImageUpload.addEventListener('change', (e) => {
                        const file = e.target.files[0];
                        if (file) {
                            const reader = new FileReader();
                            reader.onload = function (e) {
                                const preview = document.getElementById('newsletter-bg-preview');
                                if (preview) {
                                    preview.innerHTML = `<img src="${e.target.result}" style="max-width: 200px; max-height: 150px; border-radius: 4px;">`;
                                }
                                // Apply background image to section
                                const sectionContainer = section.querySelector('div[style*="padding: 60px"]');
                                if (sectionContainer) {
                                    sectionContainer.style.backgroundImage = `url(${e.target.result})`;
                                    sectionContainer.style.backgroundSize = 'cover';
                                    sectionContainer.style.backgroundPosition = 'center';
                                }
                            };
                            reader.readAsDataURL(file);
                        }
                    });
                }
            }

            setupNewsletterLiveStyling(section) {
                // Section padding live update
                const sectionPaddingSlider = document.getElementById('newsletter-section-padding');
                const sectionPaddingValue = document.getElementById('newsletter-section-padding-value');
                if (sectionPaddingSlider && sectionPaddingValue) {
                    sectionPaddingSlider.addEventListener('input', (e) => {
                        sectionPaddingValue.textContent = e.target.value + 'px';
                        this.applyNewsletterSectionStyle(section, 'padding', e.target.value + 'px');
                    });
                }

                // Section margin live update
                const sectionMarginSlider = document.getElementById('newsletter-section-margin');
                const sectionMarginValue = document.getElementById('newsletter-section-margin-value');
                if (sectionMarginSlider && sectionMarginValue) {
                    sectionMarginSlider.addEventListener('input', (e) => {
                        sectionMarginValue.textContent = e.target.value + 'px';
                        this.applyNewsletterSectionStyle(section, 'margin', e.target.value + 'px');
                    });
                }

                // Background color live update
                const bgColorPicker = document.getElementById('newsletter-bg-color');
                const bgColorText = document.getElementById('newsletter-bg-color-text');
                if (bgColorPicker && bgColorText) {
                    bgColorPicker.addEventListener('input', (e) => {
                        bgColorText.value = e.target.value;
                        this.applyNewsletterSectionStyle(section, 'backgroundColor', e.target.value);
                    });
                    bgColorText.addEventListener('input', (e) => {
                        bgColorPicker.value = e.target.value;
                        this.applyNewsletterSectionStyle(section, 'backgroundColor', e.target.value);
                    });
                }

                // Form styling live updates
                this.setupNewsletterFormStyling(section);

                // Border and shadow live updates
                this.setupNewsletterBorderShadow(section);

                // Typography live updates
                this.setupNewsletterTypographyListeners(section);
            }

            setupNewsletterFormStyling(section) {
                // Form background color live update
                const formBgColorPicker = document.getElementById('newsletter-form-bg');
                const formBgColorText = document.getElementById('newsletter-form-bg-text');
                if (formBgColorPicker && formBgColorText) {
                    formBgColorPicker.addEventListener('input', (e) => {
                        formBgColorText.value = e.target.value;
                        this.applyNewsletterFormStyle(section, 'backgroundColor', e.target.value);
                    });
                    formBgColorText.addEventListener('input', (e) => {
                        formBgColorPicker.value = e.target.value;
                        this.applyNewsletterFormStyle(section, 'backgroundColor', e.target.value);
                    });
                }

                // Input border color live update
                const inputBorderColorPicker = document.getElementById('newsletter-input-border');
                const inputBorderColorText = document.getElementById('newsletter-input-border-text');
                if (inputBorderColorPicker && inputBorderColorText) {
                    inputBorderColorPicker.addEventListener('input', (e) => {
                        inputBorderColorText.value = e.target.value;
                        this.applyNewsletterInputStyle(section, 'borderColor', e.target.value);
                    });
                    inputBorderColorText.addEventListener('input', (e) => {
                        inputBorderColorPicker.value = e.target.value;
                        this.applyNewsletterInputStyle(section, 'borderColor', e.target.value);
                    });
                }

                // Input border radius live update
                const inputRadiusSlider = document.getElementById('newsletter-input-radius');
                const inputRadiusValue = document.getElementById('newsletter-input-radius-value');
                if (inputRadiusSlider && inputRadiusValue) {
                    inputRadiusSlider.addEventListener('input', (e) => {
                        inputRadiusValue.textContent = e.target.value + 'px';
                        this.applyNewsletterInputStyle(section, 'borderRadius', e.target.value + 'px');
                    });
                }

                // Button styling live updates
                this.setupNewsletterButtonStyling(section);
            }

            setupNewsletterButtonStyling(section) {
                // Button background color live update
                const buttonBgColorPicker = document.getElementById('newsletter-button-bg');
                const buttonBgColorText = document.getElementById('newsletter-button-bg-text');
                if (buttonBgColorPicker && buttonBgColorText) {
                    buttonBgColorPicker.addEventListener('input', (e) => {
                        buttonBgColorText.value = e.target.value;
                        this.applyNewsletterButtonStyle(section, 'backgroundColor', e.target.value);
                    });
                    buttonBgColorText.addEventListener('input', (e) => {
                        buttonBgColorPicker.value = e.target.value;
                        this.applyNewsletterButtonStyle(section, 'backgroundColor', e.target.value);
                    });
                }

                // Button text color live update
                const buttonTextColorPicker = document.getElementById('newsletter-button-text-color');
                const buttonTextColorText = document.getElementById('newsletter-button-text-color-text');
                if (buttonTextColorPicker && buttonTextColorText) {
                    buttonTextColorPicker.addEventListener('input', (e) => {
                        buttonTextColorText.value = e.target.value;
                        this.applyNewsletterButtonStyle(section, 'color', e.target.value);
                    });
                    buttonTextColorText.addEventListener('input', (e) => {
                        buttonTextColorPicker.value = e.target.value;
                        this.applyNewsletterButtonStyle(section, 'color', e.target.value);
                    });
                }

                // Button border radius live update
                const buttonRadiusSlider = document.getElementById('newsletter-button-radius');
                const buttonRadiusValue = document.getElementById('newsletter-button-radius-value');
                if (buttonRadiusSlider && buttonRadiusValue) {
                    buttonRadiusSlider.addEventListener('input', (e) => {
                        buttonRadiusValue.textContent = e.target.value + 'px';
                        this.applyNewsletterButtonStyle(section, 'borderRadius', e.target.value + 'px');
                    });
                }

                // Button hover color live update
                const buttonHoverColorPicker = document.getElementById('newsletter-button-hover');
                const buttonHoverColorText = document.getElementById('newsletter-button-hover-text');
                if (buttonHoverColorPicker && buttonHoverColorText) {
                    buttonHoverColorPicker.addEventListener('input', (e) => {
                        buttonHoverColorText.value = e.target.value;
                        // Store hover color for CSS hover effect
                        this.applyNewsletterButtonHoverStyle(section, e.target.value);
                    });
                    buttonHoverColorText.addEventListener('input', (e) => {
                        buttonHoverColorPicker.value = e.target.value;
                        this.applyNewsletterButtonHoverStyle(section, e.target.value);
                    });
                }
            }

            setupNewsletterBorderShadow(section) {
                // Border width live update
                const borderWidthSlider = document.getElementById('newsletter-border-width');
                const borderWidthValue = document.getElementById('newsletter-border-width-value');
                if (borderWidthSlider && borderWidthValue) {
                    borderWidthSlider.addEventListener('input', (e) => {
                        borderWidthValue.textContent = e.target.value + 'px';
                        this.applyNewsletterSectionStyle(section, 'borderWidth', e.target.value + 'px');
                    });
                }

                // Border color live update
                const borderColorPicker = document.getElementById('newsletter-border-color');
                const borderColorText = document.getElementById('newsletter-border-color-text');
                if (borderColorPicker && borderColorText) {
                    borderColorPicker.addEventListener('input', (e) => {
                        borderColorText.value = e.target.value;
                        this.applyNewsletterSectionStyle(section, 'borderColor', e.target.value);
                    });
                    borderColorText.addEventListener('input', (e) => {
                        borderColorPicker.value = e.target.value;
                        this.applyNewsletterSectionStyle(section, 'borderColor', e.target.value);
                    });
                }

                // Border radius live update
                const borderRadiusSlider = document.getElementById('newsletter-border-radius');
                const borderRadiusValue = document.getElementById('newsletter-border-radius-value');
                if (borderRadiusSlider && borderRadiusValue) {
                    borderRadiusSlider.addEventListener('input', (e) => {
                        borderRadiusValue.textContent = e.target.value + 'px';
                        this.applyNewsletterSectionStyle(section, 'borderRadius', e.target.value + 'px');
                    });
                }

                // Box shadow live update
                const shadowSlider = document.getElementById('newsletter-shadow');
                const shadowValue = document.getElementById('newsletter-shadow-value');
                const shadowColorPicker = document.getElementById('newsletter-shadow-color');
                const shadowColorText = document.getElementById('newsletter-shadow-color-text');

                if (shadowSlider && shadowValue) {
                    shadowSlider.addEventListener('input', (e) => {
                        shadowValue.textContent = e.target.value + 'px';
                        const shadowColor = shadowColorPicker ? shadowColorPicker.value : '#000000';
                        this.applyNewsletterSectionStyle(section, 'boxShadow', `0 4px ${e.target.value}px ${shadowColor}`);
                    });
                }

                if (shadowColorPicker && shadowColorText) {
                    shadowColorPicker.addEventListener('input', (e) => {
                        shadowColorText.value = e.target.value;
                        const shadowSize = shadowSlider ? shadowSlider.value : '0';
                        this.applyNewsletterSectionStyle(section, 'boxShadow', `0 4px ${shadowSize}px ${e.target.value}`);
                    });
                    shadowColorText.addEventListener('input', (e) => {
                        shadowColorPicker.value = e.target.value;
                        const shadowSize = shadowSlider ? shadowSlider.value : '0';
                        this.applyNewsletterSectionStyle(section, 'boxShadow', `0 4px ${shadowSize}px ${e.target.value}`);
                    });
                }
            }

            setupNewsletterTypographyListeners(section) {
                // Title color live update
                const titleColorPicker = document.getElementById('newsletter-title-color');
                const titleColorText = document.getElementById('newsletter-title-color-text');
                if (titleColorPicker && titleColorText) {
                    titleColorPicker.addEventListener('input', (e) => {
                        titleColorText.value = e.target.value;
                        this.applyNewsletterTypographyStyle(section, 'title', 'color', e.target.value);
                    });
                    titleColorText.addEventListener('input', (e) => {
                        titleColorPicker.value = e.target.value;
                        this.applyNewsletterTypographyStyle(section, 'title', 'color', e.target.value);
                    });
                }

                // Title size live update
                const titleSizeSlider = document.getElementById('newsletter-title-size');
                const titleSizeValue = document.getElementById('newsletter-title-size-value');
                if (titleSizeSlider && titleSizeValue) {
                    titleSizeSlider.addEventListener('input', (e) => {
                        titleSizeValue.textContent = e.target.value + 'px';
                        this.applyNewsletterTypographyStyle(section, 'title', 'fontSize', e.target.value + 'px');
                    });
                }

                // Subtitle color live update
                const subtitleColorPicker = document.getElementById('newsletter-subtitle-color');
                const subtitleColorText = document.getElementById('newsletter-subtitle-color-text');
                if (subtitleColorPicker && subtitleColorText) {
                    subtitleColorPicker.addEventListener('input', (e) => {
                        subtitleColorText.value = e.target.value;
                        this.applyNewsletterTypographyStyle(section, 'subtitle', 'color', e.target.value);
                    });
                    subtitleColorText.addEventListener('input', (e) => {
                        subtitleColorPicker.value = e.target.value;
                        this.applyNewsletterTypographyStyle(section, 'subtitle', 'color', e.target.value);
                    });
                }

                // Subtitle size live update
                const subtitleSizeSlider = document.getElementById('newsletter-subtitle-size');
                const subtitleSizeValue = document.getElementById('newsletter-subtitle-size-value');
                if (subtitleSizeSlider && subtitleSizeValue) {
                    subtitleSizeSlider.addEventListener('input', (e) => {
                        subtitleSizeValue.textContent = e.target.value + 'px';
                        this.applyNewsletterTypographyStyle(section, 'subtitle', 'fontSize', e.target.value + 'px');
                    });
                }

                // Input text color live update
                const inputTextColorPicker = document.getElementById('newsletter-input-text-color');
                const inputTextColorText = document.getElementById('newsletter-input-text-color-text');
                if (inputTextColorPicker && inputTextColorText) {
                    inputTextColorPicker.addEventListener('input', (e) => {
                        inputTextColorText.value = e.target.value;
                        this.applyNewsletterInputStyle(section, 'color', e.target.value);
                    });
                    inputTextColorText.addEventListener('input', (e) => {
                        inputTextColorPicker.value = e.target.value;
                        this.applyNewsletterInputStyle(section, 'color', e.target.value);
                    });
                }

                // Input placeholder color live update
                const placeholderColorPicker = document.getElementById('newsletter-placeholder-color');
                const placeholderColorText = document.getElementById('newsletter-placeholder-color-text');
                if (placeholderColorPicker && placeholderColorText) {
                    placeholderColorPicker.addEventListener('input', (e) => {
                        placeholderColorText.value = e.target.value;
                        this.applyNewsletterInputStyle(section, 'placeholderColor', e.target.value);
                    });
                    placeholderColorText.addEventListener('input', (e) => {
                        placeholderColorPicker.value = e.target.value;
                        this.applyNewsletterInputStyle(section, 'placeholderColor', e.target.value);
                    });
                }
            }

            applyNewsletterChanges(section) {
                // Update content
                const title = document.getElementById('newsletter-title')?.value;
                const subtitle = document.getElementById('newsletter-subtitle')?.value;
                const placeholder = document.getElementById('newsletter-placeholder')?.value;
                const buttonText = document.getElementById('newsletter-button-text')?.value;
                const layout = document.getElementById('newsletter-layout')?.value;
                const showPrivacy = document.getElementById('newsletter-show-privacy')?.checked;
                const showSocial = document.getElementById('newsletter-show-social')?.checked;

                if (title) {
                    const titleEl = section.querySelector('h2');
                    if (titleEl) titleEl.textContent = title;
                }

                if (subtitle) {
                    const subtitleEl = section.querySelector('p');
                    if (subtitleEl) subtitleEl.textContent = subtitle;
                }

                if (placeholder) {
                    const inputEl = section.querySelector('input[type="email"]');
                    if (inputEl) inputEl.placeholder = placeholder;
                }

                if (buttonText) {
                    const buttonEl = section.querySelector('button');
                    if (buttonEl) buttonEl.textContent = buttonText;
                }

                // Update layout settings (these would be applied to the actual newsletter component)
                console.log('Newsletter settings:', { layout, showPrivacy, showSocial });
            }

            applyNewsletterSectionStyle(section, property, value) {
                const sectionContainer = section.querySelector('div[style*="padding: 60px"]');
                if (sectionContainer) {
                    sectionContainer.style[property] = value;
                }
            }

            applyNewsletterFormStyle(section, property, value) {
                const formContainer = section.querySelector('form') || section.querySelector('div[style*="display: flex"]');
                if (formContainer) {
                    formContainer.style[property] = value;
                }
            }

            applyNewsletterInputStyle(section, property, value) {
                const input = section.querySelector('input[type="email"]');
                if (input) {
                    if (property === 'placeholderColor') {
                        input.style.setProperty('--placeholder-color', value);
                        input.style.color = value;
                    } else {
                        input.style[property] = value;
                    }
                }
            }

            applyNewsletterButtonStyle(section, property, value) {
                const button = section.querySelector('button');
                if (button) {
                    button.style[property] = value;
                }
            }

            applyNewsletterButtonHoverStyle(section, hoverColor) {
                const button = section.querySelector('button');
                if (button) {
                    button.style.setProperty('--hover-color', hoverColor);
                }
            }

            applyNewsletterTypographyStyle(section, elementType, property, value) {
                let element;
                if (elementType === 'title') {
                    element = section.querySelector('h2');
                } else if (elementType === 'subtitle') {
                    element = section.querySelector('p');
                }

                if (element) {
                    element.style[property] = value;
                }
            }

            setupTestimonialsEditorListeners(section) {
                console.log('Setting up testimonials editor listeners...');

                // Live content updates
                const liveUpdateInputs = [
                    'testimonials-title',
                    'testimonials-subtitle'
                ];

                liveUpdateInputs.forEach(inputId => {
                    const input = document.getElementById(inputId);
                    if (input) {
                        input.addEventListener('input', () => {
                            this.applyTestimonialsChanges(section);
                        });
                    }
                });

                // Live styling updates
                this.setupTestimonialsLiveStyling(section);

                // Layout style handler
                const layoutSelect = document.getElementById('testimonials-layout');
                if (layoutSelect) {
                    layoutSelect.addEventListener('change', () => {
                        this.applyTestimonialsChanges(section);
                    });
                }

                // Testimonials per row handler
                const perRowSlider = document.getElementById('testimonials-per-row');
                const perRowValue = document.getElementById('testimonials-per-row-value');
                if (perRowSlider && perRowValue) {
                    perRowSlider.addEventListener('input', (e) => {
                        perRowValue.textContent = e.target.value;
                        this.applyTestimonialsChanges(section);
                    });
                }

                // Checkbox handlers
                const checkboxes = [
                    'testimonials-show-ratings',
                    'testimonials-show-avatars'
                ];

                checkboxes.forEach(checkboxId => {
                    const checkbox = document.getElementById(checkboxId);
                    if (checkbox) {
                        checkbox.addEventListener('change', () => {
                            this.applyTestimonialsChanges(section);
                        });
                    }
                });

                // Add testimonial button
                const addTestimonialBtn = document.getElementById('add-testimonial-btn');
                if (addTestimonialBtn) {
                    addTestimonialBtn.addEventListener('click', () => {
                        this.addNewTestimonial(section);
                    });
                }

                // Background image upload handler
                const bgImageUpload = document.getElementById('testimonials-bg-image');
                if (bgImageUpload) {
                    bgImageUpload.addEventListener('change', (e) => {
                        const file = e.target.files[0];
                        if (file) {
                            const reader = new FileReader();
                            reader.onload = function (e) {
                                const preview = document.getElementById('testimonials-bg-preview');
                                if (preview) {
                                    preview.innerHTML = `<img src="${e.target.result}" style="max-width: 200px; max-height: 150px; border-radius: 4px;">`;
                                }
                                // Apply background image to section
                                const sectionContainer = section.querySelector('div[style*="padding: 60px"]');
                                if (sectionContainer) {
                                    sectionContainer.style.backgroundImage = `url(${e.target.result})`;
                                    sectionContainer.style.backgroundSize = 'cover';
                                    sectionContainer.style.backgroundPosition = 'center';
                                }
                            };
                            reader.readAsDataURL(file);
                        }
                    });
                }
            }

            setupTestimonialsLiveStyling(section) {
                // Section padding live update
                const sectionPaddingSlider = document.getElementById('testimonials-section-padding');
                const sectionPaddingValue = document.getElementById('testimonials-section-padding-value');
                if (sectionPaddingSlider && sectionPaddingValue) {
                    sectionPaddingSlider.addEventListener('input', (e) => {
                        sectionPaddingValue.textContent = e.target.value + 'px';
                        this.applyTestimonialsSectionStyle(section, 'padding', e.target.value + 'px');
                    });
                }

                // Section margin live update
                const sectionMarginSlider = document.getElementById('testimonials-section-margin');
                const sectionMarginValue = document.getElementById('testimonials-section-margin-value');
                if (sectionMarginSlider && sectionMarginValue) {
                    sectionMarginSlider.addEventListener('input', (e) => {
                        sectionMarginValue.textContent = e.target.value + 'px';
                        this.applyTestimonialsSectionStyle(section, 'margin', e.target.value + 'px');
                    });
                }

                // Background color live update
                const bgColorPicker = document.getElementById('testimonials-bg-color');
                const bgColorText = document.getElementById('testimonials-bg-color-text');
                if (bgColorPicker && bgColorText) {
                    bgColorPicker.addEventListener('input', (e) => {
                        bgColorText.value = e.target.value;
                        this.applyTestimonialsSectionStyle(section, 'backgroundColor', e.target.value);
                    });
                    bgColorText.addEventListener('input', (e) => {
                        bgColorPicker.value = e.target.value;
                        this.applyTestimonialsSectionStyle(section, 'backgroundColor', e.target.value);
                    });
                }

                // Border width live update
                const borderWidthSlider = document.getElementById('testimonials-border-width');
                const borderWidthValue = document.getElementById('testimonials-border-width-value');
                if (borderWidthSlider && borderWidthValue) {
                    borderWidthSlider.addEventListener('input', (e) => {
                        borderWidthValue.textContent = e.target.value + 'px';
                        this.applyTestimonialsSectionStyle(section, 'borderWidth', e.target.value + 'px');
                    });
                }

                // Border color live update
                const borderColorPicker = document.getElementById('testimonials-border-color');
                const borderColorText = document.getElementById('testimonials-border-color-text');
                if (borderColorPicker && borderColorText) {
                    borderColorPicker.addEventListener('input', (e) => {
                        borderColorText.value = e.target.value;
                        this.applyTestimonialsSectionStyle(section, 'borderColor', e.target.value);
                    });
                    borderColorText.addEventListener('input', (e) => {
                        borderColorPicker.value = e.target.value;
                        this.applyTestimonialsSectionStyle(section, 'borderColor', e.target.value);
                    });
                }

                // Border radius live update
                const borderRadiusSlider = document.getElementById('testimonials-border-radius');
                const borderRadiusValue = document.getElementById('testimonials-border-radius-value');
                if (borderRadiusSlider && borderRadiusValue) {
                    borderRadiusSlider.addEventListener('input', (e) => {
                        borderRadiusValue.textContent = e.target.value + 'px';
                        this.applyTestimonialsSectionStyle(section, 'borderRadius', e.target.value + 'px');
                    });
                }

                // Box shadow live update
                const shadowSlider = document.getElementById('testimonials-shadow');
                const shadowValue = document.getElementById('testimonials-shadow-value');
                const shadowColorPicker = document.getElementById('testimonials-shadow-color');
                const shadowColorText = document.getElementById('testimonials-shadow-color-text');

                if (shadowSlider && shadowValue) {
                    shadowSlider.addEventListener('input', (e) => {
                        shadowValue.textContent = e.target.value + 'px';
                        const shadowColor = shadowColorPicker ? shadowColorPicker.value : '#000000';
                        this.applyTestimonialsSectionStyle(section, 'boxShadow', `0 4px ${e.target.value}px ${shadowColor}`);
                    });
                }

                if (shadowColorPicker && shadowColorText) {
                    shadowColorPicker.addEventListener('input', (e) => {
                        shadowColorText.value = e.target.value;
                        const shadowSize = shadowSlider ? shadowSlider.value : '0';
                        this.applyTestimonialsSectionStyle(section, 'boxShadow', `0 4px ${shadowSize}px ${e.target.value}`);
                    });
                    shadowColorText.addEventListener('input', (e) => {
                        shadowColorPicker.value = e.target.value;
                        const shadowSize = shadowSlider ? shadowSlider.value : '0';
                        this.applyTestimonialsSectionStyle(section, 'boxShadow', `0 4px ${shadowSize}px ${e.target.value}`);
                    });
                }

                // Typography live updates
                this.setupTestimonialsTypographyListeners(section);
            }

            setupTestimonialsTypographyListeners(section) {
                // Title color live update
                const titleColorPicker = document.getElementById('testimonials-title-color');
                const titleColorText = document.getElementById('testimonials-title-color-text');
                if (titleColorPicker && titleColorText) {
                    titleColorPicker.addEventListener('input', (e) => {
                        titleColorText.value = e.target.value;
                        this.applyTestimonialsTypographyStyle(section, 'title', 'color', e.target.value);
                    });
                    titleColorText.addEventListener('input', (e) => {
                        titleColorPicker.value = e.target.value;
                        this.applyTestimonialsTypographyStyle(section, 'title', 'color', e.target.value);
                    });
                }

                // Title size live update
                const titleSizeSlider = document.getElementById('testimonials-title-size');
                const titleSizeValue = document.getElementById('testimonials-title-size-value');
                if (titleSizeSlider && titleSizeValue) {
                    titleSizeSlider.addEventListener('input', (e) => {
                        titleSizeValue.textContent = e.target.value + 'px';
                        this.applyTestimonialsTypographyStyle(section, 'title', 'fontSize', e.target.value + 'px');
                    });
                }

                // Subtitle color live update
                const subtitleColorPicker = document.getElementById('testimonials-subtitle-color');
                const subtitleColorText = document.getElementById('testimonials-subtitle-color-text');
                if (subtitleColorPicker && subtitleColorText) {
                    subtitleColorPicker.addEventListener('input', (e) => {
                        subtitleColorText.value = e.target.value;
                        this.applyTestimonialsTypographyStyle(section, 'subtitle', 'color', e.target.value);
                    });
                    subtitleColorText.addEventListener('input', (e) => {
                        subtitleColorPicker.value = e.target.value;
                        this.applyTestimonialsTypographyStyle(section, 'subtitle', 'color', e.target.value);
                    });
                }

                // Subtitle size live update
                const subtitleSizeSlider = document.getElementById('testimonials-subtitle-size');
                const subtitleSizeValue = document.getElementById('testimonials-subtitle-size-value');
                if (subtitleSizeSlider && subtitleSizeValue) {
                    subtitleSizeSlider.addEventListener('input', (e) => {
                        subtitleSizeValue.textContent = e.target.value + 'px';
                        this.applyTestimonialsTypographyStyle(section, 'subtitle', 'fontSize', e.target.value + 'px');
                    });
                }

                // Testimonial text color live update
                const textColorPicker = document.getElementById('testimonials-text-color');
                const textColorText = document.getElementById('testimonials-text-color-text');
                if (textColorPicker && textColorText) {
                    textColorPicker.addEventListener('input', (e) => {
                        textColorText.value = e.target.value;
                        this.applyTestimonialsTypographyStyle(section, 'testimonial-text', 'color', e.target.value);
                    });
                    textColorText.addEventListener('input', (e) => {
                        textColorPicker.value = e.target.value;
                        this.applyTestimonialsTypographyStyle(section, 'testimonial-text', 'color', e.target.value);
                    });
                }

                // Customer name color live update
                const nameColorPicker = document.getElementById('testimonials-name-color');
                const nameColorText = document.getElementById('testimonials-name-color-text');
                if (nameColorPicker && nameColorText) {
                    nameColorPicker.addEventListener('input', (e) => {
                        nameColorText.value = e.target.value;
                        this.applyTestimonialsTypographyStyle(section, 'customer-name', 'color', e.target.value);
                    });
                    nameColorText.addEventListener('input', (e) => {
                        nameColorPicker.value = e.target.value;
                        this.applyTestimonialsTypographyStyle(section, 'customer-name', 'color', e.target.value);
                    });
                }

                // Star rating color live update
                const ratingColorPicker = document.getElementById('testimonials-rating-color');
                const ratingColorText = document.getElementById('testimonials-rating-color-text');
                if (ratingColorPicker && ratingColorText) {
                    ratingColorPicker.addEventListener('input', (e) => {
                        ratingColorText.value = e.target.value;
                        this.applyTestimonialsTypographyStyle(section, 'star-rating', 'color', e.target.value);
                    });
                    ratingColorText.addEventListener('input', (e) => {
                        ratingColorPicker.value = e.target.value;
                        this.applyTestimonialsTypographyStyle(section, 'star-rating', 'color', e.target.value);
                    });
                }
            }

            applyTestimonialsChanges(section) {
                // Update content
                const title = document.getElementById('testimonials-title')?.value;
                const subtitle = document.getElementById('testimonials-subtitle')?.value;
                const layout = document.getElementById('testimonials-layout')?.value;
                const perRow = document.getElementById('testimonials-per-row')?.value;
                const showRatings = document.getElementById('testimonials-show-ratings')?.checked;
                const showAvatars = document.getElementById('testimonials-show-avatars')?.checked;

                if (title) {
                    const titleEl = section.querySelector('h2');
                    if (titleEl) titleEl.textContent = title;
                }

                if (subtitle) {
                    const subtitleEl = section.querySelector('p');
                    if (subtitleEl) subtitleEl.textContent = subtitle;
                }

                // Update layout settings (these would be applied to the actual testimonials component)
                console.log('Testimonials settings:', { layout, perRow, showRatings, showAvatars });
            }

            applyTestimonialsSectionStyle(section, property, value) {
                const sectionContainer = section.querySelector('div[style*="padding: 60px"]');
                if (sectionContainer) {
                    sectionContainer.style[property] = value;
                }
            }

            applyTestimonialsTypographyStyle(section, elementType, property, value) {
                let elements;
                if (elementType === 'title') {
                    elements = section.querySelectorAll('h2');
                } else if (elementType === 'subtitle') {
                    elements = section.querySelectorAll('p');
                } else if (elementType === 'testimonial-text') {
                    elements = section.querySelectorAll('.testimonial-text');
                } else if (elementType === 'customer-name') {
                    elements = section.querySelectorAll('.customer-name');
                } else if (elementType === 'star-rating') {
                    elements = section.querySelectorAll('.star-rating');
                }

                if (elements) {
                    elements.forEach(element => {
                        element.style[property] = value;
                    });
                }
            }

            addNewTestimonial(section) {
                // This would open a modal to add a new testimonial
                console.log('Adding new testimonial');
                // For now, just show a message
                this.showSuccessMessage('Testimonial management feature coming soon!');
            }

            setupProductSliderEditorListeners(section) {
                console.log('Setting up product-slider editor listeners...');

                // Live content updates
                const liveUpdateInputs = [
                    'product-slider-title',
                    'product-slider-subtitle'
                ];

                liveUpdateInputs.forEach(inputId => {
                    const input = document.getElementById(inputId);
                    if (input) {
                        input.addEventListener('input', () => {
                            this.applyProductSliderChanges(section);
                        });
                    }
                });

                // Live styling updates
                this.setupProductSliderLiveStyling(section);

                // Products per view handler
                const perViewSlider = document.getElementById('product-slider-per-view');
                const perViewValue = document.getElementById('product-slider-per-view-value');
                if (perViewSlider && perViewValue) {
                    perViewSlider.addEventListener('input', (e) => {
                        perViewValue.textContent = e.target.value;
                        this.applyProductSliderChanges(section);
                    });
                }

                // Checkbox handlers
                const checkboxes = [
                    'product-slider-autoplay',
                    'product-slider-arrows',
                    'product-slider-dots'
                ];

                checkboxes.forEach(checkboxId => {
                    const checkbox = document.getElementById(checkboxId);
                    if (checkbox) {
                        checkbox.addEventListener('change', () => {
                            this.applyProductSliderChanges(section);
                        });
                    }
                });

                // Add product button
                const addProductBtn = document.getElementById('add-product-btn');
                if (addProductBtn) {
                    addProductBtn.addEventListener('click', () => {
                        this.addNewProduct(section);
                    });
                }

                // Background image upload handler
                const bgImageUpload = document.getElementById('product-slider-bg-image');
                if (bgImageUpload) {
                    bgImageUpload.addEventListener('change', (e) => {
                        const file = e.target.files[0];
                        if (file) {
                            const reader = new FileReader();
                            reader.onload = function (e) {
                                const preview = document.getElementById('product-slider-bg-preview');
                                if (preview) {
                                    preview.innerHTML = `<img src="${e.target.result}" style="max-width: 200px; max-height: 150px; border-radius: 4px;">`;
                                }
                                // Show delete button
                                const deleteBtn = document.getElementById('product-slider-bg-delete');
                                if (deleteBtn) {
                                    deleteBtn.style.display = 'block';
                                }
                                // Apply background image to section
                                const sectionContainer = section.querySelector('div[style*="padding: 60px"]');
                                if (sectionContainer) {
                                    sectionContainer.style.backgroundImage = `url(${e.target.result})`;
                                    sectionContainer.style.backgroundSize = 'cover';
                                    sectionContainer.style.backgroundPosition = 'center';
                                }
                            };
                            reader.readAsDataURL(file);
                        }
                    });
                }

                // Background image dimensions
                const bgImageWidth = document.getElementById('product-slider-bg-width');
                if (bgImageWidth) {
                    bgImageWidth.addEventListener('input', (e) => {
                        const value = e.target.value;
                        document.getElementById('product-slider-bg-width-value').textContent = value + 'px';
                        const sectionContainer = section.querySelector('div[style*="padding: 60px"]');
                        if (sectionContainer) {
                            sectionContainer.style.backgroundSize = `${value}px auto`;
                        }
                    });
                }

                const bgImageHeight = document.getElementById('product-slider-bg-height');
                if (bgImageHeight) {
                    bgImageHeight.addEventListener('input', (e) => {
                        const value = e.target.value;
                        document.getElementById('product-slider-bg-height-value').textContent = value + 'px';
                        const sectionContainer = section.querySelector('div[style*="padding: 60px"]');
                        if (sectionContainer) {
                            const width = bgImageWidth?.value || '1920';
                            sectionContainer.style.backgroundSize = `${width}px ${value}px`;
                        }
                    });
                }

                // Delete background image button
                const deleteBgBtn = document.getElementById('product-slider-bg-delete');
                if (deleteBgBtn) {
                    deleteBgBtn.addEventListener('click', () => {
                        const sectionContainer = section.querySelector('div[style*="padding: 60px"]');
                        if (sectionContainer) {
                            sectionContainer.style.backgroundImage = 'none';
                        }
                        const preview = document.getElementById('product-slider-bg-preview');
                        if (preview) {
                            preview.innerHTML = '';
                        }
                        deleteBgBtn.style.display = 'none';
                        bgImageUpload.value = '';
                    });
                }
            }

            setupProductSliderLiveStyling(section) {
                // Section padding live update
                const sectionPaddingSlider = document.getElementById('product-slider-section-padding');
                const sectionPaddingValue = document.getElementById('product-slider-section-padding-value');
                if (sectionPaddingSlider && sectionPaddingValue) {
                    sectionPaddingSlider.addEventListener('input', (e) => {
                        sectionPaddingValue.textContent = e.target.value + 'px';
                        this.applyProductSliderSectionStyle(section, 'padding', e.target.value + 'px');
                    });
                }

                // Section margin live update
                const sectionMarginSlider = document.getElementById('product-slider-section-margin');
                const sectionMarginValue = document.getElementById('product-slider-section-margin-value');
                if (sectionMarginSlider && sectionMarginValue) {
                    sectionMarginSlider.addEventListener('input', (e) => {
                        sectionMarginValue.textContent = e.target.value + 'px';
                        this.applyProductSliderSectionStyle(section, 'margin', e.target.value + 'px');
                    });
                }

                // Background color live update
                const bgColorPicker = document.getElementById('product-slider-bg-color');
                const bgColorText = document.getElementById('product-slider-bg-color-text');
                if (bgColorPicker && bgColorText) {
                    bgColorPicker.addEventListener('input', (e) => {
                        bgColorText.value = e.target.value;
                        this.applyProductSliderSectionStyle(section, 'backgroundColor', e.target.value);
                    });
                    bgColorText.addEventListener('input', (e) => {
                        bgColorPicker.value = e.target.value;
                        this.applyProductSliderSectionStyle(section, 'backgroundColor', e.target.value);
                    });
                }

                // Border width live update
                const borderWidthSlider = document.getElementById('product-slider-border-width');
                const borderWidthValue = document.getElementById('product-slider-border-width-value');
                if (borderWidthSlider && borderWidthValue) {
                    borderWidthSlider.addEventListener('input', (e) => {
                        borderWidthValue.textContent = e.target.value + 'px';
                        this.applyProductSliderSectionStyle(section, 'borderWidth', e.target.value + 'px');
                    });
                }

                // Border color live update
                const borderColorPicker = document.getElementById('product-slider-border-color');
                const borderColorText = document.getElementById('product-slider-border-color-text');
                if (borderColorPicker && borderColorText) {
                    borderColorPicker.addEventListener('input', (e) => {
                        borderColorText.value = e.target.value;
                        this.applyProductSliderSectionStyle(section, 'borderColor', e.target.value);
                    });
                    borderColorText.addEventListener('input', (e) => {
                        borderColorPicker.value = e.target.value;
                        this.applyProductSliderSectionStyle(section, 'borderColor', e.target.value);
                    });
                }

                // Border radius live update
                const borderRadiusSlider = document.getElementById('product-slider-border-radius');
                const borderRadiusValue = document.getElementById('product-slider-border-radius-value');
                if (borderRadiusSlider && borderRadiusValue) {
                    borderRadiusSlider.addEventListener('input', (e) => {
                        borderRadiusValue.textContent = e.target.value + 'px';
                        this.applyProductSliderSectionStyle(section, 'borderRadius', e.target.value + 'px');
                    });
                }

                // Box shadow live update
                const shadowSlider = document.getElementById('product-slider-shadow');
                const shadowValue = document.getElementById('product-slider-shadow-value');
                const shadowColorPicker = document.getElementById('product-slider-shadow-color');
                const shadowColorText = document.getElementById('product-slider-shadow-color-text');

                if (shadowSlider && shadowValue) {
                    shadowSlider.addEventListener('input', (e) => {
                        shadowValue.textContent = e.target.value + 'px';
                        const shadowColor = shadowColorPicker ? shadowColorPicker.value : '#000000';
                        this.applyProductSliderSectionStyle(section, 'boxShadow', `0 4px ${e.target.value}px ${shadowColor}`);
                    });
                }

                if (shadowColorPicker && shadowColorText) {
                    shadowColorPicker.addEventListener('input', (e) => {
                        shadowColorText.value = e.target.value;
                        const shadowSize = shadowSlider ? shadowSlider.value : '0';
                        this.applyProductSliderSectionStyle(section, 'boxShadow', `0 4px ${shadowSize}px ${e.target.value}`);
                    });
                    shadowColorText.addEventListener('input', (e) => {
                        shadowColorPicker.value = e.target.value;
                        const shadowSize = shadowSlider ? shadowSlider.value : '0';
                        this.applyProductSliderSectionStyle(section, 'boxShadow', `0 4px ${shadowSize}px ${e.target.value}`);
                    });
                }

                // Typography live updates
                this.setupProductSliderTypographyListeners(section);
            }

            setupProductSliderTypographyListeners(section) {
                // Title color live update
                const titleColorPicker = document.getElementById('product-slider-title-color');
                const titleColorText = document.getElementById('product-slider-title-color-text');
                if (titleColorPicker && titleColorText) {
                    titleColorPicker.addEventListener('input', (e) => {
                        titleColorText.value = e.target.value;
                        this.applyProductSliderTypographyStyle(section, 'title', 'color', e.target.value);
                    });
                    titleColorText.addEventListener('input', (e) => {
                        titleColorPicker.value = e.target.value;
                        this.applyProductSliderTypographyStyle(section, 'title', 'color', e.target.value);
                    });
                }

                // Title size live update
                const titleSizeSlider = document.getElementById('product-slider-title-size');
                const titleSizeValue = document.getElementById('product-slider-title-size-value');
                if (titleSizeSlider && titleSizeValue) {
                    titleSizeSlider.addEventListener('input', (e) => {
                        titleSizeValue.textContent = e.target.value + 'px';
                        this.applyProductSliderTypographyStyle(section, 'title', 'fontSize', e.target.value + 'px');
                    });
                }

                // Subtitle color live update
                const subtitleColorPicker = document.getElementById('product-slider-subtitle-color');
                const subtitleColorText = document.getElementById('product-slider-subtitle-color-text');
                if (subtitleColorPicker && subtitleColorText) {
                    subtitleColorPicker.addEventListener('input', (e) => {
                        subtitleColorText.value = e.target.value;
                        this.applyProductSliderTypographyStyle(section, 'subtitle', 'color', e.target.value);
                    });
                    subtitleColorText.addEventListener('input', (e) => {
                        subtitleColorPicker.value = e.target.value;
                        this.applyProductSliderTypographyStyle(section, 'subtitle', 'color', e.target.value);
                    });
                }

                // Subtitle size live update
                const subtitleSizeSlider = document.getElementById('product-slider-subtitle-size');
                const subtitleSizeValue = document.getElementById('product-slider-subtitle-size-value');
                if (subtitleSizeSlider && subtitleSizeValue) {
                    subtitleSizeSlider.addEventListener('input', (e) => {
                        subtitleSizeValue.textContent = e.target.value + 'px';
                        this.applyProductSliderTypographyStyle(section, 'subtitle', 'fontSize', e.target.value + 'px');
                    });
                }
            }

            applyProductSliderChanges(section) {
                // Update content
                const title = document.getElementById('product-slider-title')?.value;
                const subtitle = document.getElementById('product-slider-subtitle')?.value;
                const perView = document.getElementById('product-slider-per-view')?.value;
                const autoplay = document.getElementById('product-slider-autoplay')?.checked;
                const arrows = document.getElementById('product-slider-arrows')?.checked;
                const dots = document.getElementById('product-slider-dots')?.checked;

                if (title) {
                    const titleEl = section.querySelector('h2');
                    if (titleEl) titleEl.textContent = title;
                }

                if (subtitle) {
                    const subtitleEl = section.querySelector('p');
                    if (subtitleEl) subtitleEl.textContent = subtitle;
                }

                // Update slider settings (these would be applied to the actual slider component)
                console.log('Product slider settings:', { perView, autoplay, arrows, dots });
            }

            applyProductSliderSectionStyle(section, property, value) {
                const sectionContainer = section.querySelector('div[style*="padding: 60px"]');
                if (sectionContainer) {
                    sectionContainer.style[property] = value;
                }
            }

            applyProductSliderTypographyStyle(section, elementType, property, value) {
                let element;
                if (elementType === 'title') {
                    element = section.querySelector('h2');
                } else if (elementType === 'subtitle') {
                    element = section.querySelector('p');
                }

                if (element) {
                    element.style[property] = value;
                }
            }

            addNewProduct(section) {
                // This would open a modal to add a new product
                console.log('Adding new product to slider');
                // For now, just show a message
                this.showSuccessMessage('Product management feature coming soon!');
            }

            setupAnnouncementBarEditorListeners(section) {
                console.log(' SETTING UP PREMIUM ANNOUNCEMENT BAR CUSTOMIZER LISTENERS');
                console.log('Section:', section);
                console.log('Section type:', section.dataset.type);
                console.log('Section ID:', section.id);

                // Premium content updates
                const premiumContentInputs = [
                    'announcement-badge',
                    'announcement-main',
                    'announcement-cta',
                    'announcement-link'
                ];

                premiumContentInputs.forEach(inputId => {
                    const input = document.getElementById(inputId);
                    if (input) {
                        input.addEventListener('input', () => {
                            this.applyPremiumAnnouncementBarChanges(section);
                        });
                    }
                });

                // Premium styling updates
                this.setupPremiumAnnouncementBarStyling(section);

                // Animation handler
                const animationSelect = document.getElementById('announcement-animation');
                if (animationSelect) {
                    animationSelect.addEventListener('change', () => {
                        this.applyPremiumAnnouncementBarChanges(section);
                    });
                }

                // Animation duration handler
                const durationSlider = document.getElementById('announcement-duration');
                const durationValue = document.getElementById('announcement-duration-value');
                if (durationSlider && durationValue) {
                    durationSlider.addEventListener('input', (e) => {
                        durationValue.textContent = e.target.value + 's';
                        this.applyPremiumAnnouncementBarChanges(section);
                    });
                }

                // Loop animation handler
                const loopCheckbox = document.getElementById('announcement-loop');
                if (loopCheckbox) {
                    loopCheckbox.addEventListener('change', () => {
                        this.applyPremiumAnnouncementBarChanges(section);
                    });
                }

                // Advanced styling handlers
                console.log('Setting up premium advanced styling handlers...');
                this.setupPremiumAnnouncementBarAdvancedStyling(section);
                console.log('Premium advanced styling handlers setup complete');

                // Delete section handler
                const deleteButton = document.getElementById('delete-announcement-section');
                if (deleteButton) {
                    deleteButton.addEventListener('click', () => {
                        if (confirm('Are you sure you want to delete this announcement bar section? This action cannot be undone.')) {
                            this.deleteSection(section);
                        }
                    });
                }
            }

            applyAnnouncementBarBackgroundPattern(section, pattern) {
                const container = section.querySelector('.announcement-bar-container');
                if (!container) return;

                // Remove existing pattern classes
                container.classList.remove('announcement-bar-gradient', 'announcement-bar-stripes', 'announcement-bar-dots', 'announcement-bar-waves');

                switch (pattern) {
                    case 'gradient':
                        container.classList.add('announcement-bar-gradient');
                        this.updateAnnouncementBarGradient(section);
                        break;
                    case 'stripes':
                        container.classList.add('announcement-bar-stripes');
                        container.style.background = `
                            linear-gradient(45deg, transparent 25%, rgba(255,255,255,0.1) 25%, rgba(255,255,255,0.1) 50%, transparent 50%, transparent 75%, rgba(255,255,255,0.1) 75%),
                            ${container.style.backgroundColor || '#1e293b'}
                        `;
                        container.style.backgroundSize = '20px 20px';
                        break;
                    case 'dots':
                        container.classList.add('announcement-bar-dots');
                        container.style.background = `
                            radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px),
                            ${container.style.backgroundColor || '#1e293b'}
                        `;
                        container.style.backgroundSize = '20px 20px';
                        break;
                    case 'waves':
                        container.classList.add('announcement-bar-waves');
                        container.style.background = `
                            url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E"),
                            ${container.style.backgroundColor || '#1e293b'}
                        `;
                        break;
                    default:
                        container.style.background = container.style.backgroundColor || '#1e293b';
                        container.style.backgroundSize = '';
                }
            }

            updateAnnouncementBarGradient(section) {
                const container = section.querySelector('.announcement-bar-container');
                if (!container || !container.classList.contains('announcement-bar-gradient')) return;

                const gradient1Picker = document.getElementById('announcement-gradient-start');
                const gradient2Picker = document.getElementById('announcement-gradient-end');

                if (gradient1Picker && gradient2Picker) {
                    const color1 = gradient1Picker.value || '#667eea';
                    const color2 = gradient2Picker.value || '#764ba2';
                    container.style.background = `linear-gradient(135deg, ${color1} 0%, ${color2} 100%)`;
                }
            }

            updateAnnouncementBarBorder(section) {
                const container = section.querySelector('.announcement-bar-container');
                if (!container) return;

                const borderStyleSelect = document.getElementById('announcement-border-style');
                const borderWidthSlider = document.getElementById('announcement-border-width');
                const borderColorPicker = document.getElementById('announcement-border-color');

                if (borderStyleSelect && borderWidthSlider && borderColorPicker) {
                    const style = borderStyleSelect.value;
                    const width = borderWidthSlider.value;
                    const color = borderColorPicker.value;

                    if (style === 'none' || width === '0') {
                        container.style.border = 'none';
                    } else {
                        container.style.border = `${width}px ${style} ${color}`;
                    }
                }
            }

            toggleAnnouncementBarDismissible(section, enabled) {
                const container = section.querySelector('.announcement-bar-container');
                if (!container) return;

                if (enabled) {
                    // Add dismiss button if it doesn't exist
                    if (!container.querySelector('.announcement-dismiss')) {
                        const dismissBtn = document.createElement('button');
                        dismissBtn.className = 'announcement-dismiss';
                        dismissBtn.innerHTML = '';
                        dismissBtn.style.cssText = `
                            position: absolute;
                            top: 8px;
                            right: 12px;
                            background: none;
                            border: none;
                            color: inherit;
                            font-size: 20px;
                            cursor: pointer;
                            opacity: 0.7;
                            transition: opacity 0.2s;
                        `;
                        dismissBtn.addEventListener('click', () => {
                            container.style.display = 'none';
                        });
                        dismissBtn.addEventListener('mouseenter', () => {
                            dismissBtn.style.opacity = '1';
                        });
                        dismissBtn.addEventListener('mouseleave', () => {
                            dismissBtn.style.opacity = '0.7';
                        });
                        container.style.position = 'relative';
                        container.appendChild(dismissBtn);
                    }
                } else {
                    // Remove dismiss button if it exists
                    const dismissBtn = container.querySelector('.announcement-dismiss');
                    if (dismissBtn) {
                        dismissBtn.remove();
                    }
                }
            }

            toggleAnnouncementBarSticky(section, enabled) {
                const container = section.querySelector('.announcement-bar-container');
                if (!container) return;

                if (enabled) {
                    container.style.position = 'sticky';
                    container.style.top = '0';
                    container.style.zIndex = '1000';
                } else {
                    container.style.position = '';
                    container.style.top = '';
                    container.style.zIndex = '';
                }
            }
            applyAnnouncementBarStyle(section, property, value) {
                const container = section.querySelector('.announcement-bar-container');
                if (container) {
                    container.style[property] = value;
                }
            }

            applyAnnouncementBarLinkStyle(section, property, value) {
                const link = section.querySelector('.announcement-text a');
                if (link) {
                    link.style[property] = value;
                }
            }

            // Premium Announcement Bar Functions
            setupPremiumAnnouncementBarStyling(section) {
                console.log(' Setting up premium announcement bar styling...');

                // Gradient color handlers
                const gradientStartPicker = document.getElementById('announcement-gradient-start');
                const gradientStartText = document.getElementById('announcement-gradient-start-text');
                const gradientEndPicker = document.getElementById('announcement-gradient-end');
                const gradientEndText = document.getElementById('announcement-gradient-end-text');

                if (gradientStartPicker && gradientStartText) {
                    gradientStartPicker.addEventListener('input', (e) => {
                        gradientStartText.value = e.target.value;
                        this.updatePremiumAnnouncementBarGradient(section);
                    });
                    gradientStartText.addEventListener('input', (e) => {
                        gradientStartPicker.value = e.target.value;
                        this.updatePremiumAnnouncementBarGradient(section);
                    });
                }

                if (gradientEndPicker && gradientEndText) {
                    gradientEndPicker.addEventListener('input', (e) => {
                        gradientEndText.value = e.target.value;
                        this.updatePremiumAnnouncementBarGradient(section);
                    });
                    gradientEndText.addEventListener('input', (e) => {
                        gradientEndPicker.value = e.target.value;
                        this.updatePremiumAnnouncementBarGradient(section);
                    });
                }

                // Text color handlers
                const textColorPicker = document.getElementById('announcement-text-color');
                const textColorText = document.getElementById('announcement-text-color-text');
                if (textColorPicker && textColorText) {
                    textColorPicker.addEventListener('input', (e) => {
                        textColorText.value = e.target.value;
                        this.updatePremiumAnnouncementBarTextColor(section);
                    });
                    textColorText.addEventListener('input', (e) => {
                        textColorPicker.value = e.target.value;
                        this.updatePremiumAnnouncementBarTextColor(section);
                    });
                }

                // CTA button color handlers
                const ctaColorPicker = document.getElementById('announcement-cta-color');
                const ctaColorText = document.getElementById('announcement-cta-color-text');
                if (ctaColorPicker && ctaColorText) {
                    ctaColorPicker.addEventListener('input', (e) => {
                        ctaColorText.value = e.target.value;
                        this.updatePremiumAnnouncementBarCTA(section);
                    });
                    ctaColorText.addEventListener('input', (e) => {
                        ctaColorPicker.value = e.target.value;
                        this.updatePremiumAnnouncementBarCTA(section);
                    });
                }

                // Padding, font size, border radius handlers
                const paddingSlider = document.getElementById('announcement-padding');
                const paddingValue = document.getElementById('announcement-padding-value');
                if (paddingSlider && paddingValue) {
                    paddingSlider.addEventListener('input', (e) => {
                        paddingValue.textContent = e.target.value + 'px';
                        this.updatePremiumAnnouncementBarSpacing(section);
                    });
                }

                const fontSizeSlider = document.getElementById('announcement-font-size');
                const fontSizeValue = document.getElementById('announcement-font-size-value');
                if (fontSizeSlider && fontSizeValue) {
                    fontSizeSlider.addEventListener('input', (e) => {
                        fontSizeValue.textContent = e.target.value + 'px';
                        this.updatePremiumAnnouncementBarTypography(section);
                    });
                }

                const borderRadiusSlider = document.getElementById('announcement-border-radius');
                const borderRadiusValue = document.getElementById('announcement-border-radius-value');
                if (borderRadiusSlider && borderRadiusValue) {
                    borderRadiusSlider.addEventListener('input', (e) => {
                        borderRadiusValue.textContent = e.target.value + 'px';
                        this.updatePremiumAnnouncementBarSpacing(section);
                    });
                }
            }

            applyPremiumAnnouncementBarChanges(section) {
                console.log(' Applying premium announcement bar changes...');

                // Update content
                const badgeText = document.getElementById('announcement-badge')?.value || ' Limited Time';
                const mainMessage = document.getElementById('announcement-main')?.value || 'MEGA SALE! Get up to 70% off on all items';
                const ctaText = document.getElementById('announcement-cta')?.value || 'Shop Now ';
                const ctaLink = document.getElementById('announcement-link')?.value || '#';

                const container = section.querySelector('.announcement-bar-container');
                const announcementText = container?.querySelector('.announcement-text');

                if (announcementText) {
                    // Update badge
                    const badgeElement = announcementText.querySelector('span:first-child');
                    if (badgeElement) {
                        badgeElement.textContent = badgeText;
                    }

                    // Update main message
                    const mainText = announcementText.querySelector('span:nth-child(2)');
                    if (mainText) {
                        mainText.textContent = mainMessage;
                    }

                    // Update CTA button
                    const ctaButton = announcementText.querySelector('a');
                    if (ctaButton) {
                        ctaButton.textContent = ctaText;
                        ctaButton.href = ctaLink;
                    }
                }

                this.showSuccessMessage('Premium announcement bar updated!');
            }

            updatePremiumAnnouncementBarGradient(section) {
                const container = section.querySelector('.announcement-bar-container');
                if (!container) return;

                const startColor = document.getElementById('announcement-gradient-start')?.value || '#667eea';
                const endColor = document.getElementById('announcement-gradient-end')?.value || '#764ba2';

                // Ensure colors are valid hex values
                const validStartColor = startColor.startsWith('#') ? startColor : '#667eea';
                const validEndColor = endColor.startsWith('#') ? endColor : '#764ba2';

                container.style.background = `linear-gradient(135deg, ${validStartColor} 0%, ${validEndColor} 100%)`;
            }

            updatePremiumAnnouncementBarTextColor(section) {
                const container = section.querySelector('.announcement-bar-container');
                if (!container) return;

                const textColor = document.getElementById('announcement-text-color')?.value || '#ffffff';
                container.style.color = textColor;
            }

            updatePremiumAnnouncementBarCTA(section) {
                const container = section.querySelector('.announcement-bar-container');
                const ctaButton = container?.querySelector('a');
                if (!ctaButton) return;

                const ctaColor = document.getElementById('announcement-cta-color')?.value || '#fbbf24';
                ctaButton.style.color = ctaColor;
                ctaButton.style.borderColor = ctaColor + '80'; // 50% opacity
                ctaButton.style.background = ctaColor + '20'; // 12% opacity
            }

            updatePremiumAnnouncementBarSpacing(section) {
                const container = section.querySelector('.announcement-bar-container');
                if (!container) return;

                const padding = document.getElementById('announcement-padding')?.value || '16';
                const borderRadius = document.getElementById('announcement-border-radius')?.value || '12';

                container.style.padding = `${padding}px 24px`;
                container.style.borderRadius = `${borderRadius}px`;
            }

            updatePremiumAnnouncementBarTypography(section) {
                const container = section.querySelector('.announcement-bar-container');
                if (!container) return;

                const fontSize = document.getElementById('announcement-font-size')?.value || '15';
                const fontWeight = document.getElementById('announcement-font-weight')?.value || '600';
                const textTransform = document.getElementById('announcement-text-transform')?.value || 'none';

                container.style.fontSize = `${fontSize}px`;
                container.style.fontWeight = fontWeight;
                container.style.textTransform = textTransform;
            }

            setupPremiumAnnouncementBarAdvancedStyling(section) {
                console.log(' Setting up premium advanced styling...');

                // Font weight handler
                const fontWeightSelect = document.getElementById('announcement-font-weight');
                if (fontWeightSelect) {
                    fontWeightSelect.addEventListener('change', (e) => {
                        this.updatePremiumAnnouncementBarTypography(section);
                    });
                }

                // Text transform handler
                const textTransformSelect = document.getElementById('announcement-text-transform');
                if (textTransformSelect) {
                    textTransformSelect.addEventListener('change', (e) => {
                        this.updatePremiumAnnouncementBarTypography(section);
                    });
                }

                // Text alignment handler
                const textAlignSelect = document.getElementById('announcement-text-align');
                if (textAlignSelect) {
                    textAlignSelect.addEventListener('change', (e) => {
                        this.updatePremiumAnnouncementBarLayout(section);
                    });
                }

                // Background pattern handler
                const bgPatternSelect = document.getElementById('announcement-bg-pattern');
                if (bgPatternSelect) {
                    bgPatternSelect.addEventListener('change', (e) => {
                        this.updatePremiumAnnouncementBarPattern(section);
                    });
                }

                // Dismissible handler
                const dismissibleCheckbox = document.getElementById('announcement-dismissible');
                if (dismissibleCheckbox) {
                    dismissibleCheckbox.addEventListener('change', (e) => {
                        this.togglePremiumAnnouncementBarDismissible(section, e.target.checked);
                    });
                }

                // Sticky handler
                const stickyCheckbox = document.getElementById('announcement-sticky');
                if (stickyCheckbox) {
                    stickyCheckbox.addEventListener('change', (e) => {
                        this.togglePremiumAnnouncementBarSticky(section, e.target.checked);
                    });
                }
            }

            updatePremiumAnnouncementBarLayout(section) {
                const container = section.querySelector('.announcement-bar-container');
                if (!container) return;

                const textAlign = document.getElementById('announcement-text-align')?.value || 'center';
                container.style.textAlign = textAlign;
            }

            updatePremiumAnnouncementBarPattern(section) {
                const container = section.querySelector('.announcement-bar-container');
                if (!container) return;

                const pattern = document.getElementById('announcement-bg-pattern')?.value || 'none';

                // Remove existing pattern classes
                container.classList.remove('announcement-bar-gradient', 'announcement-bar-stripes', 'announcement-bar-dots', 'announcement-bar-waves');

                switch (pattern) {
                    case 'gradient':
                        container.classList.add('announcement-bar-gradient');
                        this.updatePremiumAnnouncementBarGradient(section);
                        break;
                    case 'stripes':
                        container.classList.add('announcement-bar-stripes');
                        container.style.background = `
                            linear-gradient(45deg, transparent 25%, rgba(255,255,255,0.1) 25%, rgba(255,255,255,0.1) 50%, transparent 50%, transparent 75%, rgba(255,255,255,0.1) 75%),
                            ${container.style.background}
                        `;
                        container.style.backgroundSize = '20px 20px';
                        break;
                    case 'dots':
                        container.classList.add('announcement-bar-dots');
                        container.style.background = `
                            radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px),
                            ${container.style.background}
                        `;
                        container.style.backgroundSize = '20px 20px';
                        break;
                    case 'waves':
                        container.classList.add('announcement-bar-waves');
                        container.style.background = `
                            url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E"),
                            ${container.style.background}
                        `;
                        break;
                    default:
                        this.updatePremiumAnnouncementBarGradient(section);
                }
            }

            togglePremiumAnnouncementBarDismissible(section, enabled) {
                const container = section.querySelector('.announcement-bar-container');
                if (!container) return;

                if (enabled) {
                    // Add dismiss button if it doesn't exist
                    if (!container.querySelector('button[onclick*="display=\'none\'"]')) {
                        const dismissBtn = document.createElement('button');
                        dismissBtn.innerHTML = '';
                        dismissBtn.style.cssText = `
                            position: absolute;
                            top: 8px;
                            right: 12px;
                            background: none;
                            border: none;
                            color: rgba(255, 255, 255, 0.8);
                            font-size: 18px;
                            cursor: pointer;
                            padding: 4px;
                            border-radius: 4px;
                            transition: all 0.2s ease;
                            z-index: 3;
                        `;
                        dismissBtn.addEventListener('click', () => {
                            container.style.display = 'none';
                        });
                        dismissBtn.addEventListener('mouseenter', () => {
                            dismissBtn.style.background = 'rgba(255, 255, 255, 0.2)';
                        });
                        dismissBtn.addEventListener('mouseleave', () => {
                            dismissBtn.style.background = 'none';
                        });
                        container.appendChild(dismissBtn);
                    }
                } else {
                    // Remove dismiss button if it exists
                    const dismissBtn = container.querySelector('button[onclick*="display=\'none\'"]');
                    if (dismissBtn) {
                        dismissBtn.remove();
                    }
                }
            }

            togglePremiumAnnouncementBarSticky(section, enabled) {
                const container = section.querySelector('.announcement-bar-container');
                if (!container) return;

                if (enabled) {
                    container.style.position = 'sticky';
                    container.style.top = '0';
                    container.style.zIndex = '1000';
                } else {
                    container.style.position = '';
                    container.style.top = '';
                    container.style.zIndex = '';
                }
            }

            setupImageTextEditorListeners(section) {
                console.log('Setting up image-text editor listeners...');

                // Live content updates
                const liveUpdateInputs = [
                    'image-text-title',
                    'image-text-description',
                    'image-text-button-text',
                    'image-text-button-link'
                ];

                liveUpdateInputs.forEach(inputId => {
                    const input = document.getElementById(inputId);
                    if (input) {
                        input.addEventListener('input', () => {
                            this.applyImageTextChanges(section);
                        });
                    }
                });

                // Live styling updates
                this.setupImageTextLiveStyling(section);

                // Image upload handler
                const imageUpload = document.getElementById('image-text-upload');
                if (imageUpload) {
                    imageUpload.addEventListener('change', (e) => {
                        const file = e.target.files[0];
                        if (file) {
                            const reader = new FileReader();
                            reader.onload = function (e) {
                                const preview = document.getElementById('image-text-preview');
                                if (preview) {
                                    preview.innerHTML = `<img src="${e.target.result}" style="max-width: 200px; max-height: 150px; border-radius: 4px;">`;
                                }
                                // Apply image to section
                                const imageContainer = section.querySelector('div[style*="height: 300px"]');
                                if (imageContainer) {
                                    imageContainer.style.backgroundImage = `url(${e.target.result})`;
                                    imageContainer.style.backgroundSize = 'cover';
                                    imageContainer.style.backgroundPosition = 'center';
                                    imageContainer.textContent = '';
                                }
                            };
                            reader.readAsDataURL(file);
                        }
                    });
                }

                // Background image upload handler
                const bgImageUpload = document.getElementById('image-text-bg-image');
                if (bgImageUpload) {
                    bgImageUpload.addEventListener('change', (e) => {
                        const file = e.target.files[0];
                        if (file) {
                            const reader = new FileReader();
                            reader.onload = function (e) {
                                const preview = document.getElementById('image-text-bg-preview');
                                if (preview) {
                                    preview.innerHTML = `<img src="${e.target.result}" style="max-width: 200px; max-height: 150px; border-radius: 4px;">`;
                                }
                                // Apply background image to section
                                const sectionContainer = section.querySelector('div[style*="padding: 60px"]');
                                if (sectionContainer) {
                                    sectionContainer.style.backgroundImage = `url(${e.target.result})`;
                                    sectionContainer.style.backgroundSize = 'cover';
                                    sectionContainer.style.backgroundPosition = 'center';
                                }
                            };
                            reader.readAsDataURL(file);
                        }
                    });
                }

                // Image position handler
                const positionSelect = document.getElementById('image-text-position');
                if (positionSelect) {
                    positionSelect.addEventListener('change', () => {
                        this.applyImageTextChanges(section);
                    });
                }
            }

            setupImageTextLiveStyling(section) {
                // Section padding live update
                const sectionPaddingSlider = document.getElementById('image-text-section-padding');
                const sectionPaddingValue = document.getElementById('image-text-section-padding-value');
                if (sectionPaddingSlider && sectionPaddingValue) {
                    sectionPaddingSlider.addEventListener('input', (e) => {
                        sectionPaddingValue.textContent = e.target.value + 'px';
                        this.applyImageTextSectionStyle(section, 'padding', e.target.value + 'px');
                    });
                }

                // Section margin live update
                const sectionMarginSlider = document.getElementById('image-text-section-margin');
                const sectionMarginValue = document.getElementById('image-text-section-margin-value');
                if (sectionMarginSlider && sectionMarginValue) {
                    sectionMarginSlider.addEventListener('input', (e) => {
                        sectionMarginValue.textContent = e.target.value + 'px';
                        this.applyImageTextSectionStyle(section, 'margin', e.target.value + 'px');
                    });
                }

                // Border width live update
                const borderWidthSlider = document.getElementById('image-text-border-width');
                const borderWidthValue = document.getElementById('image-text-border-width-value');
                if (borderWidthSlider && borderWidthValue) {
                    borderWidthSlider.addEventListener('input', (e) => {
                        borderWidthValue.textContent = e.target.value + 'px';
                        this.applyImageTextSectionStyle(section, 'borderWidth', e.target.value + 'px');
                    });
                }

                // Border color live update
                const borderColorPicker = document.getElementById('image-text-border-color');
                const borderColorText = document.getElementById('image-text-border-color-text');
                if (borderColorPicker && borderColorText) {
                    borderColorPicker.addEventListener('input', (e) => {
                        borderColorText.value = e.target.value;
                        this.applyImageTextSectionStyle(section, 'borderColor', e.target.value);
                    });
                    borderColorText.addEventListener('input', (e) => {
                        borderColorPicker.value = e.target.value;
                        this.applyImageTextSectionStyle(section, 'borderColor', e.target.value);
                    });
                }

                // Section border radius live update
                const sectionBorderRadiusSlider = document.getElementById('image-text-section-border-radius');
                const sectionBorderRadiusValue = document.getElementById('image-text-section-border-radius-value');
                if (sectionBorderRadiusSlider && sectionBorderRadiusValue) {
                    sectionBorderRadiusSlider.addEventListener('input', (e) => {
                        sectionBorderRadiusValue.textContent = e.target.value + 'px';
                        this.applyImageTextSectionStyle(section, 'borderRadius', e.target.value + 'px');
                    });
                }

                // Image border radius live update
                const imageBorderRadiusSlider = document.getElementById('image-text-border-radius');
                const imageBorderRadiusValue = document.getElementById('image-text-border-radius-value');
                if (imageBorderRadiusSlider && imageBorderRadiusValue) {
                    imageBorderRadiusSlider.addEventListener('input', (e) => {
                        imageBorderRadiusValue.textContent = e.target.value + 'px';
                        this.applyImageTextImageStyle(section, 'borderRadius', e.target.value + 'px');
                    });
                }

                // Box shadow live update
                const shadowSlider = document.getElementById('image-text-shadow');
                const shadowValue = document.getElementById('image-text-shadow-value');
                const shadowColorPicker = document.getElementById('image-text-shadow-color');
                const shadowColorText = document.getElementById('image-text-shadow-color-text');

                if (shadowSlider && shadowValue) {
                    shadowSlider.addEventListener('input', (e) => {
                        shadowValue.textContent = e.target.value + 'px';
                        const shadowColor = shadowColorPicker ? shadowColorPicker.value : '#000000';
                        this.applyImageTextSectionStyle(section, 'boxShadow', `0 0 ${e.target.value}px ${shadowColor}`);
                    });
                }

                if (shadowColorPicker && shadowColorText) {
                    shadowColorPicker.addEventListener('input', (e) => {
                        shadowColorText.value = e.target.value;
                        const shadowSize = shadowSlider ? shadowSlider.value : '0';
                        this.applyImageTextSectionStyle(section, 'boxShadow', `0 0 ${shadowSize}px ${e.target.value}`);
                    });
                    shadowColorText.addEventListener('input', (e) => {
                        shadowColorPicker.value = e.target.value;
                        const shadowSize = shadowSlider ? shadowSlider.value : '0';
                        this.applyImageTextSectionStyle(section, 'boxShadow', `0 0 ${shadowSize}px ${e.target.value}`);
                    });
                }

                // Background color live update
                const bgColorPicker = document.getElementById('image-text-bg-color');
                const bgColorText = document.getElementById('image-text-bg-color-text');
                if (bgColorPicker && bgColorText) {
                    bgColorPicker.addEventListener('input', (e) => {
                        bgColorText.value = e.target.value;
                        this.applyImageTextSectionStyle(section, 'backgroundColor', e.target.value);
                    });
                    bgColorText.addEventListener('input', (e) => {
                        bgColorPicker.value = e.target.value;
                        this.applyImageTextSectionStyle(section, 'backgroundColor', e.target.value);
                    });
                }

                // Opacity live update
                const opacitySlider = document.getElementById('image-text-opacity');
                const opacityValue = document.getElementById('image-text-opacity-value');
                if (opacitySlider && opacityValue) {
                    opacitySlider.addEventListener('input', (e) => {
                        opacityValue.textContent = e.target.value + '%';
                        this.applyImageTextSectionStyle(section, 'opacity', e.target.value / 100);
                    });
                }

                // Scale live update
                const scaleSlider = document.getElementById('image-text-scale');
                const scaleValue = document.getElementById('image-text-scale-value');
                if (scaleSlider && scaleValue) {
                    scaleSlider.addEventListener('input', (e) => {
                        scaleValue.textContent = e.target.value + '%';
                        this.applyImageTextSectionStyle(section, 'transform', `scale(${e.target.value / 100})`);
                    });
                }

                // Typography live updates
                this.setupImageTextTypographyListeners(section);
            }

            setupImageTextTypographyListeners(section) {
                // Title color live update
                const titleColorPicker = document.getElementById('image-text-title-color');
                const titleColorText = document.getElementById('image-text-title-color-text');
                if (titleColorPicker && titleColorText) {
                    titleColorPicker.addEventListener('input', (e) => {
                        titleColorText.value = e.target.value;
                        this.applyImageTextTypographyStyle(section, 'title', 'color', e.target.value);
                    });
                    titleColorText.addEventListener('input', (e) => {
                        titleColorPicker.value = e.target.value;
                        this.applyImageTextTypographyStyle(section, 'title', 'color', e.target.value);
                    });
                }

                // Title size live update
                const titleSizeSlider = document.getElementById('image-text-title-size');
                const titleSizeValue = document.getElementById('image-text-title-size-value');
                if (titleSizeSlider && titleSizeValue) {
                    titleSizeSlider.addEventListener('input', (e) => {
                        titleSizeValue.textContent = e.target.value + 'px';
                        this.applyImageTextTypographyStyle(section, 'title', 'fontSize', e.target.value + 'px');
                    });
                }

                // Text color live update
                const textColorPicker = document.getElementById('image-text-text-color');
                const textColorText = document.getElementById('image-text-text-color-text');
                if (textColorPicker && textColorText) {
                    textColorPicker.addEventListener('input', (e) => {
                        textColorText.value = e.target.value;
                        this.applyImageTextTypographyStyle(section, 'text', 'color', e.target.value);
                    });
                    textColorText.addEventListener('input', (e) => {
                        textColorPicker.value = e.target.value;
                        this.applyImageTextTypographyStyle(section, 'text', 'color', e.target.value);
                    });
                }

                // Text size live update
                const textSizeSlider = document.getElementById('image-text-text-size');
                const textSizeValue = document.getElementById('image-text-text-size-value');
                if (textSizeSlider && textSizeValue) {
                    textSizeSlider.addEventListener('input', (e) => {
                        textSizeValue.textContent = e.target.value + 'px';
                        this.applyImageTextTypographyStyle(section, 'text', 'fontSize', e.target.value + 'px');
                    });
                }

                // Button styling live updates
                const buttonBgPicker = document.getElementById('image-text-button-bg');
                const buttonBgText = document.getElementById('image-text-button-bg-text');
                if (buttonBgPicker && buttonBgText) {
                    buttonBgPicker.addEventListener('input', (e) => {
                        buttonBgText.value = e.target.value;
                        this.applyImageTextButtonStyle(section, 'backgroundColor', e.target.value);
                    });
                    buttonBgText.addEventListener('input', (e) => {
                        buttonBgPicker.value = e.target.value;
                        this.applyImageTextButtonStyle(section, 'backgroundColor', e.target.value);
                    });
                }

                const buttonTextColorPicker = document.getElementById('image-text-button-text-color');
                const buttonTextColorText = document.getElementById('image-text-button-text-color-text');
                if (buttonTextColorPicker && buttonTextColorText) {
                    buttonTextColorPicker.addEventListener('input', (e) => {
                        buttonTextColorText.value = e.target.value;
                        this.applyImageTextButtonStyle(section, 'color', e.target.value);
                    });
                    buttonTextColorText.addEventListener('input', (e) => {
                        buttonTextColorPicker.value = e.target.value;
                        this.applyImageTextButtonStyle(section, 'color', e.target.value);
                    });
                }

                const buttonRadiusSlider = document.getElementById('image-text-button-radius');
                const buttonRadiusValue = document.getElementById('image-text-button-radius-value');
                if (buttonRadiusSlider && buttonRadiusValue) {
                    buttonRadiusSlider.addEventListener('input', (e) => {
                        buttonRadiusValue.textContent = e.target.value + 'px';
                        this.applyImageTextButtonStyle(section, 'borderRadius', e.target.value + 'px');
                    });
                }
            }

            applyImageTextChanges(section) {
                // Update content
                const title = document.getElementById('image-text-title')?.value;
                const description = document.getElementById('image-text-description')?.value;
                const buttonText = document.getElementById('image-text-button-text')?.value;
                const buttonLink = document.getElementById('image-text-button-link')?.value;
                const imagePosition = document.getElementById('image-text-position')?.value;

                if (title) {
                    const titleEl = section.querySelector('h3');
                    if (titleEl) titleEl.textContent = title;
                }

                if (description) {
                    const textEl = section.querySelector('p');
                    if (textEl) textEl.textContent = description;
                }

                if (buttonText) {
                    const buttonEl = section.querySelector('button');
                    if (buttonEl) {
                        buttonEl.textContent = buttonText;
                        if (buttonLink) {
                            buttonEl.onclick = () => window.open(buttonLink, '_blank');
                        }
                    }
                }

                // Update image position
                if (imagePosition) {
                    const container = section.querySelector('div[style*="display: flex"]');
                    if (container) {
                        const imageDiv = container.querySelector('div:first-child');
                        const textDiv = container.querySelector('div:last-child');
                        if (imagePosition === 'right') {
                            container.insertBefore(textDiv, imageDiv);
                        } else {
                            container.insertBefore(imageDiv, textDiv);
                        }
                    }
                }
            }

            applyImageTextSectionStyle(section, property, value) {
                const sectionContainer = section.querySelector('div[style*="padding: 60px"]');
                if (sectionContainer) {
                    sectionContainer.style[property] = value;
                }
            }

            applyImageTextImageStyle(section, property, value) {
                const imageContainer = section.querySelector('div[style*="height: 300px"]');
                if (imageContainer) {
                    imageContainer.style[property] = value;
                }
            }

            applyImageTextTypographyStyle(section, elementType, property, value) {
                let element;
                if (elementType === 'title') {
                    element = section.querySelector('h3');
                } else if (elementType === 'text') {
                    element = section.querySelector('p');
                }

                if (element) {
                    element.style[property] = value;
                }
            }

            applyImageTextButtonStyle(section, property, value) {
                const button = section.querySelector('button');
                if (button) {
                    button.style[property] = value;
                }
            }

            setupNavbarEditorListeners(section) {
                console.log('Setting up navbar editor listeners...');

                // Logo type handler removed - now all logo options are always visible

                // User Authentication event listeners removed

                // Logo image preview
                const logoImageInput = document.getElementById('navbar-logo-image');
                if (logoImageInput) {
                    logoImageInput.addEventListener('change', (e) => {
                        const file = e.target.files[0];
                        if (file) {
                            const reader = new FileReader();
                            reader.onload = function (e) {
                                const preview = document.getElementById('logo-image-preview');
                                preview.innerHTML = `<img src="${e.target.result}" style="max-width: 100px; max-height: 50px; border-radius: 4px;">`;
                            };
                            reader.readAsDataURL(file);
                        }
                        // Apply changes live
                        this.applyNavbarChanges(section);
                    });
                }

                // Live updates for all input fields
                const liveUpdateInputs = [
                    'navbar-logo-display',
                    'navbar-logo-text',
                    'navbar-logo-text-color',
                    'navbar-logo-bg',
                    'navbar-logo-link',
                    'navbar-bg-color',
                    'navbar-text-color',
                    'navbar-hover-color',
                    'navbar-font-family',
                    'navbar-font-weight',
                    'navbar-font-size',
                    'navbar-text-uppercase',
                    'navbar-enable-hover',
                    'navbar-hover-effect',
                    'navbar-hover-duration'
                ];

                liveUpdateInputs.forEach(inputId => {
                    const input = document.getElementById(inputId);
                    if (input) {
                        input.addEventListener('input', () => {
                            this.applyNavbarChanges(section);
                        });
                    }
                });

                // Live updates for icon checkboxes
                const iconCheckboxes = [
                    'navbar-cart-icon',
                    'navbar-favorite-icon',
                    'navbar-search-icon',
                    'navbar-profile-icon'
                ];

                iconCheckboxes.forEach(checkboxId => {
                    const checkbox = document.getElementById(checkboxId);
                    if (checkbox) {
                        checkbox.addEventListener('change', () => {
                            this.applyNavbarChanges(section);
                        });
                    }
                });

                // Add menu item button
                const addMenuItemBtn = document.getElementById('add-menu-item');
                console.log('Add menu item button found:', addMenuItemBtn);
                if (addMenuItemBtn) {
                    addMenuItemBtn.addEventListener('click', (e) => {
                        console.log('Add menu item button clicked');
                        e.stopPropagation();
                        this.showMenuItemModal();
                    });
                } else {
                    console.error('Add menu item button not found!');
                }

                // Remove menu item buttons
                document.querySelectorAll('.btn-remove-menu-item').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const index = e.target.dataset.index;
                        const menuItem = document.querySelector(`.menu-item[data-index="${index}"]`);
                        if (menuItem) {
                            menuItem.remove();
                            // Update navbar directly without regenerating editor
                            const currentSection = document.querySelector('.canvas-section.selected');
                            if (currentSection) {
                                this.updateNavbarMenuItems(currentSection);
                            }
                        }
                    });
                });

                // Menu item modal event listeners
                this.setupMenuItemModalListeners();

                // Font size range slider with live value display
                const fontSizeSlider = document.getElementById('navbar-font-size');
                const fontSizeValue = document.getElementById('navbar-font-size-value');
                if (fontSizeSlider && fontSizeValue) {
                    fontSizeSlider.addEventListener('input', (e) => {
                        fontSizeValue.textContent = e.target.value + 'px';
                        // Update navbar menu items with new styling
                        this.updateNavbarMenuItems(section);
                    });
                }

                // Hover duration range slider with live value display
                const hoverDurationSlider = document.getElementById('navbar-hover-duration');
                const hoverDurationValue = document.getElementById('navbar-hover-duration-value');
                if (hoverDurationSlider && hoverDurationValue) {
                    hoverDurationSlider.addEventListener('input', (e) => {
                        hoverDurationValue.textContent = e.target.value + 's';
                        // Update navbar menu items with new styling
                        this.updateNavbarMenuItems(section);
                    });
                }

                // Color picker synchronization for text and hover colors
                const textColorPicker = document.getElementById('navbar-text-color');
                const textColorText = document.getElementById('navbar-text-color-text');
                if (textColorPicker && textColorText) {
                    textColorPicker.addEventListener('input', (e) => {
                        textColorText.value = e.target.value;
                        this.updateNavbarMenuItems(section);
                    });
                    textColorText.addEventListener('input', (e) => {
                        textColorPicker.value = e.target.value;
                        this.updateNavbarMenuItems(section);
                    });
                }

                const hoverColorPicker = document.getElementById('navbar-hover-color');
                const hoverColorText = document.getElementById('navbar-hover-color-text');
                if (hoverColorPicker && hoverColorText) {
                    hoverColorPicker.addEventListener('input', (e) => {
                        hoverColorText.value = e.target.value;
                        this.updateNavbarMenuItems(section);
                    });
                    hoverColorText.addEventListener('input', (e) => {
                        hoverColorPicker.value = e.target.value;
                        this.updateNavbarMenuItems(section);
                    });
                }

                // Font family and weight change handlers
                const fontFamilySelect = document.getElementById('navbar-font-family');
                const fontWeightSelect = document.getElementById('navbar-font-weight');
                const uppercaseCheckbox = document.getElementById('navbar-text-uppercase');

                if (fontFamilySelect) {
                    fontFamilySelect.addEventListener('change', () => {
                        this.updateNavbarMenuItems(section);
                    });
                }

                if (fontWeightSelect) {
                    fontWeightSelect.addEventListener('change', () => {
                        this.updateNavbarMenuItems(section);
                    });
                }

                if (uppercaseCheckbox) {
                    uppercaseCheckbox.addEventListener('change', () => {
                        this.updateNavbarMenuItems(section);
                    });
                }
                console.log('Collection selector updated with', collections.length, 'collections');
            }

            // Listen for collection updates from other tabs/windows
            setupCollectionListener() {
                window.addEventListener('storage', (e) => {
                    if (e.key === 'collections' && e.newValue) {
                        try {
                            const collections = JSON.parse(e.newValue);
                            this.updateCollectionSelector(collections);
                        } catch (error) {
                            console.error('Error parsing collections from storage:', error);
                        }
                    }
                });

                // Also listen for custom events
                window.addEventListener('collectionsUpdated', (e) => {
                    if (e.detail && e.detail.collections) {
                        this.updateCollectionSelector(e.detail.collections);
                    }
                });
            }

            setupHeroSliderEditorListeners(section) {
                console.log('Setting up hero slider editor listeners...');

                // Initialize hero slider if not already done
                if (!section.heroSliderInstance) {
                    section.heroSliderInstance = new HeroSlider(section);
                }

                // Auto-play duration slider
                const autoplaySlider = document.getElementById('slider-autoplay');
                const autoplayValue = document.getElementById('slider-autoplay-value');
                if (autoplaySlider && autoplayValue) {
                    autoplaySlider.addEventListener('input', (e) => {
                        autoplayValue.textContent = e.target.value + 's';
                        if (section.heroSliderInstance) {
                            section.heroSliderInstance.setAutoplayDuration(e.target.value);
                        }
                    });
                }

                // Auto-play enabled checkbox
                const autoplayEnabled = document.getElementById('slider-autoplay-enabled');
                if (autoplayEnabled) {
                    autoplayEnabled.addEventListener('change', (e) => {
                        if (section.heroSliderInstance) {
                            if (e.target.checked) {
                                section.heroSliderInstance.startAutoPlay();
                            } else {
                                section.heroSliderInstance.stopAutoPlay();
                            }
                        }
                    });
                }

                // Show/hide dots checkbox
                const showDots = document.getElementById('slider-show-dots');
                if (showDots) {
                    showDots.addEventListener('change', (e) => {
                        const dotsContainer = section.querySelector('.flex.justify-center.mt-8.space-x-4');
                        if (dotsContainer) {
                            dotsContainer.style.display = e.target.checked ? 'flex' : 'none';
                        }
                    });
                }

                // Show/hide arrows checkbox
                const showArrows = document.getElementById('slider-show-arrows');
                if (showArrows) {
                    showArrows.addEventListener('change', (e) => {
                        const prevBtn = section.querySelector('.slider-control.prev');
                        const nextBtn = section.querySelector('.slider-control.next');
                        if (prevBtn && nextBtn) {
                            prevBtn.style.display = e.target.checked ? 'block' : 'none';
                            nextBtn.style.display = e.target.checked ? 'block' : 'none';
                        }
                    });
                }

                // Add new slide button - use event delegation for dynamic content
                document.addEventListener('click', (e) => {
                    if (e.target && e.target.id === 'add-new-slide') {
                        e.preventDefault();
                        e.stopPropagation();
                        console.log('Add new slide button clicked!');
                        try {
                            this.addNewSlide(section);
                            console.log('New slide added successfully');
                        } catch (error) {
                            console.error('Error adding new slide:', error);
                            showErrorMessage('Failed to add new slide: ' + error.message);
                        }
                    }
                });

                // Also try direct event listener as fallback
                const addSlideBtn = document.getElementById('add-new-slide');
                if (addSlideBtn) {
                    console.log('Add slide button found, adding direct event listener...');
                    addSlideBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        console.log('Add new slide button clicked (direct)!');
                        try {
                            this.addNewSlide(section);
                            console.log('New slide added successfully');
                        } catch (error) {
                            console.error('Error adding new slide:', error);
                            showErrorMessage('Failed to add new slide: ' + error.message);
                        }
                    });
                } else {
                    console.warn('Add slide button not found initially, using event delegation');
                }

                // Edit slide buttons
                document.querySelectorAll('.btn-edit-slide').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const slideIndex = parseInt(e.target.dataset.slideIndex);
                        this.editSlide(section, slideIndex);
                    });
                });

                // Remove slide buttons
                document.querySelectorAll('.btn-remove-slide').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const slideIndex = parseInt(e.target.dataset.slideIndex);
                        this.removeSlide(section, slideIndex);
                    });
                });

                // Save slide changes button
                const saveSlideBtn = document.getElementById('save-slide-changes');
                if (saveSlideBtn) {
                    saveSlideBtn.addEventListener('click', () => {
                        this.saveSlideChanges(section);
                    });
                }

                // Rich text editor functionality
                this.setupRichTextEditors();

                // Live styling controls
                this.setupLiveSliderStyling(section);
                this.setupLiveSlideStyling(section);

                // Populate slider styling controls with current values
                this.populateSliderStylingControls(section);
            }

            setupLiveSliderStyling(section) {
                // Hero section padding live update
                const sectionPaddingSlider = document.getElementById('hero-section-padding');
                const sectionPaddingValue = document.getElementById('hero-section-padding-value');
                if (sectionPaddingSlider && sectionPaddingValue) {
                    sectionPaddingSlider.addEventListener('input', (e) => {
                        sectionPaddingValue.textContent = e.target.value + 'px';
                        this.applyLiveHeroSectionStyle(section, 'padding', e.target.value + 'px');
                    });
                }

                // Hero section margin live update
                const sectionMarginSlider = document.getElementById('hero-section-margin');
                const sectionMarginValue = document.getElementById('hero-section-margin-value');
                if (sectionMarginSlider && sectionMarginValue) {
                    sectionMarginSlider.addEventListener('input', (e) => {
                        sectionMarginValue.textContent = e.target.value + 'px';
                        this.applyLiveHeroSectionStyle(section, 'margin', e.target.value + 'px');
                    });
                }

                // Border width live update
                const borderWidthSlider = document.getElementById('hero-border-width');
                const borderWidthValue = document.getElementById('hero-border-width-value');
                if (borderWidthSlider && borderWidthValue) {
                    borderWidthSlider.addEventListener('input', (e) => {
                        borderWidthValue.textContent = e.target.value + 'px';
                        this.applyLiveHeroSectionStyle(section, 'borderWidth', e.target.value + 'px');
                    });
                }

                // Border color live update
                const borderColorPicker = document.getElementById('hero-border-color');
                const borderColorText = document.getElementById('hero-border-color-text');
                if (borderColorPicker && borderColorText) {
                    borderColorPicker.addEventListener('input', (e) => {
                        borderColorText.value = e.target.value;
                        this.applyLiveHeroSectionStyle(section, 'borderColor', e.target.value);
                    });
                    borderColorText.addEventListener('input', (e) => {
                        borderColorPicker.value = e.target.value;
                        this.applyLiveHeroSectionStyle(section, 'borderColor', e.target.value);
                    });
                }

                // Border radius live update
                const borderRadiusSlider = document.getElementById('hero-border-radius');
                const borderRadiusValue = document.getElementById('hero-border-radius-value');
                if (borderRadiusSlider && borderRadiusValue) {
                    borderRadiusSlider.addEventListener('input', (e) => {
                        borderRadiusValue.textContent = e.target.value + 'px';
                        this.applyLiveHeroSectionStyle(section, 'borderRadius', e.target.value + 'px');
                    });
                }

                // Box shadow live update
                const shadowSlider = document.getElementById('hero-shadow');
                const shadowValue = document.getElementById('hero-shadow-value');
                const shadowColorPicker = document.getElementById('hero-shadow-color');
                const shadowColorText = document.getElementById('hero-shadow-color-text');

                if (shadowSlider && shadowValue) {
                    shadowSlider.addEventListener('input', (e) => {
                        shadowValue.textContent = e.target.value + 'px';
                        const shadowColor = shadowColorPicker ? shadowColorPicker.value : '#000000';
                        this.applyLiveHeroSectionStyle(section, 'boxShadow', `0 0 ${e.target.value}px ${shadowColor}`);
                    });
                }

                if (shadowColorPicker && shadowColorText) {
                    shadowColorPicker.addEventListener('input', (e) => {
                        shadowColorText.value = e.target.value;
                        const shadowSize = shadowSlider ? shadowSlider.value : '0';
                        this.applyLiveHeroSectionStyle(section, 'boxShadow', `0 0 ${shadowSize}px ${e.target.value}`);
                    });
                    shadowColorText.addEventListener('input', (e) => {
                        shadowColorPicker.value = e.target.value;
                        const shadowSize = shadowSlider ? shadowSlider.value : '0';
                        this.applyLiveHeroSectionStyle(section, 'boxShadow', `0 0 ${shadowSize}px ${e.target.value}`);
                    });
                }

                // Background color live update
                const bgColorPicker = document.getElementById('hero-bg-color');
                const bgColorText = document.getElementById('hero-bg-color-text');
                if (bgColorPicker && bgColorText) {
                    bgColorPicker.addEventListener('input', (e) => {
                        bgColorText.value = e.target.value;
                        this.applyLiveHeroSectionStyle(section, 'backgroundColor', e.target.value);
                    });
                    bgColorText.addEventListener('input', (e) => {
                        bgColorPicker.value = e.target.value;
                        this.applyLiveHeroSectionStyle(section, 'backgroundColor', e.target.value);
                    });
                }

                // Background image live update
                const bgImageInput = document.getElementById('hero-bg-image');
                if (bgImageInput) {
                    bgImageInput.addEventListener('change', (e) => {
                        const file = e.target.files[0];
                        if (file) {
                            const reader = new FileReader();
                            reader.onload = function (e) {
                                const preview = document.getElementById('hero-bg-preview');
                                if (preview) {
                                    preview.innerHTML = `<img src="${e.target.result}" style="max-width: 200px; max-height: 150px; border-radius: 4px;">`;
                                }
                                // Apply background image to hero section
                                const heroSection = section.querySelector('section');
                                if (heroSection) {
                                    heroSection.style.backgroundImage = `url(${e.target.result})`;
                                    heroSection.style.backgroundSize = 'cover';
                                    heroSection.style.backgroundPosition = 'center';
                                }
                            };
                            reader.readAsDataURL(file);
                        }
                    });
                }

                // Opacity live update
                const opacitySlider = document.getElementById('hero-opacity');
                const opacityValue = document.getElementById('hero-opacity-value');
                if (opacitySlider && opacityValue) {
                    opacitySlider.addEventListener('input', (e) => {
                        opacityValue.textContent = e.target.value + '%';
                        this.applyLiveHeroSectionStyle(section, 'opacity', e.target.value / 100);
                    });
                }

                // Scale live update
                const scaleSlider = document.getElementById('hero-scale');
                const scaleValue = document.getElementById('hero-scale-value');
                if (scaleSlider && scaleValue) {
                    scaleSlider.addEventListener('input', (e) => {
                        scaleValue.textContent = e.target.value + '%';
                        this.applyLiveHeroSectionStyle(section, 'transform', `scale(${e.target.value / 100})`);
                    });
                }

                // Min height live update
                const minHeightSlider = document.getElementById('hero-min-height');
                const minHeightValue = document.getElementById('hero-min-height-value');
                if (minHeightSlider && minHeightValue) {
                    minHeightSlider.addEventListener('input', (e) => {
                        minHeightValue.textContent = e.target.value + 'px';
                        this.applyLiveHeroSectionStyle(section, 'minHeight', e.target.value + 'px');
                    });
                }
            }

            applyLiveSliderStyle(section, property, value) {
                const sliderContainer = section.querySelector('.hero-slider');
                if (sliderContainer) {
                    sliderContainer.style[property] = value;
                }
            }

            applyLiveHeroSectionStyle(section, property, value) {
                const heroSection = section.querySelector('section');
                if (heroSection) {
                    heroSection.style[property] = value;
                }
            }

            populateSliderStylingControls(section) {
                const heroSection = section.querySelector('section');
                if (!heroSection) return;

                // Section padding
                const sectionPadding = parseInt(heroSection.style.padding) || 128;
                const sectionPaddingSlider = document.getElementById('hero-section-padding');
                const sectionPaddingValue = document.getElementById('hero-section-padding-value');
                if (sectionPaddingSlider && sectionPaddingValue) {
                    sectionPaddingSlider.value = sectionPadding;
                    sectionPaddingValue.textContent = sectionPadding + 'px';
                }

                // Section margin
                const sectionMargin = parseInt(heroSection.style.margin) || 0;
                const sectionMarginSlider = document.getElementById('hero-section-margin');
                const sectionMarginValue = document.getElementById('hero-section-margin-value');
                if (sectionMarginSlider && sectionMarginValue) {
                    sectionMarginSlider.value = sectionMargin;
                    sectionMarginValue.textContent = sectionMargin + 'px';
                }

                // Border width
                const borderWidth = parseInt(heroSection.style.borderWidth) || 0;
                const borderWidthSlider = document.getElementById('hero-border-width');
                const borderWidthValue = document.getElementById('hero-border-width-value');
                if (borderWidthSlider && borderWidthValue) {
                    borderWidthSlider.value = borderWidth;
                    borderWidthValue.textContent = borderWidth + 'px';
                }

                // Border color
                const borderColor = heroSection.style.borderColor || '#000000';
                const borderColorPicker = document.getElementById('hero-border-color');
                const borderColorText = document.getElementById('hero-border-color-text');
                if (borderColorPicker && borderColorText) {
                    borderColorPicker.value = this.rgbToHex(borderColor) || '#000000';
                    borderColorText.value = this.rgbToHex(borderColor) || '#000000';
                }

                // Border radius
                const borderRadius = parseInt(heroSection.style.borderRadius) || 0;
                const borderRadiusSlider = document.getElementById('hero-border-radius');
                const borderRadiusValue = document.getElementById('hero-border-radius-value');
                if (borderRadiusSlider && borderRadiusValue) {
                    borderRadiusSlider.value = borderRadius;
                    borderRadiusValue.textContent = borderRadius + 'px';
                }

                // Box shadow
                const boxShadow = heroSection.style.boxShadow || '0 0 0px #000000';
                const shadowMatch = boxShadow.match(/0 0 (\d+)px ([^)]+)/);
                const shadowSize = shadowMatch ? parseInt(shadowMatch[1]) : 0;
                const shadowColor = shadowMatch ? shadowMatch[2] : '#000000';

                const shadowSlider = document.getElementById('hero-shadow');
                const shadowValue = document.getElementById('hero-shadow-value');
                const shadowColorPicker = document.getElementById('hero-shadow-color');
                const shadowColorText = document.getElementById('hero-shadow-color-text');

                if (shadowSlider && shadowValue) {
                    shadowSlider.value = shadowSize;
                    shadowValue.textContent = shadowSize + 'px';
                }
                if (shadowColorPicker && shadowColorText) {
                    shadowColorPicker.value = this.rgbToHex(shadowColor) || '#000000';
                    shadowColorText.value = this.rgbToHex(shadowColor) || '#000000';
                }

                // Background color
                const bgColor = heroSection.style.backgroundColor || '#ffffff';
                const bgColorPicker = document.getElementById('hero-bg-color');
                const bgColorText = document.getElementById('hero-bg-color-text');
                if (bgColorPicker && bgColorText) {
                    bgColorPicker.value = this.rgbToHex(bgColor) || '#ffffff';
                    bgColorText.value = this.rgbToHex(bgColor) || '#ffffff';
                }

                // Background image
                const bgImage = heroSection.style.backgroundImage;
                if (bgImage && bgImage !== 'none') {
                    const preview = document.getElementById('hero-bg-preview');
                    if (preview) {
                        preview.innerHTML = `<img src="${bgImage.replace(/url\(['"]?(.*?)['"]?\)/, '$1')}" style="max-width: 200px; max-height: 150px; border-radius: 4px;">`;
                    }
                }

                // Opacity
                const opacity = Math.round((heroSection.style.opacity || 1) * 100);
                const opacitySlider = document.getElementById('hero-opacity');
                const opacityValue = document.getElementById('hero-opacity-value');
                if (opacitySlider && opacityValue) {
                    opacitySlider.value = opacity;
                    opacityValue.textContent = opacity + '%';
                }

                // Scale
                const transform = heroSection.style.transform || 'scale(1)';
                const scaleMatch = transform.match(/scale\(([^)]+)\)/);
                const scale = scaleMatch ? Math.round(parseFloat(scaleMatch[1]) * 100) : 100;
                const scaleSlider = document.getElementById('hero-scale');
                const scaleValue = document.getElementById('hero-scale-value');
                if (scaleSlider && scaleValue) {
                    scaleSlider.value = scale;
                    scaleValue.textContent = scale + '%';
                }

                // Min height
                const minHeight = parseInt(heroSection.style.minHeight) || 400;
                const minHeightSlider = document.getElementById('hero-min-height');
                const minHeightValue = document.getElementById('hero-min-height-value');
                if (minHeightSlider && minHeightValue) {
                    minHeightSlider.value = minHeight;
                    minHeightValue.textContent = minHeight + 'px';
                }
            }

            setupLiveSlideStyling(section) {
                // Slide background color live update
                const slideBgColorPicker = document.getElementById('slide-bg-color');
                const slideBgColorText = document.getElementById('slide-bg-color-text');
                if (slideBgColorPicker && slideBgColorText) {
                    slideBgColorPicker.addEventListener('input', (e) => {
                        slideBgColorText.value = e.target.value;
                        this.applyLiveSlideStyle(section, 'backgroundColor', e.target.value);
                    });
                    slideBgColorText.addEventListener('input', (e) => {
                        slideBgColorPicker.value = e.target.value;
                        this.applyLiveSlideStyle(section, 'backgroundColor', e.target.value);
                    });
                }

                // Slide background image live update
                const slideBgImageInput = document.getElementById('slide-bg-image');
                if (slideBgImageInput) {
                    slideBgImageInput.addEventListener('change', (e) => {
                        const file = e.target.files[0];
                        if (file) {
                            const reader = new FileReader();
                            reader.onload = function (e) {
                                const preview = document.getElementById('slide-bg-preview');
                                if (preview) {
                                    preview.innerHTML = `<img src="${e.target.result}" style="max-width: 200px; max-height: 150px; border-radius: 4px;">`;
                                }
                                // Apply background image to slide
                                const slideEditorSection = document.getElementById('slide-editor-section');
                                const slideIndex = parseInt(slideEditorSection.dataset.currentSlideIndex);
                                const slide = section.querySelectorAll('.slide')[slideIndex];
                                if (slide) {
                                    slide.style.backgroundImage = `url(${e.target.result})`;
                                    slide.style.backgroundSize = 'cover';
                                    slide.style.backgroundPosition = 'center';
                                }
                            };
                            reader.readAsDataURL(file);
                        }
                    });
                }
            }

            applyLiveSlideStyle(section, property, value) {
                const slideEditorSection = document.getElementById('slide-editor-section');
                if (slideEditorSection && slideEditorSection.dataset.currentSlideIndex !== undefined) {
                    const slideIndex = parseInt(slideEditorSection.dataset.currentSlideIndex);
                    const slide = section.querySelectorAll('.slide')[slideIndex];
                    if (slide) {
                        slide.style[property] = value;
                    }
                }
            }

            addNewSlide(section) {
                console.log('Adding new slide to section:', section);

                const slidesContainer = section.querySelector('.hero-slider');
                const dotsContainer = section.querySelector('.flex.justify-center.mt-8.space-x-4');

                console.log('Slides container found:', !!slidesContainer);
                console.log('Dots container found:', !!dotsContainer);

                if (slidesContainer && dotsContainer) {
                    const slideCount = slidesContainer.querySelectorAll('.slide').length;
                    const newSlideIndex = slideCount;

                    console.log('Current slide count:', slideCount);
                    console.log('New slide index:', newSlideIndex);

                    // Create new slide
                    const newSlide = document.createElement('div');
                    newSlide.className = 'slide text-center';
                    newSlide.innerHTML = `
                        <h1 class="hero-text text-6xl md:text-8xl text-[var(--madas-dark-moss)] mb-4">
                            NEW SLIDE<br>
                            <span class="text-[var(--madas-pop-pink)]">TITLE</span>
                        </h1>
                        <p class="hero-text text-2xl md:text-3xl text-[var(--madas-dark-moss)]">
                            NEW SUBTITLE
                        </p>
                    `;

                    // Create new dot
                    const newDot = document.createElement('button');
                    newDot.className = 'slider-dot w-3 h-3 rounded-full bg-gray-300 hover:bg-[var(--madas-pop-pink)] transition-all duration-300';
                    newDot.setAttribute('data-slide', newSlideIndex);

                    // Add to containers
                    slidesContainer.appendChild(newSlide);
                    dotsContainer.appendChild(newDot);

                    // Reinitialize hero slider
                    if (section.heroSliderInstance) {
                        section.heroSliderInstance.destroy();
                    }
                    section.heroSliderInstance = new HeroSlider(section);

                    // Update editor slide list live
                    this.updateSlideListLive(section);

                    console.log('New slide added successfully');
                    this.showSuccessMessage('New slide added successfully!');
                } else {
                    console.error('Slides container or dots container not found');
                    console.error('Slides container:', slidesContainer);
                    console.error('Dots container:', dotsContainer);
                    this.showErrorMessage('Could not find slides container. Please make sure you are in a slider section.');
                }
            }

            editSlide(section, slideIndex) {
                const slide = section.querySelectorAll('.slide')[slideIndex];
                if (slide) {
                    const h1 = slide.querySelector('h1');
                    const p = slide.querySelector('p');

                    // Show slide editor section
                    const slideEditorSection = document.getElementById('slide-editor-section');
                    const currentSlideNumber = document.getElementById('current-slide-number');

                    if (slideEditorSection && currentSlideNumber) {
                        slideEditorSection.style.display = 'block';
                        currentSlideNumber.textContent = slideIndex + 1;

                        // Populate editor with current slide data
                        const titleContent = document.getElementById('slide-title-content');
                        const subtitleContent = document.getElementById('slide-subtitle-content');

                        if (titleContent && h1) {
                            titleContent.innerHTML = h1.innerHTML;
                        }
                        if (subtitleContent && p) {
                            subtitleContent.textContent = p.textContent;
                        }

                        // Populate slide-specific styling controls with current values
                        this.populateSlideStylingControls(slide);

                        // Store current slide index for saving
                        slideEditorSection.dataset.currentSlideIndex = slideIndex;
                    }
                }
            }

            removeSlide(section, slideIndex) {
                const slides = section.querySelectorAll('.slide');
                const dots = section.querySelectorAll('.slider-dot');

                if (slides.length > 1 && slides[slideIndex] && dots[slideIndex]) {
                    // Remove slide and dot
                    slides[slideIndex].remove();
                    dots[slideIndex].remove();

                    // Update data-slide attributes for remaining dots
                    const remainingDots = section.querySelectorAll('.slider-dot');
                    remainingDots.forEach((dot, index) => {
                        dot.setAttribute('data-slide', index);
                    });

                    // Reinitialize hero slider
                    if (section.heroSliderInstance) {
                        section.heroSliderInstance.destroy();
                    }
                    section.heroSliderInstance = new HeroSlider(section);

                    // Update editor slide list live
                    this.updateSlideListLive(section);
                }
            }

            saveSlideChanges(section) {
                const slideEditorSection = document.getElementById('slide-editor-section');
                const slideIndex = parseInt(slideEditorSection.dataset.currentSlideIndex);
                const slide = section.querySelectorAll('.slide')[slideIndex];

                if (slide) {
                    const titleContent = document.getElementById('slide-title-content');
                    const subtitleContent = document.getElementById('slide-subtitle-content');
                    const bgColor = document.getElementById('slide-bg-color')?.value;
                    const bgImage = document.getElementById('slide-bg-image')?.files[0];

                    // Update slide content
                    const h1 = slide.querySelector('h1');
                    const p = slide.querySelector('p');

                    if (h1 && titleContent) {
                        h1.innerHTML = titleContent.innerHTML;
                    }
                    if (p && subtitleContent) {
                        p.textContent = subtitleContent.textContent;
                    }

                    // Update background
                    if (bgColor) {
                        slide.style.backgroundColor = bgColor;
                    }

                    // Handle background image
                    if (bgImage) {
                        const reader = new FileReader();
                        reader.onload = function (e) {
                            slide.style.backgroundImage = `url(${e.target.result})`;
                            slide.style.backgroundSize = 'cover';
                            slide.style.backgroundPosition = 'center';
                        };
                        reader.readAsDataURL(bgImage);
                    }

                    // Hide slide editor
                    slideEditorSection.style.display = 'none';

                    // Refresh editor to update slide list
                    this.openComponentEditor(section);
                }
            }

            setupRichTextEditors() {
                // Setup rich text editor functionality
                document.querySelectorAll('.rich-text-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.preventDefault();
                        const command = e.target.closest('.rich-text-btn').dataset.command;
                        document.execCommand(command, false, null);

                        // Update active state
                        document.querySelectorAll('.rich-text-btn').forEach(b => b.classList.remove('active'));
                        e.target.closest('.rich-text-btn').classList.add('active');

                        // Apply changes live to slide
                        this.applyRichTextChangesLive();
                    });
                });

                // Color picker functionality
                document.querySelectorAll('.rich-text-color').forEach(colorPicker => {
                    colorPicker.addEventListener('change', (e) => {
                        document.execCommand('foreColor', false, e.target.value);
                        this.applyRichTextChangesLive();
                    });
                });

                // Font size functionality
                document.querySelectorAll('.rich-text-select').forEach(select => {
                    select.addEventListener('change', (e) => {
                        const fontSize = e.target.value;
                        const content = e.target.closest('.rich-text-editor').querySelector('.rich-text-content');
                        if (content) {
                            content.className = `rich-text-content ${fontSize}`;
                        }
                        this.applyRichTextChangesLive();
                    });
                });

                // Live content updates
                document.querySelectorAll('.rich-text-content').forEach(content => {
                    content.addEventListener('input', () => {
                        this.applyRichTextChangesLive();
                    });
                });
            }

            applyRichTextChangesLive() {
                const slideEditorSection = document.getElementById('slide-editor-section');
                if (slideEditorSection && slideEditorSection.dataset.currentSlideIndex !== undefined) {
                    const slideIndex = parseInt(slideEditorSection.dataset.currentSlideIndex);
                    const currentSection = document.querySelector('.canvas-section.selected');

                    if (currentSection) {
                        const slide = currentSection.querySelectorAll('.slide')[slideIndex];
                        if (slide) {
                            const titleContent = document.getElementById('slide-title-content');
                            const subtitleContent = document.getElementById('slide-subtitle-content');

                            if (titleContent) {
                                const h1 = slide.querySelector('h1');
                                if (h1) {
                                    h1.innerHTML = titleContent.innerHTML;
                                }
                            }

                            if (subtitleContent) {
                                const p = slide.querySelector('p');
                                if (p) {
                                    p.textContent = subtitleContent.textContent;
                                }
                            }
                        }
                    }
                }
            }

            updateSlideListLive(section) {
                // Get current slide data
                const slides = section.querySelectorAll('.slide');
                const slideData = Array.from(slides).map((slide, index) => {
                    const h1 = slide.querySelector('h1');
                    const p = slide.querySelector('p');
                    return {
                        title: h1 ? h1.innerHTML : `Slide ${index + 1} Title`,
                        subtitle: p ? p.textContent : `Slide ${index + 1} Subtitle`,
                        index: index
                    };
                });

                // Update the slides list in the editor
                const slidesList = document.getElementById('slider-slides-list');
                if (slidesList) {
                    slidesList.innerHTML = slideData.map((slide, index) => `
                        <div class="slide-item" data-slide-index="${index}">
                            <div class="slide-item-header">
                                <span class="slide-number">Slide ${index + 1}</span>
                                <div class="slide-item-controls">
                                    <button type="button" class="btn-edit-slide" data-slide-index="${index}">Edit</button>
                                    <button type="button" class="btn-remove-slide" data-slide-index="${index}"></button>
                                </div>
                            </div>
                            <div class="slide-preview">
                                <div class="slide-preview-content">
                                    <div class="slide-preview-title">${slide.title.replace(/<[^>]*>/g, '').substring(0, 30)}...</div>
                                    <div class="slide-preview-subtitle">${slide.subtitle.substring(0, 50)}...</div>
                                </div>
                            </div>
                        </div>
                    `).join('');

                    // Re-attach event listeners for the new buttons
                    this.attachSlideListEventListeners(section);
                }
            }

            attachSlideListEventListeners(section) {
                // Edit slide buttons
                document.querySelectorAll('.btn-edit-slide').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const slideIndex = parseInt(e.target.dataset.slideIndex);
                        this.editSlide(section, slideIndex);
                    });
                });

                // Remove slide buttons
                document.querySelectorAll('.btn-remove-slide').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const slideIndex = parseInt(e.target.dataset.slideIndex);
                        this.removeSlide(section, slideIndex);
                    });
                });
            }

            populateSlideStylingControls(slide) {
                // Slide background color
                const bgColor = slide.style.backgroundColor || '#ffffff';
                const bgColorPicker = document.getElementById('slide-bg-color');
                const bgColorText = document.getElementById('slide-bg-color-text');
                if (bgColorPicker && bgColorText) {
                    bgColorPicker.value = this.rgbToHex(bgColor) || '#ffffff';
                    bgColorText.value = this.rgbToHex(bgColor) || '#ffffff';
                }

                // Slide background image
                const bgImage = slide.style.backgroundImage;
                if (bgImage && bgImage !== 'none') {
                    const preview = document.getElementById('slide-bg-preview');
                    if (preview) {
                        preview.innerHTML = `<img src="${bgImage.replace(/url\(['"]?(.*?)['"]?\)/, '$1')}" style="max-width: 200px; max-height: 150px; border-radius: 4px;">`;
                    }
                }
            }

            rgbToHex(rgb) {
                if (rgb.startsWith('#')) return rgb;
                const match = rgb.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);
                if (match) {
                    const r = parseInt(match[1]);
                    const g = parseInt(match[2]);
                    const b = parseInt(match[3]);
                    return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
                }
                return rgb;
            }

            hideMenuItemModal() {
                console.log('hideMenuItemModal called');
                const modal = document.getElementById('menu-item-modal');
                console.log('Modal found for hiding:', modal);
                if (modal) {
                    modal.classList.remove('active');
                    console.log('Modal hidden');

                    // Clear flag to allow section editor to close normally
                    this.menuModalOpen = false;
                } else {
                    console.error('Modal not found for hiding!');
                }
            }

            setupMenuItemModalListeners() {
                // Only set up listeners if they haven't been set up already
                if (this.menuModalListenersSetup) {
                    return;
                }

                console.log('Setting up menu item modal listeners...');

                // Close modal button
                const closeBtn = document.getElementById('close-menu-modal');
                if (closeBtn) {
                    closeBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.hideMenuItemModal();
                    });
                }

                // Cancel button
                const cancelBtn = document.getElementById('cancel-menu-item');
                if (cancelBtn) {
                    cancelBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.hideMenuItemModal();
                    });
                }

                // Add menu item confirm button
                const confirmBtn = document.getElementById('add-menu-item-confirm');
                if (confirmBtn) {
                    confirmBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.addMenuItem();
                    });
                }

                // Modal backdrop
                const modal = document.getElementById('menu-item-modal');
                if (modal) {
                    modal.addEventListener('click', (e) => {
                        if (e.target.id === 'menu-item-modal') {
                            this.hideMenuItemModal();
                        }
                    });
                }

                this.menuModalListenersSetup = true;
                console.log('Menu item modal listeners set up successfully');
            }

            addMenuItem() {
                console.log('addMenuItem called');
                const name = document.getElementById('menu-item-name')?.value;
                const collection = document.getElementById('menu-item-collection')?.value;

                console.log('Name:', name, 'Collection:', collection);

                if (!name) {
                    console.log('No name provided, showing error message');
                    this.showSuccessMessage('Please enter a menu item name');
                    return;
                }

                const menuItemsContainer = document.getElementById('navbar-menu-items');
                console.log('Menu items container found:', menuItemsContainer);

                if (menuItemsContainer) {
                    const menuItem = document.createElement('div');
                    menuItem.className = 'menu-item';
                    menuItem.dataset.index = Date.now();

                    menuItem.innerHTML = `
                        <span class="menu-item-text">${name}</span>
                        <span class="menu-item-collection">${collection || 'No Collection'}</span>
                        <button type="button" class="btn-remove-menu-item" data-index="${menuItem.dataset.index}"></button>
                    `;

                    menuItemsContainer.appendChild(menuItem);
                    console.log('Menu item added to container');

                    // Add remove event listener to new button
                    const removeBtn = menuItem.querySelector('.btn-remove-menu-item');
                    removeBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        menuItem.remove();
                        // Update navbar directly without regenerating editor
                        const currentSection = document.querySelector('.canvas-section.selected');
                        if (currentSection) {
                            this.updateNavbarMenuItems(currentSection);
                        }
                    });
                } else {
                    console.error('Menu items container not found!');
                }

                this.hideMenuItemModal();
                this.showSuccessMessage('Menu item added successfully!');

                // Update navbar directly without regenerating editor
                const currentSection = document.querySelector('.canvas-section.selected');
                console.log('Current section for live update:', currentSection);
                if (currentSection) {
                    this.updateNavbarMenuItems(currentSection);
                } else {
                    console.error('No current section found for live update!');
                }
            }

            updateNavbarMenuItems(section) {
                console.log('Updating navbar menu items only...');

                // Get menu items from the menu items container
                const menuItems = Array.from(document.querySelectorAll('#navbar-menu-items .menu-item')).map(item => ({
                    text: item.querySelector('.menu-item-text').textContent,
                    collection: item.querySelector('.menu-item-collection').textContent.replace('No Collection', '')
                }));

                // Get styling options from editor
                const textColor = document.getElementById('navbar-text-color')?.value || '#2b4a24';
                const hoverColor = document.getElementById('navbar-hover-color')?.value || '#f0c9e0';
                const fontFamily = document.getElementById('navbar-font-family')?.value || 'var(--madas-font-family)';
                const fontWeight = document.getElementById('navbar-font-weight')?.value || '500';
                const fontSize = document.getElementById('navbar-font-size')?.value || '16';
                const isUppercase = document.getElementById('navbar-text-uppercase')?.checked || true;
                const enableHover = document.getElementById('navbar-enable-hover')?.checked || true;
                const hoverEffect = document.getElementById('navbar-hover-effect')?.value || 'color';
                const hoverDuration = document.getElementById('navbar-hover-duration')?.value || '0.3';

                // Update menu links (desktop and mobile)
                const menuContainer = section.querySelector('.navbar-menu');
                const mobileMenuContainer = section.querySelector('.navbar-mobile-menu');

                if (menuItems.length > 0) {
                    // Desktop menu links with custom styling
                    const desktopMenuLinks = menuItems.map(item => {
                        const textTransform = isUppercase ? 'uppercase' : 'none';
                        let hoverStyle = '';

                        if (enableHover) {
                            switch (hoverEffect) {
                                case 'color':
                                    hoverStyle = `onmouseover="this.style.color='${hoverColor}'" onmouseout="this.style.color='${textColor}'"`;
                                    break;
                                case 'underline':
                                    hoverStyle = `onmouseover="this.style.textDecoration='underline'; this.style.color='${hoverColor}'" onmouseout="this.style.textDecoration='none'; this.style.color='${textColor}'"`;
                                    break;
                                case 'background':
                                    hoverStyle = `onmouseover="this.style.backgroundColor='${hoverColor}20'; this.style.color='${hoverColor}'" onmouseout="this.style.backgroundColor='transparent'; this.style.color='${textColor}'"`;
                                    break;
                                case 'scale':
                                    hoverStyle = `onmouseover="this.style.transform='scale(1.05)'; this.style.color='${hoverColor}'" onmouseout="this.style.transform='scale(1)'; this.style.color='${textColor}'"`;
                                    break;
                            }
                        }

                        // Generate link that returns to navbar section in builder
                        return `<a href="#" class="nav-link navbar-link" data-collection="${item.collection}" onclick="event.preventDefault(); window.builder.selectNavbarSection(); return false;" style="color: ${textColor}; text-decoration: none; font-weight: ${fontWeight}; font-family: ${fontFamily}; font-size: ${fontSize}px; transition: all ${hoverDuration}s ease; text-transform: ${textTransform}; cursor: pointer;" ${hoverStyle}>${item.text}</a>`;
                    }).join('');

                    // Mobile menu links with custom styling
                    const mobileMenuLinks = menuItems.map(item => {
                        const textTransform = isUppercase ? 'uppercase' : 'none';
                        let hoverStyle = '';

                        if (enableHover) {
                            switch (hoverEffect) {
                                case 'color':
                                    hoverStyle = `onmouseover="this.style.color='${hoverColor}'" onmouseout="this.style.color='${textColor}'"`;
                                    break;
                                case 'underline':
                                    hoverStyle = `onmouseover="this.style.textDecoration='underline'; this.style.color='${hoverColor}'" onmouseout="this.style.textDecoration='none'; this.style.color='${textColor}'"`;
                                    break;
                                case 'background':
                                    hoverStyle = `onmouseover="this.style.backgroundColor='${hoverColor}20'; this.style.color='${hoverColor}'" onmouseout="this.style.backgroundColor='transparent'; this.style.color='${textColor}'"`;
                                    break;
                                case 'scale':
                                    hoverStyle = `onmouseover="this.style.transform='scale(1.05)'; this.style.color='${hoverColor}'" onmouseout="this.style.transform='scale(1)'; this.style.color='${textColor}'"`;
                                    break;
                            }
                        }

                        // Generate link that returns to navbar section in builder
                        return `<a href="#" class="navbar-link block py-3 transition-colors font-medium" data-collection="${item.collection}" onclick="event.preventDefault(); window.builder.selectNavbarSection(); return false;" style="color: ${textColor}; font-family: ${fontFamily}; font-weight: ${fontWeight}; font-size: ${fontSize}px; text-transform: ${textTransform}; transition: all ${hoverDuration}s ease; cursor: pointer;" ${hoverStyle}>${item.text}</a>`;
                    }).join('');

                    if (menuContainer) {
                        menuContainer.innerHTML = desktopMenuLinks;
                    }

                    if (mobileMenuContainer) {
                        mobileMenuContainer.innerHTML = mobileMenuLinks;
                    }
                } else {
                    // Clear containers if no menu items
                    if (menuContainer) {
                        menuContainer.innerHTML = '';
                    }
                    if (mobileMenuContainer) {
                        mobileMenuContainer.innerHTML = '';
                    }
                }

                // Update search bar hover effect
                this.updateSearchBarHover(section, hoverColor, hoverDuration, enableHover);

                console.log('Navbar menu items updated successfully');
            }

            updateSearchBarHover(section, hoverColor, hoverDuration, enableHover) {
                const searchInput = section.querySelector('.navbar-search-input');
                if (searchInput && enableHover) {
                    searchInput.style.transition = `border-color ${hoverDuration}s ease`;
                    searchInput.addEventListener('focus', () => {
                        searchInput.style.borderColor = hoverColor;
                    });
                    searchInput.addEventListener('blur', () => {
                        searchInput.style.borderColor = '#e5e7eb';
                    });
                }
            }

            setupMobileMenuToggle(section) {
                const mobileToggle = section.querySelector('.navbar-mobile-toggle');
                const mobileMenu = section.querySelector('.navbar-mobile-menu');
                const mobileSearch = section.querySelector('.navbar-mobile-search');

                console.log('Setting up mobile menu toggle...');
                console.log('Mobile toggle found:', mobileToggle);
                console.log('Mobile menu found:', mobileMenu);
                console.log('Mobile search found:', mobileSearch);

                if (mobileToggle && mobileMenu) {
                    console.log('Adding click event listener to mobile toggle');
                    mobileToggle.addEventListener('click', (e) => {
                        console.log('Mobile toggle clicked!');
                        e.stopPropagation();
                        mobileMenu.classList.toggle('active');

                        // Close search bar if open
                        if (mobileSearch) {
                            mobileSearch.classList.remove('active');
                        }

                        // Update toggle icon
                        const icon = mobileToggle.querySelector('.material-icons');
                        if (mobileMenu.classList.contains('active')) {
                            icon.textContent = 'close';
                            console.log('Menu opened, icon changed to close');
                        } else {
                            icon.textContent = 'menu';
                            console.log('Menu closed, icon changed to menu');
                        }
                    });

                    // Close mobile menu when clicking outside
                    document.addEventListener('click', (e) => {
                        if (!section.contains(e.target) && mobileMenu.classList.contains('active')) {
                            mobileMenu.classList.remove('active');
                            const icon = mobileToggle.querySelector('.material-icons');
                            icon.textContent = 'menu';
                        }
                    });

                    // Close mobile menu when clicking on a menu link
                    mobileMenu.addEventListener('click', (e) => {
                        if (e.target.classList.contains('navbar-link')) {
                            mobileMenu.classList.remove('active');
                            const icon = mobileToggle.querySelector('.material-icons');
                            icon.textContent = 'menu';
                        }
                    });
                }

                // Setup search icon functionality for mobile
                this.setupMobileSearchToggle(section);
            }

            setupMobileSearchToggle(section) {
                const searchIcon = section.querySelector('.navbar-search');
                const mobileSearch = section.querySelector('.navbar-mobile-search');
                const mobileMenu = section.querySelector('.navbar-mobile-menu');

                if (searchIcon && mobileSearch) {
                    searchIcon.addEventListener('click', (e) => {
                        e.stopPropagation();

                        // Close mobile menu if open
                        if (mobileMenu) {
                            mobileMenu.classList.remove('active');
                            const toggleIcon = section.querySelector('.navbar-mobile-toggle .material-icons');
                            if (toggleIcon) {
                                toggleIcon.textContent = 'menu';
                            }
                        }

                        // Toggle search bar
                        mobileSearch.classList.toggle('active');

                        // Focus on search input when opened
                        if (mobileSearch.classList.contains('active')) {
                            const searchInput = mobileSearch.querySelector('input');
                            if (searchInput) {
                                setTimeout(() => searchInput.focus(), 100);
                            }
                        }
                    });

                    // Close search bar when clicking outside
                    document.addEventListener('click', (e) => {
                        if (!section.contains(e.target) && mobileSearch.classList.contains('active')) {
                            mobileSearch.classList.remove('active');
                        }
                    });

                    // Handle search input
                    const searchInput = mobileSearch.querySelector('input');
                    if (searchInput) {
                        searchInput.addEventListener('keypress', (e) => {
                            if (e.key === 'Enter') {
                                const searchTerm = e.target.value.trim();
                                if (searchTerm) {
                                    console.log('Searching for:', searchTerm);
                                    // Here you can add your search functionality
                                    this.showSuccessMessage(`Searching for: ${searchTerm}`);
                                    mobileSearch.classList.remove('active');
                                    e.target.value = '';
                                }
                            }
                        });
                    }
                }
            }

            applySectionChanges(section) {
                console.log('Applying changes to section:', section.dataset.type);

                const sectionType = section.dataset.type;

                switch (sectionType) {
                    case 'hero-slider':
                        this.applyHeroSliderChanges(section);
                        break;
                    case 'hero-banner':
                        this.applyHeroBannerChanges(section);
                        break;
                    case 'product-slider':
                        this.applyProductSliderChanges(section);
                        break;
                    case 'product-grid':
                        this.applyProductGridChanges(section);
                        break;
                    case 'announcement-bar':
                        this.applyPremiumAnnouncementBarChanges(section);
                        break;
                    case 'testimonials':
                        this.applyTestimonialsChanges(section);
                        break;
                    case 'newsletter':
                        this.applyNewsletterChanges(section);
                        break;
                    case 'contact-form':
                        this.applyContactFormChanges(section);
                        break;
                    case 'navbar':
                        this.applyNavbarChanges(section);
                        break;
                    default:
                        this.applyDefaultChanges(section);
                }

                this.showSuccessMessage('Section updated successfully!');
            }

            applyHeroSliderChanges(section) {
                const title = document.getElementById('hero-title')?.value;
                const subtitle = document.getElementById('hero-subtitle')?.value;
                const buttonText = document.getElementById('hero-button')?.value;
                const bgColor = document.getElementById('hero-bg-color')?.value;

                if (title) section.querySelector('h1').textContent = title;
                if (subtitle) section.querySelector('p').textContent = subtitle;
                if (buttonText) section.querySelector('button').textContent = buttonText;
                if (bgColor) {
                    const contentDiv = section.querySelector('div:last-child');
                    const validBgColor = bgColor.startsWith('#') ? bgColor : '#667eea';
                    contentDiv.style.background = `linear-gradient(135deg, ${validBgColor} 0%, #764ba2 100%)`;
                }
            }

            applyHeroBannerChanges(section) {
                const title = document.getElementById('banner-title')?.value;
                const subtitle = document.getElementById('banner-subtitle')?.value;
                const button1 = document.getElementById('banner-button1')?.value;
                const button2 = document.getElementById('banner-button2')?.value;
                const bgColor = document.getElementById('banner-bg-color')?.value;

                if (title) section.querySelector('h1').textContent = title;
                if (subtitle) section.querySelector('p').textContent = subtitle;
                if (button1) section.querySelector('button:first-of-type').textContent = button1;
                if (button2) section.querySelector('button:last-of-type').textContent = button2;
                if (bgColor) {
                    const contentDiv = section.querySelector('div:last-child');
                    const validBgColor = bgColor.startsWith('#') ? bgColor : '#667eea';
                    contentDiv.style.background = `linear-gradient(135deg, ${validBgColor} 0%, #764ba2 100%)`;
                }
            }

            applyProductSliderChanges(section) {
                const title = document.getElementById('slider-title')?.value;
                const subtitle = document.getElementById('slider-subtitle')?.value;
                const bgColor = document.getElementById('slider-bg-color')?.value;

                if (title) section.querySelector('h2').textContent = title;
                if (subtitle) section.querySelector('p').textContent = subtitle;
                if (bgColor) {
                    const contentDiv = section.querySelector('div:last-child');
                    contentDiv.style.background = bgColor;
                }
            }

            applyProductGridChanges(section) {
                const title = document.getElementById('grid-title')?.value;
                const subtitle = document.getElementById('grid-subtitle')?.value;
                const bgColor = document.getElementById('grid-bg-color')?.value;

                if (title) section.querySelector('h2').textContent = title;
                if (subtitle) section.querySelector('p').textContent = subtitle;
                if (bgColor) {
                    const contentDiv = section.querySelector('div:last-child');
                    contentDiv.style.background = bgColor;
                }
            }

            applyAnnouncementBarChanges(section) {
                const text = document.getElementById('announcement-text')?.value;
                const bgColor = document.getElementById('announcement-bg-color')?.value;
                const textColor = document.getElementById('announcement-text-color')?.value;

                if (text) section.querySelector('span').textContent = text;
                if (bgColor) {
                    const contentDiv = section.querySelector('div:last-child');
                    contentDiv.style.background = bgColor;
                }
                if (textColor) {
                    const contentDiv = section.querySelector('div:last-child');
                    contentDiv.style.color = textColor;
                }
            }

            applyTestimonialsChanges(section) {
                const title = document.getElementById('testimonials-title')?.value;
                const subtitle = document.getElementById('testimonials-subtitle')?.value;
                const bgColor = document.getElementById('testimonials-bg-color')?.value;

                if (title) section.querySelector('h2').textContent = title;
                if (subtitle) section.querySelector('p').textContent = subtitle;
                if (bgColor) {
                    const contentDiv = section.querySelector('div:last-child');
                    contentDiv.style.background = bgColor;
                }
            }

            applyNewsletterChanges(section) {
                const title = document.getElementById('newsletter-title')?.value;
                const subtitle = document.getElementById('newsletter-subtitle')?.value;
                const buttonText = document.getElementById('newsletter-button')?.value;
                const bgColor = document.getElementById('newsletter-bg-color')?.value;

                if (title) section.querySelector('h2').textContent = title;
                if (subtitle) section.querySelector('p').textContent = subtitle;
                if (buttonText) section.querySelector('button').textContent = buttonText;
                if (bgColor) {
                    const contentDiv = section.querySelector('div:last-child');
                    const validBgColor = bgColor.startsWith('#') ? bgColor : '#667eea';
                    contentDiv.style.background = `linear-gradient(135deg, ${validBgColor} 0%, #fcb69f 100%)`;
                }
            }

            applyContactFormChanges(section) {
                const title = document.getElementById('contact-title')?.value;
                const subtitle = document.getElementById('contact-subtitle')?.value;
                const buttonText = document.getElementById('contact-button')?.value;
                const bgColor = document.getElementById('contact-bg-color')?.value;

                if (title) section.querySelector('h2').textContent = title;
                if (subtitle) section.querySelector('p').textContent = subtitle;
                if (buttonText) section.querySelector('button').textContent = buttonText;
                if (bgColor) {
                    const contentDiv = section.querySelector('div:last-child');
                    contentDiv.style.background = bgColor;
                }
            }

            applyNavbarChanges(section) {
                console.log('Applying comprehensive navbar changes...');
                console.log('Section ID:', section.id, 'Type:', section.dataset.type);

                // Get logo settings
                const logoDisplay = document.getElementById('navbar-logo-display')?.value;
                const logoTextValue = document.getElementById('navbar-logo-text')?.value;
                const logoTextColor = document.getElementById('navbar-logo-text-color')?.value;
                const logoBgColor = document.getElementById('navbar-logo-bg')?.value;
                const logoImageFile = document.getElementById('navbar-logo-image')?.files[0];
                const logoLinkUrl = document.getElementById('navbar-logo-link')?.value;

                // Menu items are handled separately by updateNavbarMenuItems method
                // No need to read them here to prevent duplication

                // User Authentication section removed

                // Get icon settings
                const cartIcon = document.getElementById('navbar-cart-icon')?.checked;
                const favoriteIcon = document.getElementById('navbar-favorite-icon')?.checked;
                const searchIcon = document.getElementById('navbar-search-icon')?.checked;
                const profileIcon = document.getElementById('navbar-profile-icon')?.checked;

                // Get styling
                const bgColor = document.getElementById('navbar-bg-color')?.value;

                // Update logo display
                const logoContainer = section.querySelector('.navbar-logo-container');
                const logoImageElement = section.querySelector('.navbar-logo-image');
                const logoTextElement = section.querySelector('.navbar-logo-text');

                if (logoContainer) {
                    // Show/hide logo image and text based on display option
                    if (logoDisplay === 'logo-only') {
                        if (logoImageElement) logoImageElement.style.display = 'flex';
                        if (logoTextElement) logoTextElement.style.display = 'none';
                    } else if (logoDisplay === 'text-only') {
                        if (logoImageElement) logoImageElement.style.display = 'none';
                        if (logoTextElement) logoTextElement.style.display = 'block';
                    } else { // logo-text (default)
                        if (logoImageElement) logoImageElement.style.display = 'flex';
                        if (logoTextElement) logoTextElement.style.display = 'block';
                    }
                }

                // Update logo text content and styling
                const logoTextEl = section.querySelector('.navbar-logo-text');
                if (logoTextEl) {
                    if (logoTextValue) {
                        logoTextEl.textContent = logoTextValue;
                    }
                    if (logoTextColor) {
                        logoTextEl.style.color = logoTextColor;
                    }
                    if (logoBgColor) {
                        logoTextEl.style.background = logoBgColor;
                        logoTextEl.style.padding = '4px 8px';
                        logoTextEl.style.borderRadius = '4px';
                    }
                }

                // Handle image upload if provided
                if (logoImageFile) {
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        // Update both logo image elements (desktop and mobile)
                        const logoImages = section.querySelectorAll('.navbar-logo-img');
                        logoImages.forEach(img => {
                            img.src = e.target.result;
                        });
                    };
                    reader.readAsDataURL(logoImageFile);
                }

                // Update logo link URL
                const logoLinkElement = section.querySelector('.navbar-logo-link');
                if (logoLinkElement && logoLinkUrl) {
                    logoLinkElement.href = logoLinkUrl;
                }

                // Menu items are handled by updateNavbarMenuItems method
                // No need to update them here to prevent duplication

                // User Authentication buttons removed

                // Update icon visibility
                const actionsContainer = section.querySelector('.navbar-actions-container');
                if (actionsContainer) {
                    // Show/hide cart icon
                    const cartBtn = section.querySelector('.navbar-cart-btn');
                    if (cartBtn) {
                        cartBtn.style.display = cartIcon ? 'block' : 'none';
                    }

                    // Show/hide favorite icon
                    const favoriteBtn = section.querySelector('.navbar-favorite-btn');
                    if (favoriteBtn) {
                        favoriteBtn.style.display = favoriteIcon ? 'block' : 'none';
                    }

                    // Show/hide profile icon
                    const profileContainer = section.querySelector('.navbar-profile-container');
                    if (profileContainer) {
                        profileContainer.style.display = profileIcon ? 'block' : 'none';
                    }
                }

                // Update search bar visibility
                const searchContainer = section.querySelector('.navbar-search-container');
                if (searchContainer) {
                    searchContainer.style.display = searchIcon ? 'block' : 'none';
                }

                // Update background color
                if (bgColor) {
                    const navElement = section.querySelector('nav');
                    if (navElement) navElement.style.background = bgColor;
                }

                console.log('Navbar changes applied successfully!');
            }

            createNavbarIconsContainer(section) {
                const navElement = section.querySelector('nav');
                const iconsContainer = document.createElement('div');
                iconsContainer.className = 'navbar-icons';
                iconsContainer.style.cssText = `
                    display: flex; 
                    align-items: center; 
                    gap: 4px; 
                    margin-left: auto;
                    margin-right: 16px;
                    flex-shrink: 0;
                `;

                // Insert before the buttons
                const buttonsContainer = section.querySelector('.navbar-buttons');
                if (buttonsContainer) {
                    navElement.insertBefore(iconsContainer, buttonsContainer);
                } else {
                    navElement.appendChild(iconsContainer);
                }

                return iconsContainer;
            }

            applyDefaultChanges(section) {
                console.log('Applying comprehensive changes to section:', section.dataset.type);

                // Get all form values
                const title = document.getElementById('section-title')?.value;
                const content = document.getElementById('section-content')?.value;
                const buttonText = document.getElementById('section-button-text')?.value;
                const buttonLink = document.getElementById('section-button-link')?.value;

                const bgColor = document.getElementById('default-bg-color')?.value;
                const textColor = document.getElementById('section-text-color')?.value;
                const buttonBg = document.getElementById('section-button-bg')?.value;
                const buttonTextColor = document.getElementById('section-button-text-color')?.value;
                const bgImage = document.getElementById('section-bg-image')?.value;
                const bgPosition = document.getElementById('section-bg-position')?.value;

                const padding = document.getElementById('padding-slider')?.value;
                const margin = document.getElementById('margin-slider')?.value;
                const textAlign = document.getElementById('section-text-align')?.value;
                const sectionWidth = document.getElementById('section-width')?.value;

                const borderWidth = document.getElementById('border-width-slider')?.value;
                const borderRadius = document.getElementById('border-radius-slider')?.value;
                const shadowIntensity = document.getElementById('shadow-slider')?.value;
                const borderColor = document.getElementById('border-color')?.value;
                const borderStyle = document.getElementById('border-style')?.value;

                const fontFamily = document.getElementById('section-font-family')?.value;
                const fontSize = document.getElementById('font-size-slider')?.value;
                const fontWeight = document.getElementById('section-font-weight')?.value;
                const lineHeight = document.getElementById('line-height-slider')?.value;

                const contentDiv = section.querySelector('div:last-child');
                if (!contentDiv) return;

                // Apply content changes
                if (title) {
                    const titleElement = contentDiv.querySelector('h1, h2, h3');
                    if (titleElement) titleElement.textContent = title;
                }

                if (content) {
                    const contentElement = contentDiv.querySelector('p');
                    if (contentElement) contentElement.textContent = content;
                }

                if (buttonText) {
                    const buttonElement = contentDiv.querySelector('button, .btn');
                    if (buttonElement) buttonElement.textContent = buttonText;
                }

                if (buttonLink) {
                    const linkElement = contentDiv.querySelector('a');
                    if (linkElement) linkElement.href = buttonLink;
                }

                // Apply styling changes
                if (bgColor) {
                    contentDiv.style.backgroundColor = bgColor;
                }

                if (textColor) {
                    contentDiv.style.color = textColor;
                }

                if (buttonBg) {
                    const buttonElement = contentDiv.querySelector('button, .btn');
                    if (buttonElement) buttonElement.style.backgroundColor = buttonBg;
                }

                if (buttonTextColor) {
                    const buttonElement = contentDiv.querySelector('button, .btn');
                    if (buttonElement) buttonElement.style.color = buttonTextColor;
                }

                if (bgImage) {
                    contentDiv.style.backgroundImage = `url('${bgImage}')`;
                    contentDiv.style.backgroundSize = 'cover';
                    contentDiv.style.backgroundPosition = bgPosition || 'center';
                    contentDiv.style.backgroundRepeat = 'no-repeat';
                }

                // Apply layout changes
                if (padding !== undefined) {
                    contentDiv.style.padding = padding + 'px';
                }

                if (margin !== undefined) {
                    contentDiv.style.margin = margin + 'px';
                }

                if (textAlign) {
                    contentDiv.style.textAlign = textAlign;
                }

                if (sectionWidth) {
                    contentDiv.style.width = sectionWidth;
                    if (sectionWidth !== '100%') {
                        contentDiv.style.margin = '0 auto';
                    }
                }

                // Apply border and effects
                if (borderWidth !== undefined && borderColor && borderStyle) {
                    if (borderStyle === 'none') {
                        contentDiv.style.border = 'none';
                    } else {
                        contentDiv.style.border = `${borderWidth}px ${borderStyle} ${borderColor}`;
                    }
                }

                if (borderRadius !== undefined) {
                    contentDiv.style.borderRadius = borderRadius + 'px';
                }

                if (shadowIntensity !== undefined) {
                    const shadowValues = [
                        'none',
                        '0 2px 4px rgba(0, 0, 0, 0.1)',
                        '0 4px 8px rgba(0, 0, 0, 0.15)',
                        '0 8px 16px rgba(0, 0, 0, 0.2)'
                    ];
                    contentDiv.style.boxShadow = shadowValues[parseInt(shadowIntensity)];
                }

                // Apply typography
                if (fontFamily) {
                    contentDiv.style.fontFamily = fontFamily;
                }

                if (fontSize !== undefined) {
                    contentDiv.style.fontSize = fontSize + 'px';
                }

                if (fontWeight) {
                    contentDiv.style.fontWeight = fontWeight;
                }

                if (lineHeight !== undefined) {
                    contentDiv.style.lineHeight = lineHeight;
                }

                console.log('All changes applied successfully!');
            }

            resetSectionChanges(section) {
                console.log('Resetting changes for section:', section.dataset.type);

                // Close and reopen the editor to reset all fields
                this.closeComponentEditor();
                setTimeout(() => {
                    this.openComponentEditor(section);
                }, 100);

                this.showSuccessMessage('Section reset to original values!');
            }

            setupLeftSidebar() {
                console.log('Setting up left sidebar...');

                // Tool selection
                const sidebarIcons = document.querySelectorAll('.sidebar-icon');
                sidebarIcons.forEach(icon => {
                    icon.addEventListener('click', () => {
                        // Remove active class from all icons
                        sidebarIcons.forEach(i => i.classList.remove('active'));
                        // Add active class to clicked icon
                        icon.classList.add('active');

                        const tool = icon.dataset.tool;
                        console.log('Tool selected:', tool);
                        this.switchToTool(tool);
                    });
                });
            }
            switchToTool(toolName) {
                console.log('Switching to tool:', toolName);

                // Update active tool
                this.currentTool = toolName;

                // Show appropriate panel content
                switch (toolName) {
                    case 'sections':
                        this.showSectionsPanel();
                        break;
                    case 'components':
                        this.showComponentsPanel();
                        break;
                    case 'styling':
                        this.showStylingPanel();
                        break;
                    case 'layers':
                        this.showLayersPanel();
                        break;
                    case 'assets':
                        this.showAssetsPanel();
                        break;
                    case 'settings':
                        this.showSettingsPanel();
                        break;
                }

                this.showSuccessMessage(`Switched to ${toolName.charAt(0).toUpperCase() + toolName.slice(1)} tool`);
            }

            showSectionsPanel() {
                // Show the sections panel (default behavior)
                document.querySelector('.right-panel > div:first-child').style.display = 'block';
                document.querySelector('.right-panel > div:nth-child(2)').style.display = 'block';
                document.getElementById('component-editor').style.display = 'none';
            }

            showComponentsPanel() {
                // Show components panel
                this.showSectionsPanel(); // For now, same as sections
                console.log('Components panel shown');
            }

            showStylingPanel() {
                // Show styling panel
                this.showSectionsPanel(); // For now, same as sections
                console.log('Styling panel shown');
            }

            showLayersPanel() {
                // Show layers panel
                this.showSectionsPanel(); // For now, same as sections
                console.log('Layers panel shown');
            }

            showAssetsPanel() {
                // Show assets panel
                this.showSectionsPanel(); // For now, same as sections
                console.log('Assets panel shown');
            }

            showSettingsPanel() {
                // Show settings panel
                this.showSectionsPanel(); // For now, same as sections
                console.log('Settings panel shown');
            }

            setupSpacingControl() {
                console.log('Setting up spacing control...');

                // Spacing button
                const spacingBtn = document.getElementById('spacing-btn');
                if (spacingBtn) {
                    spacingBtn.addEventListener('click', () => {
                        console.log('Spacing button clicked!');
                        this.showSpacingModal();
                    });
                }

                // Close spacing modal
                const closeSpacingModal = document.getElementById('close-spacing-modal');
                if (closeSpacingModal) {
                    closeSpacingModal.addEventListener('click', () => {
                        this.hideSpacingModal();
                    });
                }

                // Spacing modal backdrop
                const spacingModal = document.getElementById('spacing-modal');
                if (spacingModal) {
                    spacingModal.addEventListener('click', (e) => {
                        if (e.target.id === 'spacing-modal') {
                            this.hideSpacingModal();
                        }
                    });
                }

                // Spacing slider
                const spacingSlider = document.getElementById('spacing-slider');
                const spacingValue = document.getElementById('spacing-value');
                if (spacingSlider && spacingValue) {
                    spacingSlider.addEventListener('input', (e) => {
                        spacingValue.textContent = e.target.value + 'px';
                    });
                }

                // Spacing presets
                const spacingPresets = document.querySelectorAll('.spacing-preset');
                spacingPresets.forEach(preset => {
                    preset.addEventListener('click', () => {
                        // Remove active class from all presets
                        spacingPresets.forEach(p => p.classList.remove('active'));
                        // Add active class to clicked preset
                        preset.classList.add('active');

                        const value = preset.dataset.value;
                        if (spacingSlider && spacingValue) {
                            spacingSlider.value = value;
                            spacingValue.textContent = value + 'px';
                        }
                    });
                });

                // Apply spacing button
                const applySpacing = document.getElementById('apply-spacing');
                if (applySpacing) {
                    applySpacing.addEventListener('click', () => {
                        this.applySectionSpacing();
                    });
                }

                // Reset spacing button
                const resetSpacing = document.getElementById('reset-spacing');
                if (resetSpacing) {
                    resetSpacing.addEventListener('click', () => {
                        this.resetSectionSpacing();
                    });
                }
            }

            showSpacingModal() {
                console.log('Showing spacing modal...');
                const modal = document.getElementById('spacing-modal');
                if (modal) {
                    modal.classList.add('active');

                    // Set current spacing value
                    const currentSpacing = this.getCurrentSectionSpacing();
                    const spacingSlider = document.getElementById('spacing-slider');
                    const spacingValue = document.getElementById('spacing-value');

                    if (spacingSlider && spacingValue) {
                        spacingSlider.value = currentSpacing;
                        spacingValue.textContent = currentSpacing + 'px';
                    }

                    // Update preset selection
                    const spacingPresets = document.querySelectorAll('.spacing-preset');
                    spacingPresets.forEach(preset => {
                        preset.classList.remove('active');
                        if (parseInt(preset.dataset.value) === currentSpacing) {
                            preset.classList.add('active');
                        }
                    });
                }
            }

            hideSpacingModal() {
                console.log('Hiding spacing modal...');
                const modal = document.getElementById('spacing-modal');
                if (modal) {
                    modal.classList.remove('active');
                }
            }

            getCurrentSectionSpacing() {
                const sections = document.querySelectorAll('.canvas-section');
                if (sections.length > 0) {
                    const firstSection = sections[0];
                    const margin = window.getComputedStyle(firstSection).margin;
                    return parseInt(margin) || 20;
                }
                return 20; // Default spacing
            }

            applySectionSpacing() {
                const spacingSlider = document.getElementById('spacing-slider');
                if (!spacingSlider) return;

                const spacingValue = parseInt(spacingSlider.value);
                console.log('Applying section spacing:', spacingValue + 'px');

                // Apply spacing to all sections
                const sections = document.querySelectorAll('.canvas-section');
                sections.forEach(section => {
                    section.style.margin = spacingValue + 'px';
                });

                this.hideSpacingModal();
                this.showSuccessMessage(`Section spacing updated to ${spacingValue}px!`);
            }

            resetSectionSpacing() {
                console.log('Resetting section spacing to default...');

                // Reset to default spacing (20px)
                const sections = document.querySelectorAll('.canvas-section');
                sections.forEach(section => {
                    section.style.margin = '20px';
                });

                // Update modal values
                const spacingSlider = document.getElementById('spacing-slider');
                const spacingValue = document.getElementById('spacing-value');

                if (spacingSlider && spacingValue) {
                    spacingSlider.value = 20;
                    spacingValue.textContent = '20px';
                }

                // Update preset selection
                const spacingPresets = document.querySelectorAll('.spacing-preset');
                spacingPresets.forEach(preset => {
                    preset.classList.remove('active');
                    if (preset.dataset.value === '20') {
                        preset.classList.add('active');
                    }
                });

                this.showSuccessMessage('Section spacing reset to default (20px)!');
            }

            setupStyleSectionButton() {
                console.log('Setting up style section button...');

                const styleBtn = document.getElementById('style-section-btn');
                console.log('Style section button found:', !!styleBtn);

                if (styleBtn) {
                    console.log('Adding click event listener to style section button');
                    styleBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        console.log('Style section button clicked!');
                        try {
                            this.openSectionStylingPanel();
                        } catch (error) {
                            console.error('Error opening section styling panel:', error);
                            this.showSuccessMessage('Error opening styling panel. Please try again.');
                        }
                    });
                    console.log('Style section button event listener added successfully');
                } else {
                    console.error('Style section button not found!');
                    // Try again after a short delay
                    setTimeout(() => {
                        console.log('Retrying to find style section button...');
                        const retryBtn = document.getElementById('style-section-btn');
                        if (retryBtn) {
                            console.log('Found style section button on retry');
                            retryBtn.addEventListener('click', (e) => {
                                e.preventDefault();
                                e.stopPropagation();
                                console.log('Style section button clicked! (retry)');
                                try {
                                    this.openSectionStylingPanel();
                                } catch (error) {
                                    console.error('Error opening section styling panel:', error);
                                    this.showSuccessMessage('Error opening styling panel. Please try again.');
                                }
                            });
                        } else {
                            console.error('Style section button still not found on retry');
                        }
                    }, 1000);
                }
            }

            openSectionStylingPanel() {
                console.log('Opening section styling panel...');

                // Open the component editor with styling panel
                const editor = document.getElementById('component-editor');
                const editorContent = document.getElementById('editor-content');

                console.log('Editor found:', !!editor);
                console.log('Editor content found:', !!editorContent);

                if (editor && editorContent) {
                    console.log('Hiding sections panel and showing editor...');

                    // Hide the sections panel and show the editor
                    const sectionsPanel = document.querySelector('.right-panel > div:first-child');
                    const secondPanel = document.querySelector('.right-panel > div:nth-child(2)');

                    console.log('Sections panel found:', !!sectionsPanel);
                    console.log('Second panel found:', !!secondPanel);

                    if (sectionsPanel) sectionsPanel.style.display = 'none';
                    if (secondPanel) secondPanel.style.display = 'none';
                    editor.style.display = 'block';

                    console.log('Generating section selection panel...');
                    // Generate the section selection panel
                    const stylingHTML = this.generateSectionSelectionPanel();
                    console.log('Section selection panel HTML length:', stylingHTML.length);

                    // Set the styling panel content
                    editorContent.innerHTML = stylingHTML;

                    // Update panel title
                    const panelTitle = document.getElementById('panel-title');
                    if (panelTitle) {
                        panelTitle.textContent = 'Style Section';
                        console.log('Panel title updated to: Style Section');
                    } else {
                        console.error('Panel title element not found!');
                    }

                    console.log('Setting up section selection...');
                    // Setup section selection
                    this.setupSectionSelection();

                    console.log('Section styling panel opened successfully - ready for selection');
                    this.showSuccessMessage('Style Section panel opened! Select a section to style.');
                } else {
                    console.error('Component editor elements not found!');
                    this.showSuccessMessage('Error: Could not find styling panel elements.');
                }
            }

            generateSectionSelectionPanel() {
                // Get all sections on the canvas
                const sections = document.querySelectorAll('.canvas-section');

                if (sections.length === 0) {
                    return `
                        <div class="editor-form">
                            <div class="editor-section">
                                <h4 class="editor-section-title">No Sections Available</h4>
                                <p style="color: #6b7280; text-align: center; padding: 20px;">
                                    No sections found on the canvas. Please add some sections first.
                                </p>
                                <button class="btn btn-primary" onclick="document.querySelector('.right-panel > div:first-child').style.display = 'block'; document.getElementById('component-editor').style.display = 'none';" style="width: 100%; margin-top: 16px;">
                                    <span class="material-icons" style="font-size: 16px; margin-right: 8px;">add</span>
                                    Add Section
                                </button>
                            </div>
                        </div>
                    `;
                }

                const sectionListHTML = Array.from(sections).map((section, index) => `
                    <div class="section-selection-item" data-section-id="${section.id}" data-section-type="${section.dataset.type}" style="
                        padding: 12px; 
                        border: 2px solid #e5e7eb; 
                        border-radius: 8px; 
                        margin-bottom: 8px; 
                        cursor: pointer; 
                        transition: all 0.2s ease;
                        background: white;
                    ">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div style="
                                width: 40px; 
                                height: 40px; 
                                border-radius: 6px; 
                                background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); 
                                display: flex; 
                                align-items: center; 
                                justify-content: center;
                                color: white;
                                font-size: 18px;
                            ">
                                ${index + 1}
                            </div>
                            <div style="flex: 1;">
                                <div style="font-weight: 600; color: #1f2937; margin-bottom: 4px;">
                                    ${section.dataset.type.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase())}
                                </div>
                                <div style="font-size: 12px; color: #6b7280;">
                                    ID: ${section.id}
                                </div>
                            </div>
                            <div class="material-icons" style="color: #9ca3af; font-size: 20px;">chevron_right</div>
                        </div>
                    </div>
                `).join('');

                return `
                    <div class="editor-form">
                        <div class="editor-section">
                            <h4 class="editor-section-title">Select Section to Style</h4>
                            <p style="color: #6b7280; margin-bottom: 16px;">
                                Click on any section below to open its styling controls.
                            </p>
                            
                            <div id="section-selection-list">
                                ${sectionListHTML}
                            </div>
                            
                            <button class="btn btn-secondary" onclick="document.querySelector('.right-panel > div:first-child').style.display = 'block'; document.getElementById('component-editor').style.display = 'none';" style="width: 100%; margin-top: 16px;">
                                <span class="material-icons" style="font-size: 16px; margin-right: 8px;">arrow_back</span>
                                Back to Sections
                            </button>
                        </div>
                    </div>
                `;
            }

            setupSectionSelection() {
                // Add hover effects and click handlers to section selection items
                const sectionItems = document.querySelectorAll('.section-selection-item');

                sectionItems.forEach(item => {
                    // Hover effects
                    item.addEventListener('mouseenter', () => {
                        item.style.borderColor = '#3b82f6';
                        item.style.boxShadow = '0 4px 12px rgba(59, 130, 246, 0.15)';
                        item.style.transform = 'translateY(-1px)';
                    });

                    item.addEventListener('mouseleave', () => {
                        item.style.borderColor = '#e5e7eb';
                        item.style.boxShadow = 'none';
                        item.style.transform = 'translateY(0)';
                    });

                    // Click handler
                    item.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();

                        const sectionId = item.dataset.sectionId;
                        const sectionType = item.dataset.sectionType;

                        // Find the actual section element
                        const section = document.getElementById(sectionId);
                        if (section) {
                            console.log('Section selected for styling:', sectionType, 'ID:', sectionId);

                            // Select the section visually (this will trigger selectSection but won't open editor due to styling mode check)
                            document.querySelectorAll('.canvas-section').forEach(s => s.classList.remove('selected'));
                            section.classList.add('selected');

                            // Open styling panel for this section
                            this.openStylingForSection(section);
                        }
                    });
                });
            }

            openStylingForSection(section) {
                console.log('Opening styling panel for section:', section.dataset.type);

                // Generate the comprehensive styling panel for the selected section
                const stylingHTML = this.generateSectionStylingPanel(section);

                // Update the editor content
                const editorContent = document.getElementById('editor-content');
                if (editorContent) {
                    editorContent.innerHTML = stylingHTML;

                    // Update panel title
                    const panelTitle = document.getElementById('panel-title');
                    if (panelTitle) {
                        panelTitle.textContent = `Style ${section.dataset.type.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase())}`;
                    }

                    // Setup styling controls
                    this.setupSectionStylingControls(section);

                    // Setup apply and reset buttons
                    this.setupStylingPanelButtons(section);

                    console.log('Section styling panel opened for:', section.dataset.type);
                }
            }

            generateSectionStylingPanel(section) {
                // Get current section styles
                const currentMargin = section.style.margin || '20px';
                const currentPadding = section.style.padding || '20px';
                const currentBorderRadius = section.style.borderRadius || '8px';
                const currentBorder = section.style.border || 'none';
                const currentBoxShadow = section.style.boxShadow || 'none';

                // Parse current values
                const marginValue = parseInt(currentMargin) || 20;
                const paddingValue = parseInt(currentPadding) || 20;
                const borderRadiusValue = parseInt(currentBorderRadius) || 8;
                const borderWidthValue = currentBorder.includes('px') ? parseInt(currentBorder.split('px')[0]) : 0;

                return `
                    <div class="editor-form">
                        <div class="editor-section">
                            <h4 class="editor-section-title">Section Spacing</h4>
                            
                            <div class="form-group">
                                <label class="form-label">Section Type</label>
                                <input type="text" class="form-input" value="${section.dataset.type}" readonly>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Margin (outside spacing)</label>
                                <div class="range-group">
                                    <input type="range" class="form-range" id="section-margin" min="0" max="100" value="${marginValue}">
                                    <div class="range-value">
                                        <span id="section-margin-value">${marginValue}px</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Padding (inside spacing)</label>
                                <div class="range-group">
                                    <input type="range" class="form-range" id="section-padding" min="0" max="100" value="${paddingValue}">
                                    <div class="range-value">
                                        <span id="section-padding-value">${paddingValue}px</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="editor-section">
                            <h4 class="editor-section-title">Borders</h4>
                            
                            <div class="form-group">
                                <label class="form-label">Border Radius (rounded corners)</label>
                                <div class="range-group">
                                    <input type="range" class="form-range" id="section-border-radius" min="0" max="50" value="${borderRadiusValue}">
                                    <div class="range-value">
                                        <span id="section-border-radius-value">${borderRadiusValue}px</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Border Width</label>
                                <div class="range-group">
                                    <input type="range" class="form-range" id="section-border-width" min="0" max="10" value="${borderWidthValue}">
                                    <div class="range-value">
                                        <span id="section-border-width-value">${borderWidthValue}px</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Border Color</label>
                                <div class="color-picker">
                                    <input type="color" class="color-input" id="section-border-color" value="#e5e7eb">
                                    <input type="text" class="form-input" id="section-border-color-text" value="#e5e7eb">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Border Style</label>
                                <select class="form-select" id="section-border-style">
                                    <option value="none">None</option>
                                    <option value="solid">Solid</option>
                                    <option value="dashed">Dashed</option>
                                    <option value="dotted">Dotted</option>
                                    <option value="double">Double</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="editor-section">
                            <h4 class="editor-section-title">Shadows</h4>
                            
                            <div class="form-group">
                                <label class="form-label">Box Shadow</label>
                                <select class="form-select" id="section-box-shadow">
                                    <option value="none" ${currentBoxShadow === 'none' ? 'selected' : ''}>None</option>
                                    <option value="0 1px 3px rgba(0, 0, 0, 0.1)" ${currentBoxShadow.includes('0 1px 3px') ? 'selected' : ''}>Small</option>
                                    <option value="0 4px 6px rgba(0, 0, 0, 0.1)" ${currentBoxShadow.includes('0 4px 6px') ? 'selected' : ''}>Medium</option>
                                    <option value="0 10px 15px rgba(0, 0, 0, 0.1)" ${currentBoxShadow.includes('0 10px 15px') ? 'selected' : ''}>Large</option>
                                    <option value="0 20px 25px rgba(0, 0, 0, 0.1)" ${currentBoxShadow.includes('0 20px 25px') ? 'selected' : ''}>Extra Large</option>
                                    <option value="0 0 0 3px rgba(59, 130, 246, 0.5)" ${currentBoxShadow.includes('0 0 0 3px') ? 'selected' : ''}>Glow</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="editor-section">
                            <h4 class="editor-section-title">Quick Actions</h4>
                            
                            <div class="form-group">
                                <button class="btn btn-primary" id="apply-section-styles" style="width: 100%; margin-bottom: 8px;">
                                    <span class="material-icons" style="font-size: 16px; margin-right: 8px;">save</span>
                                    Apply & Save
                                </button>
                                
                                <button class="btn btn-secondary" id="reset-section-styles" style="width: 100%; margin-bottom: 8px;">
                                    <span class="material-icons" style="font-size: 16px; margin-right: 8px;">refresh</span>
                                    Reset to Default
                                </button>
                                
                                <button class="btn btn-secondary" id="back-to-selection" style="width: 100%;">
                                    <span class="material-icons" style="font-size: 16px; margin-right: 8px;">arrow_back</span>
                                    Back to Selection
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }

            setupStylingPanelButtons(section) {
                // Apply & Save button
                const applyBtn = document.getElementById('apply-section-styles');
                if (applyBtn) {
                    applyBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.applySectionStyles(section);
                        this.saveTheme();
                    });
                }

                // Reset button
                const resetBtn = document.getElementById('reset-section-styles');
                if (resetBtn) {
                    resetBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.resetSectionStyles(section);
                    });
                }

                // Back to Selection button
                const backBtn = document.getElementById('back-to-selection');
                if (backBtn) {
                    backBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.openSectionStylingPanel(); // Go back to section selection
                    });
                }
            }

            setupConnectSections() {
                console.log('Setting up connect sections...');

                const connectBtn = document.getElementById('connect-sections-btn');
                if (connectBtn) {
                    connectBtn.addEventListener('click', () => {
                        console.log('Connect sections button clicked!');
                        this.connectAllSections();
                    });
                }
            }

            connectAllSections() {
                console.log('Connecting all sections...');

                const sections = document.querySelectorAll('.canvas-section');
                if (sections.length === 0) {
                    this.showSuccessMessage('No sections to connect');
                    return;
                }

                // Remove all margins to connect sections
                sections.forEach(section => {
                    console.log('Setting margin to 0 for section:', section.dataset.type, 'ID:', section.id);
                    section.style.margin = '0';
                });

                console.log('Sections connected, now saving theme...');

                // Auto-save the theme with the new section styles
                try {
                    this.saveTheme();
                    console.log('Theme saved successfully after connecting sections');
                } catch (error) {
                    console.error('Error saving theme after connecting sections:', error);
                    this.showSuccessMessage('Sections connected but failed to save. Please save manually.');
                    return;
                }

                this.showSuccessMessage('All sections connected and saved successfully!');
            }

            applySectionSpacingValue(spacingValue) {
                console.log('Applying section spacing value:', spacingValue + 'px');

                const sections = document.querySelectorAll('.canvas-section');
                sections.forEach(section => {
                    section.style.margin = spacingValue + 'px';
                });

                // Auto-save the theme with the new section styles
                this.saveTheme();
            }

            setupGridLayout() {
                console.log('Setting up grid layout...');

                const gridBtn = document.getElementById('grid-layout-btn');
                if (gridBtn) {
                    gridBtn.addEventListener('click', () => {
                        console.log('Grid layout button clicked!');
                        this.enterGridSelectionMode();
                    });
                }

                // Close grid modal
                const closeGridModal = document.getElementById('close-grid-modal');
                if (closeGridModal) {
                    closeGridModal.addEventListener('click', () => {
                        this.hideGridLayoutModal();
                    });
                }

                // Grid modal backdrop
                const gridModal = document.getElementById('grid-layout-modal');
                if (gridModal) {
                    gridModal.addEventListener('click', (e) => {
                        if (e.target.id === 'grid-layout-modal') {
                            this.hideGridLayoutModal();
                        }
                    });
                }

                // Grid gap slider
                const gridGapSlider = document.getElementById('grid-gap-slider');
                const gridGapValue = document.getElementById('grid-gap-value');
                if (gridGapSlider && gridGapValue) {
                    gridGapSlider.addEventListener('input', (e) => {
                        gridGapValue.textContent = e.target.value + 'px';
                    });
                }

                // Grid layout presets
                const gridPresets = document.querySelectorAll('.grid-preset');
                gridPresets.forEach(preset => {
                    preset.addEventListener('click', () => {
                        // Remove active class from all presets
                        gridPresets.forEach(p => p.classList.remove('active'));
                        // Add active class to clicked preset
                        preset.classList.add('active');
                    });
                });

                // Apply grid button
                const applyGrid = document.getElementById('apply-grid');
                if (applyGrid) {
                    applyGrid.addEventListener('click', () => {
                        this.applyGridLayout();
                    });
                }

                // Reset grid button
                const resetGrid = document.getElementById('reset-grid');
                if (resetGrid) {
                    resetGrid.addEventListener('click', () => {
                        this.resetGridLayout();
                    });
                }
            }

            enterGridSelectionMode() {
                console.log('Entering grid selection mode...');

                const sections = document.querySelectorAll('.canvas-section');
                if (sections.length === 0) {
                    this.showSuccessMessage('No sections available to select');
                    return;
                }

                if (sections.length < 2) {
                    this.showSuccessMessage('You need at least 2 sections to create a grid layout');
                    return;
                }

                // Clear any existing selections
                this.clearAllSelections();

                // Add selection mode class to canvas
                const canvas = document.getElementById('canvas');
                canvas.classList.add('grid-selection-mode');

                // Show selection instructions
                this.showGridSelectionInstructions();

                // Add click listeners to sections for selection
                this.setupGridSectionSelection();

                // Update grid button to show "Apply Grid" mode
                this.updateGridButtonForSelection();
            }

            showGridSelectionInstructions() {
                // Remove existing instructions if any
                const existingInstructions = document.getElementById('grid-selection-instructions');
                if (existingInstructions) {
                    existingInstructions.remove();
                }

                // Create instruction overlay
                const instructions = document.createElement('div');
                instructions.id = 'grid-selection-instructions';
                instructions.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: rgba(0, 0, 0, 0.9);
                    color: white;
                    padding: 20px 30px;
                    border-radius: 12px;
                    text-align: center;
                    z-index: 10000;
                    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
                    border: 2px solid #3b82f6;
                `;

                instructions.innerHTML = `
                    <div style="margin-bottom: 15px;">
                        <span class="material-icons" style="font-size: 32px; color: #3b82f6; margin-bottom: 10px; display: block;">grid_view</span>
                        <h3 style="margin: 0 0 10px 0; font-size: 18px; font-weight: 600;">Select Sections for Grid Layout</h3>
                        <p style="margin: 0; font-size: 14px; opacity: 0.9;">Click on sections to select them for grid arrangement</p>
                    </div>
                    <div style="display: flex; gap: 10px; justify-content: center; margin-top: 15px;">
                        <button id="apply-grid-selection" style="
                            background: #3b82f6; 
                            color: white; 
                            border: none; 
                            padding: 8px 16px; 
                            border-radius: 6px; 
                            cursor: pointer;
                            font-weight: 500;
                        ">Apply Grid</button>
                        <button id="cancel-grid-selection" style="
                            background: #6b7280; 
                            color: white; 
                            border: none; 
                            padding: 8px 16px; 
                            border-radius: 6px; 
                            cursor: pointer;
                            font-weight: 500;
                        ">Cancel</button>
                    </div>
                `;

                document.body.appendChild(instructions);

                // Add event listeners
                document.getElementById('apply-grid-selection').addEventListener('click', () => {
                    this.applyGridToSelectedSections();
                });

                document.getElementById('cancel-grid-selection').addEventListener('click', () => {
                    this.exitGridSelectionMode();
                });
            }

            setupGridSectionSelection() {
                const sections = document.querySelectorAll('.canvas-section');

                sections.forEach(section => {
                    // Add selection cursor
                    section.style.cursor = 'pointer';

                    // Add click listener for selection
                    section.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.toggleSectionSelection(section);
                    });
                });
            }

            toggleSectionSelection(section) {
                // Toggle section selection
                console.log('Section clicked:', section);
                console.log('Section ID:', section.id);
                console.log('Current classes:', section.className);
                console.log('Has grid-selected:', section.classList.contains('grid-selected'));

                if (section.classList.contains('grid-selected')) {
                    section.classList.remove('grid-selected');
                    section.style.border = '';
                    section.style.backgroundColor = '';
                    console.log('Removed grid-selected class');
                } else {
                    section.classList.add('grid-selected');
                    section.style.border = '3px solid #3b82f6';
                    section.style.backgroundColor = 'rgba(59, 130, 246, 0.1)';
                    console.log('Added grid-selected class');
                }

                console.log('New classes:', section.className);

                // Update instruction text with selection count
                this.updateSelectionCount();
            }

            updateSelectionCount() {
                const selectedCount = document.querySelectorAll('.canvas-section.grid-selected').length;
                // Update selection count
                console.log('Selected count:', selectedCount);

                const instructions = document.getElementById('grid-selection-instructions');
                if (instructions) {
                    const countText = instructions.querySelector('p');
                    if (countText) {
                        countText.textContent = `Click on sections to select them for grid arrangement (${selectedCount} selected)`;
                        console.log('Updated instruction text with count:', selectedCount);
                    }
                } else {
                    console.log('Instructions element not found');
                }
            }

            updateGridButtonForSelection() {
                const gridBtn = document.getElementById('grid-layout-btn');
                if (gridBtn) {
                    gridBtn.innerHTML = `
                        <span class="material-icons" style="font-size: 16px; margin-right: 8px;">check_circle</span>
                        Apply Grid
                    `;
                    gridBtn.style.background = '#10b981';
                    gridBtn.style.color = 'white';
                }
            }

            applyGridToSelectedSections() {
                const selectedSections = document.querySelectorAll('.canvas-section.grid-selected');

                // Apply grid to selected sections
                console.log('Found selected sections:', selectedSections.length);
                console.log('Selected sections:', selectedSections);

                // Debug: Check all sections and their classes
                const allSections = document.querySelectorAll('.canvas-section');
                console.log('All sections on canvas:', allSections.length);
                allSections.forEach((section, index) => {
                    console.log(`Section ${index}:`, {
                        id: section.id,
                        classes: section.className,
                        hasGridSelected: section.classList.contains('grid-selected')
                    });
                });

                if (selectedSections.length < 2) {
                    this.showSuccessMessage('Please select at least 2 sections for grid layout');
                    return;
                }

                // Store selected section IDs for later use
                this.gridSelectedSectionIds = Array.from(selectedSections).map(section => section.id);
                console.log('Stored selected section IDs:', this.gridSelectedSectionIds);

                // Exit selection mode but preserve stored IDs
                this.exitGridSelectionModePreserveIds();

                // Show grid layout modal
                this.showGridLayoutModal();
            }

            exitGridSelectionMode() {
                console.log('Exiting grid selection mode...');

                // Remove selection mode class from canvas
                const canvas = document.getElementById('canvas');
                canvas.classList.remove('grid-selection-mode');

                // Remove selection instructions
                const instructions = document.getElementById('grid-selection-instructions');
                if (instructions) {
                    instructions.remove();
                }

                // Clear all selections
                this.clearAllSelections();

                // Clear stored section IDs
                this.gridSelectedSectionIds = null;

                // Reset grid button
                this.resetGridButton();

                // Remove selection listeners
                this.removeGridSelectionListeners();
            }

            exitGridSelectionModePreserveIds() {
                console.log('Exiting grid selection mode (preserving IDs)...');

                // Remove selection mode class from canvas
                const canvas = document.getElementById('canvas');
                canvas.classList.remove('grid-selection-mode');

                // Remove selection instructions
                const instructions = document.getElementById('grid-selection-instructions');
                if (instructions) {
                    instructions.remove();
                }

                // Clear all selections (but keep stored IDs)
                this.clearAllSelections();

                // DON'T clear stored section IDs - we need them for grid application
                console.log('Preserved stored section IDs:', this.gridSelectedSectionIds);

                // Reset grid button
                this.resetGridButton();

                // Remove selection listeners
                this.removeGridSelectionListeners();
            }

            clearAllSelections() {
                const sections = document.querySelectorAll('.canvas-section');
                sections.forEach(section => {
                    section.classList.remove('grid-selected', 'selected');
                    section.style.border = '';
                    section.style.backgroundColor = '';
                    section.style.cursor = '';
                });
            }

            resetGridButton() {
                const gridBtn = document.getElementById('grid-layout-btn');
                if (gridBtn) {
                    gridBtn.innerHTML = `
                        <span class="material-icons" style="font-size: 16px; margin-right: 8px;">grid_view</span>
                        Grid Layout
                    `;
                    gridBtn.style.background = '';
                    gridBtn.style.color = '';
                }
            }

            removeGridSelectionListeners() {
                const sections = document.querySelectorAll('.canvas-section');
                sections.forEach(section => {
                    // Remove the click listener by cloning the element
                    const newSection = section.cloneNode(true);
                    section.parentNode.replaceChild(newSection, section);
                });
            }

            showGridLayoutModal() {
                console.log('Showing grid layout modal...');
                const modal = document.getElementById('grid-layout-modal');
                if (modal) {
                    modal.classList.add('active');

                    // Set default selection
                    const gridPresets = document.querySelectorAll('.grid-preset');
                    gridPresets.forEach(preset => {
                        preset.classList.remove('active');
                        if (preset.dataset.layout === 'single') {
                            preset.classList.add('active');
                        }
                    });
                }
            }

            hideGridLayoutModal() {
                console.log('Hiding grid layout modal...');
                const modal = document.getElementById('grid-layout-modal');
                if (modal) {
                    modal.classList.remove('active');
                }
            }

            applyGridLayout() {
                const selectedLayout = document.querySelector('.grid-preset.active')?.dataset.layout;
                const gapValue = document.getElementById('grid-gap-slider')?.value || 20;

                if (!selectedLayout) {
                    this.showSuccessMessage('Please select a layout type');
                    return;
                }

                console.log('Applying grid layout:', selectedLayout, 'with gap:', gapValue + 'px');

                // Get selected sections using stored IDs
                let selectedSections = [];
                // Apply grid layout
                console.log('Stored section IDs:', this.gridSelectedSectionIds);

                if (this.gridSelectedSectionIds && this.gridSelectedSectionIds.length > 0) {
                    selectedSections = this.gridSelectedSectionIds.map(id => {
                        const section = document.getElementById(id);
                        console.log(`Looking for section with ID: ${id}, found:`, section);
                        return section;
                    }).filter(section => section);
                    console.log('Found sections by IDs:', selectedSections.length);
                    console.log('Found sections:', selectedSections);
                } else {
                    selectedSections = document.querySelectorAll('.canvas-section.selected');
                    console.log('Using fallback selection method:', selectedSections.length);
                }

                if (selectedSections.length === 0) {
                    this.showSuccessMessage('No sections selected for grid layout');
                    this.hideGridLayoutModal();
                    return;
                }

                if (selectedSections.length === 1) {
                    this.showSuccessMessage('Please select at least 2 sections to apply grid layout');
                    this.hideGridLayoutModal();
                    return;
                }

                console.log('Applying grid to', selectedSections.length, 'selected sections');

                // Create a container for the selected sections if it doesn't exist
                let gridContainer = document.getElementById('grid-container');
                if (!gridContainer) {
                    gridContainer = document.createElement('div');
                    gridContainer.id = 'grid-container';
                    gridContainer.style.position = 'relative';
                    gridContainer.style.margin = '20px 0';
                }

                // Clear existing grid container styles
                gridContainer.style.display = '';
                gridContainer.style.gridTemplateColumns = '';
                gridContainer.style.gridTemplateRows = '';
                gridContainer.style.gap = '';
                gridContainer.style.gridAutoFlow = '';

                // Move selected sections to grid container
                const canvas = document.getElementById('canvas');
                const firstSelectedSection = selectedSections[0];

                // Insert grid container before the first selected section
                if (!gridContainer.parentNode) {
                    canvas.insertBefore(gridContainer, firstSelectedSection);
                }

                // Move all selected sections into the grid container
                selectedSections.forEach(section => {
                    gridContainer.appendChild(section);
                    section.style.margin = '0';
                });

                // Apply grid layout based on selection
                switch (selectedLayout) {
                    case 'single':
                        // Single column - default behavior
                        gridContainer.style.display = 'block';
                        selectedSections.forEach(section => {
                            section.style.width = '100%';
                            section.style.margin = '0 0 ' + gapValue + 'px 0';
                        });
                        break;

                    case 'two':
                        gridContainer.style.display = 'grid';
                        gridContainer.style.gridTemplateColumns = '1fr 1fr';
                        gridContainer.style.gap = gapValue + 'px';
                        break;

                    case 'three':
                        gridContainer.style.display = 'grid';
                        gridContainer.style.gridTemplateColumns = 'repeat(3, 1fr)';
                        gridContainer.style.gap = gapValue + 'px';
                        break;

                    case 'four':
                        gridContainer.style.display = 'grid';
                        gridContainer.style.gridTemplateColumns = 'repeat(4, 1fr)';
                        gridContainer.style.gap = gapValue + 'px';
                        break;

                    case 'masonry':
                        gridContainer.style.display = 'grid';
                        gridContainer.style.gridTemplateColumns = 'repeat(auto-fit, minmax(300px, 1fr))';
                        gridContainer.style.gap = gapValue + 'px';
                        gridContainer.style.gridAutoRows = 'masonry';
                        break;

                    case 'auto':
                        gridContainer.style.display = 'grid';
                        gridContainer.style.gridTemplateColumns = 'repeat(auto-fit, minmax(250px, 1fr))';
                        gridContainer.style.gap = gapValue + 'px';
                        break;
                }

                // Deselect all sections after applying grid
                selectedSections.forEach(section => {
                    section.classList.remove('selected');
                });

                // Clear stored section IDs after successful application
                this.gridSelectedSectionIds = null;

                this.hideGridLayoutModal();
                this.showSuccessMessage(`Grid layout "${selectedLayout}" applied to ${selectedSections.length} selected sections!`);
            }

            resetGridLayout() {
                console.log('Resetting grid layout...');

                const canvas = document.getElementById('canvas');
                const gridContainer = document.getElementById('grid-container');

                if (gridContainer) {
                    // Move all sections back to canvas
                    const sectionsInGrid = Array.from(gridContainer.children);
                    sectionsInGrid.forEach(section => {
                        canvas.appendChild(section);
                        section.style.width = '';
                        section.style.margin = '20px';
                    });

                    // Remove the grid container
                    gridContainer.remove();
                }

                // Reset modal values
                const gridGapSlider = document.getElementById('grid-gap-slider');
                const gridGapValue = document.getElementById('grid-gap-value');

                if (gridGapSlider && gridGapValue) {
                    gridGapSlider.value = 20;
                    gridGapValue.textContent = '20px';
                }

                // Reset preset selection
                const gridPresets = document.querySelectorAll('.grid-preset');
                gridPresets.forEach(preset => {
                    preset.classList.remove('active');
                    if (preset.dataset.layout === 'single') {
                        preset.classList.add('active');
                    }
                });

                this.showSuccessMessage('Grid layout reset to default!');
            }

            // Section creation methods
            createNavbarSection() {
                return `
                    <div class="canvas-section" data-type="navbar" draggable="true">
                        <nav class="navbar" style="background: linear-gradient(135deg, #2D5A27 0%, #4A7C59 100%); color: white; padding: 1rem 2rem; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                            <div class="navbar-brand" style="font-size: 1.5rem; font-weight: 700; color: white; text-decoration: none;">
                                <span class="material-icons" style="margin-right: 0.5rem; vertical-align: middle;">store</span>
                                Your Brand
                            </div>
                            <div class="navbar-menu" style="display: flex; gap: 2rem; align-items: center;">
                                <a href="#" class="navbar-link" style="color: white; text-decoration: none; font-weight: 500; transition: color 0.2s ease;">Home</a>
                                <a href="#" class="navbar-link" style="color: white; text-decoration: none; font-weight: 500; transition: color 0.2s ease;">Products</a>
                                <a href="#" class="navbar-link" style="color: white; text-decoration: none; font-weight: 500; transition: color 0.2s ease;">About</a>
                                <a href="#" class="navbar-link" style="color: white; text-decoration: none; font-weight: 500; transition: color 0.2s ease;">Contact</a>
                            </div>
                            <button class="navbar-mobile-toggle" id="mobile-menu-button" style="display: none; background: none; border: none; color: white; cursor: pointer;">
                                <span class="material-icons">menu</span>
                            </button>
                        </nav>
                        <div class="navbar-mobile-menu hidden" id="mobile-menu" style="background: #2D5A27; padding: 1rem; display: none; flex-direction: column; gap: 1rem;">
                            <a href="#" class="navbar-link" style="color: white; text-decoration: none; font-weight: 500; padding: 0.5rem 0;">Home</a>
                            <a href="#" class="navbar-link" style="color: white; text-decoration: none; font-weight: 500; padding: 0.5rem 0;">Products</a>
                            <a href="#" class="navbar-link" style="color: white; text-decoration: none; font-weight: 500; padding: 0.5rem 0;">About</a>
                            <a href="#" class="navbar-link" style="color: white; text-decoration: none; font-weight: 500; padding: 0.5rem 0;">Contact</a>
                        </div>
                    </div>
                `;
            }

            createHeaderNavSection() {
                return this.createNavbarSection();
            }

            createHeroBannerSection() {
                return `
                    <div class="canvas-section" data-type="hero-banner" draggable="true">
                        <section class="hero-banner" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 4rem 2rem; text-align: center; min-height: 60vh; display: flex; align-items: center; justify-content: center;">
                            <div class="hero-content" style="max-width: 800px;">
                                <h1 style="font-size: 3rem; font-weight: 700; margin-bottom: 1rem; line-height: 1.2;">Welcome to Your Website</h1>
                                <p style="font-size: 1.25rem; margin-bottom: 2rem; opacity: 0.9; line-height: 1.6;">Create amazing experiences with our professional website builder. Build, customize, and launch your dream website in minutes.</p>
                                <div class="hero-buttons" style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                                    <button style="background: white; color: #667eea; padding: 1rem 2rem; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: transform 0.2s;">Get Started</button>
                                    <button style="background: transparent; color: white; padding: 1rem 2rem; border: 2px solid white; border-radius: 8px; font-weight: 600; cursor: pointer; transition: transform 0.2s;">Learn More</button>
                                </div>
                            </div>
                        </section>
                    </div>
                `;
            }

            createHeroSliderSection() {
                return `
                    <div class="canvas-section" data-type="hero-slider" draggable="true">
                        <section class="hero-slider" style="position: relative; height: 70vh; overflow: hidden; background: linear-gradient(45deg, #ff6b6b, #4ecdc4);">
                            <div class="slider-content" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: white; z-index: 2;">
                                <h1 style="font-size: 3.5rem; font-weight: 700; margin-bottom: 1rem;">Amazing Products</h1>
                                <p style="font-size: 1.5rem; margin-bottom: 2rem; opacity: 0.9;">Discover our collection of premium products designed for modern living.</p>
                                <button style="background: white; color: #ff6b6b; padding: 1rem 2.5rem; border: none; border-radius: 50px; font-weight: 600; cursor: pointer; font-size: 1.1rem;">Shop Now</button>
                            </div>
                            <div class="slider-indicators" style="position: absolute; bottom: 2rem; left: 50%; transform: translateX(-50%); display: flex; gap: 0.5rem;">
                                <div style="width: 12px; height: 12px; border-radius: 50%; background: white; opacity: 0.7; cursor: pointer;"></div>
                                <div style="width: 12px; height: 12px; border-radius: 50%; background: white; opacity: 0.3; cursor: pointer;"></div>
                                <div style="width: 12px; height: 12px; border-radius: 50%; background: white; opacity: 0.3; cursor: pointer;"></div>
                            </div>
                        </section>
                    </div>
                `;
            }

            createAboutUsSection() {
                return `
                    <div class="canvas-section" data-type="about-us" draggable="true">
                        <section class="about-us" style="padding: 4rem 2rem; background: #f8fafc;">
                            <div class="container" style="max-width: 1200px; margin: 0 auto;">
                                <div class="about-content" style="display: grid; grid-template-columns: 1fr 1fr; gap: 4rem; align-items: center;">
                                    <div class="about-text">
                                        <h2 style="font-size: 2.5rem; font-weight: 700; color: #1e293b; margin-bottom: 1.5rem;">About Our Company</h2>
                                        <p style="font-size: 1.1rem; color: #64748b; line-height: 1.7; margin-bottom: 1.5rem;">We are passionate about creating innovative solutions that make a difference. Our team of experts works tirelessly to deliver exceptional results for our clients.</p>
                                        <p style="font-size: 1.1rem; color: #64748b; line-height: 1.7; margin-bottom: 2rem;">With over 10 years of experience in the industry, we have built a reputation for excellence and reliability.</p>
                                        <button style="background: #2D5A27; color: white; padding: 1rem 2rem; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">Learn More</button>
                                    </div>
                                    <div class="about-image" style="text-align: center;">
                                        <div style="width: 100%; height: 400px; background: linear-gradient(135deg, #e2e8f0, #cbd5e1); border-radius: 12px; display: flex; align-items: center; justify-content: center; color: #64748b; font-size: 1.2rem;">
                                            <span class="material-icons" style="font-size: 4rem; margin-right: 1rem;">business</span>
                                            Company Image
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </div>
                `;
            }

            createContactFormSection() {
                return `
                    <div class="canvas-section" data-type="contact-form" draggable="true">
                        <section class="contact-form" style="padding: 4rem 2rem; background: white;">
                            <div class="container" style="max-width: 800px; margin: 0 auto;">
                                <div class="contact-header" style="text-align: center; margin-bottom: 3rem;">
                                    <h2 style="font-size: 2.5rem; font-weight: 700; color: #1e293b; margin-bottom: 1rem;">Get In Touch</h2>
                                    <p style="font-size: 1.1rem; color: #64748b;">We'd love to hear from you. Send us a message and we'll respond as soon as possible.</p>
                                </div>
                                <form class="contact-form-content" style="display: grid; gap: 1.5rem;">
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
                                        <input type="text" placeholder="First Name" style="padding: 1rem; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 1rem; transition: border-color 0.2s;">
                                        <input type="text" placeholder="Last Name" style="padding: 1rem; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 1rem; transition: border-color 0.2s;">
                                    </div>
                                    <input type="email" placeholder="Email Address" style="padding: 1rem; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 1rem; transition: border-color 0.2s;">
                                    <input type="text" placeholder="Subject" style="padding: 1rem; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 1rem; transition: border-color 0.2s;">
                                    <textarea placeholder="Your Message" rows="5" style="padding: 1rem; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 1rem; resize: vertical; transition: border-color 0.2s;"></textarea>
                                    <button type="submit" style="background: #2D5A27; color: white; padding: 1rem 2rem; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 1.1rem; transition: background-color 0.2s;">Send Message</button>
                                </form>
                            </div>
                        </section>
                    </div>
                `;
            }

            createNewsletterSection() {
                return `
                    <div class="canvas-section" data-type="newsletter" draggable="true">
                        <section class="newsletter" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 3rem 2rem; text-align: center;">
                            <div class="newsletter-content" style="max-width: 600px; margin: 0 auto;">
                                <h2 style="font-size: 2.5rem; font-weight: 700; margin-bottom: 1rem;">Stay Updated</h2>
                                <p style="font-size: 1.2rem; margin-bottom: 2rem; opacity: 0.9;">Subscribe to our newsletter and never miss out on the latest updates, offers, and news.</p>
                                <form class="newsletter-form" style="display: flex; gap: 1rem; max-width: 400px; margin: 0 auto;">
                                    <input type="email" placeholder="Enter your email" style="flex: 1; padding: 1rem; border: none; border-radius: 8px; font-size: 1rem;">
                                    <button type="submit" style="background: white; color: #667eea; padding: 1rem 2rem; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">Subscribe</button>
                                </form>
                            </div>
                        </section>
                    </div>
                `;
            }

            createTestimonialsSection() {
                return `
                    <div class="canvas-section" data-type="testimonials" draggable="true">
                        <section class="testimonials" style="padding: 4rem 2rem; background: #f8fafc;">
                            <div class="container" style="max-width: 1200px; margin: 0 auto;">
                                <div class="testimonials-header" style="text-align: center; margin-bottom: 3rem;">
                                    <h2 style="font-size: 2.5rem; font-weight: 700; color: #1e293b; margin-bottom: 1rem;">What Our Customers Say</h2>
                                    <p style="font-size: 1.1rem; color: #64748b;">Don't just take our word for it - hear from our satisfied customers.</p>
                                </div>
                                <div class="testimonials-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">
                                    <div class="testimonial-card" style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                                        <div class="testimonial-content" style="margin-bottom: 1.5rem;">
                                            <p style="font-size: 1.1rem; color: #64748b; line-height: 1.6; font-style: italic;">"Excellent service and amazing results. The team went above and beyond to deliver exactly what we needed."</p>
                                        </div>
                                        <div class="testimonial-author" style="display: flex; align-items: center; gap: 1rem;">
                                            <div style="width: 50px; height: 50px; background: #2D5A27; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600;">JD</div>
                                            <div>
                                                <h4 style="font-weight: 600; color: #1e293b; margin: 0;">John Doe</h4>
                                                <p style="color: #64748b; margin: 0; font-size: 0.9rem;">CEO, Company Inc.</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="testimonial-card" style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                                        <div class="testimonial-content" style="margin-bottom: 1.5rem;">
                                            <p style="font-size: 1.1rem; color: #64748b; line-height: 1.6; font-style: italic;">"Professional, reliable, and innovative. Highly recommend their services to anyone looking for quality work."</p>
                                        </div>
                                        <div class="testimonial-author" style="display: flex; align-items: center; gap: 1rem;">
                                            <div style="width: 50px; height: 50px; background: #2D5A27; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600;">JS</div>
                                            <div>
                                                <h4 style="font-weight: 600; color: #1e293b; margin: 0;">Jane Smith</h4>
                                                <p style="color: #64748b; margin: 0; font-size: 0.9rem;">Marketing Director</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </div>
                `;
            }

            createProductSliderSection() {
                return `
                    <div class="canvas-section" data-type="product-slider" draggable="true">
                        <section class="product-slider" style="padding: 4rem 2rem; background: white;">
                            <div class="container" style="max-width: 1200px; margin: 0 auto;">
                                <div class="section-header" style="text-align: center; margin-bottom: 3rem;">
                                    <h2 style="font-size: 2.5rem; font-weight: 700; color: #1e293b; margin-bottom: 1rem;">Featured Products</h2>
                                    <p style="font-size: 1.1rem; color: #64748b;">Discover our most popular and trending products</p>
                                </div>
                                <div class="products-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem;">
                                    <div class="product-card" style="background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: transform 0.2s;">
                                        <div class="product-image" style="height: 200px; background: linear-gradient(135deg, #e2e8f0, #cbd5e1); display: flex; align-items: center; justify-content: center; color: #64748b;">
                                            <span class="material-icons" style="font-size: 3rem;">shopping_bag</span>
                                        </div>
                                        <div class="product-info" style="padding: 1.5rem;">
                                            <h3 style="font-weight: 600; color: #1e293b; margin-bottom: 0.5rem;">Product Name</h3>
                                            <p style="color: #64748b; margin-bottom: 1rem; font-size: 0.9rem;">Product description goes here</p>
                                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                                <span style="font-size: 1.25rem; font-weight: 700; color: #2D5A27;">$99.99</span>
                                                <button style="background: #2D5A27; color: white; padding: 0.5rem 1rem; border: none; border-radius: 6px; cursor: pointer;">Add to Cart</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="product-card" style="background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: transform 0.2s;">
                                        <div class="product-image" style="height: 200px; background: linear-gradient(135deg, #e2e8f0, #cbd5e1); display: flex; align-items: center; justify-content: center; color: #64748b;">
                                            <span class="material-icons" style="font-size: 3rem;">shopping_bag</span>
                                        </div>
                                        <div class="product-info" style="padding: 1.5rem;">
                                            <h3 style="font-weight: 600; color: #1e293b; margin-bottom: 0.5rem;">Product Name</h3>
                                            <p style="color: #64748b; margin-bottom: 1rem; font-size: 0.9rem;">Product description goes here</p>
                                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                                <span style="font-size: 1.25rem; font-weight: 700; color: #2D5A27;">$99.99</span>
                                                <button style="background: #2D5A27; color: white; padding: 0.5rem 1rem; border: none; border-radius: 6px; cursor: pointer;">Add to Cart</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </div>
                `;
            }

            createProductGridSection() {
                return this.createProductSliderSection();
            }

            createImageTextSection() {
                return `
                    <div class="canvas-section" data-type="image-text" draggable="true">
                        <section class="image-text" style="padding: 4rem 2rem; background: white;">
                            <div class="container" style="max-width: 1200px; margin: 0 auto;">
                                <div class="image-text-content" style="display: grid; grid-template-columns: 1fr 1fr; gap: 4rem; align-items: center;">
                                    <div class="image-section">
                                        <div style="width: 100%; height: 400px; background: linear-gradient(135deg, #e2e8f0, #cbd5e1); border-radius: 12px; display: flex; align-items: center; justify-content: center; color: #64748b; font-size: 1.2rem;">
                                            <span class="material-icons" style="font-size: 4rem; margin-right: 1rem;">image</span>
                                            Your Image Here
                                        </div>
                                    </div>
                                    <div class="text-section">
                                        <h2 style="font-size: 2.5rem; font-weight: 700; color: #1e293b; margin-bottom: 1.5rem;">Compelling Headline</h2>
                                        <p style="font-size: 1.1rem; color: #64748b; line-height: 1.7; margin-bottom: 1.5rem;">This is where you tell your story. Explain what makes your product or service unique and why customers should choose you.</p>
                                        <p style="font-size: 1.1rem; color: #64748b; line-height: 1.7; margin-bottom: 2rem;">Use this space to highlight key benefits, features, or any other important information that will help convert visitors into customers.</p>
                                        <button style="background: #2D5A27; color: white; padding: 1rem 2rem; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">Learn More</button>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </div>
                `;
            }

            createHeaderSimpleSection() {
                return `
                    <div class="canvas-section" data-type="header-simple" draggable="true">
                            <!-- Header -->
    <header class="bg-white shadow-sm border-b border-gray-200 fixed top-0 left-0 right-0 z-40 h-16">
        <div class="flex items-center justify-between h-full px-4 lg:px-6">
            <div class="flex items-center space-x-4">
                <button id="menu-toggle" class="lg:hidden text-[var(--madas-primary)] p-2 rounded-lg hover:bg-gray-100">
                    <span class="material-icons">menu</span>
                </button>
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 bg-[var(--madas-primary)] rounded-lg flex items-center justify-center">
                        <span class="text-white font-bold text-sm">M</span>
                    </div>
                    <div>
                        <h1 id="business-name" class="text-xl font-bold text-[var(--madas-primary)]">Loading...</h1>
                        <button id="plan-badge" onclick="window.location.href='/pages/settings.html#plans'"
                            class="text-xs px-2 py-0.5 rounded-full bg-blue-100 text-blue-800 hover:bg-blue-200 transition-colors cursor-pointer">
                            Loading Plan...
                        </button>
                    </div>
                </div>
            </div>

            <div class="flex items-center space-x-4">
                <div class="hidden md:flex items-center space-x-2 text-sm text-gray-600">
                    <span class="material-icons text-[var(--madas-primary)]">notifications</span>
                    <span class="bg-red-500 text-white text-xs rounded-full px-2 py-1">3</span>
                </div>
                <div class="flex items-center space-x-3">
                    <!-- Dark mode toggle button -->
                    <button class="dark-toggle" id="darkToggle" title="Toggle dark mode">
                        <svg id="darkToggleIcon" viewBox="0 0 24 24">
                            <path
                                d="M12 2a1 1 0 0 1 1 1v1a1 1 0 1 1-2 0V3a1 1 0 0 1 1-1zm5.657 3.343a1 1 0 0 1 1.414 0l.707.707a1 1 0 1 1-1.414 1.414l-.707-.707a1 1 0 0 1 0-1.414zM21 11a1 1 0 1 1 0 2h-1a1 1 0 1 1 0-2h1zm-2.929 7.071a1 1 0 0 1 0 1.414l-.707.707a1 1 0 1 1-1.414-1.414l.707-.707a1 1 0 0 1 1.414 0zM12 20a1 1 0 0 1-1-1v-1a1 1 0 1 1 2 0v1a1 1 0 0 1-1 1zm-7.071-2.929a1 1 0 0 1-1.414 0l-.707-.707a1 1 0 1 1 1.414-1.414l.707.707a1 1 0 0 1 0 1.414zM4 13a1 1 0 1 1 0-2H3a1 1 0 1 1 0 2h1zm2.343-7.657a1 1 0 0 1 0 1.414l-.707.707A1 1 0 1 1 4.222 6.05l.707-.707a1 1 0 0 1 1.414 0zM12 6a6 6 0 1 1 0 12A6 6 0 0 1 12 6z" />
                        </svg>
                    </button>
                    <div class="hidden md:block text-right">
                        <p id="user-name" class="text-sm font-medium text-gray-900">Loading...</p>
                        <p id="user-email" class="text-xs text-gray-500">loading@example.com</p>
                    </div>
                    <button id="profile-btn"
                        class="w-8 h-8 bg-[var(--madas-accent)] rounded-full flex items-center justify-center hover:bg-yellow-400 transition-colors cursor-pointer">
                        <span class="text-[var(--madas-primary)] font-bold text-sm" id="user-initial">U</span>
                    </button>
                    <button id="logout-btn"
                        class="text-gray-500 hover:text-[var(--madas-primary)] p-2 rounded-lg hover:bg-gray-100">
                        <span class="material-icons">logout</span>
                    </button>
                </div>
            </div>
        </div>
    </header>
                    </div>
                `;
            }

            createTextContentSection() {
                return `
                    <div class="canvas-section" data-type="text-content" draggable="true">
                        <section class="text-content" style="padding: 4rem 2rem; background: white;">
                            <div class="container" style="max-width: 800px; margin: 0 auto; text-align: center;">
                                <h2 style="font-size: 2.5rem; font-weight: 700; color: #1e293b; margin-bottom: 1.5rem;">Your Content Title</h2>
                                <p style="font-size: 1.1rem; color: #64748b; line-height: 1.7; margin-bottom: 1.5rem;">This is a simple text content section. You can use it to add any text content to your website. Perfect for descriptions, announcements, or any other textual information.</p>
                                <p style="font-size: 1.1rem; color: #64748b; line-height: 1.7;">Customize this section by editing the text, changing colors, fonts, or adding additional elements as needed.</p>
                            </div>
                        </section>
                    </div>
                `;
            }

            createImageGallerySection() {
                return `
                    <div class="canvas-section" data-type="image-gallery" draggable="true">
                        <section class="image-gallery" style="padding: 4rem 2rem; background: #f8fafc;">
                            <div class="container" style="max-width: 1200px; margin: 0 auto;">
                                <div class="gallery-header" style="text-align: center; margin-bottom: 3rem;">
                                    <h2 style="font-size: 2.5rem; font-weight: 700; color: #1e293b; margin-bottom: 1rem;">Image Gallery</h2>
                                    <p style="font-size: 1.1rem; color: #64748b;">Showcase your images in a beautiful gallery layout</p>
                                </div>
                                <div class="gallery-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                                    <div class="gallery-item" style="height: 200px; background: linear-gradient(135deg, #e2e8f0, #cbd5e1); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #64748b;">
                                        <span class="material-icons" style="font-size: 3rem;">image</span>
                                    </div>
                                    <div class="gallery-item" style="height: 200px; background: linear-gradient(135deg, #e2e8f0, #cbd5e1); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #64748b;">
                                        <span class="material-icons" style="font-size: 3rem;">image</span>
                                    </div>
                                    <div class="gallery-item" style="height: 200px; background: linear-gradient(135deg, #e2e8f0, #cbd5e1); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #64748b;">
                                        <span class="material-icons" style="font-size: 3rem;">image</span>
                                    </div>
                                    <div class="gallery-item" style="height: 200px; background: linear-gradient(135deg, #e2e8f0, #cbd5e1); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #64748b;">
                                        <span class="material-icons" style="font-size: 3rem;">image</span>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </div>
                `;
            }

            createFooterSimpleSection() {
                return `
                    <div class="canvas-section" data-type="footer-simple" draggable="true">
                        <footer class="footer-simple" style="background: #1e293b; color: white; padding: 3rem 2rem; text-align: center;">
                            <div class="container" style="max-width: 1200px; margin: 0 auto;">
                                <div class="footer-content">
                                    <h3 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem;">Your Brand</h3>
                                    <p style="color: #94a3b8; margin-bottom: 2rem;">Building amazing websites with professional tools.</p>
                                    <div class="footer-links" style="display: flex; justify-content: center; gap: 2rem; margin-bottom: 2rem; flex-wrap: wrap;">
                                        <a href="#" style="color: #94a3b8; text-decoration: none; transition: color 0.2s;">Privacy Policy</a>
                                        <a href="#" style="color: #94a3b8; text-decoration: none; transition: color 0.2s;">Terms of Service</a>
                                        <a href="#" style="color: #94a3b8; text-decoration: none; transition: color 0.2s;">Contact</a>
                                    </div>
                                    <p style="color: #64748b; font-size: 0.9rem;"> 2024 Your Brand. All rights reserved.</p>
                                </div>
                            </div>
                        </footer>
                    </div>
                `;
            }

            createAnnouncementBarSection() {
                return `
                    <div class="canvas-section" data-type="announcement-bar" draggable="true">
                        <div class="announcement-bar" style="background: #2D5A27; color: white; padding: 0.75rem 2rem; text-align: center; font-weight: 500;">
                            <p style="margin: 0; font-size: 0.9rem;"> Special Offer: Get 20% off on all products this week! <a href="#" style="color: white; text-decoration: underline; margin-left: 0.5rem;">Shop Now</a></p>
                        </div>
                    </div>
                `;
            }

            createModalPopupSection() {
                return `
                    <div class="canvas-section" data-type="modal-popup" draggable="true">
                        <section class="modal-popup" style="padding: 4rem 2rem; background: white; text-align: center;">
                            <div class="container" style="max-width: 600px; margin: 0 auto;">
                                <h2 style="font-size: 2.5rem; font-weight: 700; color: #1e293b; margin-bottom: 1rem;">Modal Popup</h2>
                                <p style="font-size: 1.1rem; color: #64748b; margin-bottom: 2rem;">This section demonstrates a modal popup functionality. Click the button below to see it in action.</p>
                                <button onclick="alert('This is a modal popup!')" style="background: #2D5A27; color: white; padding: 1rem 2rem; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">Open Modal</button>
                            </div>
                        </section>
                    </div>
                `;
            }

            createFloatingButtonSection() {
                return `
                    <div class="canvas-section" data-type="floating-button" draggable="true">
                        <section class="floating-button" style="padding: 4rem 2rem; background: #f8fafc; text-align: center; position: relative;">
                            <div class="container" style="max-width: 600px; margin: 0 auto;">
                                <h2 style="font-size: 2.5rem; font-weight: 700; color: #1e293b; margin-bottom: 1rem;">Floating Action Button</h2>
                                <p style="font-size: 1.1rem; color: #64748b; margin-bottom: 2rem;">This section includes a floating action button that stays visible while scrolling.</p>
                                <div style="height: 200px; background: white; border-radius: 12px; display: flex; align-items: center; justify-content: center; color: #64748b;">
                                    <span class="material-icons" style="font-size: 3rem; margin-right: 1rem;">add</span>
                                    Content Area
                                </div>
                            </div>
                            <button class="floating-btn" style="position: fixed; bottom: 2rem; right: 2rem; width: 60px; height: 60px; background: #2D5A27; color: white; border: none; border-radius: 50%; cursor: pointer; box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 1000;">
                                <span class="material-icons">add</span>
                            </button>
                        </section>
                    </div>
                `;
            }

            createAccordionSection() {
                return `
                    <div class="canvas-section" data-type="accordion" draggable="true">
                        <section class="accordion" style="padding: 4rem 2rem; background: white;">
                            <div class="container" style="max-width: 800px; margin: 0 auto;">
                                <div class="accordion-header" style="text-align: center; margin-bottom: 3rem;">
                                    <h2 style="font-size: 2.5rem; font-weight: 700; color: #1e293b; margin-bottom: 1rem;">Frequently Asked Questions</h2>
                                    <p style="font-size: 1.1rem; color: #64748b;">Find answers to common questions about our services</p>
                                </div>
                                <div class="accordion-items">
                                    <div class="accordion-item" style="border: 1px solid #e2e8f0; border-radius: 8px; margin-bottom: 1rem; overflow: hidden;">
                                        <div class="accordion-header" style="background: #f8fafc; padding: 1.5rem; cursor: pointer; display: flex; justify-content: space-between; align-items: center;">
                                            <h3 style="font-weight: 600; color: #1e293b; margin: 0;">What services do you offer?</h3>
                                            <span class="material-icons" style="color: #64748b;">expand_more</span>
                                        </div>
                                        <div class="accordion-content" style="padding: 1.5rem; background: white;">
                                            <p style="color: #64748b; line-height: 1.6; margin: 0;">We offer a comprehensive range of web development services including custom websites, e-commerce solutions, and digital marketing services.</p>
                                        </div>
                                    </div>
                                    <div class="accordion-item" style="border: 1px solid #e2e8f0; border-radius: 8px; margin-bottom: 1rem; overflow: hidden;">
                                        <div class="accordion-header" style="background: #f8fafc; padding: 1.5rem; cursor: pointer; display: flex; justify-content: space-between; align-items: center;">
                                            <h3 style="font-weight: 600; color: #1e293b; margin: 0;">How long does a project take?</h3>
                                            <span class="material-icons" style="color: #64748b;">expand_more</span>
                                        </div>
                                        <div class="accordion-content" style="padding: 1.5rem; background: white;">
                                            <p style="color: #64748b; line-height: 1.6; margin: 0;">Project timelines vary depending on complexity, but most websites are completed within 2-4 weeks from the start of development.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </div>
                `;
            }

            createTabsSection() {
                return `
                    <div class="canvas-section" data-type="tabs" draggable="true">
                        <section class="tabs" style="padding: 4rem 2rem; background: white;">
                            <div class="container" style="max-width: 800px; margin: 0 auto;">
                                <div class="tabs-header" style="text-align: center; margin-bottom: 3rem;">
                                    <h2 style="font-size: 2.5rem; font-weight: 700; color: #1e293b; margin-bottom: 1rem;">Our Services</h2>
                                    <p style="font-size: 1.1rem; color: #64748b;">Explore our different service offerings</p>
                                </div>
                                <div class="tabs-container">
                                    <div class="tabs-nav" style="display: flex; border-bottom: 2px solid #e2e8f0; margin-bottom: 2rem;">
                                        <button class="tab-btn active" style="background: none; border: none; padding: 1rem 2rem; cursor: pointer; font-weight: 600; color: #2D5A27; border-bottom: 2px solid #2D5A27;">Web Design</button>
                                        <button class="tab-btn" style="background: none; border: none; padding: 1rem 2rem; cursor: pointer; font-weight: 600; color: #64748b;">Development</button>
                                        <button class="tab-btn" style="background: none; border: none; padding: 1rem 2rem; cursor: pointer; font-weight: 600; color: #64748b;">Marketing</button>
                                    </div>
                                    <div class="tabs-content">
                                        <div class="tab-panel active" style="padding: 2rem; background: #f8fafc; border-radius: 8px;">
                                            <h3 style="font-size: 1.5rem; font-weight: 600; color: #1e293b; margin-bottom: 1rem;">Web Design Services</h3>
                                            <p style="color: #64748b; line-height: 1.6;">We create beautiful, user-friendly websites that engage your audience and drive conversions. Our design process focuses on user experience and modern aesthetics.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </div>
                `;
            }

            createCountdownTimerSection() {
                return `
                    <div class="canvas-section" data-type="countdown-timer" draggable="true">
                        <section class="countdown-timer" style="padding: 4rem 2rem; background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%); color: white; text-align: center;">
                            <div class="container" style="max-width: 800px; margin: 0 auto;">
                                <h2 style="font-size: 2.5rem; font-weight: 700; margin-bottom: 1rem;">Limited Time Offer!</h2>
                                <p style="font-size: 1.2rem; margin-bottom: 2rem; opacity: 0.9;">Don't miss out on our special promotion</p>
                                <div class="countdown" style="display: flex; justify-content: center; gap: 2rem; margin-bottom: 2rem;">
                                    <div class="countdown-item" style="text-align: center;">
                                        <div style="font-size: 3rem; font-weight: 700; background: rgba(255,255,255,0.2); padding: 1rem; border-radius: 8px; margin-bottom: 0.5rem;">05</div>
                                        <div style="font-size: 0.9rem; opacity: 0.8;">Days</div>
                                    </div>
                                    <div class="countdown-item" style="text-align: center;">
                                        <div style="font-size: 3rem; font-weight: 700; background: rgba(255,255,255,0.2); padding: 1rem; border-radius: 8px; margin-bottom: 0.5rem;">12</div>
                                        <div style="font-size: 0.9rem; opacity: 0.8;">Hours</div>
                                    </div>
                                    <div class="countdown-item" style="text-align: center;">
                                        <div style="font-size: 3rem; font-weight: 700; background: rgba(255,255,255,0.2); padding: 1rem; border-radius: 8px; margin-bottom: 0.5rem;">30</div>
                                        <div style="font-size: 0.9rem; opacity: 0.8;">Minutes</div>
                                    </div>
                                    <div class="countdown-item" style="text-align: center;">
                                        <div style="font-size: 3rem; font-weight: 700; background: rgba(255,255,255,0.2); padding: 1rem; border-radius: 8px; margin-bottom: 0.5rem;">45</div>
                                        <div style="font-size: 0.9rem; opacity: 0.8;">Seconds</div>
                                    </div>
                                </div>
                                <button style="background: white; color: #ff6b6b; padding: 1rem 2rem; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 1.1rem;">Claim Offer Now</button>
                            </div>
                        </section>
                    </div>
                `;
            }

            createProgressBarSection() {
                return `
                    <div class="canvas-section" data-type="progress-bar" draggable="true">
                        <section class="progress-bar" style="padding: 4rem 2rem; background: #f8fafc;">
                            <div class="container" style="max-width: 800px; margin: 0 auto;">
                                <div class="progress-header" style="text-align: center; margin-bottom: 3rem;">
                                    <h2 style="font-size: 2.5rem; font-weight: 700; color: #1e293b; margin-bottom: 1rem;">Our Progress</h2>
                                    <p style="font-size: 1.1rem; color: #64748b;">Track our achievements and milestones</p>
                                </div>
                                <div class="progress-items">
                                    <div class="progress-item" style="margin-bottom: 2rem;">
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                            <span style="font-weight: 600; color: #1e293b;">Project Completion</span>
                                            <span style="color: #64748b;">85%</span>
                                        </div>
                                        <div style="background: #e2e8f0; height: 8px; border-radius: 4px; overflow: hidden;">
                                            <div style="background: #2D5A27; height: 100%; width: 85%; transition: width 0.3s ease;"></div>
                                        </div>
                                    </div>
                                    <div class="progress-item" style="margin-bottom: 2rem;">
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                            <span style="font-weight: 600; color: #1e293b;">Customer Satisfaction</span>
                                            <span style="color: #64748b;">92%</span>
                                        </div>
                                        <div style="background: #e2e8f0; height: 8px; border-radius: 4px; overflow: hidden;">
                                            <div style="background: #2D5A27; height: 100%; width: 92%; transition: width 0.3s ease;"></div>
                                        </div>
                                    </div>
                                    <div class="progress-item" style="margin-bottom: 2rem;">
                                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                            <span style="font-weight: 600; color: #1e293b;">Team Growth</span>
                                            <span style="color: #64748b;">78%</span>
                                        </div>
                                        <div style="background: #e2e8f0; height: 8px; border-radius: 4px; overflow: hidden;">
                                            <div style="background: #2D5A27; height: 100%; width: 78%; transition: width 0.3s ease;"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </div>
                `;
            }

            loadTemplate(templateType) {
                console.log('Loading template:', templateType);
                const canvas = document.getElementById('canvas');

                // Clear existing content
                canvas.innerHTML = '';

                let templateSections = [];

                switch (templateType) {
                    case 'modern':
                        templateSections = [
                            this.createHeaderNavSection(),
                            this.createHeroSliderSection(),
                            this.createProductSliderSection(),
                            this.createTestimonialsSection(),
                            this.createNewsletterSection()
                        ];
                        break;
                    case 'elegant':
                        templateSections = [
                            this.createHeaderNavSection(),
                            this.createHeroBannerSection(),
                            this.createAboutUsSection(),
                            this.createImageTextSection(),
                            this.createContactFormSection()
                        ];
                        break;
                    case 'vibrant':
                        templateSections = [
                            this.createAnnouncementBarSection(),
                            this.createHeaderNavSection(),
                            this.createHeroSliderSection(),
                            this.createProductGridSection(),
                            this.createNewsletterSection()
                        ];
                        break;
                    case 'minimal':
                        templateSections = [
                            this.createHeaderSimpleSection(),
                            this.createTextContentSection(),
                            this.createImageGallerySection(),
                            this.createFooterSimpleSection()
                        ];
                        break;
                    default:
                        console.log('Unknown template type, using default');
                        return;
                }

                // Add all template sections to canvas
                templateSections.forEach(sectionHTML => {
                    canvas.insertAdjacentHTML('beforeend', sectionHTML);
                });

                // Add unique IDs to all template sections
                const templateSectionsElements = document.querySelectorAll('.canvas-section');
                templateSectionsElements.forEach(section => {
                    if (!section.id) {
                        const sectionId = `section-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
                        section.id = sectionId;
                    }
                });

                // Setup controls for all sections
                this.setupSectionControls();

                this.showSuccessMessage(`Template "${templateType}" loaded successfully!`);
            }

            // Load themes from Firebase
            async loadThemesFromFirebase() {
                try {
                    if (!window.firebase || !window.firebase.auth || !window.firebase.auth.currentUser) {
                        console.log('User not authenticated, skipping Firebase theme loading');
                        return [];
                    }

                    console.log(' Loading themes from Firebase...');
                    const currentUser = window.firebase.auth.currentUser;
                    console.log('User authenticated:', currentUser.uid);

                    const userThemesRef = window.firebase.collection(window.firebase.db, 'user_themes');
                    const querySnapshot = await window.firebase.getDocs(userThemesRef);

                    const themes = [];
                    querySnapshot.forEach(doc => {
                        const themeData = doc.data();
                        if (themeData.userId === currentUser.uid && doc.id !== 'current') {
                            themes.push({ id: doc.id, ...themeData });
                        }
                    });

                    console.log(` Loaded ${themes.length} themes from Firebase`);

                    // Also update localStorage for offline access
                    localStorage.setItem('firebase_themes', JSON.stringify(themes));
                    console.log(' Themes also saved to localStorage for offline access');

                    return themes;
                } catch (error) {
                    console.error(' Error loading themes from Firebase:', error);
                    return [];
                }
            }

            // Load current theme from Firebase
            async loadCurrentThemeFromFirebase() {
                try {
                    if (!window.bridgeService || !window.bridgeService.isAuthenticated()) {
                        console.log('User not authenticated, skipping Firebase current theme loading');
                        return null;
                    }

                    console.log('Loading current theme from Firebase...');
                    const userThemesRef = window.bridgeService.db.collection('user_themes');
                    const currentThemeDoc = await userThemesRef.doc('current').get();

                    if (currentThemeDoc.exists) {
                        const themeData = { id: 'current', ...currentThemeDoc.data() };
                        console.log('Current theme loaded from Firebase:', themeData.name);
                        return themeData;
                    }

                    return null;
                } catch (error) {
                    console.error('Error loading current theme from Firebase:', error);
                    return null;
                }
            }

            ensureThemeIsolation(theme) {
                if (!theme) return null;

                // Generate unique ID to prevent conflicts
                const uniqueId = theme.uniqueId || 'unique-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
                const themeId = theme.id || 'theme-' + Date.now() + '-' + Math.random().toString(36).substr(2, 5);

                // Preserve the original theme name - don't change it unless it's empty
                const preservedName = theme.name && theme.name.trim() !== '' ? theme.name : 'My Website';

                console.log(' Ensuring theme isolation:', {
                    originalName: theme.name,
                    preservedName: preservedName,
                    originalId: theme.id,
                    newId: themeId
                });

                return {
                    id: themeId,
                    name: preservedName,
                    description: theme.description || 'Your custom website theme',
                    status: theme.status || 'draft',
                    createdAt: theme.createdAt || new Date().toISOString(),
                    lastModified: new Date().toISOString(),
                    sections: theme.sections ? JSON.parse(JSON.stringify(theme.sections)) : [],
                    theme: theme.theme ? JSON.parse(JSON.stringify(theme.theme)) : {},
                    userId: theme.userId || 'demo-user',
                    uniqueId: uniqueId
                };
            }

            // Update theme name in the UI
            updateThemeNameInUI(themeName) {
                try {
                    console.log(' Updating theme name in UI:', themeName);

                    // Update the theme name input field
                    const themeNameInput = document.getElementById('theme-name');
                    if (themeNameInput && themeName) {
                        themeNameInput.value = themeName;
                        console.log(' Updated theme name input to:', themeName);
                    }

                    // Update the page title
                    if (themeName) {
                        document.title = `Editing: ${themeName} - MADAS Website Builder`;
                    }

                    // Update any other UI elements that show the theme name
                    const themeNameDisplay = document.querySelector('.theme-name-display');
                    if (themeNameDisplay) {
                        themeNameDisplay.textContent = themeName;
                    }

                    console.log(' Theme name updated in UI successfully');
                } catch (error) {
                    console.error('Error updating theme name in UI:', error);
                }
            }

            // Check for duplicate theme names and generate unique name
            checkForDuplicateName(themeName, excludeId = null) {
                try {
                    const savedThemes = JSON.parse(localStorage.getItem('savedThemes') || '[]');
                    const firebaseThemes = JSON.parse(localStorage.getItem('firebase_themes') || '[]');
                    const allThemes = [...savedThemes, ...firebaseThemes];

                    // Filter out the current theme if editing
                    const otherThemes = allThemes.filter(theme => theme.id !== excludeId);

                    // Check if name exists
                    const existingTheme = otherThemes.find(theme =>
                        theme.name && theme.name.toLowerCase() === themeName.toLowerCase()
                    );

                    if (existingTheme) {
                        // Generate unique name
                        let counter = 1;
                        let newName = `${themeName} (${counter})`;

                        while (otherThemes.find(theme =>
                            theme.name && theme.name.toLowerCase() === newName.toLowerCase()
                        )) {
                            counter++;
                            newName = `${themeName} (${counter})`;
                        }

                        console.log(` Duplicate name found: "${themeName}" -> "${newName}"`);
                        return newName;
                    }

                    return themeName;
                } catch (error) {
                    console.error('Error checking for duplicate names:', error);
                    return themeName;
                }
            }

            loadExistingTheme(theme) {
                // Prevent duplicate loading
                if (this.themeLoaded) {
                    console.log('Theme already loaded, skipping duplicate load');
                    return;
                }

                // Ensure theme isolation to prevent data sharing
                const isolatedTheme = this.ensureThemeIsolation(theme);
                console.log('Loading isolated theme:', isolatedTheme.name);
                console.log('Original theme ID:', theme.id, 'Isolated theme ID:', isolatedTheme.id);

                const canvas = document.getElementById('canvas');

                // Clear existing content
                canvas.innerHTML = '';

                // Mark theme as loaded
                this.themeLoaded = true;

                // Update current theme with isolated data
                this.currentTheme = isolatedTheme;

                // Update the theme name in the UI
                this.updateThemeNameInUI(this.currentTheme.name);

                // Load saved sections from isolated theme
                if (isolatedTheme.sections && isolatedTheme.sections.length > 0) {
                    isolatedTheme.sections.forEach(sectionData => {
                        const sectionHTML = `<div class="canvas-section" data-type="${sectionData.type}" draggable="true">${sectionData.content}</div>`;
                        canvas.insertAdjacentHTML('beforeend', sectionHTML);

                        // Apply saved styles to the section
                        const allSections = document.querySelectorAll('.canvas-section');
                        const lastSection = allSections[allSections.length - 1];

                        if (sectionData.styles && lastSection) {
                            console.log('Applying saved styles to section:', sectionData.type);
                            console.log('Saved styles:', sectionData.styles);

                            // Apply all saved styles
                            if (sectionData.styles.margin) {
                                lastSection.style.margin = sectionData.styles.margin;
                                console.log('Applied margin:', sectionData.styles.margin);
                            }
                            if (sectionData.styles.padding) {
                                lastSection.style.padding = sectionData.styles.padding;
                            }
                            if (sectionData.styles.borderRadius) {
                                lastSection.style.borderRadius = sectionData.styles.borderRadius;
                            }
                            if (sectionData.styles.border) {
                                lastSection.style.border = sectionData.styles.border;
                            }
                            if (sectionData.styles.boxShadow) {
                                lastSection.style.boxShadow = sectionData.styles.boxShadow;
                            }
                            if (sectionData.styles.backgroundColor) {
                                lastSection.style.backgroundColor = sectionData.styles.backgroundColor;
                            }
                            if (sectionData.styles.backgroundImage) {
                                lastSection.style.backgroundImage = sectionData.styles.backgroundImage;
                            }
                            if (sectionData.styles.backgroundSize) {
                                lastSection.style.backgroundSize = sectionData.styles.backgroundSize;
                            }
                            if (sectionData.styles.backgroundPosition) {
                                lastSection.style.backgroundPosition = sectionData.styles.backgroundPosition;
                            }
                            if (sectionData.styles.backgroundRepeat) {
                                lastSection.style.backgroundRepeat = sectionData.styles.backgroundRepeat;
                            }
                        }
                    });

                    // Add unique IDs to all loaded theme sections
                    const themeSectionsElements = document.querySelectorAll('.canvas-section');
                    themeSectionsElements.forEach(section => {
                        if (!section.id) {
                            const sectionId = `section-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
                            section.id = sectionId;
                        }
                    });

                    // Restore menu items for navbar sections
                    isolatedTheme.sections.forEach((sectionData, index) => {
                        if (sectionData.type === 'navbar' && sectionData.menuItems) {
                            const navbarSection = themeSectionsElements[index];
                            if (navbarSection) {
                                // Update the navbar menu with saved menu items
                                const menuContainer = navbarSection.querySelector('.navbar-menu');
                                const mobileMenuContainer = navbarSection.querySelector('.navbar-mobile-menu');

                                if (menuContainer && mobileMenuContainer) {
                                    const menuLinks = sectionData.menuItems.map(item => {
                                        return `<a href="#" class="navbar-link" data-collection="${item.collection}" onclick="event.preventDefault(); window.builder.selectNavbarSection(); return false;" style="color: white; text-decoration: none; font-weight: 500; transition: color 0.2s ease; cursor: pointer;">${item.text}</a>`;
                                    }).join('');

                                    menuContainer.innerHTML = menuLinks;
                                    mobileMenuContainer.innerHTML = menuLinks;
                                }
                            }
                        }
                    });
                } else {
                    // If no sections, show welcome message
                    canvas.innerHTML = `
                        <div style="display: flex; align-items: center; justify-content: center; min-height: 400px; color: #1e293b; text-align: center; font-size: 18px; background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%); border-radius: 12px; padding: 40px;">
                            <div>
                                <div style="font-size: 48px; margin-bottom: 16px;"></div>
                                <h2 style="font-size: 24px; font-weight: 700; margin: 0 0 12px 0; color: #1e293b;">Editing "${theme.name}"</h2>
                                <p style="margin: 0 0 24px 0; color: #64748b; font-size: 16px;">${theme.description || 'Your theme is ready to be customized!'}</p>
                                <p style="margin: 0; color: #9ca3af; font-size: 14px;">Click "Add Section" to start building your website</p>
                            </div>
                        </div>
                    `;
                }

                // Setup controls for all sections
                this.setupSectionControls();

                // Restore spacing if saved
                if (theme.spacing) {
                    setTimeout(() => {
                        this.applySectionSpacingValue(theme.spacing);
                    }, 100);
                }

                this.showSuccessMessage(`Theme "${theme.name}" loaded successfully!`);
            }

            showSaveConfirmation() {
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center';
                modal.innerHTML = `
                    <div class="bg-white rounded-xl max-w-md w-full mx-4 p-6">
                        <div class="text-center">
                            <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <span class="material-icons text-blue-600 text-2xl">save</span>
                            </div>
                            <h3 class="text-xl font-bold text-gray-900 mb-2">Save Theme</h3>
                            <p class="text-gray-600 mb-6">Are you sure you want to save your current theme? This will update your theme with all the changes you've made.</p>
                            <div class="flex space-x-3">
                                <button id="cancel-save" class="flex-1 px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                                    Cancel
                                </button>
                                <button id="confirm-save" class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                    Save Theme
                                </button>
                            </div>
                        </div>
                    </div>
                `;

                document.body.appendChild(modal);

                // Handle cancel
                modal.querySelector('#cancel-save').addEventListener('click', () => {
                    modal.remove();
                });

                // Handle confirm save
                modal.querySelector('#confirm-save').addEventListener('click', () => {
                    this.saveTheme();
                    modal.remove();
                });

                // Handle backdrop click
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.remove();
                    }
                });
            }

            async saveTheme() {
                console.log('Saving theme...');

                try {
                    // Validate canvas exists
                    const canvas = document.querySelector('.canvas-container');
                    if (!canvas) {
                        throw new Error('Canvas container not found');
                    }

                    // Get all sections from canvas
                    const sections = document.querySelectorAll('.canvas-section');
                    if (!sections || sections.length === 0) {
                        console.warn('No sections found to save');
                    }

                    const currentSpacing = this.getCurrentSectionSpacing();

                    // Build theme data with validation
                    const themeData = {
                        id: this.currentTheme?.id || 'theme-' + Date.now(),
                        name: this.currentTheme?.name || 'Untitled Theme',
                        description: this.currentTheme?.description || '',
                        startingPoint: this.currentTheme?.startingPoint || 'blank',
                        template: this.currentTheme?.template || null,
                        sections: Array.from(sections).map(section => {
                            try {
                                const sectionData = {
                                    type: section.dataset.type || 'unknown',
                                    content: section.innerHTML || '',
                                    styles: {
                                        margin: section.style.margin || '',
                                        padding: section.style.padding || '',
                                        borderRadius: section.style.borderRadius || '',
                                        border: section.style.border || '',
                                        boxShadow: section.style.boxShadow || '',
                                        backgroundColor: section.style.backgroundColor || '',
                                        backgroundImage: section.style.backgroundImage || '',
                                        backgroundSize: section.style.backgroundSize || '',
                                        backgroundPosition: section.style.backgroundPosition || '',
                                        backgroundRepeat: section.style.backgroundRepeat || ''
                                    }
                                };

                                // For navbar sections, also save the menu items data
                                if (section.dataset.type === 'navbar') {
                                    try {
                                        const menuItems = Array.from(section.querySelectorAll('.navbar-link')).map(link => ({
                                            text: link.textContent || '',
                                            collection: link.dataset.collection || ''
                                        }));
                                        sectionData.menuItems = menuItems;
                                    } catch (menuError) {
                                        console.warn('Error saving menu items:', menuError);
                                        sectionData.menuItems = [];
                                    }
                                }

                                return sectionData;
                            } catch (sectionError) {
                                console.error('Error processing section:', sectionError);
                                return {
                                    type: 'error',
                                    content: '',
                                    styles: {},
                                    error: sectionError.message
                                };
                            }
                        }),
                        spacing: currentSpacing || 0,
                        createdAt: this.currentTheme?.createdAt || new Date().toISOString(),
                        lastModified: new Date().toISOString(),
                        status: 'draft',
                        userId: this.currentTheme?.userId || 'demo-user-' + Date.now(),
                        previewGradient: this.currentTheme?.previewGradient || 'from-[var(--madas-primary)] via-[var(--madas-secondary)] to-[var(--madas-accent)]',
                        previewIcon: this.currentTheme?.previewIcon || 'store'
                    };

                    // Save using storage service with fallback
                    await this.saveThemeData(themeData);

                    // Update current theme data
                    this.currentTheme = themeData;

                    this.showSuccessMessage(`Theme "${themeData.name}" saved successfully!`);
                    console.log('Theme saved successfully:', themeData);

                } catch (error) {
                    console.error('Error saving theme:', error);
                    this.showErrorMessage('Failed to save theme: ' + (error.message || 'Unknown error'));
                }
            }

            // Helper method for saving theme data
            async saveThemeData(themeData) {
                try {
                    console.log(' Starting saveThemeData process...');

                    // Validate theme data first
                    const validatedData = this.validateThemeData(themeData);
                    console.log(' Theme data validated:', validatedData.name);

                    // Ensure data consistency before saving
                    this.ensureDataConsistency();

                    // Check authentication more thoroughly
                    const isAuthenticated = window.bridgeService &&
                        window.bridgeService.isAuthenticated &&
                        window.bridgeService.isAuthenticated();

                    console.log(' Authentication check:', isAuthenticated);

                    // Try multiple save methods with retry logic
                    const saveMethods = [
                        { name: 'Firebase', method: () => this.saveWithFirebase(validatedData), condition: isAuthenticated && window.firebase },
                        { name: 'StorageService', method: () => this.saveWithStorageService(validatedData), condition: window.storageService },
                        { name: 'localStorage', method: () => this.saveWithLocalStorage(validatedData), condition: true }
                    ];

                    let saveSuccess = false;
                    let lastError = null;

                    for (const saveMethod of saveMethods) {
                        if (saveMethod.condition) {
                            try {
                                console.log(` Trying ${saveMethod.name} save...`);
                                await saveMethod.method();
                                console.log(` ${saveMethod.name} save successful`);
                                saveSuccess = true;
                                break;
                            } catch (error) {
                                console.warn(` ${saveMethod.name} save failed:`, error.message);
                                lastError = error;
                                continue;
                            }
                        }
                    }

                    if (!saveSuccess) {
                        throw new Error(`All save methods failed. Last error: ${lastError?.message || 'Unknown error'}`);
                    }

                    // Update current theme with validated data
                    this.currentTheme = validatedData;

                    console.log(' Theme saved successfully:', validatedData.name);

                } catch (error) {
                    console.error(' Error in saveThemeData:', error);
                    this.showErrorMessage(`Failed to save theme: ${error.message}`);
                    throw error;
                }
            }

            // Save using storage service
            async saveWithStorageService(themeData) {
                try {
                    // Save to savedThemes collection
                    const savedThemesResult = await window.storageService.loadFromLocalStorage('savedThemes');
                    const savedThemes = savedThemesResult.success ? savedThemesResult.data : [];
                    const existingIndex = savedThemes.findIndex(theme => theme.id === themeData.id);

                    if (existingIndex >= 0) {
                        savedThemes[existingIndex] = themeData;
                        console.log('Updated existing theme at index:', existingIndex);
                    } else {
                        savedThemes.push(themeData);
                        console.log('Added new theme to saved themes');
                    }

                    await this.safeSaveToStorage('savedThemes', savedThemes);

                    // Also save to firebase_themes for compatibility
                    const firebaseThemesResult = await window.storageService.loadFromLocalStorage('firebase_themes');
                    const firebaseThemes = firebaseThemesResult.success ? firebaseThemesResult.data : [];
                    const firebaseIndex = firebaseThemes.findIndex(theme => theme.id === themeData.id);

                    if (firebaseIndex >= 0) {
                        firebaseThemes[firebaseIndex] = themeData;
                    } else {
                        firebaseThemes.push(themeData);
                    }

                    await this.safeSaveToStorage('firebase_themes', firebaseThemes);

                    // Store in localStorage for editing (small data)
                    try {
                        localStorage.setItem('editThemeData', JSON.stringify(themeData));
                        // Set flag for theme-library.html to detect new theme
                        localStorage.setItem('newThemeSaved', 'true');
                        console.log(' Set newThemeSaved flag for theme library');
                    } catch (error) {
                        console.warn('Could not save editThemeData to localStorage:', error);
                    }
                } catch (error) {
                    console.error('Error saving with storage service:', error);
                    throw error;
                }
            }

            // Save using localStorage with error handling
            async saveWithLocalStorage(themeData) {
                try {
                    const savedThemes = JSON.parse(localStorage.getItem('savedThemes') || '[]');
                    const existingIndex = savedThemes.findIndex(theme => theme.id === themeData.id);

                    if (existingIndex >= 0) {
                        savedThemes[existingIndex] = themeData;
                    } else {
                        savedThemes.push(themeData);
                    }

                    localStorage.setItem('savedThemes', JSON.stringify(savedThemes));

                    // Also save to firebase_themes for compatibility
                    const firebaseThemes = JSON.parse(localStorage.getItem('firebase_themes') || '[]');
                    const firebaseIndex = firebaseThemes.findIndex(theme => theme.id === themeData.id);

                    if (firebaseIndex >= 0) {
                        firebaseThemes[firebaseIndex] = themeData;
                    } else {
                        firebaseThemes.push(themeData);
                    }

                    localStorage.setItem('firebase_themes', JSON.stringify(firebaseThemes));
                    localStorage.setItem('editThemeData', JSON.stringify(themeData));

                    // Set flag for theme-library.html to detect new theme
                    localStorage.setItem('newThemeSaved', 'true');
                    console.log(' Set newThemeSaved flag for theme library');

                } catch (storageError) {
                    if (storageError.name === 'QuotaExceededError') {
                        console.error('localStorage quota exceeded. Please clear some data or use Firebase storage.');
                        this.showErrorMessage('Storage quota exceeded. Please sign in to use cloud storage or clear some data.');

                        // Offer to clear localStorage
                        this.showClearStorageOption();
                        throw new Error('Storage quota exceeded. Please sign in to use cloud storage.');
                    }
                    throw storageError;
                }
            }

            publishTheme() {
                if (!this.currentTheme) {
                    this.showSuccessMessage('Please save your theme first before publishing.');
                    return;
                }

                // Show publish confirmation modal
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center';
                modal.innerHTML = `
                    <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4">
                        <div class="text-center">
                            <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <span class="material-icons text-green-600 text-2xl">publish</span>
                            </div>
                            <h3 class="text-xl font-bold text-gray-900 mb-2">Publish Theme</h3>
                            <p class="text-gray-600 mb-6">Are you sure you want to publish "${this.currentTheme.name}"? This will make it live and set all other themes to draft.</p>
                            <div class="flex space-x-3">
                                <button id="cancel-publish" class="flex-1 px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                                    Cancel
                                </button>
                                <button id="confirm-publish" class="flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                                    Publish Now
                                </button>
                            </div>
                        </div>
                    </div>
                `;

                document.body.appendChild(modal);

                // Handle cancel
                modal.querySelector('#cancel-publish').addEventListener('click', () => {
                    modal.remove();
                });

                // Handle confirm publish
                modal.querySelector('#confirm-publish').addEventListener('click', () => {
                    this.confirmPublish();
                    modal.remove();
                });

                // Handle backdrop click
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.remove();
                    }
                });
            }

            // Save using Firebase Firestore
            async saveWithFirebase(themeData) {
                try {
                    console.log(' Saving theme to Firebase...');

                    // Check if user is authenticated
                    if (!window.firebase || !window.firebase.auth || !window.firebase.auth.currentUser) {
                        throw new Error('User not authenticated. Please sign in to save to cloud storage.');
                    }

                    const currentUser = window.firebase.auth.currentUser;
                    console.log('User authenticated:', currentUser.uid);

                    // Check if Firebase services are available
                    if (!window.firebase.db) {
                        throw new Error('Firebase database not available. Please check your connection.');
                    }

                    // Prepare theme document
                    const themeDoc = {
                        ...themeData,
                        userId: currentUser.uid,
                        updatedAt: new Date().toISOString(),
                        savedAt: new Date().toISOString()
                    };

                    // Save to user's themes collection
                    const userThemesRef = window.firebase.collection(window.firebase.db, 'user_themes');

                    // Use the theme ID as the document ID for easy updates
                    const themeDocRef = window.firebase.doc(userThemesRef, themeData.id);
                    await window.firebase.setDoc(themeDocRef, themeDoc, { merge: true });

                    console.log(' Theme saved to Firebase successfully');
                    this.showSuccessMessage('Theme saved to cloud storage successfully!');

                    // Also update localStorage for offline access
                    const themes = JSON.parse(localStorage.getItem('firebase_themes') || '[]');
                    const existingIndex = themes.findIndex(t => t.id === themeData.id);

                    if (existingIndex !== -1) {
                        themes[existingIndex] = themeDoc;
                    } else {
                        themes.push(themeDoc);
                    }

                    localStorage.setItem('firebase_themes', JSON.stringify(themes));
                    console.log(' Theme also saved to localStorage for offline access');

                } catch (error) {
                    console.error(' Error saving to Firebase:', error);

                    // Provide more specific error messages
                    if (error.message.includes('not authenticated')) {
                        throw new Error('Please sign in to save to cloud storage. You can still save locally without signing in.');
                    } else if (error.message.includes('database not available')) {
                        throw new Error('Cloud storage is temporarily unavailable. Your theme has been saved locally.');
                    } else {
                        throw new Error(`Failed to save to cloud storage: ${error.message}`);
                    }
                }
            }

            async confirmPublish() {
                console.log('Publishing theme...');

                try {
                    // Check if user is authenticated first
                    const isAuthenticated = window.bridgeService &&
                        window.bridgeService.isAuthenticated &&
                        window.bridgeService.isAuthenticated();

                    console.log('Authentication status in confirmPublish:', isAuthenticated);

                    if (!isAuthenticated) {
                        console.log('User not authenticated, showing sign-in prompt');
                        this.showPublishSignInPrompt();
                        return;
                    }

                    console.log('User is authenticated, proceeding with save and publish');
                    // Save the current theme (only if authenticated)
                    await this.saveTheme();

                    // Get current theme data
                    const themeData = this.getCurrentThemeData();
                    const siteId = this.currentTheme.id || `site-${Date.now()}`;

                    // Show publishing progress
                    this.showSuccessMessage('Publishing your theme... This may take a few moments.');

                    // Publish to Firebase
                    const publishResult = await window.bridgeService.publishSite(siteId, themeData);

                    // Update local theme status
                    this.currentTheme.status = 'published';
                    this.currentTheme.publishedAt = new Date().toISOString();
                    this.currentTheme.publishedUrl = publishResult.publishedUrl;
                    this.currentTheme.subdomain = publishResult.subdomain;

                    // Update local storage
                    await this.updateLocalThemeStatus();

                    // Store published theme data for access
                    const publishedThemeData = {
                        siteId: siteId,
                        publishedAt: new Date().toISOString(),
                        publishedUrl: publishResult.publishedUrl,
                        subdomain: publishResult.subdomain,
                        status: 'published'
                    };

                    localStorage.setItem('publishedTheme', JSON.stringify(publishedThemeData));

                    this.showSuccessMessage(`Theme "${this.currentTheme.name}" published successfully!`);
                    console.log('Theme published:', publishedThemeData);

                    // Update live site button visibility
                    this.updateLiveSiteButtonVisibility();

                    // Show access information
                    setTimeout(() => {
                        this.showPublishSuccessModal(publishedThemeData);
                    }, 1000);

                } catch (error) {
                    console.error('Publishing error:', error);
                    this.showErrorMessage(`Failed to publish theme: ${error.message}`);
                }
            }

            /**
             * Get current theme data for publishing
             */

            /**
             * Get current theme data for preview/publish
             */
            getCurrentThemeData() {
                try {
                    console.log('=== GETTING CURRENT THEME DATA ===');
                    const canvas = document.getElementById('canvas');
                    if (!canvas) {
                        console.error('Canvas element not found');
                        return null;
                    }

                    console.log('Canvas found:', canvas);
                    console.log('Canvas HTML:', canvas.innerHTML);

                    // Get all sections from canvas
                    const sections = [];
                    const sectionElements = canvas.querySelectorAll('.canvas-section');
                    console.log('Found section elements:', sectionElements.length);

                    sectionElements.forEach((sectionElement, index) => {
                        console.log(`Processing section ${index}:`, sectionElement);
                        const sectionData = {
                            id: sectionElement.id || `section-${index}`,
                            type: sectionElement.dataset.sectionType || sectionElement.dataset.type || 'custom',
                            content: sectionElement.innerHTML, // Use innerHTML as content for preview
                            html: sectionElement.outerHTML,    // Keep full HTML for backup
                            styles: this.extractSectionStyles(sectionElement),
                            order: index
                        };
                        console.log(`Section ${index} data:`, sectionData);
                        sections.push(sectionData);
                    });

                    // Get theme metadata - preserve the original theme name and check for duplicates
                    const originalName = this.currentTheme?.name || 'My Website';
                    const uniqueName = this.checkForDuplicateName(originalName, this.currentTheme?.id);

                    const themeData = {
                        id: this.currentTheme?.id || `theme-${Date.now()}`,
                        name: uniqueName,
                        description: this.currentTheme?.description || '',
                        sections: sections,
                        createdAt: this.currentTheme?.createdAt || new Date().toISOString(),
                        updatedAt: new Date().toISOString(),
                        status: this.currentTheme?.status || 'draft',
                        userId: this.currentTheme?.userId || 'demo-user',
                        uniqueId: this.currentTheme?.uniqueId || 'unique-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9)
                    };

                    // Update current theme name if it was changed due to duplicates
                    if (uniqueName !== originalName) {
                        this.currentTheme.name = uniqueName;
                        console.log(` Theme name updated to avoid duplicate: "${originalName}" -> "${uniqueName}"`);
                    }

                    console.log('=== FINAL THEME DATA ===');
                    console.log('Theme data:', themeData);
                    console.log('Sections count:', sections.length);
                    console.log('Current theme:', this.currentTheme);

                    return themeData;

                } catch (error) {
                    console.error('Error getting current theme data:', error);
                    return null;
                }
            }

            /**
             * Extract styles from a section element
             */
            extractSectionStyles(sectionElement) {
                try {
                    const styles = [];

                    // Get inline styles
                    if (sectionElement.style.cssText) {
                        styles.push(`#${sectionElement.id} { ${sectionElement.style.cssText} }`);
                    }

                    // Get styles from child elements
                    const styledElements = sectionElement.querySelectorAll('[style]');
                    styledElements.forEach(element => {
                        if (element.style.cssText) {
                            const selector = element.id ? `#${element.id}` :
                                element.className ? `.${element.className.split(' ')[0]}` :
                                    element.tagName.toLowerCase();
                            styles.push(`${selector} { ${element.style.cssText} }`);
                        }
                    });

                    return styles.join('\n');
                } catch (error) {
                    console.error('Error extracting section styles:', error);
                    return '';
                }
            }

            /**
             * Create preview link for current theme
             */
            async createPreview() {
                try {
                    // Check if bridge service is available
                    if (!window.bridgeService) {
                        console.warn('Bridge service not available, using fallback preview');
                        this.createFallbackPreview();
                        return;
                    }

                    // Check if createPreviewLink method exists
                    if (typeof window.bridgeService.createPreviewLink !== 'function') {
                        console.warn('createPreviewLink method not available, using fallback preview');
                        this.createFallbackPreview();
                        return;
                    }

                    // Check if user is authenticated
                    if (!window.bridgeService.isAuthenticated()) {
                        this.showPreviewSignInPrompt();
                        return;
                    }

                    // Get current theme data
                    const themeData = this.getCurrentThemeData();
                    const siteId = this.currentTheme.id || `site-${Date.now()}`;

                    // Show preview creation progress
                    this.showSuccessMessage('Creating preview... This may take a few moments.');

                    // Create preview link - pass themeData directly, bridge service will normalize it
                    console.log(' Sending theme data to preview:', themeData);
                    const previewResult = await window.bridgeService.createPreviewLink(themeData);

                    // Check if preview creation was successful
                    if (previewResult && previewResult.success) {
                        console.log(' Preview created successfully:', previewResult);
                        this.showPreviewModal(previewResult);
                    } else {
                        console.error(' Preview creation failed:', previewResult);
                        this.showErrorMessage(`Failed to create preview: ${previewResult?.error || 'Unknown error'}`);
                    }

                } catch (error) {
                    console.error('Preview creation error:', error);
                    this.showErrorMessage(`Failed to create preview: ${error.message}`);
                }
            }

            /**
             * Create fallback preview when bridge service is not available
             */
            createFallbackPreview() {
                try {
                    console.log('=== CREATING FALLBACK PREVIEW ===');

                    // Get current theme data
                    const themeData = this.getCurrentThemeData();
                    const siteId = this.currentTheme?.id || `site-${Date.now()}`;

                    console.log('Creating fallback preview with themeData:', themeData);
                    console.log('Site ID:', siteId);
                    console.log('Current theme:', this.currentTheme);

                    // Validate theme data
                    if (!themeData) {
                        console.error('No theme data generated');
                        this.showErrorMessage('No website content to preview. Please add some sections first.');
                        return;
                    }

                    if (!themeData.sections || themeData.sections.length === 0) {
                        console.error('No sections found in theme data:', themeData);
                        this.showErrorMessage('No sections found. Please add some sections to your website first.');
                        return;
                    }

                    console.log('Theme data validation passed. Sections count:', themeData.sections.length);

                    // Generate a simple preview ID
                    const previewId = `preview_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                    console.log('Generated preview ID:', previewId);

                    // Store preview data in localStorage
                    const previewData = {
                        id: previewId,
                        siteId: siteId,
                        themeData: themeData,
                        timestamp: new Date().toISOString(),
                        expiresAt: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString()
                    };

                    console.log('Storing preview data:', previewData);
                    localStorage.setItem(`preview_${previewId}`, JSON.stringify(previewData));

                    // Verify storage
                    const storedData = localStorage.getItem(`preview_${previewId}`);
                    console.log('Stored data verification:', storedData ? 'SUCCESS' : 'FAILED');

                    if (!storedData) {
                        throw new Error('Failed to store preview data in localStorage');
                    }

                    // Parse and verify the stored data
                    const parsedData = JSON.parse(storedData);
                    console.log('Parsed stored data:', parsedData);
                    console.log('Stored sections count:', parsedData.themeData?.sections?.length || 0);

                    // Create preview result
                    const previewResult = {
                        success: true,
                        previewUrl: `preview.html?id=${previewId}`,
                        previewId: previewId,
                        expiresAt: previewData.expiresAt
                    };

                    console.log('Fallback preview created successfully:', previewResult);
                    this.showPreviewModal(previewResult);

                } catch (error) {
                    console.error('Fallback preview creation error:', error);
                    this.showErrorMessage(`Failed to create preview: ${error.message}`);
                }
            }

            /**
             * Delete a section from the canvas
             */
            deleteSection(sectionElement) {
                try {
                    console.log('deleteSection called with:', sectionElement);
                    if (!sectionElement) {
                        console.error('No section element provided for deletion');
                        return;
                    }

                    // Show confirmation dialog
                    this.showDeleteConfirmation('section', () => {
                        console.log('Deleting section:', sectionElement.id);

                        // Remove from DOM
                        sectionElement.remove();

                        // Update theme data
                        if (this.currentTheme && this.currentTheme.sections) {
                            this.currentTheme.sections = this.currentTheme.sections.filter(
                                section => section.id !== sectionElement.id
                            );
                        }

                        // Clear selection if this was the selected section
                        if (sectionElement.classList.contains('selected')) {
                            this.clearSelection();
                        }

                        // Check if canvas is empty and show placeholder
                        this.checkAndShowPlaceholder();

                        // Save changes
                        this.saveTheme();

                        this.showSuccessMessage('Section deleted successfully');
                        console.log('Section deleted successfully');
                    });

                } catch (error) {
                    console.error('Error deleting section:', error);
                    this.showErrorMessage('Failed to delete section: ' + error.message);
                }
            }

            /**
             * Duplicate a section
             */
            duplicateSection(sectionElement) {
                try {
                    if (!sectionElement) {
                        console.error('No section element provided for duplication');
                        return;
                    }

                    console.log('Duplicating section:', sectionElement.id);

                    // Clone the section
                    const clonedSection = sectionElement.cloneNode(true);

                    // Generate new ID
                    const newId = `section-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
                    clonedSection.id = newId;

                    // Remove selected class
                    clonedSection.classList.remove('selected');

                    // Insert after the original section
                    sectionElement.parentNode.insertBefore(clonedSection, sectionElement.nextSibling);

                    // Make form IDs unique to prevent duplicates
                    this.makeFormIdsUnique(clonedSection);

                    // Setup controls for the new section
                    this.setupSectionControls();

                    // Select the new section
                    this.selectSection(clonedSection);

                    // Save changes
                    this.saveTheme();

                    this.showSuccessMessage('Section duplicated successfully');
                    console.log('Section duplicated successfully');

                } catch (error) {
                    console.error('Error duplicating section:', error);
                    this.showErrorMessage('Failed to duplicate section: ' + error.message);
                }
            }

            /**
             * Show delete confirmation dialog
             */
            showDeleteConfirmation(type, onConfirm) {
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center';
                modal.innerHTML = `
                    <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4">
                        <div class="text-center">
                            <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <span class="material-icons text-red-600 text-2xl">delete</span>
                            </div>
                            <h3 class="text-xl font-bold text-gray-900 mb-2">Delete ${type.charAt(0).toUpperCase() + type.slice(1)}</h3>
                            <p class="text-gray-600 mb-6">Are you sure you want to delete this ${type}? This action cannot be undone.</p>
                            
                            <div class="flex space-x-3">
                                <button id="cancel-delete" class="flex-1 px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                                    Cancel
                                </button>
                                <button id="confirm-delete" class="flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
                                    Delete
                                </button>
                            </div>
                        </div>
                    </div>
                `;

                document.body.appendChild(modal);

                // Add event listeners
                modal.querySelector('#cancel-delete').addEventListener('click', () => {
                    document.body.removeChild(modal);
                });

                modal.querySelector('#confirm-delete').addEventListener('click', () => {
                    document.body.removeChild(modal);
                    onConfirm();
                });

                // Close on backdrop click
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        document.body.removeChild(modal);
                    }
                });
            }

            /**
             * Generate unique ID for form elements
             */
            generateUniqueId(prefix = 'element') {
                return `${prefix}-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
            }

            /**
             * Make form element IDs unique within a section
             */
            makeFormIdsUnique(sectionElement) {
                try {
                    if (!sectionElement) return;

                    // Find all form elements with IDs
                    const formElements = sectionElement.querySelectorAll('input[id], select[id], textarea[id], button[id]');
                    const sectionId = sectionElement.id || this.generateUniqueId('section');

                    formElements.forEach(element => {
                        const originalId = element.id;
                        if (originalId) {
                            // Create unique ID based on section ID and original ID
                            const uniqueId = `${sectionId}-${originalId}`;
                            element.id = uniqueId;

                            // Update any labels that reference this ID
                            const labels = document.querySelectorAll(`label[for="${originalId}"]`);
                            labels.forEach(label => {
                                label.setAttribute('for', uniqueId);
                            });

                            console.log(`Updated ID: ${originalId} -> ${uniqueId}`);
                        }
                    });

                } catch (error) {
                    console.error('Error making form IDs unique:', error);
                }
            }

            /**
             * Fix any existing duplicate IDs in the document
             */
            fixDuplicateIds() {
                try {
                    console.log('Checking for duplicate IDs...');
                    const allElements = document.querySelectorAll('[id]');
                    const idCounts = {};
                    const duplicates = [];

                    // Count occurrences of each ID
                    allElements.forEach(element => {
                        const id = element.id;
                        if (id) {
                            idCounts[id] = (idCounts[id] || 0) + 1;
                            if (idCounts[id] > 1) {
                                duplicates.push(id);
                            }
                        }
                    });

                    // Fix duplicates
                    if (duplicates.length > 0) {
                        console.warn(`Found ${duplicates.length} duplicate IDs:`, duplicates);

                        duplicates.forEach(duplicateId => {
                            const elements = document.querySelectorAll(`#${duplicateId}`);
                            elements.forEach((element, index) => {
                                if (index > 0) { // Keep the first one, fix the rest
                                    const newId = `${duplicateId}-${index}`;
                                    element.id = newId;

                                    // Update any labels that reference this ID
                                    const labels = document.querySelectorAll(`label[for="${duplicateId}"]`);
                                    labels.forEach(label => {
                                        if (label.getAttribute('for') === duplicateId) {
                                            label.setAttribute('for', newId);
                                        }
                                    });

                                    console.log(`Fixed duplicate ID: ${duplicateId} -> ${newId}`);
                                }
                            });
                        });

                        this.showSuccessMessage(`Fixed ${duplicates.length} duplicate IDs`);
                    } else {
                        console.log('No duplicate IDs found');
                    }

                } catch (error) {
                    console.error('Error fixing duplicate IDs:', error);
                }
            }

            /**
             * Check if user needs to sign in for cloud features
             */
            checkAuthenticationStatus() {
                try {
                    if (!window.bridgeService) {
                        return { authenticated: false, reason: 'Bridge service not available' };
                    }

                    if (!window.bridgeService.isAuthenticated()) {
                        return { authenticated: false, reason: 'User not signed in' };
                    }

                    return { authenticated: true, reason: 'User is authenticated' };
                } catch (error) {
                    console.error('Error checking authentication:', error);
                    return { authenticated: false, reason: 'Authentication check failed' };
                }
            }

            /**
             * Delete a theme
             */
            async deleteTheme(themeId) {
                try {
                    console.log('Deleting theme:', themeId);

                    // Show confirmation dialog
                    this.showDeleteConfirmation('theme', async () => {
                        try {
                            // Delete from Firebase if authenticated
                            if (window.bridgeService && window.bridgeService.isAuthenticated()) {
                                try {
                                    const userThemesRef = window.bridgeService.db.collection('user_themes');
                                    await userThemesRef.doc(themeId).delete();
                                    console.log('Theme deleted from Firebase');
                                } catch (firebaseError) {
                                    console.warn('Failed to delete from Firebase:', firebaseError);
                                }
                            }

                            // Delete from localStorage
                            const savedThemes = await this.safeLoadFromStorage('savedThemes');
                            const updatedThemes = savedThemes.filter(theme => theme.id !== themeId);
                            await this.safeSaveToStorage('savedThemes', updatedThemes);

                            // Delete from firebase_themes collection
                            const firebaseThemes = await this.safeLoadFromStorage('firebase_themes');
                            const updatedFirebaseThemes = firebaseThemes.filter(theme => theme.id !== themeId);
                            await this.safeSaveToStorage('firebase_themes', updatedFirebaseThemes);

                            // If this was the current theme, clear it
                            if (this.currentTheme && this.currentTheme.id === themeId) {
                                this.currentTheme = null;
                                this.clearCanvas();
                            }

                            this.showSuccessMessage('Theme deleted successfully');
                            console.log('Theme deleted successfully');

                            // Refresh theme library if it's open
                            if (document.getElementById('theme-library-modal')) {
                                this.loadThemes();
                            }

                        } catch (error) {
                            console.error('Error deleting theme:', error);
                            this.showErrorMessage('Failed to delete theme: ' + error.message);
                        }
                    });

                } catch (error) {
                    console.error('Error in deleteTheme:', error);
                    this.showErrorMessage('Failed to delete theme: ' + error.message);
                }
            }

            /**
             * Clear the canvas
             */
            clearCanvas() {
                try {
                    console.log('Clearing canvas...');
                    const canvas = document.getElementById('canvas');
                    if (canvas) {
                        canvas.innerHTML = '';
                        this.checkAndShowPlaceholder();
                    }

                    // Clear current theme
                    this.currentTheme = null;

                    // Clear selection
                    this.clearSelection();

                    console.log('Canvas cleared successfully');

                } catch (error) {
                    console.error('Error clearing canvas:', error);
                    this.showErrorMessage('Failed to clear canvas: ' + error.message);
                }
            }

            /**
             * Show sign-in prompt for cloud features
             */
            showSignInPrompt() {
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center';
                modal.innerHTML = `
                    <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4">
                        <div class="text-center">
                            <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <span class="material-icons text-blue-600 text-2xl">cloud_upload</span>
                            </div>
                            <h3 class="text-xl font-bold text-gray-900 mb-2">Sign In Required</h3>
                            <p class="text-gray-600 mb-6">To save your themes to the cloud, please sign in to your account.</p>
                            
                            <div class="flex space-x-3">
                                <button id="cancel-signin" class="flex-1 px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                                    Cancel
                                </button>
                                <button id="signin-btn" class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                    Sign In
                                </button>
                            </div>
                        </div>
                    </div>
                `;

                document.body.appendChild(modal);

                // Add event listeners
                modal.querySelector('#cancel-signin').addEventListener('click', () => {
                    document.body.removeChild(modal);
                });

                modal.querySelector('#signin-btn').addEventListener('click', () => {
                    document.body.removeChild(modal);
                    // Redirect to login page or show login modal
                    window.location.href = '../login.html';
                });
            }

            /**
             * Safe storage methods with fallbacks
             */
            async safeLoadFromStorage(key) {
                try {
                    if (window.storageService && typeof window.storageService.loadFromLocalStorage === 'function') {
                        const result = await window.storageService.loadFromLocalStorage(key);
                        return result.success ? result.data : [];
                    } else {
                        console.warn(`StorageService error for ${key}, falling back to localStorage`);
                        const data = localStorage.getItem(key);
                        return data ? JSON.parse(data) : [];
                    }
                } catch (error) {
                    console.warn(`StorageService error for ${key}, falling back to localStorage:`, error);
                    const data = localStorage.getItem(key);
                    return data ? JSON.parse(data) : [];
                }
            }

            async safeSaveToStorage(key, data) {
                try {
                    if (window.storageService && typeof window.storageService.saveToLocalStorage === 'function') {
                        const result = await window.storageService.saveToLocalStorage(key, data);
                        if (!result.success) {
                            throw new Error(result.error);
                        }
                    } else {
                        console.warn(`StorageService not available for ${key}, using direct localStorage`);
                        localStorage.setItem(key, JSON.stringify(data));
                    }
                } catch (error) {
                    console.warn(`StorageService error for ${key}, falling back to localStorage:`, error);
                    localStorage.setItem(key, JSON.stringify(data));
                }
            }

            /**
             * Debug canvas content
             */
            debugCanvas() {
                try {
                    console.log('=== DEBUGGING CANVAS ===');
                    const canvas = document.getElementById('canvas');

                    if (!canvas) {
                        console.error('Canvas element not found!');
                        this.showErrorMessage('Canvas element not found!');
                        return;
                    }

                    console.log('Canvas element:', canvas);
                    console.log('Canvas innerHTML length:', canvas.innerHTML.length);
                    console.log('Canvas innerHTML:', canvas.innerHTML);

                    const sections = canvas.querySelectorAll('.canvas-section');
                    console.log('Found sections:', sections.length);

                    sections.forEach((section, index) => {
                        console.log(`Section ${index}:`, {
                            id: section.id,
                            className: section.className,
                            dataset: section.dataset,
                            type: section.dataset.sectionType || section.dataset.type,
                            html: section.outerHTML.substring(0, 200) + '...'
                        });
                    });

                    // Test getCurrentThemeData
                    console.log('Testing getCurrentThemeData...');
                    const themeData = this.getCurrentThemeData();
                    console.log('Theme data result:', themeData);

                    if (themeData && themeData.sections) {
                        console.log('Sections in theme data:', themeData.sections.length);
                        themeData.sections.forEach((section, index) => {
                            console.log(`Theme section ${index}:`, {
                                id: section.id,
                                type: section.type,
                                htmlLength: section.html?.length || 0,
                                stylesLength: section.styles?.length || 0
                            });
                        });
                    }

                    this.showSuccessMessage(`Debug complete! Found ${sections.length} sections. Check console for details.`);

                } catch (error) {
                    console.error('Debug error:', error);
                    this.showErrorMessage(`Debug failed: ${error.message}`);
                }
            }

            showStorageInfo() {
                try {
                    console.log('=== THEME STORAGE INFORMATION ===');

                    // Check localStorage
                    const savedThemes = JSON.parse(localStorage.getItem('savedThemes') || '[]');
                    const firebaseThemes = JSON.parse(localStorage.getItem('firebase_themes') || '[]');
                    const editThemeData = localStorage.getItem('editThemeData');
                    const newThemeSaved = localStorage.getItem('newThemeSaved');

                    console.log(' localStorage savedThemes:', savedThemes);
                    console.log(' localStorage firebase_themes:', firebaseThemes);
                    console.log(' localStorage editThemeData:', editThemeData ? JSON.parse(editThemeData) : null);
                    console.log(' localStorage newThemeSaved flag:', newThemeSaved);

                    // Show current theme info
                    console.log(' Current theme:', this.currentTheme);

                    // Create storage info modal
                    const modal = document.createElement('div');
                    modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center';
                    modal.innerHTML = `
                        <div class="bg-white rounded-xl p-8 max-w-4xl w-full mx-4 max-h-[80vh] overflow-y-auto">
                            <div class="text-center mb-6">
                                <h3 class="text-2xl font-bold text-gray-900 mb-2">Theme Storage Information</h3>
                                <p class="text-gray-600">Where your themes are saved and how to access them</p>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                <div class="bg-blue-50 p-4 rounded-lg">
                                    <h4 class="font-semibold text-blue-900 mb-2"> Local Storage</h4>
                                    <p class="text-sm text-blue-700 mb-2">Themes are saved in your browser's localStorage:</p>
                                    <ul class="text-xs text-blue-600 space-y-1">
                                        <li> <strong>savedThemes:</strong> ${savedThemes.length} themes</li>
                                        <li> <strong>firebase_themes:</strong> ${firebaseThemes.length} themes</li>
                                        <li> <strong>editThemeData:</strong> ${editThemeData ? 'Available' : 'None'}</li>
                                    </ul>
                                </div>
                                
                                <div class="bg-green-50 p-4 rounded-lg">
                                    <h4 class="font-semibold text-green-900 mb-2"> Cloud Storage</h4>
                                    <p class="text-sm text-green-700 mb-2">Themes are also saved to Firebase:</p>
                                    <ul class="text-xs text-green-600 space-y-1">
                                        <li> <strong>Collection:</strong> user_themes</li>
                                        <li> <strong>Status:</strong> ${window.bridgeService && window.bridgeService.isAuthenticated() ? 'Connected' : 'Not connected'}</li>
                                        <li> <strong>Sync:</strong> Automatic</li>
                                    </ul>
                                </div>
                            </div>
                            
                            <div class="bg-gray-50 p-4 rounded-lg mb-6">
                                <h4 class="font-semibold text-gray-900 mb-2"> Current Theme</h4>
                                <div class="text-sm text-gray-700">
                                    <p><strong>Name:</strong> ${this.currentTheme?.name || 'Not set'}</p>
                                    <p><strong>ID:</strong> ${this.currentTheme?.id || 'Not set'}</p>
                                    <p><strong>Status:</strong> ${this.currentTheme?.status || 'Not set'}</p>
                                    <p><strong>Sections:</strong> ${this.currentTheme?.sections?.length || 0}</p>
                                </div>
                            </div>
                            
                            <div class="bg-yellow-50 p-4 rounded-lg mb-6">
                                <h4 class="font-semibold text-yellow-900 mb-2"> How to Access Your Themes</h4>
                                <ol class="text-sm text-yellow-700 space-y-1">
                                    <li>1. Go to <strong>Theme Library</strong> to see all your themes</li>
                                    <li>2. Each theme is saved with a unique ID and name</li>
                                    <li>3. Themes are automatically synced between localStorage and Firebase</li>
                                    <li>4. You can edit, preview, or delete themes from the library</li>
                                </ol>
                            </div>
                            
                            <div class="flex justify-center space-x-3">
                                <button id="close-storage-modal" class="px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors">
                                    Close
                                </button>
                                <button id="open-theme-library" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                    Open Theme Library
                                </button>
                            </div>
                        </div>
                    `;

                    document.body.appendChild(modal);

                    // Handle close button
                    modal.querySelector('#close-storage-modal').addEventListener('click', () => {
                        modal.remove();
                    });

                    // Handle open theme library button
                    modal.querySelector('#open-theme-library').addEventListener('click', () => {
                        window.location.href = 'theme-library.html';
                    });

                    // Handle backdrop click
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) {
                            modal.remove();
                        }
                    });

                    this.showSuccessMessage('Storage information displayed! Check the modal for details.');

                } catch (error) {
                    console.error('Error showing storage info:', error);
                    this.showErrorMessage(`Failed to show storage info: ${error.message}`);
                }
            }

            debugPreviewData() {
                try {
                    console.log('=== DEBUGGING PREVIEW DATA ===');

                    // Check canvas
                    const canvas = document.getElementById('canvas');
                    if (!canvas) {
                        console.error('Canvas not found!');
                        this.showErrorMessage('Canvas not found!');
                        return;
                    }

                    console.log('Canvas found:', canvas);
                    console.log('Canvas sections:', canvas.querySelectorAll('.canvas-section').length);

                    // Test getCurrentThemeData
                    console.log('Testing getCurrentThemeData...');
                    const themeData = this.getCurrentThemeData();
                    console.log('Theme data:', themeData);

                    if (!themeData) {
                        console.error('No theme data generated!');
                        this.showErrorMessage('No theme data generated!');
                        return;
                    }

                    if (!themeData.sections || themeData.sections.length === 0) {
                        console.error('No sections in theme data!');
                        this.showErrorMessage('No sections found in theme data!');
                        return;
                    }

                    console.log('Theme data validation passed!');
                    console.log('Sections count:', themeData.sections.length);
                    console.log('Theme ID:', themeData.id);
                    console.log('Theme name:', themeData.name);

                    // Test preview creation
                    console.log('Testing preview creation...');
                    this.createFallbackPreview();

                    this.showSuccessMessage('Preview debug complete! Check console for details.');

                } catch (error) {
                    console.error('Preview debug error:', error);
                    this.showErrorMessage(`Preview debug failed: ${error.message}`);
                }
            }

            /**
             * Show preview modal with link
             */
            showPreviewModal(previewData) {
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center';
                modal.innerHTML = `
                    <div class="bg-white rounded-xl p-8 max-w-lg w-full mx-4">
                        <div class="text-center">
                            <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <span class="material-icons text-blue-600 text-2xl">visibility</span>
                            </div>
                            <h3 class="text-xl font-bold text-gray-900 mb-2">Preview Created!</h3>
                            <p class="text-gray-600 mb-6">Your preview link is ready. It will expire in 24 hours.</p>
                            
                            <div class="bg-gray-50 rounded-lg p-4 mb-6 text-left">
                                <h4 class="font-semibold text-gray-900 mb-3">Preview Link:</h4>
                                <div class="flex items-center space-x-2">
                                    <input type="text" id="preview-url" value="${previewData.previewUrl}" 
                                           class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm bg-white" readonly>
                                    <button onclick="copyToClipboard('${previewData.previewUrl}')" 
                                            class="px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm">
                                        Copy
                                    </button>
                                </div>
                                <p class="text-xs text-gray-500 mt-2">Expires: ${new Date(previewData.expiresAt).toLocaleString()}</p>
                            </div>
                            
                            <div class="flex space-x-3">
                                <button id="close-preview" class="flex-1 px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                                    Close
                                </button>
                                <button id="open-preview" class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                    Open Preview
                                </button>
                            </div>
                        </div>
                    </div>
                `;

                document.body.appendChild(modal);

                // Handle close
                modal.querySelector('#close-preview').addEventListener('click', () => {
                    modal.remove();
                });

                // Handle open preview
                modal.querySelector('#open-preview').addEventListener('click', () => {
                    window.open(previewData.previewUrl, '_blank');
                    modal.remove();
                });

                // Handle backdrop click
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.remove();
                    }
                });
            }

            /**
             * Update local theme status after publishing
             */
            async updateLocalThemeStatus() {
                // Get all themes and set them to draft
                let allThemes, firebaseThemes;

                allThemes = await this.safeLoadFromStorage('savedThemes');
                firebaseThemes = await this.safeLoadFromStorage('firebase_themes');

                // Update all themes to draft status
                allThemes.forEach(theme => {
                    theme.status = 'draft';
                    theme.updatedAt = new Date().toISOString();
                });

                firebaseThemes.forEach(theme => {
                    theme.status = 'draft';
                    theme.updatedAt = new Date().toISOString();
                });

                // Set current theme to published
                const currentThemeIndex = allThemes.findIndex(theme => theme.id === this.currentTheme.id);
                const firebaseThemeIndex = firebaseThemes.findIndex(theme => theme.id === this.currentTheme.id);

                if (currentThemeIndex !== -1) {
                    allThemes[currentThemeIndex] = { ...allThemes[currentThemeIndex], ...this.currentTheme };
                }

                if (firebaseThemeIndex !== -1) {
                    firebaseThemes[firebaseThemeIndex] = { ...firebaseThemes[firebaseThemeIndex], ...this.currentTheme };
                }

                // Save updated themes
                if (window.storageService) {
                    await this.safeSaveToStorage('savedThemes', allThemes);
                    await this.safeSaveToStorage('firebase_themes', firebaseThemes);
                } else {
                    try {
                        localStorage.setItem('savedThemes', JSON.stringify(allThemes));
                        localStorage.setItem('firebase_themes', JSON.stringify(firebaseThemes));
                    } catch (error) {
                        if (error.name === 'QuotaExceededError') {
                            console.error('localStorage quota exceeded during publish');
                            this.showErrorMessage('Storage quota exceeded. Please clear some data or sign in to use cloud storage.');
                            return;
                        }
                        throw error;
                    }
                }
            }

            showPublishSuccessModal(publishedTheme) {
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center';
                modal.innerHTML = `
                    <div class="bg-white rounded-xl p-8 max-w-lg w-full mx-4">
                        <div class="text-center">
                            <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <span class="material-icons text-green-600 text-2xl">check_circle</span>
                            </div>
                            <h3 class="text-xl font-bold text-gray-900 mb-2">Theme Published Successfully!</h3>
                            <p class="text-gray-600 mb-6">Your theme "${this.currentTheme.name}" is now live and accessible.</p>
                            
                            <div class="bg-gray-50 rounded-lg p-4 mb-6 text-left">
                                <h4 class="font-semibold text-gray-900 mb-3">Access Your Site:</h4>
                                <div class="space-y-2">
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm text-gray-600">Subdomain:</span>
                                        <a href="https://${publishedTheme.subdomain}" target="_blank" class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                                            ${publishedTheme.subdomain}
                                        </a>
                                    </div>
                                    ${publishedTheme.publishedUrl ? `
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm text-gray-600">Published URL:</span>
                                        <a href="${publishedTheme.publishedUrl}" target="_blank" class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                                            View Site
                                        </a>
                                    </div>
                                    ` : ''}
                                </div>
                            </div>

                            <div class="flex space-x-3">
                                <button id="close-publish-success" class="flex-1 px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                                    Close
                                </button>
                                <button id="view-published-site" class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                    View Site
                                </button>
                            </div>
                        </div>
                    </div>
                `;

                document.body.appendChild(modal);

                // Handle close
                modal.querySelector('#close-publish-success').addEventListener('click', () => {
                    modal.remove();
                });

                // Handle view site
                modal.querySelector('#view-published-site').addEventListener('click', () => {
                    if (publishedTheme.publishedUrl) {
                        window.open(publishedTheme.publishedUrl, '_blank');
                    } else if (publishedTheme.subdomain) {
                        window.open(`https://${publishedTheme.subdomain}`, '_blank');
                    }
                    modal.remove();
                });

                // Handle backdrop click
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.remove();
                    }
                });
            }

            async redirectToLiveSite() {
                try {
                    // Check if we have a published theme in localStorage
                    const publishedThemeData = localStorage.getItem('publishedTheme');

                    if (publishedThemeData) {
                        const publishedTheme = JSON.parse(publishedThemeData);
                        console.log('Found published theme:', publishedTheme);

                        // Open the published site
                        if (publishedTheme.publishedUrl) {
                            window.open(publishedTheme.publishedUrl, '_blank');
                            this.showSuccessMessage(`Opening live site: ${publishedTheme.subdomain}`);
                        } else if (publishedTheme.subdomain) {
                            window.open(`https://${publishedTheme.subdomain}`, '_blank');
                            this.showSuccessMessage(`Opening live site: ${publishedTheme.subdomain}`);
                        } else {
                            this.showErrorMessage('Published site URL not found. Please republish your theme.');
                        }
                    } else {
                        // No published theme found
                        this.showErrorMessage('No published theme found. Please publish a theme first.');

                        // Show option to publish current theme
                        setTimeout(() => {
                            const choice = confirm('No published theme found. Would you like to publish this theme?');
                            if (choice) {
                                this.publishTheme();
                            }
                        }, 1000);
                    }

                } catch (error) {
                    console.error('Error redirecting to live site:', error);
                    this.showSuccessMessage('Error accessing live site');
                }
            }

            async updateLiveSiteButtonVisibility() {
                const liveSiteBtn = document.getElementById('live-site-btn');
                if (!liveSiteBtn) return;

                // Check if there's a published theme
                let allThemes, firebaseThemes;

                allThemes = await this.safeLoadFromStorage('savedThemes');
                firebaseThemes = await this.safeLoadFromStorage('firebase_themes');

                const themes = [...allThemes, ...firebaseThemes];
                const publishedTheme = themes.find(theme => theme.status === 'published');

                if (publishedTheme) {
                    liveSiteBtn.style.display = 'block';
                    liveSiteBtn.innerHTML = `
                        <span class="material-icons text-sm mr-2">web</span>
                        View Live Site
                    `;
                } else {
                    liveSiteBtn.style.display = 'none';
                }
            }

            duplicateSelectedSection() {
                const selectedSection = document.querySelector('.canvas-section.selected');
                if (!selectedSection) {
                    this.showSuccessMessage('Please select a section to duplicate');
                    return;
                }

                // Clone the selected section
                const clonedSection = selectedSection.cloneNode(true);

                // Remove selection from original and add to clone
                selectedSection.classList.remove('selected');
                clonedSection.classList.add('selected');

                // Insert after the original section
                selectedSection.parentNode.insertBefore(clonedSection, selectedSection.nextSibling);

                // Setup controls for the new section
                this.setupSectionControls();

                this.showSuccessMessage('Section duplicated successfully!');
            }

            clearCanvas() {
                if (confirm('Are you sure you want to clear the entire canvas? This action cannot be undone.')) {
                    const canvas = document.getElementById('canvas');
                    canvas.innerHTML = `
                        <div style="display: flex; align-items: center; justify-content: center; min-height: 400px; color: #9ca3af; text-align: center; font-size: 18px;">
                            <div>
                                <div style="font-size: 48px; margin-bottom: 16px;"></div>
                                <p style="margin: 0;">Click "Add Section" to start building your website</p>
                            </div>
                        </div>
                    `;

                    this.showSuccessMessage('Canvas cleared successfully!');
                }
            }

            saveAsTemplate() {
                const sections = document.querySelectorAll('.canvas-section');
                if (sections.length === 0) {
                    this.showSuccessMessage('No sections to save as template');
                    return;
                }

                const templateName = prompt('Enter template name:');
                if (!templateName) return;

                // Save template to localStorage
                const template = {
                    name: templateName,
                    sections: Array.from(sections).map(section => ({
                        type: section.dataset.type,
                        content: section.innerHTML
                    })),
                    created: new Date().toISOString()
                };

                const templates = JSON.parse(localStorage.getItem('websiteTemplates') || '[]');
                templates.push(template);
                localStorage.setItem('websiteTemplates', JSON.stringify(templates));

                this.showSuccessMessage(`Template "${templateName}" saved successfully!`);
            }

            loadTemplate() {
                const templates = JSON.parse(localStorage.getItem('websiteTemplates') || '[]');
                if (templates.length === 0) {
                    this.showSuccessMessage('No saved templates found');
                    return;
                }

                // Create template selection modal
                const templateNames = templates.map(t => t.name).join('\n');
                const selectedIndex = prompt(`Select template (0-${templates.length - 1}):\n\n${templates.map((t, i) => `${i}: ${t.name}`).join('\n')}`);

                if (selectedIndex === null) return;

                const index = parseInt(selectedIndex);
                if (isNaN(index) || index < 0 || index >= templates.length) {
                    this.showSuccessMessage('Invalid template selection');
                    return;
                }

                const template = templates[index];
                const canvas = document.getElementById('canvas');

                // Clear canvas and load template
                canvas.innerHTML = template.sections.map(section =>
                    `<div class="canvas-section" data-type="${section.type}" draggable="true">${section.content}</div>`
                ).join('');

                // Setup controls for all sections
                this.setupSectionControls();

                this.showSuccessMessage(`Template "${template.name}" loaded successfully!`);
            }

            deleteSection(section) {
                console.log('Deleting section:', section.dataset.type);

                if (confirm('Are you sure you want to delete this section?')) {
                    section.remove();

                    // Remove from our tracking
                    const sectionType = section.dataset.type;
                    this.sections = this.sections.filter(s => s.type !== sectionType);

                    console.log('Section deleted successfully!');
                    this.showSuccessMessage('Section deleted successfully!');

                    // If no sections left, show placeholder
                    this.checkAndShowPlaceholder();
                }
            }

            // Helper function to safely load from storage
            async safeLoadFromStorage(key) {
                if (window.storageService && typeof window.storageService.loadFromLocalStorage === 'function') {
                    try {
                        const result = await window.storageService.loadFromLocalStorage(key);
                        return result.success ? result.data : [];
                    } catch (error) {
                        console.warn(`StorageService error for ${key}, falling back to localStorage:`, error);
                        return JSON.parse(localStorage.getItem(key) || '[]');
                    }
                } else {
                    return JSON.parse(localStorage.getItem(key) || '[]');
                }
            }

            // Helper function to safely save to storage
            async safeSaveToStorage(key, data) {
                if (window.storageService && typeof window.storageService.saveToLocalStorage === 'function') {
                    try {
                        await this.safeSaveToStorage(key, data);
                    } catch (error) {
                        console.warn(`StorageService error for ${key}, falling back to localStorage:`, error);
                        localStorage.setItem(key, JSON.stringify(data));
                    }
                } else {
                    localStorage.setItem(key, JSON.stringify(data));
                }
            }

            // Check if canvas should show placeholder
            checkAndShowPlaceholder() {
                const canvas = document.getElementById('canvas');
                if (!canvas) return;

                // Check if canvas has any actual content (not just the placeholder)
                const hasContent = canvas.children.length > 0 &&
                    !canvas.querySelector('[style*="min-height: 400px"]') &&
                    !canvas.querySelector('[style*="color: #9ca3af"]');

                if (!hasContent) {
                    // Show placeholder only if no sections exist
                    canvas.innerHTML = `
                        <div style="display: flex; align-items: center; justify-content: center; min-height: 400px; color: #9ca3af; text-align: center; font-size: 18px;">
                            <div>
                                <div style="font-size: 48px; margin-bottom: 16px;"></div>
                                <p style="margin: 0;">Click "Add Section" to start building your website</p>
                            </div>
                        </div>
                    `;
                }
            }
        }

        // Initialize the builder when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM loaded, initializing professional builder...');

            // Verify key DOM elements exist
            const canvas = document.getElementById('canvas');
            const addSectionBtn = document.getElementById('add-section-btn');
            const saveBtn = document.getElementById('save-btn');
            const publishBtn = document.getElementById('publish-btn');

            console.log('DOM Elements check:');
            console.log('- Canvas:', canvas ? 'Found' : 'Missing');
            console.log('- Add Section Button:', addSectionBtn ? 'Found' : 'Missing');
            console.log('- Save Button:', saveBtn ? 'Found' : 'Missing');
            console.log('- Publish Button:', publishBtn ? 'Found' : 'Missing');

            if (!canvas) {
                console.error('Critical error: Canvas element not found!');
                return;
            }

            const builder = new ProfessionalBuilder();
            builder.init();
            builder.setupCollectionListener(); // Setup collection listener
            window.builder = builder;

            // Notify that builder is created (for init.js)
            window.dispatchEvent(new CustomEvent('builderCreated', {
                detail: { builder: builder }
            }));

            // Fix any existing duplicate IDs after initialization
            setTimeout(() => {
                builder.fixDuplicateIds();
            }, 1000);

            console.log('Professional builder instance created and initialized');

            // Initialize mobile menu functionality for MADAS navbar
            initializeMobileMenu();
        });

        // Also initialize mobile menu on page load for published version
        document.addEventListener('DOMContentLoaded', function () {
            // Small delay to ensure all elements are loaded
            setTimeout(() => {
                initializeMobileMenu();
            }, 100);
        });

        // Copy to clipboard function
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                // Show temporary success message
                const notification = document.createElement('div');
                notification.className = 'fixed top-4 right-4 bg-green-600 text-white px-4 py-2 rounded-lg z-50';
                notification.textContent = 'URL copied to clipboard!';
                document.body.appendChild(notification);

                setTimeout(() => {
                    notification.remove();
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy: ', err);
            });
        }

        // Mobile menu function
        function closeMobileMenu(mobileMenu, mobileMenuButton) {
            try {
                if (!mobileMenu || !mobileMenuButton) return;

                // Hide menu
                mobileMenu.classList.add("hidden");

                // Reset button
                mobileMenuButton.innerHTML = "";
                const icon = document.createElement("span");
                icon.className = "material-icons text-[var(--madas-dark-moss)] text-lg";
                icon.textContent = "menu";
                mobileMenuButton.appendChild(icon);
            } catch (error) {
                console.error("Error closing mobile menu:", error);
            }
        }
        // Mobile menu functionality for MADAS navbar
        function updateMobileMenuButtonVisibility() {
            const button = document.getElementById("mobile-menu-button");
            if (!button) return;

            const isMobile = window.innerWidth < 1024;
            button.style.display = isMobile ? "flex" : "none";
            button.style.visibility = isMobile ? "visible" : "hidden";
            button.style.opacity = isMobile ? "1" : "0";
        }

        function initializeMobileMenu() {
            updateMobileMenuButtonVisibility();
            window.addEventListener("resize", updateMobileMenuButtonVisibility);
            console.log('Initializing mobile menu functionality...');
        }

        // ========== MESSAGE SYSTEM ==========
        function showMessage(message, type = "success") {
            try {
                const existing = document.querySelector(".dynamic-message");
                if (existing) existing.remove();

                const messageElement = document.createElement("div");
                messageElement.className = `dynamic-message fixed top-20 left-1/2 transform -translate-x-1/2 px-4 py-2 rounded-lg shadow-md z-50 text-sm 
                    ${type === "success" ? "bg-green-500 text-white" : "bg-red-500 text-white"} 
                    transition-all duration-300 ease-in-out opacity-100`;

                messageElement.setAttribute("role", "alert");
                messageElement.setAttribute("aria-live", "assertive");

                // Content
                messageElement.innerHTML = `
                    <div class="flex items-center gap-2">
                        <span>${message}</span>
                        <button class="ml-2 text-white hover:text-gray-200 focus:outline-none">&times;</button>
                    </div>
                `;

                // Close button
                const closeButton = messageElement.querySelector("button");
                closeButton.addEventListener("click", () => {
                    messageElement.remove();
                });

                document.body.appendChild(messageElement);

                // Auto-remove safely
                setTimeout(() => {
                    if (document.body.contains(messageElement)) {
                        messageElement.remove();
                    }
                }, 5000);

            } catch (error) {
                console.error("Error showing message:", error);
            }
        }

        // Ensure mobile menu button is visible on mobile devices
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        if (mobileMenuButton) {
            // Check if we're on a mobile device (screen width < 1024px)
            const isMobile = window.innerWidth < 1024;
            if (isMobile) {
                mobileMenuButton.style.display = 'flex';
                mobileMenuButton.style.visibility = 'visible';
                mobileMenuButton.style.opacity = '1';
            }

            // Add resize listener to update visibility when screen size changes
            window.addEventListener('resize', function () {
                const isMobile = window.innerWidth < 1024;
                if (isMobile) {
                    mobileMenuButton.style.display = 'flex';
                    mobileMenuButton.style.visibility = 'visible';
                    mobileMenuButton.style.opacity = '1';
                } else {
                    mobileMenuButton.style.display = 'none';
                }
            });
        }

        // Use event delegation to handle dynamically created elements
        document.addEventListener('click', function (event) {
            // Check if clicked element is a mobile menu button
            if (event.target.closest('#mobile-menu-button')) {
                event.preventDefault();
                event.stopPropagation();

                const mobileMenuButton = event.target.closest('#mobile-menu-button');
                const mobileMenu = document.getElementById('mobile-menu');

                console.log('Mobile menu button clicked');
                console.log('Mobile menu found:', !!mobileMenu);
                console.log('Mobile menu classes:', mobileMenu ? mobileMenu.className : 'N/A');

                if (mobileMenu) {
                    const isHidden = mobileMenu.classList.contains('hidden');
                    console.log('Mobile menu is hidden:', isHidden);

                    if (isHidden) {
                        openMobileMenu(mobileMenu, mobileMenuButton);
                    } else {
                        closeMobileMenu(mobileMenu, mobileMenuButton);
                    }
                } else {
                    console.error('Mobile menu element not found!');
                }
            }

            // Close mobile menu when clicking outside
            if (!event.target.closest('#mobile-menu-button') && !event.target.closest('#mobile-menu')) {
                const mobileMenu = document.getElementById('mobile-menu');
                const mobileMenuButton = document.getElementById('mobile-menu-button');
                if (mobileMenu && !mobileMenu.classList.contains('hidden')) {
                    closeMobileMenu(mobileMenu, mobileMenuButton);
                }
            }

            // Close mobile menu when clicking on menu links
            if (event.target.closest('#mobile-menu a')) {
                const mobileMenu = document.getElementById('mobile-menu');
                const mobileMenuButton = document.getElementById('mobile-menu-button');
                if (mobileMenu) {
                    closeMobileMenu(mobileMenu, mobileMenuButton);
                }
            }
        });

        function openMobileMenu(mobileMenu, mobileMenuButton) {
            if (mobileMenu && mobileMenuButton) {
                mobileMenu.classList.remove('hidden');
                mobileMenuButton.innerHTML = '<span class="material-icons text-[var(--madas-dark-moss)] text-lg">close</span>';
                console.log('Mobile menu opened');
                console.log('Mobile menu content:', mobileMenu.innerHTML.substring(0, 200) + '...');

                // Ensure mobile menu items are populated
                const mobileMenuContainer = mobileMenu.querySelector('.navbar-mobile-menu');
                if (mobileMenuContainer) {
                    console.log('Mobile menu container found:', !!mobileMenuContainer);
                    console.log('Mobile menu items:', mobileMenuContainer.innerHTML);

                    // If no menu items, try to populate them
                    if (!mobileMenuContainer.innerHTML.trim()) {
                        console.log('No mobile menu items found, attempting to populate...');
                        // Find the current section and update its mobile menu
                        const currentSection = document.querySelector('.canvas-section.selected');
                        if (currentSection && window.builder) {
                            window.builder.updateNavbarMenuItems(currentSection);
                        }
                    }
                } else {
                    console.log('Mobile menu container not found');
                }
            }

        }

        // Global error message function
        function showErrorMessage(message) {
            // Create error message element
            const errorDiv = document.createElement('div');
            errorDiv.className = 'fixed top-4 right-4 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 max-w-md';
            errorDiv.innerHTML = `
                <div class="flex items-center gap-2">
                    <span class="material-icons">error</span>
                    <span>${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-2 text-white hover:text-gray-200">
                        <span class="material-icons text-sm">close</span>
                    </button>
                </div>
            `;

            document.body.appendChild(errorDiv);

            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (errorDiv.parentElement) {
                    errorDiv.remove();
                }
            }, 5000);
        }

        // Global success message function
        function showSuccessMessage(message) {
            const successDiv = document.createElement('div');
            successDiv.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 max-w-md';
            successDiv.innerHTML = `
                <div class="flex items-center gap-2">
                    <span class="material-icons">check_circle</span>
                    <span>${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-2 text-white hover:text-gray-200">
                        <span class="material-icons text-sm">close</span>
                    </button>
                </div>
            `;

            document.body.appendChild(successDiv);

            // Auto-remove after 3 seconds
            setTimeout(() => {
                if (successDiv.parentElement) {
                    successDiv.remove();
                }
            }, 3000);
        }

        // Initialize the builder when the page loads
        document.addEventListener('DOMContentLoaded', function () {
            try {
                console.log(' Starting Professional Website Builder...');

                const builder = new ProfessionalBuilder();
                window.builder = builder;

                // Add global error handler
                window.addEventListener('error', function (event) {
                    console.error(' Global error:', event.error);
                    // Don't show error messages for bridge service issues
                    if (!event.error.message.includes('bridgeService') &&
                        !event.error.message.includes('isAuthenticated') &&
                        !event.error.message.includes('runtime.lastError') &&
                        !event.error.message.includes('Could not establish connection')) {
                        showErrorMessage('An error occurred. Please check the console for details.');
                    }
                });

                // Add unhandled promise rejection handler
                window.addEventListener('unhandledrejection', function (event) {
                    console.error(' Unhandled promise rejection:', event.reason);
                    // Don't show error messages for bridge service issues
                    if (!event.reason.message.includes('bridgeService') &&
                        !event.reason.message.includes('isAuthenticated') &&
                        !event.reason.message.includes('runtime.lastError') &&
                        !event.reason.message.includes('Could not establish connection')) {
                        showErrorMessage('An error occurred. Please check the console for details.');
                    }
                    // Prevent the default behavior
                    event.preventDefault();
                });

                console.log(' Builder instance created successfully');
            } catch (error) {
                console.error(' Error creating builder:', error);
                showErrorMessage('Failed to initialize the website builder. Please refresh the page.');
            }

            // Initialize mobile menu
            initializeMobileMenu();

            const initServices = () => {
                try {
                    console.log(' Initializing services...');

                    // Check if required services are available
                    if (window.BridgeService) {
                        // Create bridge service if it doesn't exist
                        if (!window.bridgeService) {
                            window.bridgeService = new BridgeService();
                            console.log(' Bridge service created');
                        }

                        // Wait for bridge service to be initialized
                        if (window.bridgeService && window.bridgeService.isInitialized) {
                            // Ensure bridge service has required methods
                            if (typeof window.bridgeService.isAuthenticated !== 'function') {
                                console.warn(' Bridge service missing isAuthenticated method, adding fallback...');
                                window.bridgeService.isAuthenticated = () => false;
                            }
                            // Initialize other services if available
                            if (window.StorageService) {
                                window.storageService = new StorageService(window.bridgeService);
                                window.storageService.migrateLocalStorageData();
                                console.log(' Storage service initialized');
                            }

                            if (window.PreviewService) {
                                window.previewService = new PreviewService(window.bridgeService);
                                console.log(' Preview service initialized');
                            }

                            if (window.SiteManager) {
                                window.siteManager = new SiteManager(window.bridgeService);
                                console.log(' Site manager initialized');
                            }

                            // Initialize the builder
                            if (typeof builder.init === 'function') {
                                builder.init();
                                console.log(' Builder initialized successfully');
                            } else {
                                console.warn(' Builder init method not found');
                            }

                            console.log(' All services initialized successfully');
                        } else {
                            // Bridge service not ready yet, wait a bit more
                            console.log(' Waiting for bridge service...');
                            setTimeout(initServices, 100);
                        }
                    } else {
                        // BridgeService not ready yet, wait a bit more
                        console.log(' Waiting for BridgeService...');
                        setTimeout(initServices, 100);
                    }
                } catch (error) {
                    console.error(' Error initializing services:', error);
                    // Try again after a short delay
                    setTimeout(initServices, 500);
                }
            };
            initServices();
        });
    </script>
    <script>
        }

        // Close sidebar when clicking outside on mobile
        document.addEventListener('click', (e) => {
            if (window.innerWidth < 1024 &&
                !sidebar.contains(e.target) &&
                !toggleBtn.contains(e.target)) {
                sidebar.classList.add('-translate-x-full');
            }
        });
    </script>

    <script type="module">
        // Use existing Firebase instance from the main script
        const auth = window.auth;
        const db = window.db;

        let currentUserId = null;

        onAuthStateChanged(auth, async (user) => {
            if (!user) {
                window.location.href = "/login";
                return;
            }

            try {
                console.log(' User authenticated:', user.email);

                // ============================================
                // TENANT ISOLATION: Initialize Business Context
                // ============================================

                // Check for super admin users first (bypass business detection)
                const superAdminEmails = [
                    "hesainosama@gmail.com",
                    "test@example.com"
                ];

                if (superAdminEmails.includes(user.email)) {
                    console.log(" Super admin detected - granting full access");
                    window.currentUserRole = "super-admin";
                    window.currentBusinessId = "super-admin";
                    window.currentBusinessData = {
                        businessName: "Super Admin",
                        plan: { type: "enterprise", status: "active" }
                    };

                    // Set super admin permissions
                    const userData = {
                        email: user.email,
                        displayName: user.displayName || "Super Admin",
                        role: "super-admin",
                        approved: true,
                        permissions: {
                            home: ["view"],
                            orders: ["view", "search", "create", "edit"],
                            inventory: ["view", "edit"],
                            customers: ["view", "edit"],
                            employees: ["view", "edit"],
                            finance: ["view", "reports"],
                            analytics: ["view", "export"],
                            settings: ["view", "edit"],
                            admin: ["view", "manage_all_businesses"]
                        }
                    };

                    // Store user data
                    localStorage.setItem("madasUser", JSON.stringify(userData));

                    // Update UI
                    const username = userData.displayName || user.displayName || user.email.split("@")[0];
                    const userNameEl = document.getElementById("user-name");
                    const userEmailEl = document.getElementById("user-email");
                    const userInitialEl = document.getElementById("user-initial");

                    if (userNameEl) userNameEl.textContent = username;
                    if (userEmailEl) userEmailEl.textContent = user.email;
                    if (userInitialEl) userInitialEl.textContent = username.charAt(0).toUpperCase();

                    // Update business name and plan
                    const businessNameEl = document.getElementById("business-name");
                    if (businessNameEl) businessNameEl.textContent = "Super Admin";

                    const planBadge = document.getElementById("plan-badge");
                    if (planBadge) {
                        planBadge.textContent = "Enterprise Plan";
                        planBadge.className = "text-xs px-2 py-0.5 rounded-full bg-purple-100 text-purple-800 hover:bg-purple-200 transition-colors cursor-pointer";
                    }

                    // Hide loading screen if it exists
                    const loadingScreen = document.getElementById('loadingScreen');
                    if (loadingScreen) loadingScreen.style.display = 'none';

                    return;
                }

                // Step 1: Find user's business (check if owner)
                const businessesQuery = query(collection(db, "businesses"), where("owner.userId", "==", user.uid));
                const businessSnapshot = await getDocs(businessesQuery);

                if (!businessSnapshot.empty) {
                    // User is a business owner
                    const businessDoc = businessSnapshot.docs[0];
                    window.currentBusinessId = businessDoc.id;
                    window.currentBusinessData = businessDoc.data();
                    window.currentUserRole = 'owner';

                    console.log(' Business Owner:', window.currentBusinessData.businessName);
                    console.log(' Business ID:', window.currentBusinessId);
                    console.log(' Plan:', window.currentBusinessData.plan?.type);

                } else {
                    // Step 2: Check if user is staff member
                    const allBusinesses = await getDocs(collection(db, "businesses"));
                    let foundBusiness = false;

                    for (const businessDoc of allBusinesses.docs) {
                        const businessId = businessDoc.id;
                        const staffRef = doc(db, 'businesses', businessId, 'staff', user.uid);
                        const staffDoc = await getDoc(staffRef);

                        if (staffDoc.exists()) {
                            const staffData = staffDoc.data();
                            window.currentBusinessId = businessId;
                            window.currentBusinessData = businessDoc.data();
                            window.currentUserRole = staffData.role;
                            window.currentUserPermissions = staffData.permissions;

                            console.log(' Staff Member:', window.currentBusinessData.businessName);
                            console.log(' Business ID:', window.currentBusinessId);
                            console.log(' Role:', window.currentUserRole);

                            foundBusiness = true;
                            break;
                        }
                    }

                    if (!foundBusiness) {
                        console.warn(" User not associated with any business.");
                        console.log(" User email:", user.email);
                        console.log(" User UID:", user.uid);

                        // For now, create a temporary business context for testing
                        console.log(" Creating temporary business context for testing...");
                        window.currentBusinessId = "temp-business";
                        window.currentBusinessData = {
                            businessName: "Temporary Business",
                            plan: { type: "basic", status: "active" },
                            owner: { name: user.displayName || user.email.split("@")[0] }
                        };
                        window.currentUserRole = "owner";

                        // Set basic permissions
                        const userData = {
                            email: user.email,
                            displayName: user.displayName || user.email.split("@")[0],
                            role: "owner",
                            approved: true,
                            permissions: {
                                home: ["view"],
                                orders: ["view", "search", "create", "edit"],
                                inventory: ["view", "edit"],
                                customers: ["view", "edit"],
                                employees: ["view", "edit"],
                                finance: ["view", "reports"],
                                analytics: ["view", "export"],
                                settings: ["view", "edit"]
                            }
                        };

                        // Store user data
                        localStorage.setItem("madasUser", JSON.stringify(userData));

                        // Update UI
                        const username = userData.displayName || user.displayName || user.email.split("@")[0];
                        const userNameEl = document.getElementById("user-name");
                        const userEmailEl = document.getElementById("user-email");
                        const userInitialEl = document.getElementById("user-initial");

                        if (userNameEl) userNameEl.textContent = username;
                        if (userEmailEl) userEmailEl.textContent = user.email;
                        if (userInitialEl) userInitialEl.textContent = username.charAt(0).toUpperCase();

                        // Update business name and plan
                        const businessNameEl = document.getElementById("business-name");
                        if (businessNameEl) businessNameEl.textContent = "Temporary Business";

                        const planBadge = document.getElementById("plan-badge");
                        if (planBadge) {
                            planBadge.textContent = "Basic Plan";
                            planBadge.className = "text-xs px-2 py-0.5 rounded-full bg-green-100 text-green-800 hover:bg-green-200 transition-colors cursor-pointer";
                        }

                        // Hide loading screen if it exists
                        const loadingScreen = document.getElementById('loadingScreen');
                        if (loadingScreen) loadingScreen.style.display = 'none';

                        return;
                    }
                }

                // Set user permissions based on role
                let userData = {
                    email: user.email,
                    displayName: user.displayName || window.currentBusinessData.owner?.name,
                    role: window.currentUserRole,
                    approved: true // All business users are approved by default
                };

                // Set permissions based on role
                if (window.currentUserRole === 'owner') {
                    userData.permissions = {
                        home: ["view"],
                        orders: ["view", "search", "create", "edit"],
                        inventory: ["view", "edit"],
                        customers: ["view", "edit"],
                        employees: ["view", "edit"],
                        finance: ["view", "reports"],
                        analytics: ["view", "export"],
                        settings: ["view", "edit"]
                    };
                } else if (window.currentUserRole === 'admin') {
                    userData.permissions = {
                        home: ["view"],
                        orders: ["view", "search", "create", "edit"],
                        inventory: ["view", "edit"],
                        customers: ["view", "edit"],
                        employees: ["view", "edit"],
                        finance: ["view", "reports"],
                        analytics: ["view", "export"],
                        settings: ["view", "edit"]
                    };
                } else {
                    // For staff members, use permissions from their staff document
                    userData.permissions = window.currentUserPermissions || {
                        home: ["view"]
                    };
                }

                ;
            }

                console.log(' User data created:', {
                email: userData.email,
                role: userData.role,
                businessId: window.currentBusinessId,
                businessName: window.currentBusinessData?.businessName,
                approved: userData.approved
            });

            // Store user data
            localStorage.setItem("madasUser", JSON.stringify(userData));

            // Update UI
            currentUserId = user.uid;
            const username = userData.displayName || window.currentBusinessData?.owner?.name || user.displayName || user.email.split("@")[0];

            // Update user info if elements exist
            const userNameEl = document.getElementById("user-name");
            const userEmailEl = document.getElementById("user-email");
            const userInitialEl = document.getElementById("user-initial");

            if (userNameEl) userNameEl.textContent = username;
            if (userEmailEl) userEmailEl.textContent = user.email;
            if (userInitialEl) userInitialEl.textContent = username.charAt(0).toUpperCase();

            // Update business name and plan
            const businessName = window.currentBusinessData?.businessName || "DIGIX Admin";
            const planType = window.currentBusinessData?.plan?.type || "basic";
            const planStatus = window.currentBusinessData?.plan?.status || "active";

            const businessNameEl = document.getElementById("business-name");
            if (businessNameEl) businessNameEl.textContent = businessName;

            const planBadge = document.getElementById("plan-badge");
            if (planBadge) {
                planBadge.textContent = `${planType.charAt(0).toUpperCase() + planType.slice(1)} Plan`;

                // Set plan badge color based on plan type
                if (planType === 'enterprise') {
                    planBadge.className = "text-xs px-2 py-0.5 rounded-full bg-purple-100 text-purple-800 hover:bg-purple-200 transition-colors cursor-pointer";
                } else if (planType === 'professional') {
                    planBadge.className = "text-xs px-2 py-0.5 rounded-full bg-blue-100 text-blue-800 hover:bg-blue-200 transition-colors cursor-pointer";
                } else {
                    planBadge.className = "text-xs px-2 py-0.5 rounded-full bg-green-100 text-green-800 hover:bg-green-200 transition-colors cursor-pointer";
                }

                // Add trial badge if in trial
                if (planStatus === 'trial') {
                    planBadge.textContent += ' (Trial)';
                }
            }

            // Hide loading screen if it exists
            const loadingScreen = document.getElementById('loadingScreen');
            if (loadingScreen) loadingScreen.style.display = 'none';

        } catch (error) {
            console.error("Permission check failed:", error);
            window.location.href = "/login";
        }
        });

        // Logout logic
        const logoutBtn = document.getElementById("logout-btn");
        if (logoutBtn) {
            logoutBtn.addEventListener("click", () => {
                auth.signOut().then(() => {
                    window.location.href = "/login";
                }).catch((error) => {
                    console.error("Logout error:", error);
                    window.location.href = "/login";
                });
            });
        }

        // Profile button
        const profileBtn = document.getElementById("profile-btn");
        if (profileBtn) {
            profileBtn.addEventListener("click", () => {
                window.location.href = "/pages/profile.html";
            });
        }

        // Finance Dropdown functionality
        const financeDropdownBtn = document.getElementById("finance-dropdown-btn");
        const financeDropdownMenu = document.getElementById("finance-dropdown-menu");
        const financeArrow = document.querySelector("#finance-dropdown-btn .dropdown-arrow");

        if (financeDropdownBtn && financeDropdownMenu) {
            financeDropdownBtn.addEventListener("click", (e) => {
                e.preventDefault();
                const isOpen = financeDropdownMenu.classList.contains("show");

                if (isOpen) {
                    financeDropdownMenu.classList.remove("show");
                    financeDropdownMenu.classList.add("hidden");
                    if (financeArrow) financeArrow.classList.remove("rotate");
                } else {
                    financeDropdownMenu.classList.remove("hidden");
                    financeDropdownMenu.classList.add("show");
                    if (financeArrow) financeArrow.classList.add("rotate");
                }
            });

            // Close dropdown when clicking outside
            document.addEventListener("click", (e) => {
                if (!financeDropdownBtn.contains(e.target) && !financeDropdownMenu.contains(e.target)) {
                    financeDropdownMenu.classList.remove("show");
                    financeDropdownMenu.classList.add("hidden");
                    if (financeArrow) financeArrow.classList.remove("rotate");
                }
            });
        }

        // E-commerce Dropdown functionality
        const ecommerceDropdownBtn = document.getElementById("ecommerce-dropdown-btn");
        const ecommerceDropdownMenu = document.getElementById("ecommerce-dropdown-menu");
        const ecommerceArrow = document.getElementById("ecommerce-arrow");

        if (ecommerceDropdownBtn && ecommerceDropdownMenu) {
            ecommerceDropdownBtn.addEventListener("click", (e) => {
                e.preventDefault();
                const isOpen = ecommerceDropdownMenu.classList.contains("show");

                if (isOpen) {
                    ecommerceDropdownMenu.classList.remove("show");
                    ecommerceDropdownMenu.classList.add("hidden");
                    if (ecommerceArrow) ecommerceArrow.classList.remove("rotate");
                } else {
                    ecommerceDropdownMenu.classList.remove("hidden");
                    ecommerceDropdownMenu.classList.add("show");
                    if (ecommerceArrow) ecommerceArrow.classList.add("rotate");
                }
            });
        }

        // Dark mode toggle logic
        const darkToggle = document.getElementById('darkToggle');
        const darkIcon = document.getElementById('darkToggleIcon');
        function setDarkMode(on) {
            document.body.classList.toggle('dark-mode', on);
            localStorage.setItem('dark-mode', on ? '1' : '0');
            if (on) {
                darkIcon.innerHTML = '<path d="M21.64 13.64A9 9 0 1 1 10.36 2.36a7 7 0 1 0 11.28 11.28z"/>';
            } else {
                darkIcon.innerHTML = '<path d="M12 2a1 1 0 0 1 1 1v1a1 1 0 1 1-2 0V3a1 1 0 0 1 1-1zm5.657 3.343a1 1 0 0 1 1.414 0l.707.707a1 1 0 1 1-1.414 1.414l-.707-.707a1 1 0 0 1 0-1.414zM21 11a1 1 0 1 1 0 2h-1a1 1 0 1 1 0-2h1zm-2.929 7.071a1 1 0 0 1 0 1.414l-.707.707a1 1 0 1 1-1.414-1.414l.707-.707a1 1 0 0 1 1.414 0zM12 20a1 1 0 0 1-1-1v-1a1 1 0 1 1 2 0v1a1 1 0 0 1-1 1zm-7.071-2.929a1 1 0 0 1-1.414 0l-.707-.707a1 1 0 1 1 1.414-1.414l.707.707a1 1 0 0 1 0 1.414zM4 13a1 1 0 1 1 0-2H3a1 1 0 1 1 0 2h1zm2.343-7.657a1 1 0 0 1 0 1.414l-.707.707A1 1 0 1 1 4.222 6.05l.707-.707a1 1 0 0 1 1.414 0zM12 6a6 6 0 1 1 0 12A6 6 0 0 1 12 6z" />';
            }
        }
        if (darkToggle) {
            darkToggle.addEventListener('click', () => {
                setDarkMode(!document.body.classList.contains('dark-mode'));
            });
        }
        if (localStorage.getItem('dark-mode') === '1') {
            setDarkMode(true);
        }

        // Inventory Dropdown functionality
        document.addEventListener("DOMContentLoaded", () => {
            const inventoryToggle = document.getElementById("inventory-toggle");
            const inventorySubmenu = document.getElementById("inventory-submenu");
            const inventoryArrow = document.getElementById("inventory-arrow");

            if (inventoryToggle && inventorySubmenu && inventoryArrow) {
                inventoryToggle.addEventListener("click", (e) => {
                    e.preventDefault();
                    const isOpen = !inventorySubmenu.classList.contains("hidden");

                    if (isOpen) {
                        inventorySubmenu.classList.add("hidden");
                        inventoryArrow.style.transform = "rotate(0deg)";
                    } else {
                        inventorySubmenu.classList.remove("hidden");
                        inventoryArrow.style.transform = "rotate(180deg)";
                    }
                });
            }
        });

        // Active Page Highlighting and Dropdown Management
        function highlightActivePage() {
            // Remove all active classes first
            document.querySelectorAll('.sidebar-link').forEach(link => {
                link.classList.remove('active');
            });

            // Get current page path
            const currentPath = window.location.pathname;
            const currentPageName = window.location.pathname.split('/').pop().replace('.html', '');

            console.log('Current path:', currentPath);
            console.log('Current page name:', currentPageName);

            // DASHBOARD LINK - Handle separately and FIRST
            const dashboardLink = document.querySelector('a[href="/dashboard"]');
            if (dashboardLink) {
                console.log(' Checking Dashboard link for path:', currentPath);
                console.log(' Current path details:', {
                    path: currentPath,
                    endsWithIndex: currentPath.endsWith('index.html'),
                    includesPages: currentPath.includes('pages'),
                    isRoot: currentPath === '/',
                    isDashboard: currentPath === '/dashboard'
                });

                // Dashboard should ONLY be active on dashboard page
                const isDashboardPage = (
                    currentPath === '/' ||
                    currentPath === '/dashboard' ||
                    currentPath === '/dashboard/' ||
                    currentPath.endsWith('/dashboard/index.html') ||
                    currentPath.endsWith('/index.html') ||
                    (currentPath.includes('index.html') && !currentPath.includes('pages')) ||
                    currentPath.startsWith('/dashboard') && !currentPath.includes('/pages')
                );

                if (isDashboardPage) {
                    dashboardLink.classList.add('active');
                    foundMatch = true;
                    console.log(' Dashboard page detected and highlighted for path:', currentPath);
                } else {
                    dashboardLink.classList.remove('active');
                    console.log(' Dashboard link NOT highlighted for path:', currentPath);
                }
            }

            // OTHER LINKS - Handle all other links
            sidebarLinks.forEach(link => {
                const href = link.getAttribute('href');
                if (!href || href === '#') return;

                // Skip Dashboard link - already handled above
                if (href === '/dashboard') return;

                // COMPLETELY DISABLE Dashboard highlighting on non-dashboard pages
                // Handle Dashboard link with PRECISE matching
                if (href === '/dashboard') {
                    // Dashboard should ONLY be active on dashboard page
                    const isDashboardPage = (
                        currentPath === '/' ||
                        currentPath === '/dashboard' ||
                        currentPath === '/dashboard/' ||
                        currentPath.endsWith('/dashboard/index.html') ||
                        currentPath.endsWith('/index.html') ||
                        (currentPath.includes('index.html') && !currentPath.includes('pages')) ||
                        currentPath.startsWith('/dashboard') && !currentPath.includes('/pages')
                    );
                    foundMatch = true;
                    console.log('Dashboard page detected and highlighted');
                }
            }
                }

                // Handle other links with normal matching
                else {
            // Check if current path matches this specific link
            if (currentPath === href || currentPath.endsWith(href.replace('/dashboard', ''))) {
                link.classList.add('active');
                foundMatch = true;
                console.log('Exact match found:', href);
            }
            // Check page name matching for other links
            else if (!foundMatch) {
                const linkPageName = href.split('/').pop().replace('.html', '');
                if (currentPageName === linkPageName ||
                    (currentPageName && currentPageName.toLowerCase().includes(linkPageName.toLowerCase())) ||
                    (linkPageName && linkPageName.toLowerCase().includes(currentPageName.toLowerCase()))) {
                    link.classList.add('active');
                    foundMatch = true;
                    console.log('Page name match found:', href, 'for page:', currentPageName);
                }
            }
        }
            });

        // Special cases for specific pages with dropdown management
        if (currentPath.includes('collections') || currentPageName === 'collections') {
            const collectionsLink = document.querySelector('a[href*="collections"]');
            if (collectionsLink) {
                collectionsLink.classList.add('active');
                foundMatch = true;
                console.log('Collections page detected');

                // Keep inventory dropdown open
                const inventoryDropdown = document.getElementById('inventory-submenu');
                const inventoryArrow = document.getElementById('inventory-arrow');
                if (inventoryDropdown && inventoryArrow) {
                    inventoryDropdown.classList.remove('hidden');
                    inventoryArrow.style.transform = 'rotate(180deg)';
                    console.log('Inventory dropdown kept open for collections');
                }
            }
        }

        if (currentPath.includes('products') || currentPageName === 'products') {
            const productsLink = document.querySelector('a[href*="products"]');
            if (productsLink) {
                productsLink.classList.add('active');
                foundMatch = true;
                console.log('Products page detected');

                // Keep inventory dropdown open
                const inventoryDropdown = document.getElementById('inventory-submenu');
                const inventoryArrow = document.getElementById('inventory-arrow');
                if (inventoryDropdown && inventoryArrow) {
                    inventoryDropdown.classList.remove('hidden');
                    inventoryArrow.style.transform = 'rotate(180deg)';
                    console.log('Inventory dropdown kept open for products');
                }
            }
        }

        if (currentPath.includes('low-stock') || currentPageName === 'low-stock') {
            const lowStockLink = document.querySelector('a[href*="low-stock"]');
            if (lowStockLink) {
                lowStockLink.classList.add('active');
                foundMatch = true;
                console.log('Low Stock page detected');

                // Keep inventory dropdown open
                const inventoryDropdown = document.getElementById('inventory-submenu');
                const inventoryArrow = document.getElementById('inventory-arrow');
                if (inventoryDropdown && inventoryArrow) {
                    inventoryDropdown.classList.remove('hidden');
                    inventoryArrow.style.transform = 'rotate(180deg)';
                    console.log('Inventory dropdown kept open for low-stock');
                }
            }
        }

        if (currentPath.includes('product-reviews') || currentPageName === 'reviews') {
            const reviewsLink = document.querySelector('a[href*="product-reviews"]');
            if (reviewsLink) {
                reviewsLink.classList.add('active');
                foundMatch = true;
                console.log('Reviews page detected');

                // Keep inventory dropdown open
                const inventoryDropdown = document.getElementById('inventory-submenu');
                const inventoryArrow = document.getElementById('inventory-arrow');
                if (inventoryDropdown && inventoryArrow) {
                    inventoryDropdown.classList.remove('hidden');
                    inventoryArrow.style.transform = 'rotate(180deg)';
                    console.log('Inventory dropdown kept open for reviews');
                }
            }
        }

        if (currentPath.includes('orders') || currentPageName === 'orders') {
            const ordersLink = document.querySelector('a[href*="orders"]');
            if (ordersLink) {
                ordersLink.classList.add('active');
                foundMatch = true;
                console.log('Orders page detected');
            }
        }

        if (currentPath.includes('Customer') || currentPageName === 'Customer') {
            const customerLink = document.querySelector('a[href*="Customer"]');
            if (customerLink) {
                customerLink.classList.add('active');
                foundMatch = true;
                console.log('Customer page detected');
            }
        }

        if (currentPath.includes('Admin') || currentPageName === 'Admin') {
            const adminLink = document.querySelector('a[href*="Admin"]');
            if (adminLink) {
                adminLink.classList.add('active');
                foundMatch = true;
                console.log('Admin page detected');
            }
        }

        if (currentPath.includes('settings') || currentPageName === 'settings') {
            const settingsLink = document.querySelector('a[href*="settings"]');
            if (settingsLink) {
                settingsLink.classList.add('active');
                foundMatch = true;
                console.log('Settings page detected');
            }
        }

        if (currentPath.includes('finance') || currentPageName === 'finance') {
            const financeLink = document.querySelector('a[href*="finance"]');
            if (financeLink) {
                financeLink.classList.add('active');
                foundMatch = true;
                console.log('Finance page detected');

                // Keep finance dropdown open
                const financeDropdown = document.getElementById('finance-dropdown-menu');
                const financeArrow = document.querySelector('#finance-dropdown-btn .dropdown-arrow');
                if (financeDropdown && financeArrow) {
                    financeDropdown.classList.remove('hidden');
                    financeDropdown.classList.add('show');
                    financeArrow.classList.add('rotated');
                    console.log('Finance dropdown kept open for finance page');
                }
            }
        }

        if (currentPath.includes('analytics') || currentPageName === 'analytics') {
            const analyticsLink = document.querySelector('a[href*="analytics"]');
            if (analyticsLink) {
                analyticsLink.classList.add('active');
                foundMatch = true;
                console.log('Analytics page detected');

                // Keep finance dropdown open
                const financeDropdown = document.getElementById('finance-dropdown-menu');
                const financeArrow = document.querySelector('#finance-dropdown-btn .dropdown-arrow');
                if (financeDropdown && financeArrow) {
                    financeDropdown.classList.remove('hidden');
                    financeDropdown.classList.add('show');
                    financeArrow.classList.add('rotated');
                    console.log('Finance dropdown kept open for analytics');
                }
            }
        }

        if (currentPath.includes('reports') || currentPageName === 'reports') {
            const reportsLink = document.querySelector('a[href*="reports"]');
            if (reportsLink) {
                reportsLink.classList.add('active');
                foundMatch = true;
                console.log('Reports page detected');

                // Keep finance dropdown open
                const financeDropdown = document.getElementById('finance-dropdown-menu');
                const financeArrow = document.querySelector('#finance-dropdown-btn .dropdown-arrow');
                if (financeDropdown && financeArrow) {
                    financeDropdown.classList.remove('hidden');
                    financeDropdown.classList.add('show');
                    financeArrow.classList.add('rotated');
                    console.log('Finance dropdown kept open for reports');
                }
            }
        }

        if (currentPath.includes('insights') || currentPageName === 'insights') {
            const insightsLink = document.querySelector('a[href*="insights"]');
            if (insightsLink) {
                insightsLink.classList.add('active');
                foundMatch = true;
                console.log('Insights page detected');

                // Keep finance dropdown open
                const financeDropdown = document.getElementById('finance-dropdown-menu');
                const financeArrow = document.querySelector('#finance-dropdown-btn .dropdown-arrow');
                if (financeDropdown && financeArrow) {
                    financeDropdown.classList.remove('hidden');
                    financeDropdown.classList.add('show');
                    financeArrow.classList.add('rotated');
                    console.log('Finance dropdown kept open for insights');
                }
            }
        }

        if (currentPath.includes('expenses') || currentPageName === 'expenses') {
            const expensesLink = document.querySelector('a[href*="expenses"]');
            if (expensesLink) {
                expensesLink.classList.add('active');
                foundMatch = true;
                console.log('Expenses page detected');

                // Keep finance dropdown open
                const financeDropdown = document.getElementById('finance-dropdown-menu');
                const financeArrow = document.querySelector('#finance-dropdown-btn .dropdown-arrow');
                if (financeDropdown && financeArrow) {
                    financeDropdown.classList.remove('hidden');
                    financeDropdown.classList.add('show');
                    financeArrow.classList.add('rotated');
                    console.log('Finance dropdown kept open for expenses');
                }
            }
        }

        if (currentPath.includes('pos') || currentPageName === 'pos') {
            const posLink = document.querySelector('a[href*="pos"]');
            if (posLink) {
                posLink.classList.add('active');
                foundMatch = true;
                console.log('POS page detected');
            }
        }
        }

        // Run on page load
        document.addEventListener('DOMContentLoaded', highlightActivePage);

        // Also run when navigation changes (for SPA-like behavior)
        window.addEventListener('popstate', highlightActivePage);

    </script>
</body>
<script src="/js/sidebar.js"></script>

</html>